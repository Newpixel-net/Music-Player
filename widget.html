<body>
 <div class="bg-animation">
 <div class="wave"></div>
 <div class="wave"></div>
 <div class="wave"></div>
 <div class="particles" id="particles"></div>
 </div>

 <!-- Settings Button -->
 <button class="settings-btn" id="settingsBtn">
 <svg viewBox="0 0 24 24">
 <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
 </svg>
 </button>

 <!-- Settings Modal -->
 <div class="settings-modal-overlay" id="settingsModalOverlay">
 <div class="settings-modal">
 <div class="settings-header">
 <div class="settings-title">
 <span>âš™ï¸</span>
 <span>Settings</span>
 </div>
 <button class="settings-close" id="closeSettingsModal">Close</button>
 </div>
 <div class="settings-body">
 <div class="setting-group">
 <div class="setting-label">
 <span>ğŸ›ï¸</span>
 <span>Display Options</span>
 </div>
 <div class="setting-row">
 <div class="setting-info">
 <div class="setting-name">Sticky Controls</div>
 <div class="setting-desc">Show playback controls at bottom of screen</div>
 </div>
 <label class="toggle-switch">
 <input type="checkbox" id="toggleStickyControls" checked>
 <span class="toggle-slider"></span>
 </label>
 </div>
 <div class="setting-row">
 <div class="setting-info">
 <div class="setting-name">Music Visualizer</div>
 <div class="setting-desc">Show animated bars in sticky controls</div>
 </div>
 <label class="toggle-switch">
 <input type="checkbox" id="toggleVisualizer" checked>
 <span class="toggle-slider"></span>
 </label>
 </div>
 <div class="setting-row">
 <div class="setting-info">
 <div class="setting-name">Background Animations</div>
 <div class="setting-desc">Enable animated particles and waves</div>
 </div>
 <label class="toggle-switch">
 <input type="checkbox" id="toggleBackgroundAnim" checked>
 <span class="toggle-slider"></span>
 </label>
 </div>
 </div>

 <div class="setting-group">
 <div class="setting-label">
 <span>ğŸ¬</span>
 <span>Floating Player</span>
 </div>
 <div class="setting-description">
 The floating player can be dragged anywhere on screen and stays visible while browsing.
 For true picture-in-picture mode that works when minimized, try the "Pop-out Window" button in the floating player.
 </div>
 <div class="setting-row">
 <div class="setting-info">
 <div class="setting-name">Enable Floating Player</div>
 <div class="setting-desc">Show draggable video player overlay</div>
 </div>
 <label class="toggle-switch">
 <input type="checkbox" id="toggleFloatingPlayer">
 <span class="toggle-slider"></span>
 </label>
 </div>
 </div>

 <div class="setting-group">
 <div class="setting-label">
 <span>â„¹ï¸</span>
 <span>About</span>
 </div>
 <div class="setting-description">
 Universal Music Player Pro - Enhanced Edition<br>
 Features: Community Library, Mood System, Music Visualizer, Floating Player<br>
 <strong style="color: #43e97b;">ğŸŒ Firebase Connected</strong> - Share playlists with the world!
 </div>
 </div>
 </div>
 </div>
 </div>

 <!-- Floating Mini Player -->
 <div class="floating-player" id="floatingPlayer">
 <div class="floating-player-header">
 <div class="floating-player-title">
 <span>ğŸµ</span>
 <span>Now Playing</span>
 </div>
 <div class="floating-player-actions">
 <button class="floating-action-btn" id="popoutWindowBtn" title="Open in new window">
 <span>â§‰</span>
 </button>
 <button class="floating-action-btn" id="closeFloatingPlayer">Ã—</button>
 </div>
 </div>
 <div class="floating-player-video">
 <div id="floatingPlayerFrame"></div>
 </div>
 <div class="floating-player-info">
 <div class="floating-player-song" id="floatingSongTitle">No Track</div>
 <div class="floating-player-artist" id="floatingArtistName">Select a song</div>
 </div>
 <div class="floating-player-controls">
 <button class="floating-control-btn" id="floatingPrevBtn">
 <svg viewBox="0 0 24 24">
 <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
 </svg>
 </button>
 <button class="floating-control-btn large" id="floatingPlayPauseBtn">
 <svg viewBox="0 0 24 24">
 <path d="M8 5v14l11-7z"/>
 </svg>
 </button>
 <button class="floating-control-btn" id="floatingNextBtn">
 <svg viewBox="0 0 24 24">
 <path d="M16 18h2V6h-2v12zm-11-7l8.5-6v12z"/>
 </svg>
 </button>
 </div>
 </div>

 <!-- Sticky Control Bar with Visualizer -->
 <div class="sticky-controls" id="stickyControls">
 <div class="sticky-info">
 <div class="sticky-thumb" id="stickyThumb">
 <div class="playlist-thumb-placeholder">ğŸµ</div>
 </div>
 <div class="sticky-text">
 <div class="sticky-song" id="stickySongTitle">No Track</div>
 <div class="sticky-artist" id="stickyArtistName">Select a song</div>
 </div>
 </div>
 
 <!-- Music Visualizer -->
 <div class="music-visualizer paused" id="musicVisualizer">
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 </div>
 
 <div class="sticky-controls-buttons">
 <button class="sticky-btn" id="stickyPrevBtn">
 <svg viewBox="0 0 24 24">
 <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
 </svg>
 </button>
 <button class="sticky-btn large" id="stickyPlayPauseBtn">
 <svg viewBox="0 0 24 24">
 <path d="M8 5v14l11-7z"/>
 </svg>
 </button>
 <button class="sticky-btn" id="stickyNextBtn">
 <svg viewBox="0 0 24 24">
 <path d="M16 18h2V6h-2v12zm-11-7l8.5-6v12z"/>
 </svg>
 </button>
 </div>
 </div>

 <div class="player-wrapper">
 <div class="music-player">
 <!-- Top Bar with Title and Volume -->
 <div class="top-bar">
 <div class="app-title">
 <span>ğŸµ</span>
 <span>Music Player Pro</span>
 </div>
 <div class="volume-control-top">
 <button class="control-btn small" id="volumeBtn">
 <svg viewBox="0 0 24 24" id="volumeIcon">
 <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
 </svg>
 <svg viewBox="0 0 24 24" id="muteIcon" style="display: none;">
 <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
 </svg>
 </button>
 <div class="volume-slider-top" id="volumeSlider">
 <div class="volume-fill-top" id="volumeFill"></div>
 </div>
 </div>
 </div>

 <!-- Mood Selector -->
 <div class="mood-section">
 <div class="mood-header">
 <h2 class="mood-title">ğŸ­ Mood</h2>
 <button class="mood-help-btn" id="moodHelpBtn" title="View all moods">?</button>
 </div>
 <div class="random-buttons-row">
 <button class="random-btn random-btn-mood" id="randomMoodBtn" title="Apply random mood">
 ğŸ² Mood
 </button>
 <button class="random-btn random-btn-atmosphere" id="randomAtmosphereBtn" title="Apply random atmosphere">
 ğŸ² Atmosphere
 </button>
 <button class="random-btn random-btn-bg" id="randomBgBtn" title="Apply random background effects">
 ğŸ² BG Effects
 </button>
 </div>
 <div class="mood-selector-wrapper">
 <button class="mood-nav-btn mood-nav-left" id="moodNavLeft">
 <svg viewBox="0 0 24 24" width="20" height="20">
 <path fill="currentColor" d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
 </svg>
 </button>
 <div class="mood-selector" id="moodSelector">
 <div class="mood-option active" data-mood="default" title="Default Vibes"></div>
 <div class="mood-option" data-mood="sunset" title="Sunset Chill"></div>
 <div class="mood-option" data-mood="ocean" title="Ocean Waves"></div>
 <div class="mood-option" data-mood="forest" title="Forest Calm"></div>
 <div class="mood-option" data-mood="midnight" title="Midnight Dreams"></div>
 <div class="mood-option" data-mood="aurora" title="Aurora Lights"></div>
 <div class="mood-option" data-mood="candy" title="Candy Pop"></div>
 <div class="mood-option" data-mood="neon" title="Neon Nights"></div>
 <div class="mood-option" data-mood="tropical" title="Tropical Heat"></div>
 <div class="mood-option" data-mood="cosmic" title="Cosmic Journey"></div>
 <div class="mood-option" data-mood="plasma" title="Plasma Orbs"></div>
 <div class="mood-option" data-mood="starfield" title="Starfield"></div>
 <div class="mood-option" data-mood="lava" title="Lava Bubbles"></div>
 <div class="mood-option" data-mood="electric" title="Electric Storm"></div>
 <div class="mood-option" data-mood="matrix" title="Matrix Code"></div>
 <div class="mood-option" data-mood="rainbow" title="Rainbow Shimmer"></div>
 <div class="mood-option" data-mood="vaporwave" title="Vaporwave Grid"></div>
 <div class="mood-option" data-mood="fire" title="Rising Flames"></div>
 <div class="mood-option" data-mood="cyberpunk" title="Cyberpunk Glitch"></div>
 <div class="mood-option" data-mood="galaxy" title="Galaxy Nebula"></div>
 <div class="mood-option" data-mood="glitch" title="RGB Glitch"></div>
 <div class="mood-option" data-mood="lightning" title="Lightning Storm"></div>
 <div class="mood-option" data-mood="pulse" title="Heartbeat Pulse"></div>
 <div class="mood-option" data-mood="prism" title="Prism Refraction"></div>
 <div class="mood-option" data-mood="hologram" title="Hologram Scan"></div>
 <div class="mood-option" data-mood="laser" title="Laser Beams"></div>
 <div class="mood-option" data-mood="warp" title="Warp Speed"></div>
 <div class="mood-option" data-mood="disco" title="Disco Lights"></div>
 <div class="mood-option" data-mood="nuclear" title="Nuclear Glow"></div>
 <div class="mood-option" data-mood="supernova" title="Supernova Explosion"></div>
 <div class="mood-option" data-mood="oceanic" title="Oceanic Depths"></div>
 <div class="mood-option" data-mood="desert" title="Desert Sunset"></div>
 <div class="mood-option" data-mood="arctic" title="Arctic Freeze"></div>
 <div class="mood-option" data-mood="jungle" title="Jungle Night"></div>
 <div class="mood-option" data-mood="cherry" title="Cherry Blossom"></div>
 <div class="mood-option" data-mood="thunder" title="Thunderstorm"></div>
 <div class="mood-option" data-mood="mystic" title="Mystic Forest"></div>
 <div class="mood-option" data-mood="cybergrid" title="Cyber Grid"></div>
 <div class="mood-option" data-mood="royal" title="Royal Purple"></div>
 <div class="mood-option" data-mood="golden" title="Golden Hour"></div>
 <div class="mood-option" data-mood="nebula" title="Nebula Dream"></div>
 <div class="mood-option" data-mood="crimson" title="Crimson Tide"></div>
 <div class="mood-option" data-mood="emerald" title="Emerald City"></div>
 <div class="mood-option" data-mood="solar" title="Solar Flare"></div>
 <div class="mood-option" data-mood="moonlight" title="Moonlight Serenade"></div>
 <div class="mood-option" data-mood="sakura" title="Sakura Blossoms"></div>
 <div class="mood-option" data-mood="volcano" title="Volcano Lava"></div>
 <div class="mood-option" data-mood="arcticaurora" title="Arctic Aurora"></div>
 <div class="mood-option" data-mood="amethyst" title="Amethyst Crystal"></div>
 <div class="mood-option" data-mood="emeraldforest" title="Emerald Forest"></div>
 <div class="mood-option" data-mood="sunsetbeach" title="Sunset Beach"></div>
 <div class="mood-option" data-mood="deepocean" title="Deep Ocean"></div>
 <div class="mood-option" data-mood="rosegold" title="Rose Gold"></div>
 <div class="mood-option" data-mood="cosmos" title="Cosmos"></div>
 <div class="mood-option" data-mood="phoenix" title="Phoenix Flame"></div>
 </div>
 <button class="mood-nav-btn mood-nav-right" id="moodNavRight">
 <svg viewBox="0 0 24 24" width="20" height="20">
 <path fill="currentColor" d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
 </svg>
 </button>
 </div>

 <!-- Background Effects Button -->
 <button class="mood-effects-btn" id="moodEffectsBtn" title="Background Effects">âœ¨</button>
 </div>

 <!-- Background Effects Popup - Moved outside mood-section to fix transparency -->
 <div class="mood-effects-popup" id="moodEffectsPopup">
 <div class="mood-effects-header">
 <div class="mood-effects-title">âœ¨ Background Effects</div>
 </div>
 <div class="mood-effects-body">
 <!-- Controls -->
 <div class="effect-controls">
 <div class="effect-control-group">
 <label class="effect-control-label">Speed: <span id="effectSpeedValue">1x</span></label>
 <input type="range" class="effect-slider" id="effectSpeed" min="0.5" max="3" step="0.1" value="1">
 </div>
 <div class="effect-control-group">
 <label class="effect-control-label">Intensity: <span id="effectIntensityValue">50%</span></label>
 <input type="range" class="effect-slider" id="effectIntensity" min="0" max="100" step="5" value="50">
 </div>
 </div>

 <!-- Style Customization -->
 <div class="effect-category">
 <div class="effect-category-title" data-category="style">ğŸ¨ Style Customization <span>â–¼</span></div>
 <div class="effect-options expanded" id="styleEffects" style="grid-template-columns: 1fr;">
 <div class="style-control">
 <label>ğŸ¨ Background Color</label>
 <input type="color" id="bgColor" value="#f8f8f8">
 </div>
 <div class="style-control">
 <label>ğŸµ Audio Textures</label>
 <div class="texture-grid">
 <button class="texture-btn active" data-texture="none" title="No Texture">
 <span class="texture-none-icon">âœ•</span>
 </button>
 <button class="texture-btn texture-speaker-grille" data-texture="speaker-grille" title="Speaker Grille"></button>
 <button class="texture-btn texture-sound-waves" data-texture="sound-waves" title="Sound Waves"></button>
 <button class="texture-btn texture-equalizer" data-texture="equalizer" title="Equalizer Bars"></button>
 <button class="texture-btn texture-waveform" data-texture="waveform" title="Waveform"></button>
 <button class="texture-btn texture-bass-ripples" data-texture="bass-ripples" title="Bass Ripples"></button>
 <button class="texture-btn texture-studio-foam" data-texture="studio-foam" title="Studio Foam"></button>
 <button class="texture-btn texture-audio-jack" data-texture="audio-jack" title="Audio Jack"></button>
 <button class="texture-btn texture-mic-mesh" data-texture="mic-mesh" title="Microphone Mesh"></button>
 <button class="texture-btn texture-piano-keys" data-texture="piano-keys" title="Piano Keys"></button>
 <button class="texture-btn texture-guitar-strings" data-texture="guitar-strings" title="Guitar Strings"></button>
 <button class="texture-btn texture-drum-skin" data-texture="drum-skin" title="Drum Skin"></button>
 <button class="texture-btn texture-foam-pyramids" data-texture="foam-pyramids" title="Foam Pyramids"></button>
 <button class="texture-btn texture-xlr-connector" data-texture="xlr-connector" title="XLR Connector"></button>
 <button class="texture-btn texture-cassette-tape" data-texture="cassette-tape" title="Cassette Tape"></button>
 <button class="texture-btn texture-cd-diffraction" data-texture="cd-diffraction" title="CD Diffraction"></button>
 <button class="texture-btn texture-mixing-console" data-texture="mixing-console" title="Mixing Console"></button>
 <button class="texture-btn texture-frequency-spectrum" data-texture="frequency-spectrum" title="Frequency Spectrum"></button>
 <button class="texture-btn texture-oscilloscope" data-texture="oscilloscope" title="Oscilloscope"></button>
 <button class="texture-btn texture-soundwave-circular" data-texture="soundwave-circular" title="Circular Sound Waves"></button>
 <button class="texture-btn texture-amplitude-pulse" data-texture="amplitude-pulse" title="Amplitude Pulse"></button>
 <button class="texture-btn texture-stereo-waves" data-texture="stereo-waves" title="Stereo Waves"></button>
 <button class="texture-btn texture-frequency-rings" data-texture="frequency-rings" title="Frequency Rings"></button>
 <button class="texture-btn texture-audio-spectrum-3d" data-texture="audio-spectrum-3d" title="3D Audio Spectrum"></button>
 <button class="texture-btn texture-sine-waves" data-texture="sine-waves" title="Sine Waves"></button>
 <button class="texture-btn texture-beat-grid" data-texture="beat-grid" title="Beat Grid"></button>
 <button class="texture-btn texture-harmonic-waves" data-texture="harmonic-waves" title="Harmonic Waves"></button>
 </div>
 </div>
 <div class="style-control">
 <label>Opacity: <span id="bgOpacityValue">100%</span></label>
 <input type="range" class="effect-slider" id="bgOpacity" min="0" max="100" value="100">
 </div>
 <div class="style-control">
 <label>Blur: <span id="bgBlurValue">0px</span></label>
 <input type="range" class="effect-slider" id="bgBlur" min="0" max="20" value="0">
 </div>
 <div class="style-control">
 <label>Border Radius: <span id="borderRadiusValue">12px</span></label>
 <input type="range" class="effect-slider" id="borderRadius" min="0" max="50" value="12">
 </div>
 <div class="style-control">
 <label>Shadow Depth: <span id="bgShadowDepthValue">0px</span></label>
 <input type="range" class="effect-slider" id="bgShadowDepth" min="0" max="30" value="0">
 </div>
 <div class="style-control">
 <label>Border Glow: <span id="bgBorderGlowValue">0px</span></label>
 <input type="range" class="effect-slider" id="bgBorderGlow" min="0" max="10" value="0">
 <input type="color" id="bgBorderGlowColor" value="#667eea">
 </div>
 </div>
 </div>

 <!-- Pulse Effects -->
 <div class="effect-category">
 <div class="effect-category-title" data-category="pulse">ğŸµ Pulse Effects <span>â–¼</span></div>
 <div class="effect-options expanded" id="pulseEffects">
 <button class="effect-btn" data-effect="heartbeat">ğŸ’“ Heartbeat</button>
 <button class="effect-btn" data-effect="flash">âš¡ Flash</button>
 <button class="effect-btn" data-effect="glowpulse">ğŸ’« Glow Pulse</button>
 <button class="effect-btn" data-effect="scalebounce">ğŸ¯ Scale Bounce</button>
 <button class="effect-btn" data-effect="breathe">ğŸŒ¬ï¸ Breathe</button>
 <button class="effect-btn" data-effect="beatdrop">ğŸ’¥ Beat Drop</button>
 </div>
 </div>

 <!-- Motion Effects -->
 <div class="effect-category">
 <div class="effect-category-title" data-category="motion">ğŸŒŠ Motion Effects <span>â–¼</span></div>
 <div class="effect-options" id="motionEffects">
 <button class="effect-btn" data-effect="shake">ğŸ“³ Shake</button>
 <button class="effect-btn" data-effect="sway">ğŸ Sway</button>
 <button class="effect-btn" data-effect="float">â˜ï¸ Float</button>
 <button class="effect-btn" data-effect="wobble">ğŸŒ€ Wobble</button>
 <button class="effect-btn" data-effect="tilt3d">ğŸ² Tilt 3D</button>
 </div>
 </div>

 <!-- Visual FX -->
 <div class="effect-category">
 <div class="effect-category-title" data-category="visual">âœ¨ Visual FX <span>â–¼</span></div>
 <div class="effect-options" id="visualEffects">
 <button class="effect-btn" data-effect="flicker">ğŸ“º Flicker</button>
 <button class="effect-btn" data-effect="glitch">âš ï¸ Glitch</button>
 <button class="effect-btn" data-effect="rgbsplit">ğŸŒˆ RGB Split</button>
 <button class="effect-btn" data-effect="wavemotion">ğŸŒŠ Wave Motion</button>
 <button class="effect-btn" data-effect="ripple">ğŸ’§ Ripple</button>
 <button class="effect-btn" data-effect="prism">ğŸ”® Prism</button>
 </div>
 </div>

 <!-- Border Effects -->
 <div class="effect-category">
 <div class="effect-category-title" data-category="border">ğŸ¨ Border Effects <span>â–¼</span></div>
 <div class="effect-options" id="borderEffects">
 <button class="effect-btn" data-effect="borderpulse">ğŸ’  Border Pulse</button>
 <button class="effect-btn" data-effect="neonglow">ğŸ’¡ Neon Glow</button>
 <button class="effect-btn" data-effect="rainbowborder">ğŸŒˆ Rainbow</button>
 <button class="effect-btn" data-effect="shadowdance">ğŸ•´ï¸ Shadow Dance</button>
 <button class="effect-btn" data-effect="electricedges">âš¡ Electric Edges</button>
 </div>
 </div>

 <button class="effect-reset-btn" id="effectResetBtn">ğŸ”„ Reset All Effects</button>
 </div>
 </div>

 <!-- Playlist Tabs with Sticky + Button -->
 <div class="playlist-tabs-wrapper">
 <div class="playlist-tabs-container" id="playlistTabs"></div>
 <button class="add-playlist-btn" id="addPlaylistBtn">+</button>
 </div>

 <!-- Import Playlist Button -->
 <button class="import-playlist-btn" id="importPlaylistBtn">
 <span>â–¶ï¸</span>
 <span>Import YouTube Playlist</span>
 </button>

 <!-- Floating Player Controls -->
 <div class="pip-controls">
 <button class="pip-btn" id="floatingPlayerBtn" style="flex: 1;">
 <span>ğŸ“º</span>
 <span>Floating Video Player</span>
 </button>
 </div>

 <!-- YouTube Video Player -->
 <div class="video-player-container">
 <div id="player"></div>
 </div>

 <!-- Song Info -->
 <div class="song-info">
 <div class="song-title" id="songTitle">No Tracks</div>
 <div class="artist-name" id="artistName">Import a playlist to begin</div>
 </div>

 <!-- Progress Bar -->
 <div class="progress-container">
 <div class="progress-bar" id="progressBar">
 <div class="progress-fill" id="progressFill"></div>
 </div>
 <div class="time-display">
 <span id="currentTime">0:00</span>
 <span id="totalTime">0:00</span>
 </div>
 </div>

 <!-- Playback Controls -->
 <div class="controls">
 <button class="control-btn small" id="prevBtn">
 <svg viewBox="0 0 24 24">
 <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
 </svg>
 </button>

 <button class="control-btn large" id="playPauseBtn">
 <svg viewBox="0 0 24 24" id="playIcon">
 <path d="M8 5v14l11-7z"/>
 </svg>
 <svg viewBox="0 0 24 24" id="pauseIcon" style="display: none;">
 <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
 </svg>
 </button>

 <button class="control-btn small" id="nextBtn">
 <svg viewBox="0 0 24 24">
 <path d="M16 18h2V6h-2v12zm-11-7l8.5-6v12z"/>
 </svg>
 </button>

 <button class="control-btn medium" id="shuffleBtn">
 <svg viewBox="0 0 24 24">
 <path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/>
 </svg>
 </button>

 <button class="control-btn medium" id="repeatBtn">
 <svg viewBox="0 0 24 24">
 <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/>
 </svg>
 </button>
 </div>

 <!-- Horizontal Carousel -->
 <div class="carousel-section" id="carouselSection" style="display: none;">
 <div class="carousel-header">
 <h3>Now Playing</h3>
 </div>
 <div class="carousel-container">
 <button class="carousel-nav prev" id="carouselPrev">
 <svg viewBox="0 0 24 24">
 <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
 </svg>
 </button>
 <div class="carousel-wrapper">
 <div class="carousel-track" id="carouselTrack"></div>
 </div>
 <button class="carousel-nav next" id="carouselNext">
 <svg viewBox="0 0 24 24">
 <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
 </svg>
 </button>
 </div>
 </div>

 <!-- Playlist Library Button -->
 <button class="library-button" id="libraryBtn">
 <span>ğŸ“š</span>
 <span>Browse Community Library</span>
 <span style="opacity: 0.7; font-size: 12px;" id="libraryBadge">(Empty)</span>
 </button>

 <!-- Vertical Playlist -->
 <div class="playlist-container">
 <div class="playlist-header">
 <h3>All Tracks</h3>
 <button class="playlist-header-add-btn" id="playlistHeaderAddBtn" title="Add song to current playlist">+ Add New</button>
 <span class="playlist-count" id="playlistCount">0 songs</span>
 </div>
 <div class="playlist-scroll" id="playlist">
 <div class="empty-state">
 <div class="empty-state-icon">ğŸµ</div>
 <div class="empty-state-text">
 Click "Import YouTube Playlist" to add songs<br>
 or browse the Community Library for instant access!
 </div>
 </div>
 </div>
 </div>
 </div>
 </div>

 <!-- Playlist Library Modal -->
 <div class="modal-overlay" id="libraryModalOverlay">
 <div class="modal">
 <div class="modal-header">
 <h2 class="modal-title">ğŸ“š Community Playlist Library</h2>
 <button class="modal-close" id="closeLibraryModal">Close</button>
 </div>
 <div class="library-search-container">
 <div class="library-search-wrapper">
 <input type="text" class="library-search-input" id="librarySearchInput" placeholder="ğŸ” Search playlists by name, mood, or genre...">
 <button class="library-search-btn" id="librarySearchBtn">Search</button>
 </div>
 <div class="library-search-preview" id="librarySearchPreview"></div>
 </div>
 <div class="library-pagination" id="libraryPaginationTop"></div>
 <div class="modal-body" id="libraryModalBody">
 <div class="library-status">Loading community playlists...</div>
 </div>
 <div class="library-pagination" id="libraryPaginationBottom"></div>
 </div>
 </div>

 <!-- Import Playlist Modal -->
 <div class="modal-overlay" id="playlistModalOverlay">
 <div class="modal">
 <div class="modal-header">
 <h2 class="modal-title" id="playlistModalTitle">Import YouTube Playlist</h2>
 <button class="modal-close" id="closePlaylistModal">Cancel</button>
 </div>
 <div class="input-modal-content">
 <div class="input-group">
 <label class="input-label">Playlist Name</label>
 <input type="text" class="input-field" id="playlistNameInput" placeholder="My Awesome Playlist">
 </div>
 
 <!-- Manual Playlist Toggle -->
 <div class="input-group" style="margin-bottom: 16px;">
 <label class="manual-playlist-toggle">
 <input type="checkbox" id="manualPlaylistCheckbox">
 <span class="manual-playlist-label">ğŸ“ Manual Playlist (Add songs one by one)</span>
 </label>
 </div>
 
 <!-- Regular Playlist URL Input -->
 <div class="input-group" id="playlistUrlGroup">
 <label class="input-label">YouTube Playlist URL or ID</label>
 <input type="text" class="input-field" id="playlistUrlInput" placeholder="https://www.youtube.com/playlist?list=...">
 </div>
 
 <!-- Manual Playlist Video URL Input (Hidden by default) -->
 <div class="input-group" id="videoUrlGroup" style="display: none;">
 <label class="input-label">YouTube Video URL</label>
 <input type="text" class="input-field" id="videoUrlInput" placeholder="https://www.youtube.com/watch?v=...">
 </div>
 
 <!-- Community Feature Notice (only for regular playlists) -->
 <div id="communityNotice" style="padding: 10px; background: rgba(67, 233, 123, 0.1); border-radius: 8px; margin-bottom: 12px; border: 1px solid rgba(67, 233, 123, 0.3);">
 <div style="font-size: 12px; color: #aaa; line-height: 1.6;">
 <strong style="color: #43e97b;">ğŸŒ Community Feature:</strong> This playlist will be saved to our shared database and accessible to all users worldwide - helping everyone save on API costs! One import = Everyone benefits! ğŸ‰
 </div>
 </div>
 
 <div class="modal-actions">
 <button class="modal-btn cancel" id="cancelPlaylist">Cancel</button>
 <button class="modal-btn save" id="loadPlaylist">
 <span id="loadPlaylistText">Import & Share</span>
 </button>
 </div>
 <div id="playlistStatus" style="margin-top: 12px; font-size: 13px; text-align: center; color: #667eea;"></div>
 </div>
 </div>
 </div>
 </div>
 </div>


 <!-- Add Song Modal -->
 <div class="modal-overlay" id="addSongModalOverlay">
 <div class="modal">
 <div class="modal-header">
 <h2 class="modal-title" id="addSongModalTitle">Add Song to Playlist</h2>
 <button class="modal-close" id="closeAddSongModal">Cancel</button>
 </div>
 <div class="input-modal-content">
 <div class="input-group">
 <label class="input-label">YouTube Video URL</label>
 <input type="text" class="input-field" id="addSongVideoUrl" placeholder="https://www.youtube.com/watch?v=...">
 </div>
 <div class="modal-actions">
 <button class="modal-btn cancel" id="cancelAddSong">Cancel</button>
 <button class="modal-btn save" id="addSongBtn">
 <span id="addSongBtnText">Add Song</span>
 </button>
 </div>
 <div id="addSongStatus" style="margin-top: 12px; font-size: 13px; text-align: center; color: #667eea;"></div>
 </div>
 </div>
 </div>
  <!-- Mood Help Modal -->
  <div class="modal-overlay" id="moodHelpModalOverlay">
    <div class="modal mood-help-modal">
      <div class="modal-header">
        <h2 class="modal-title">ğŸ­ All Available Moods</h2>
        <button class="modal-close" id="closeMoodHelpModal">&times;</button>
      </div>
      <div class="modal-body mood-help-content">
        <div class="mood-category">
          <h3 class="mood-category-title">ğŸŒŸ Classic Vibes</h3>
          <div class="mood-list">
            <div class="mood-item" data-mood="default"><span class="mood-emoji">ğŸ¨</span><strong>Default Vibes</strong> - Atmospheric gradient animation</div>
            <div class="mood-item" data-mood="sunset"><span class="mood-emoji">ğŸŒ…</span><strong>Sunset Chill</strong> - Warm sunset orange and pink</div>
            <div class="mood-item" data-mood="ocean"><span class="mood-emoji">ğŸŒŠ</span><strong>Ocean Waves</strong> - Cool blue ocean waves</div>
            <div class="mood-item" data-mood="forest"><span class="mood-emoji">ğŸŒ²</span><strong>Forest Calm</strong> - Natural green forest</div>
            <div class="mood-item" data-mood="midnight"><span class="mood-emoji">ğŸŒ™</span><strong>Midnight Dreams</strong> - Dark midnight blues</div>
            <div class="mood-item" data-mood="aurora"><span class="mood-emoji">ğŸŒˆ</span><strong>Aurora Lights</strong> - Northern lights colors</div>
            <div class="mood-item" data-mood="candy"><span class="mood-emoji">ğŸ­</span><strong>Candy Pop</strong> - Sweet pink candy colors</div>
            <div class="mood-item" data-mood="neon"><span class="mood-emoji">ğŸ’«</span><strong>Neon Nights</strong> - Vibrant neon colors</div>
            <div class="mood-item" data-mood="tropical"><span class="mood-emoji">ğŸŒº</span><strong>Tropical Heat</strong> - Warm tropical sunset</div>
            <div class="mood-item" data-mood="cosmic"><span class="mood-emoji">ğŸŒŒ</span><strong>Cosmic Journey</strong> - Deep space purple</div>
          </div>
        </div>

        <div class="mood-category">
          <h3 class="mood-category-title">âš¡ Dynamic Effects</h3>
          <div class="mood-list">
            <div class="mood-item" data-mood="plasma"><span class="mood-emoji">ğŸ”®</span><strong>Plasma Orbs</strong> - Floating plasma orbs with blur</div>
            <div class="mood-item" data-mood="starfield"><span class="mood-emoji">âœ¨</span><strong>Starfield</strong> - Twinkling stars effect</div>
            <div class="mood-item" data-mood="lava"><span class="mood-emoji">ğŸŒ‹</span><strong>Lava Bubbles</strong> - Bubbling lava effect</div>
            <div class="mood-item" data-mood="electric"><span class="mood-emoji">âš¡</span><strong>Electric Storm</strong> - Lightning strikes</div>
            <div class="mood-item" data-mood="matrix"><span class="mood-emoji">ğŸ’š</span><strong>Matrix Code</strong> - Falling green code</div>
            <div class="mood-item" data-mood="rainbow"><span class="mood-emoji">ğŸŒˆ</span><strong>Rainbow Shimmer</strong> - Rainbow animation</div>
            <div class="mood-item" data-mood="vaporwave"><span class="mood-emoji">ğŸŒŠ</span><strong>Vaporwave</strong> - Retro grid aesthetic</div>
            <div class="mood-item" data-mood="fire"><span class="mood-emoji">ğŸ”¥</span><strong>Fire</strong> - Rising flames effect</div>
            <div class="mood-item" data-mood="cyberpunk"><span class="mood-emoji">ğŸ®</span><strong>Cyberpunk</strong> - Glitchy cyber bars</div>
            <div class="mood-item" data-mood="galaxy"><span class="mood-emoji">ğŸŒŒ</span><strong>Galaxy</strong> - Spinning nebula</div>
          </div>
        </div>

        <div class="mood-category">
          <h3 class="mood-category-title">ğŸ’¥ Bold & Intense</h3>
          <div class="mood-list">
            <div class="mood-item" data-mood="glitch"><span class="mood-emoji">âš¡</span><strong>Glitch</strong> - RGB split glitch effect</div>
            <div class="mood-item" data-mood="lightning"><span class="mood-emoji">âš¡</span><strong>Lightning</strong> - Flashing lightning</div>
            <div class="mood-item" data-mood="pulse"><span class="mood-emoji">ğŸ’“</span><strong>Pulse</strong> - Heartbeat pulsing</div>
            <div class="mood-item" data-mood="prism"><span class="mood-emoji">ğŸŒˆ</span><strong>Prism</strong> - Refracted rainbow light</div>
            <div class="mood-item" data-mood="hologram"><span class="mood-emoji">ğŸ’</span><strong>Hologram</strong> - Holographic shimmer</div>
            <div class="mood-item" data-mood="laser"><span class="mood-emoji">ğŸ”´</span><strong>Laser</strong> - Sweeping laser beams</div>
            <div class="mood-item" data-mood="warp"><span class="mood-emoji">ğŸš€</span><strong>Warp</strong> - Warp speed streaks</div>
            <div class="mood-item" data-mood="disco"><span class="mood-emoji">ğŸª©</span><strong>Disco</strong> - Rotating disco lights</div>
            <div class="mood-item" data-mood="nuclear"><span class="mood-emoji">â˜¢ï¸</span><strong>Nuclear</strong> - Radioactive glow</div>
            <div class="mood-item" data-mood="supernova"><span class="mood-emoji">ğŸ’¥</span><strong>Supernova</strong> - Explosive expansion</div>
          </div>
        </div>

        <div class="mood-category">
          <h3 class="mood-category-title">ğŸ¨ Atmosphere Collection</h3>
          <div class="mood-list">
            <div class="mood-item" data-mood="oceanic"><span class="mood-emoji">ğŸŒŠ</span><strong>Oceanic</strong> - Deep ocean depths</div>
            <div class="mood-item" data-mood="desert"><span class="mood-emoji">ğŸœï¸</span><strong>Desert</strong> - Warm desert sunset</div>
            <div class="mood-item" data-mood="arctic"><span class="mood-emoji">â„ï¸</span><strong>Arctic</strong> - Frozen arctic ice</div>
            <div class="mood-item" data-mood="jungle"><span class="mood-emoji">ğŸŒ¿</span><strong>Jungle</strong> - Dense jungle night</div>
            <div class="mood-item" data-mood="cherry"><span class="mood-emoji">ğŸŒ¸</span><strong>Cherry</strong> - Cherry blossom pink</div>
            <div class="mood-item" data-mood="thunder"><span class="mood-emoji">â›ˆï¸</span><strong>Thunder</strong> - Stormy thunderclouds</div>
            <div class="mood-item" data-mood="mystic"><span class="mood-emoji">ğŸŒ³</span><strong>Mystic</strong> - Mystic forest purple</div>
            <div class="mood-item" data-mood="cybergrid"><span class="mood-emoji">ğŸŒ</span><strong>Cybergrid</strong> - Cyber grid lines</div>
            <div class="mood-item" data-mood="royal"><span class="mood-emoji">ğŸ‘‘</span><strong>Royal</strong> - Royal purple luxury</div>
            <div class="mood-item" data-mood="golden"><span class="mood-emoji">ğŸŒŸ</span><strong>Golden</strong> - Golden hour glow</div>
            <div class="mood-item" data-mood="nebula"><span class="mood-emoji">ğŸŒŒ</span><strong>Nebula</strong> - Dreamy nebula clouds</div>
            <div class="mood-item" data-mood="crimson"><span class="mood-emoji">â¤ï¸</span><strong>Crimson</strong> - Deep crimson red</div>
            <div class="mood-item" data-mood="emerald"><span class="mood-emoji">ğŸ’š</span><strong>Emerald</strong> - Emerald green city</div>
            <div class="mood-item" data-mood="solar"><span class="mood-emoji">â˜€ï¸</span><strong>Solar</strong> - Solar flare orange</div>
            <div class="mood-item" data-mood="moonlight"><span class="mood-emoji">ğŸŒ™</span><strong>Moonlight</strong> - Moonlight serenade</div>
          </div>
        </div>

        <div class="mood-category">
          <h3 class="mood-category-title">âœ¨ New Creative Themes</h3>
          <div class="mood-list">
            <div class="mood-item" data-mood="sakura"><span class="mood-emoji">ğŸŒ¸</span><strong>Sakura Blossoms</strong> - Delicate pink cherry blossom gradients</div>
            <div class="mood-item" data-mood="volcano"><span class="mood-emoji">ğŸŒ‹</span><strong>Volcano Lava</strong> - Dark red/orange volcanic eruption</div>
            <div class="mood-item" data-mood="arcticaurora"><span class="mood-emoji">â„ï¸</span><strong>Arctic Aurora</strong> - Ice blue northern lights shimmer</div>
            <div class="mood-item" data-mood="amethyst"><span class="mood-emoji">ğŸ’</span><strong>Amethyst Crystal</strong> - Deep purple gemstone glow</div>
            <div class="mood-item" data-mood="emeraldforest"><span class="mood-emoji">ğŸŒ²</span><strong>Emerald Forest</strong> - Rich green forest depths</div>
            <div class="mood-item" data-mood="sunsetbeach"><span class="mood-emoji">ğŸ–ï¸</span><strong>Sunset Beach</strong> - Warm orange/pink beach sunset</div>
            <div class="mood-item" data-mood="deepocean"><span class="mood-emoji">ğŸŒŠ</span><strong>Deep Ocean</strong> - Dark blue ocean depths</div>
            <div class="mood-item" data-mood="rosegold"><span class="mood-emoji">ğŸŒ¹</span><strong>Rose Gold</strong> - Elegant pink metallic shimmer</div>
            <div class="mood-item" data-mood="cosmos"><span class="mood-emoji">ğŸŒŒ</span><strong>Cosmos</strong> - Deep space purple/blue drift</div>
            <div class="mood-item" data-mood="phoenix"><span class="mood-emoji">ğŸ”¥</span><strong>Phoenix Flame</strong> - Bright orange/gold flames rising</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Easter Egg Settings Modal -->
  <div class="modal-overlay" id="easterEggModalOverlay">
    <div class="modal easter-egg-modal">
      <div class="modal-header">
        <h2 class="modal-title">âœ¨ Advanced Atmosphere Settings</h2>
        <button class="modal-close" id="closeEasterEggModal">Ã—</button>
      </div>
      <div class="easter-egg-content">

        <!-- Player Transparency -->
        <div class="easter-egg-option">
          <div class="easter-egg-option-header">
            <span class="easter-egg-icon">ğŸ¨</span>
            <div class="easter-egg-option-info">
              <div class="easter-egg-option-title">Player Background Opacity</div>
              <div class="easter-egg-option-desc">Adjust background transparency only</div>
            </div>
          </div>
          <div class="easter-egg-control">
            <input type="range" class="easter-egg-slider" id="playerOpacity" min="0" max="100" value="68">
            <span class="easter-egg-value" id="playerOpacityValue">68%</span>
          </div>
        </div>

        <!-- Sticky Mood Colors -->
        <div class="easter-egg-option">
          <div class="easter-egg-option-header">
            <span class="easter-egg-icon">ğŸŒˆ</span>
            <div class="easter-egg-option-info">
              <div class="easter-egg-option-title">Sticky Controller Mood Colors</div>
              <div class="easter-egg-option-desc">Controller changes color with mood</div>
            </div>
          </div>
          <div class="easter-egg-control">
            <label class="easter-egg-toggle">
              <input type="checkbox" id="stickyMoodColors">
              <span class="easter-egg-toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Animation Speed -->
        <div class="easter-egg-option">
          <div class="easter-egg-option-header">
            <span class="easter-egg-icon">âš¡</span>
            <div class="easter-egg-option-info">
              <div class="easter-egg-option-title">Animation Speed</div>
              <div class="easter-egg-option-desc">Control mood animation tempo</div>
            </div>
          </div>
          <div class="easter-egg-control">
            <select class="easter-egg-select" id="animationSpeed">
              <option value="0.5">Slow (0.5x)</option>
              <option value="0.75">Relaxed (0.75x)</option>
              <option value="1" selected>Normal (1x)</option>
              <option value="1.5">Fast (1.5x)</option>
              <option value="2">Hyper (2x)</option>
            </select>
          </div>
        </div>

        <!-- Blur Intensity -->
        <div class="easter-egg-option">
          <div class="easter-egg-option-header">
            <span class="easter-egg-icon">ğŸŒ«ï¸</span>
            <div class="easter-egg-option-info">
              <div class="easter-egg-option-title">Backdrop Blur Intensity</div>
              <div class="easter-egg-option-desc">Glassmorphism effect strength</div>
            </div>
          </div>
          <div class="easter-egg-control">
            <select class="easter-egg-select" id="blurIntensity">
              <option value="0">None</option>
              <option value="10">Light (10px)</option>
              <option value="20" selected>Medium (20px)</option>
              <option value="30">Heavy (30px)</option>
              <option value="40">Ultra (40px)</option>
            </select>
          </div>
        </div>

        <!-- Visualizer Bar Count -->
        <div class="easter-egg-option">
          <div class="easter-egg-option-header">
            <span class="easter-egg-icon">ğŸ“Š</span>
            <div class="easter-egg-option-info">
              <div class="easter-egg-option-title">Visualizer Complexity</div>
              <div class="easter-egg-option-desc">Number of visualizer bars</div>
            </div>
          </div>
          <div class="easter-egg-control">
            <input type="range" class="easter-egg-slider" id="visualizerBars" min="20" max="100" value="50" step="10">
            <span class="easter-egg-value" id="visualizerBarsValue">50</span>
          </div>
        </div>

        <!-- Border Glow -->
        <div class="easter-egg-option">
          <div class="easter-egg-option-header">
            <span class="easter-egg-icon">âœ¨</span>
            <div class="easter-egg-option-info">
              <div class="easter-egg-option-title">Border Glow Effect</div>
              <div class="easter-egg-option-desc">Glowing borders on player elements</div>
            </div>
          </div>
          <div class="easter-egg-control">
            <label class="easter-egg-toggle">
              <input type="checkbox" id="borderGlow">
              <span class="easter-egg-toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Particle Effects -->
        <div class="easter-egg-option">
          <div class="easter-egg-option-header">
            <span class="easter-egg-icon">ğŸ†</span>
            <div class="easter-egg-option-info">
              <div class="easter-egg-option-title">Floating Particles</div>
              <div class="easter-egg-option-desc">Animated particles in background</div>
            </div>
          </div>
          <div class="easter-egg-control">
            <label class="easter-egg-toggle">
              <input type="checkbox" id="particleEffects">
              <span class="easter-egg-toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Card Shadow Depth -->
        <div class="easter-egg-option">
          <div class="easter-egg-option-header">
            <span class="easter-egg-icon">ğŸ“¦</span>
            <div class="easter-egg-option-info">
              <div class="easter-egg-option-title">Card Shadow Depth</div>
              <div class="easter-egg-option-desc">Adjust elevation and depth of cards</div>
            </div>
          </div>
          <div class="easter-egg-control">
            <select class="easter-egg-select" id="shadowDepth">
              <option value="flat">Flat</option>
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
              <option value="ultra">Ultra</option>
            </select>
          </div>
        </div>

        <!-- Text Glow -->
        <div class="easter-egg-option">
          <div class="easter-egg-option-header">
            <span class="easter-egg-icon">ğŸ’«</span>
            <div class="easter-egg-option-info">
              <div class="easter-egg-option-title">Text Glow Effect</div>
              <div class="easter-egg-option-desc">Add glowing text shadows</div>
            </div>
          </div>
          <div class="easter-egg-control">
            <label class="easter-egg-toggle">
              <input type="checkbox" id="textGlow">
              <span class="easter-egg-toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Progress Bar Glow -->
        <div class="easter-egg-option">
          <div class="easter-egg-option-header">
            <span class="easter-egg-icon">ğŸ“Š</span>
            <div class="easter-egg-option-info">
              <div class="easter-egg-option-title">Progress Bar Glow</div>
              <div class="easter-egg-option-desc">Glowing animated progress bars</div>
            </div>
          </div>
          <div class="easter-egg-control">
            <label class="easter-egg-toggle">
              <input type="checkbox" id="progressGlow">
              <span class="easter-egg-toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Button Rotation -->
        <div class="easter-egg-option">
          <div class="easter-egg-option-header">
            <span class="easter-egg-icon">ğŸ”„</span>
            <div class="easter-egg-option-info">
              <div class="easter-egg-option-title">Button Rotation Effect</div>
              <div class="easter-egg-option-desc">Subtle rotation on hover</div>
            </div>
          </div>
          <div class="easter-egg-control">
            <label class="easter-egg-toggle">
              <input type="checkbox" id="buttonRotation">
              <span class="easter-egg-toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Color Saturation -->
        <div class="easter-egg-option">
          <div class="easter-egg-option-header">
            <span class="easter-egg-icon">ğŸŒˆ</span>
            <div class="easter-egg-option-info">
              <div class="easter-egg-option-title">Color Saturation</div>
              <div class="easter-egg-option-desc">Adjust color vividness (70-130%)</div>
            </div>
          </div>
          <div class="easter-egg-control">
            <input type="range" class="easter-egg-slider" id="colorSaturation" min="70" max="130" value="100">
            <span class="easter-egg-value" id="colorSaturationValue">100%</span>
          </div>
        </div>

        <div class="easter-egg-footer">
          <button class="easter-egg-reset" id="resetEasterEgg">Reset to Defaults</button>
        </div>

      </div>
    </div>
  </div>

 <!-- Mobile Floating Add Playlist Button -->
 <button class="add-playlist-btn-mobile" id="addPlaylistBtnMobile">+</button>

 <!-- Firebase SDK -->
 <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
 <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

 <!-- YouTube IFrame API -->
 <script src="https://www.youtube.com/iframe_api"></script>
<style>
 * {
 margin: 0;
 padding: 0;
 box-sizing: border-box;
 }

 body {
 font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
 padding: 0;
 margin: 0;
 background:
   radial-gradient(circle at 20% 30%, rgba(102, 126, 234, 0.3), transparent 50%),
   radial-gradient(circle at 80% 70%, rgba(118, 75, 162, 0.3), transparent 50%),
   radial-gradient(circle at 50% 50%, rgba(67, 233, 123, 0.15), transparent 70%),
   linear-gradient(135deg, #0f0c29, #302b63, #24243e);
 background-size: 400% 400%, 400% 400%, 300% 300%, 100% 100%;
 animation: atmosphericShift 20s ease-in-out infinite;
 min-height: 100vh;
 position: relative;
 overflow-x: hidden;
 transition: background 1s ease;
 }

 /* CRITICAL FIX: Disable transition on initial page load to prevent flickering */
 body.no-transition {
 transition: none !important;
 }

 /* PERFORMANCE OPTIMIZATION: Optimize mood backgrounds */
 body[class*="mood-"] {
 /* Reduce animation complexity for better performance */
 background-attachment: fixed;
 }

 /* Mood Backgrounds with Dramatic Animations */
 body.mood-default {
 background: linear-gradient(-45deg, #667eea, #764ba2, #667eea, #5f4fb8);
 background-size: 400% 400%;
 animation: gradientShift 12s ease-in-out infinite;
 }

 body.mood-sunset {
 background: radial-gradient(circle at 20% 50%, #ff6b6b, transparent 50%),
             radial-gradient(circle at 80% 50%, #ffa07a, transparent 50%),
             linear-gradient(135deg, #ff8c42, #ff9966);
 background-size: 200% 200%;
 animation: sunsetPulse 8s ease-in-out infinite;
 }

 body.mood-ocean {
 background: linear-gradient(45deg, #2e3192, #1bffff, #0099ff, #2e3192);
 background-size: 400% 400%;
 animation: oceanWave 10s ease-in-out infinite;
 }

 body.mood-forest {
 background: radial-gradient(ellipse at 30% 40%, #71b280, transparent 60%),
             radial-gradient(ellipse at 70% 60%, #2d8659, transparent 60%),
             linear-gradient(135deg, #134e5e, #1a6644);
 background-size: 300% 300%;
 animation: forestBreeze 15s ease-in-out infinite;
 }

 body.mood-midnight {
 background: radial-gradient(circle at 50% 50%, #302b63, transparent 70%),
             linear-gradient(135deg, #0f0c29, #24243e);
 background-size: 300% 300%;
 animation: midnightPulse 20s ease-in-out infinite;
 }

 body.mood-aurora {
 background: linear-gradient(0deg, #00c6ff, transparent 50%),
             linear-gradient(60deg, #0072ff, transparent 50%),
             linear-gradient(120deg, #667eea, transparent 50%),
             linear-gradient(180deg, #00d4ff, #0072ff);
 background-size: 300% 300%;
 animation: auroraFlow 8s linear infinite;
 }

 body.mood-candy {
 background: radial-gradient(circle at 30% 30%, #ff0844, transparent 40%),
             radial-gradient(circle at 70% 70%, #ffb199, transparent 40%),
             linear-gradient(135deg, #ff6b9d, #ff0844);
 background-size: 250% 250%;
 animation: candyPop 6s ease-in-out infinite;
 }

 body.mood-neon {
 background: linear-gradient(45deg, #ff00cc, #3333ff, #cc00ff, #6600ff);
 background-size: 400% 400%;
 animation: neonPulse 4s ease-in-out infinite;
 }

 body.mood-tropical {
 background: radial-gradient(circle at 40% 40%, #f093fb, transparent 50%),
             radial-gradient(circle at 60% 60%, #f5576c, transparent 50%),
             linear-gradient(135deg, #ff9a9e, #fad0c4);
 background-size: 300% 300%;
 animation: tropicalVibe 10s ease-in-out infinite;
 }

 body.mood-cosmic {
 background: radial-gradient(circle at 50% 50%, #8e2de2, transparent 60%),
             linear-gradient(45deg, #4a00e0, #6a0ec0, #ae4de2, #4a00e0);
 background-size: 400% 400%;
 animation: cosmicShift 12s linear infinite;
 }

 /* NEW BOLD MOODS WITH CSS ANIMATIONS */
 body.mood-plasma {
 background: radial-gradient(circle at 30% 40%, #ff006e, transparent 40%),
             radial-gradient(circle at 70% 60%, #8338ec, transparent 40%),
             radial-gradient(circle at 50% 50%, #3a86ff, transparent 50%),
             linear-gradient(135deg, #fb5607, #ff006e);
 background-size: 300% 300%;
 animation: plasmaFlow 8s ease-in-out infinite;
 }

 body.mood-starfield {
 background: linear-gradient(135deg, #000428, #004e92);
 animation: starfieldPulse 15s ease-in-out infinite;
 }

 body.mood-lava {
 background: radial-gradient(circle at 40% 60%, #ff4500, transparent 50%),
             radial-gradient(circle at 60% 40%, #ff6347, transparent 50%),
             linear-gradient(135deg, #8b0000, #ff4500);
 background-size: 250% 250%;
 animation: lavaFlow 10s ease-in-out infinite;
 }

 body.mood-electric {
 background: linear-gradient(45deg, #00fff9, #7000ff, #ff00f7, #00fff9);
 background-size: 400% 400%;
 animation: electricPulse 5s linear infinite;
 }

 body.mood-matrix {
 background: linear-gradient(180deg, #001100, #003300);
 animation: matrixFlicker 10s ease-in-out infinite;
 }

 body.mood-rainbow {
 background: linear-gradient(45deg, #ff0000, #ff7700, #ffdd00, #00ff00, #0088ff, #0000ff, #8800ff);
 background-size: 600% 600%;
 animation: rainbowShift 10s linear infinite;
 }

 body.mood-vaporwave {
 background: linear-gradient(180deg, #ff6ec7, #7f00ff, #00d4ff);
 background-size: 300% 300%;
 animation: vaporwaveDrift 12s ease-in-out infinite;
 }

 body.mood-fire {
 background: radial-gradient(ellipse at 50% 100%, #ff4500, transparent 60%),
             radial-gradient(ellipse at 30% 80%, #ff6347, transparent 40%),
             radial-gradient(ellipse at 70% 80%, #ff8c00, transparent 40%),
             linear-gradient(180deg, #000000, #8b0000);
 background-size: 300% 300%;
 animation: fireFlicker 6s ease-in-out infinite;
 }

 body.mood-cyberpunk {
 background: linear-gradient(135deg, #ff00de, #00ffff, #ff00de);
 background-size: 400% 400%;
 animation: cyberpunkGlitch 7s ease-in-out infinite;
 }

 body.mood-galaxy {
 background: radial-gradient(circle at 30% 30%, #667eea, transparent 30%),
             radial-gradient(circle at 70% 70%, #764ba2, transparent 30%),
             radial-gradient(circle at 50% 50%, #f093fb, transparent 40%),
             linear-gradient(135deg, #0f0c29, #302b63, #24243e);
 background-size: 400% 400%;
 animation: galaxySpin 20s linear infinite;
 }

 /* 10 NEW BOLD MOODS */
 body.mood-glitch {
 background: linear-gradient(135deg, #000000, #ff0000, #00ff00, #0000ff);
 background-size: 400% 400%;
 animation: glitchShift 4s ease-in-out infinite;
 }

 body.mood-lightning {
 background: linear-gradient(135deg, #1a1a2e, #16213e);
 animation: lightningFlash 6s ease-in-out infinite;
 }

 body.mood-pulse {
 background: radial-gradient(circle at 50% 50%, #ff006e, #3a86ff);
 background-size: 200% 200%;
 animation: heartPulse 3s ease-in-out infinite;
 }

 body.mood-prism {
 background: conic-gradient(from 0deg at 50% 50%, 
 #ff0000, #ff7700, #ffdd00, #00ff00, #0088ff, #0000ff, #8800ff, #ff0000);
 background-size: 200% 200%;
 animation: prismRotate 15s linear infinite;
 }

 body.mood-hologram {
 background: linear-gradient(45deg, #00ffff, #ff00ff, #00ffff);
 background-size: 400% 400%;
 animation: hologramShimmer 8s ease-in-out infinite;
 }

 body.mood-laser {
 background: linear-gradient(135deg, #000000, #ff0066);
 animation: laserBeam 5s ease-in-out infinite;
 }

 body.mood-warp {
 background: radial-gradient(ellipse at 50% 50%, #8e2de2, #4a00e0);
 background-size: 300% 300%;
 animation: warpSpeed 10s ease-in-out infinite;
 }

 body.mood-disco {
 background: linear-gradient(45deg, #ff00ff, #00ffff, #ffff00, #ff00ff);
 background-size: 400% 400%;
 animation: discoRotate 6s linear infinite;
 }

 body.mood-nuclear {
 background: radial-gradient(circle at 50% 50%, #00ff00, #003300);
 background-size: 200% 200%;
 animation: nuclearGlow 8s ease-in-out infinite;
 }

 body.mood-supernova {
 background: radial-gradient(circle at 50% 50%, #ffffff, #ff4500, #8b0000, #000000);
 background-size: 300% 300%;
 animation: supernovaExplosion 12s ease-in-out infinite;
 }

 /* 15 NEW AMAZING MOOD THEMES */
 body.mood-oceanic {
 background: radial-gradient(circle at 30% 30%, #006994, transparent 50%),
             radial-gradient(circle at 70% 70%, #0a4d68, transparent 50%),
             linear-gradient(135deg, #003366, #1a5f7a, #002244);
 background-size: 350% 350%;
 animation: oceanicDepths 14s ease-in-out infinite;
 }

 body.mood-desert {
 background: radial-gradient(circle at 20% 60%, #ff8c42, transparent 40%),
             radial-gradient(circle at 80% 40%, #ffa600, transparent 40%),
             linear-gradient(180deg, #ff6b35, #f7931e, #c1440e);
 background-size: 300% 300%;
 animation: desertSunset 11s ease-in-out infinite;
 }

 body.mood-arctic {
 background: radial-gradient(circle at 40% 50%, #e0f7ff, transparent 45%),
             radial-gradient(circle at 60% 50%, #b8e6f5, transparent 45%),
             linear-gradient(135deg, #d4f1f9, #a8dadc, #89c2d9);
 background-size: 280% 280%;
 animation: arcticFreeze 16s ease-in-out infinite;
 }

 body.mood-jungle {
 background: radial-gradient(circle at 25% 25%, #1e4620, transparent 55%),
             radial-gradient(circle at 75% 75%, #2d5a2f, transparent 55%),
             linear-gradient(135deg, #0f2027, #203a43, #2c5364);
 background-size: 320% 320%;
 animation: jungleNight 13s ease-in-out infinite;
 }

 body.mood-cherry {
 background: radial-gradient(circle at 35% 35%, #ffb3d9, transparent 40%),
             radial-gradient(circle at 65% 65%, #ff6bc5, transparent 40%),
             linear-gradient(135deg, #ffc8dd, #ff99cc, #ff66b2);
 background-size: 310% 310%;
 animation: cherryBlossom 10s ease-in-out infinite;
 }

 body.mood-thunder {
 background: radial-gradient(circle at 50% 50%, #4a5568, transparent 60%),
             linear-gradient(135deg, #1a202c, #2d3748, #1a1f2e);
 background-size: 330% 330%;
 animation: thunderstorm 9s ease-in-out infinite;
 }

 body.mood-mystic {
 background: radial-gradient(circle at 40% 40%, #5b3a70, transparent 50%),
             radial-gradient(circle at 60% 60%, #3d2d52, transparent 50%),
             linear-gradient(135deg, #2a1b3d, #44318d, #2f184b);
 background-size: 340% 340%;
 animation: mysticForest 15s ease-in-out infinite;
 }

 body.mood-cybergrid {
 background: linear-gradient(90deg, #0d1117 1px, transparent 1px),
             linear-gradient(180deg, #0d1117 1px, transparent 1px),
             linear-gradient(135deg, #00ff9f, #00b8d4, #7000ff);
 background-size: 50px 50px, 50px 50px, 400% 400%;
 animation: cyberGrid 8s linear infinite;
 }

 body.mood-royal {
 background: radial-gradient(circle at 30% 30%, #7209b7, transparent 50%),
             radial-gradient(circle at 70% 70%, #560bad, transparent 50%),
             linear-gradient(135deg, #3c096c, #5a189a, #240046);
 background-size: 360% 360%;
 animation: royalPurple 12s ease-in-out infinite;
 }

 body.mood-golden {
 background: radial-gradient(circle at 50% 40%, #ffd700, transparent 45%),
             radial-gradient(circle at 50% 60%, #ffaa00, transparent 45%),
             linear-gradient(135deg, #ff8c00, #ffa500, #cc7000);
 background-size: 290% 290%;
 animation: goldenHour 11s ease-in-out infinite;
 }

 body.mood-nebula {
 background: radial-gradient(circle at 30% 50%, #b794f6, transparent 45%),
             radial-gradient(circle at 70% 50%, #f687b3, transparent 45%),
             linear-gradient(135deg, #667eea, #f093fb, #4facfe);
 background-size: 380% 380%;
 animation: nebulaDream 17s ease-in-out infinite;
 }

 body.mood-crimson {
 background: radial-gradient(circle at 40% 40%, #dc2626, transparent 50%),
             radial-gradient(circle at 60% 60%, #991b1b, transparent 50%),
             linear-gradient(135deg, #7f1d1d, #b91c1c, #450a0a);
 background-size: 320% 320%;
 animation: crimsonTide 10s ease-in-out infinite;
 }

 body.mood-emerald {
 background: radial-gradient(circle at 35% 35%, #10b981, transparent 50%),
             radial-gradient(circle at 65% 65%, #059669, transparent 50%),
             linear-gradient(135deg, #064e3b, #047857, #022c22);
 background-size: 340% 340%;
 animation: emeraldCity 13s ease-in-out infinite;
 }

 body.mood-solar {
 background: radial-gradient(circle at 50% 50%, #fff7ed, #fed7aa, #fb923c, #ea580c, #9a3412);
 background-size: 350% 350%;
 animation: solarFlare 9s ease-in-out infinite;
 }

 body.mood-moonlight {
 background: radial-gradient(circle at 50% 30%, #e0e7ff, transparent 40%),
             radial-gradient(circle at 50% 70%, #c7d2fe, transparent 40%),
             linear-gradient(135deg, #4c1d95, #5b21b6, #2e1065);
 background-size: 300% 300%;
 animation: moonlightSerenade 14s ease-in-out infinite;
 }

 /* 10 NEW CREATIVE MOOD THEMES */
 body.mood-sakura {
 background: radial-gradient(circle at 30% 40%, #ffb7c5, transparent 45%),
             radial-gradient(circle at 70% 60%, #ffd9e8, transparent 45%),
             linear-gradient(135deg, #ffe5ec, #ffb7d5, #ff99c8);
 background-size: 320% 320%;
 animation: sakuraPetals 12s ease-in-out infinite;
 }

 body.mood-volcano {
 background: radial-gradient(circle at 50% 80%, #ff4500, transparent 50%),
             radial-gradient(circle at 30% 90%, #ff6347, transparent 40%),
             radial-gradient(circle at 70% 85%, #dc143c, transparent 40%),
             linear-gradient(180deg, #1a0a00, #4a1a0a, #8b0000);
 background-size: 350% 350%;
 animation: volcanoEruption 15s ease-in-out infinite;
 }

 body.mood-arcticaurora {
 background: radial-gradient(ellipse at 50% 20%, #00fff2, transparent 40%),
             radial-gradient(ellipse at 30% 40%, #4d94ff, transparent 50%),
             radial-gradient(ellipse at 70% 30%, #b19cd9, transparent 50%),
             linear-gradient(180deg, #001f3f, #003d5c, #005f7f);
 background-size: 400% 400%;
 animation: arcticWave 18s ease-in-out infinite;
 }

 body.mood-amethyst {
 background: radial-gradient(circle at 40% 40%, #b19cd9, transparent 50%),
             radial-gradient(circle at 60% 60%, #9370db, transparent 50%),
             linear-gradient(135deg, #4b0082, #6a0dad, #8b008b);
 background-size: 330% 330%;
 animation: amethystGlow 14s ease-in-out infinite;
 }

 body.mood-emeraldforest {
 background: radial-gradient(circle at 35% 35%, #2ecc71, transparent 50%),
             radial-gradient(circle at 65% 65%, #27ae60, transparent 50%),
             linear-gradient(135deg, #0b3d0b, #1a5c1a, #228b22);
 background-size: 340% 340%;
 animation: forestWhisper 16s ease-in-out infinite;
 }

 body.mood-sunsetbeach {
 background: radial-gradient(circle at 50% 40%, #ff6b35, transparent 50%),
             radial-gradient(circle at 30% 50%, #f7931e, transparent 45%),
             radial-gradient(circle at 70% 50%, #ff9a76, transparent 45%),
             linear-gradient(180deg, #ffd89b, #f9c74f, #f28c28);
 background-size: 360% 360%;
 animation: beachSunset 13s ease-in-out infinite;
 }

 body.mood-deepocean {
 background: radial-gradient(circle at 50% 50%, #006994, transparent 60%),
             radial-gradient(circle at 30% 70%, #003d5c, transparent 50%),
             radial-gradient(circle at 70% 30%, #005f7f, transparent 50%),
             linear-gradient(135deg, #001a33, #002b4d, #003d66);
 background-size: 380% 380%;
 animation: oceanTide 20s ease-in-out infinite;
 }

 body.mood-rosegold {
 background: radial-gradient(circle at 40% 50%, #e8b4b8, transparent 45%),
             radial-gradient(circle at 60% 50%, #d4a5a5, transparent 45%),
             linear-gradient(135deg, #ffd1dc, #e8b4b8, #d4a5a5);
 background-size: 310% 310%;
 animation: roseShimmer 11s ease-in-out infinite;
 }

 body.mood-cosmos {
 background: radial-gradient(circle at 50% 50%, #4c1d95, transparent 50%),
             radial-gradient(circle at 30% 30%, #5b21b6, transparent 40%),
             radial-gradient(circle at 70% 70%, #6d28d9, transparent 40%),
             linear-gradient(135deg, #0f0728, #1e0a3c, #2d1651);
 background-size: 420% 420%;
 animation: cosmicDrift 22s ease-in-out infinite;
 }

 body.mood-phoenix {
 background: radial-gradient(circle at 50% 60%, #ff8c00, transparent 50%),
             radial-gradient(circle at 40% 50%, #ffa500, transparent 40%),
             radial-gradient(circle at 60% 50%, #ff6347, transparent 40%),
             linear-gradient(135deg, #8b0000, #ff4500, #ffa500);
 background-size: 370% 370%;
 animation: phoenixRise 17s ease-in-out infinite;
 }

 /* NEW MOOD ANIMATIONS */
 @keyframes glitchShift {
 0%, 100% { background-position: 0% 50%; }
 10% { background-position: 100% 50%; }
 20% { background-position: 0% 100%; }
 30% { background-position: 100% 0%; }
 40% { background-position: 50% 50%; }
 60% { background-position: 20% 80%; }
 80% { background-position: 80% 20%; }
 }

 @keyframes lightningFlash {
 0%, 90%, 100% { background-position: 50% 50%; }
 91%, 93%, 95% { background-position: 100% 100%; }
 92%, 94% { background-position: 0% 0%; }
 96% { background-position: 75% 25%; }
 97% { background-position: 25% 75%; }
 }

 @keyframes heartPulse {
 0%, 100% { background-position: 50% 50%; }
 25% { background-position: 100% 100%; }
 50% { background-position: 0% 0%; }
 75% { background-position: 100% 0%; }
 }

 @keyframes prismRotate {
 0% { background-position: 0% 50%; }
 25% { background-position: 100% 0%; }
 50% { background-position: 100% 50%; }
 75% { background-position: 0% 100%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes hologramShimmer {
 0%, 100% { background-position: 0% 50%; }
 25% { background-position: 100% 50%; }
 50% { background-position: 50% 100%; }
 75% { background-position: 50% 0%; }
 }

 @keyframes laserBeam {
 0%, 100% { background-position: 0% 50%; }
 25% { background-position: 100% 100%; }
 50% { background-position: 50% 0%; }
 75% { background-position: 100% 50%; }
 }

 @keyframes warpSpeed {
 0%, 100% { background-position: 50% 50%; }
 25% { background-position: 100% 100%; }
 50% { background-position: 0% 0%; }
 75% { background-position: 0% 100%; }
 }

 @keyframes discoRotate {
 0% { background-position: 0% 50%; }
 25% { background-position: 100% 50%; }
 50% { background-position: 100% 100%; }
 75% { background-position: 0% 100%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes nuclearGlow {
 0%, 100% { background-position: 50% 50%; }
 25% { background-position: 100% 0%; }
 50% { background-position: 100% 100%; }
 75% { background-position: 0% 100%; }
 }

 @keyframes supernovaExplosion {
 0%, 100% { background-position: 50% 50%; }
 25% { background-position: 75% 75%; }
 50% { background-position: 100% 100%; }
 75% { background-position: 75% 75%; }
 }

 /* CSS Animated Elements for ALL Moods */
 body.mood-plasma::before,
 body.mood-starfield::before,
 body.mood-lava::before,
 body.mood-electric::before,
 body.mood-matrix::before,
 body.mood-rainbow::before,
 body.mood-vaporwave::before,
 body.mood-fire::before,
 body.mood-cyberpunk::before,
 body.mood-galaxy::before,
 body.mood-glitch::before,
 body.mood-lightning::before,
 body.mood-pulse::before,
 body.mood-prism::before,
 body.mood-hologram::before,
 body.mood-laser::before,
 body.mood-warp::before,
 body.mood-disco::before,
 body.mood-nuclear::before,
 body.mood-supernova::before {
 content: '';
 position: absolute !important;
 top: 0 !important;
 left: 0 !important;
 width: 100%;
 height: 100%;
 pointer-events: none;
 z-index: 1 !important;
 opacity: 1;
 contain: layout paint style;
 }

 /* Plasma - Floating Orbs */
 body.mood-plasma::before {
 background: 
 radial-gradient(circle at 20% 20%, rgba(255,0,110,0.6), transparent 25%),
 radial-gradient(circle at 80% 80%, rgba(131,56,236,0.6), transparent 25%),
 radial-gradient(circle at 50% 50%, rgba(58,134,255,0.5), transparent 35%),
 radial-gradient(circle at 70% 30%, rgba(255,0,110,0.4), transparent 20%),
 radial-gradient(circle at 30% 70%, rgba(131,56,236,0.4), transparent 20%);
 animation: orbsFloat 15s ease-in-out infinite;
 filter: blur(40px);
 }

 /* Starfield - Twinkling Stars */
 body.mood-starfield::before {
 background-image: 
 radial-gradient(circle, white 1px, transparent 1px),
 radial-gradient(circle, white 2px, transparent 2px),
 radial-gradient(circle, white 1px, transparent 1px),
 radial-gradient(circle, rgba(255,255,255,0.8) 1px, transparent 1px),
 radial-gradient(circle, white 2px, transparent 2px),
 radial-gradient(circle, rgba(255,255,255,0.6) 1px, transparent 1px),
 radial-gradient(circle, white 1px, transparent 1px),
 radial-gradient(circle, white 1px, transparent 1px),
 radial-gradient(circle, rgba(255,255,255,0.9) 2px, transparent 2px);
 background-size: 200px 200px, 300px 300px, 150px 150px, 250px 250px, 180px 180px, 220px 220px, 280px 280px, 160px 160px, 240px 240px;
 background-position: 0 0, 40px 60px, 130px 270px, 70px 100px, 200px 150px, 90px 220px, 150px 50px, 50px 180px, 180px 80px;
 animation: starsTwinkle 8s ease-in-out infinite;
 }

 /* Lava - Bubbling Effect */
 body.mood-lava::before {
 background: 
 radial-gradient(ellipse at 30% 90%, rgba(255,69,0,0.7), transparent 45%),
 radial-gradient(ellipse at 70% 85%, rgba(255,99,71,0.7), transparent 40%),
 radial-gradient(ellipse at 50% 95%, rgba(255,140,0,0.6), transparent 50%),
 radial-gradient(ellipse at 20% 80%, rgba(255,69,0,0.5), transparent 35%),
 radial-gradient(ellipse at 80% 92%, rgba(255,99,71,0.5), transparent 38%);
 animation: lavaBubble 12s ease-in-out infinite;
 filter: blur(50px);
 }

 /* Electric - Lightning Bolts */
 body.mood-electric::before {
 background: 
 radial-gradient(ellipse at 30% 20%, rgba(0,255,249,0.8), transparent 30%),
 radial-gradient(ellipse at 70% 80%, rgba(112,0,255,0.7), transparent 30%),
 radial-gradient(ellipse at 50% 50%, rgba(255,0,247,0.6), transparent 40%),
 linear-gradient(135deg, transparent 48%, rgba(0,255,249,0.4) 49%, rgba(0,255,249,0.4) 51%, transparent 52%),
 linear-gradient(45deg, transparent 48%, rgba(112,0,255,0.3) 49%, rgba(112,0,255,0.3) 51%, transparent 52%);
 background-size: 100% 100%, 100% 100%, 100% 100%, 100% 300%, 100% 300%;
 animation: lightningStrike 3s ease-in-out infinite;
 filter: blur(30px);
 }

 /* Matrix - Falling Code */
 body.mood-matrix::before {
 background: 
 repeating-linear-gradient(0deg, 
 transparent, 
 transparent 20px, 
 rgba(0,255,0,0.3) 20px, 
 rgba(0,255,0,0.3) 21px,
 transparent 21px,
 transparent 40px,
 rgba(0,255,0,0.5) 40px,
 rgba(0,255,0,0.5) 42px
 ),
 linear-gradient(180deg, transparent 0%, rgba(0,255,0,0.2) 50%, transparent 100%);
 background-size: 100% 100%, 100% 200%;
 animation: matrixRain 5s linear infinite;
 opacity: 0.8;
 }

 /* Rainbow - Shimmer Effect */
 body.mood-rainbow::before {
 background: 
 repeating-linear-gradient(45deg,
 rgba(255,0,0,0.3) 0px,
 rgba(255,119,0,0.3) 50px,
 rgba(255,221,0,0.3) 100px,
 rgba(0,255,0,0.3) 150px,
 rgba(0,136,255,0.3) 200px,
 rgba(0,0,255,0.3) 250px,
 rgba(136,0,255,0.3) 300px,
 rgba(255,0,0,0.3) 350px
 );
 background-size: 400% 400%;
 animation: rainbowShimmer 10s linear infinite;
 opacity: 0.9;
 }

 /* Vaporwave - Grid Lines */
 body.mood-vaporwave::before {
 background-image: 
 repeating-linear-gradient(0deg, 
 rgba(255,110,199,0.4) 0px, 
 rgba(255,110,199,0.4) 2px, 
 transparent 2px, 
 transparent 40px
 ),
 repeating-linear-gradient(90deg, 
 rgba(127,0,255,0.4) 0px, 
 rgba(127,0,255,0.4) 2px, 
 transparent 2px, 
 transparent 40px
 ),
 linear-gradient(180deg, transparent 60%, rgba(255,110,199,0.2) 100%);
 background-size: 100% 100%;
 animation: vaporwaveGrid 20s linear infinite;
 opacity: 0.9;
 }

 /* Fire - Flames Rising */
 body.mood-fire::before {
 background: 
 radial-gradient(ellipse at 50% 120%, rgba(255,69,0,0.8), transparent 60%),
 radial-gradient(ellipse at 30% 110%, rgba(255,99,71,0.7), transparent 50%),
 radial-gradient(ellipse at 70% 110%, rgba(255,140,0,0.7), transparent 50%),
 radial-gradient(ellipse at 40% 105%, rgba(255,69,0,0.6), transparent 45%),
 radial-gradient(ellipse at 60% 115%, rgba(255,140,0,0.6), transparent 48%);
 animation: flamesRise 8s ease-in-out infinite;
 filter: blur(60px);
 }

 /* Cyberpunk - Glitch Bars */
 body.mood-cyberpunk::before {
 background: 
 repeating-linear-gradient(90deg, 
 transparent 0%, 
 rgba(255,0,222,0.4) 10%, 
 transparent 20%,
 rgba(0,255,255,0.4) 30%,
 transparent 40%
 ),
 linear-gradient(180deg, 
 rgba(255,0,222,0.2) 0%, 
 transparent 50%, 
 rgba(0,255,255,0.2) 100%
 );
 background-size: 200% 100%, 100% 100%;
 animation: cyberpunkGlitchBars 5s ease-in-out infinite;
 opacity: 0.9;
 }

 /* Galaxy - Spinning Nebula */
 body.mood-galaxy::before {
 background: 
 radial-gradient(ellipse at 50% 50%, rgba(102,126,234,0.6), transparent 60%),
 radial-gradient(circle at 30% 70%, rgba(118,75,162,0.5), transparent 45%),
 radial-gradient(circle at 70% 30%, rgba(240,147,251,0.5), transparent 45%),
 radial-gradient(ellipse at 40% 60%, rgba(102,126,234,0.4), transparent 50%),
 radial-gradient(ellipse at 60% 40%, rgba(118,75,162,0.4), transparent 50%);
 animation: nebulaRotate 30s linear infinite;
 filter: blur(50px);
 }

 /* Glitch - RGB Split Effect */
 body.mood-glitch::before {
 background: 
 repeating-linear-gradient(0deg,
 rgba(255,0,0,0.3) 0px,
 rgba(255,0,0,0.3) 2px,
 transparent 2px,
 transparent 6px
 ),
 repeating-linear-gradient(90deg,
 rgba(0,255,0,0.3) 0px,
 rgba(0,255,0,0.3) 2px,
 transparent 2px,
 transparent 6px
 ),
 repeating-linear-gradient(45deg,
 rgba(0,0,255,0.3) 0px,
 rgba(0,0,255,0.3) 2px,
 transparent 2px,
 transparent 6px
 );
 animation: glitchSplit 4s ease-in-out infinite;
 opacity: 0.9;
 }

 /* Lightning - Storm Bolts */
 body.mood-lightning::before {
 background: 
 radial-gradient(ellipse at 20% 30%, rgba(255,255,255,1), transparent 10%),
 radial-gradient(ellipse at 50% 60%, rgba(255,255,255,0.9), transparent 15%),
 radial-gradient(ellipse at 80% 40%, rgba(255,255,255,1), transparent 12%),
 linear-gradient(135deg, transparent 45%, rgba(255,255,255,0.9) 48%, rgba(255,255,255,0.9) 52%, transparent 55%);
 animation: lightningBolt 6s ease-in-out infinite;
 filter: blur(15px);
 }

 /* Pulse - Heartbeat Rings */
 body.mood-pulse::before {
 background: 
 radial-gradient(circle at 50% 50%, rgba(255,0,110,0.8), transparent 40%),
 radial-gradient(circle at 50% 50%, rgba(58,134,255,0.6), transparent 60%),
 radial-gradient(circle at 50% 50%, rgba(255,0,110,0.4), transparent 80%);
 animation: pulseRings 3s ease-in-out infinite;
 filter: blur(40px);
 }

 /* Prism - Refracted Light */
 body.mood-prism::before {
 background: 
 repeating-conic-gradient(from 0deg at 50% 50%,
 rgba(255,0,0,0.4) 0deg 30deg,
 rgba(255,165,0,0.4) 30deg 60deg,
 rgba(255,255,0,0.4) 60deg 90deg,
 rgba(0,255,0,0.4) 90deg 120deg,
 rgba(0,0,255,0.4) 120deg 150deg,
 rgba(75,0,130,0.4) 150deg 180deg,
 rgba(238,130,238,0.4) 180deg 210deg,
 rgba(255,0,0,0.4) 210deg 240deg
 );
 animation: prismRefract 15s linear infinite;
 opacity: 0.9;
 }

 /* Hologram - Scan Lines */
 body.mood-hologram::before {
 background: 
 repeating-linear-gradient(0deg,
 rgba(0,255,255,0.1) 0px,
 rgba(0,255,255,0.3) 1px,
 transparent 1px,
 transparent 4px
 ),
 radial-gradient(ellipse at 50% 50%, rgba(255,0,255,0.4), transparent 60%),
 radial-gradient(ellipse at 30% 30%, rgba(0,255,255,0.4), transparent 50%);
 animation: hologramScan 8s ease-in-out infinite;
 }

 /* Laser - Sweeping Beams */
 body.mood-laser::before {
 background: 
 linear-gradient(90deg, transparent 0%, rgba(255,0,102,0.8) 50%, transparent 100%),
 linear-gradient(45deg, transparent 0%, rgba(255,0,102,0.6) 50%, transparent 100%),
 radial-gradient(circle at 50% 50%, rgba(255,0,102,0.5), transparent 60%);
 animation: laserSweep 5s ease-in-out infinite;
 filter: blur(25px);
 }

 /* Warp - Speed Streaks */
 body.mood-warp::before {
 background: 
 repeating-linear-gradient(45deg,
 transparent 0px,
 rgba(142,45,226,0.5) 50px,
 transparent 100px
 ),
 repeating-linear-gradient(-45deg,
 transparent 0px,
 rgba(74,0,224,0.5) 50px,
 transparent 100px
 );
 animation: warpStreaks 10s linear infinite;
 filter: blur(30px);
 }

 /* Disco - Rotating Spotlights */
 body.mood-disco::before {
 background: 
 radial-gradient(circle at 30% 30%, rgba(255,0,255,0.7), transparent 30%),
 radial-gradient(circle at 70% 70%, rgba(0,255,255,0.7), transparent 30%),
 radial-gradient(circle at 50% 80%, rgba(255,255,0,0.6), transparent 35%),
 radial-gradient(circle at 20% 60%, rgba(255,0,255,0.5), transparent 25%),
 radial-gradient(circle at 80% 40%, rgba(0,255,255,0.5), transparent 25%);
 animation: discoSpotlight 6s linear infinite;
 filter: blur(50px);
 }

 /* Nuclear - Radioactive Glow */
 body.mood-nuclear::before {
 background: 
 radial-gradient(circle at 50% 50%, rgba(0,255,0,0.8), transparent 50%),
 radial-gradient(circle at 50% 50%, rgba(0,255,0,0.5), transparent 70%),
 radial-gradient(circle at 50% 50%, rgba(0,255,0,0.3), transparent 90%);
 animation: radioactiveGlow 8s ease-in-out infinite;
 filter: blur(60px);
 }

 /* Supernova - Explosive Expansion */
 body.mood-supernova::before {
 background: 
 radial-gradient(circle at 50% 50%, rgba(255,255,255,1), rgba(255,69,0,0.8) 20%, rgba(139,0,0,0.5) 50%, transparent 70%),
 radial-gradient(circle at 50% 50%, rgba(255,255,255,0.8), transparent 40%),
 radial-gradient(circle at 50% 50%, rgba(255,165,0,0.6), transparent 60%);
 animation: explosionExpand 12s ease-in-out infinite;
 filter: blur(40px);
 }

 /* New Mood Animations */
 @keyframes plasmaFlow {
 0% { background-position: 0% 50%; }
 25% { background-position: 100% 100%; }
 50% { background-position: 50% 0%; }
 75% { background-position: 100% 50%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes starfieldPulse {
 0%, 100% { background-position: 50% 50%; }
 50% { background-position: 100% 100%; }
 }

 @keyframes lavaFlow {
 0% { background-position: 0% 0%; }
 50% { background-position: 100% 100%; }
 100% { background-position: 0% 0%; }
 }

 @keyframes electricPulse {
 0% { background-position: 0% 50%; }
 25% { background-position: 100% 50%; }
 50% { background-position: 100% 100%; }
 75% { background-position: 0% 100%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes matrixFlicker {
 0%, 100% { background-position: 0% 0%; }
 50% { background-position: 100% 100%; }
 }

 @keyframes rainbowShift {
 0% { background-position: 0% 50%; }
 100% { background-position: 100% 50%; }
 }

 @keyframes vaporwaveDrift {
 0% { background-position: 0% 0%; }
 50% { background-position: 0% 100%; }
 100% { background-position: 0% 0%; }
 }

 @keyframes fireFlicker {
 0%, 100% { background-position: 0% 50%; }
 25% { background-position: 100% 100%; }
 50% { background-position: 50% 0%; }
 75% { background-position: 100% 50%; }
 }

 @keyframes cyberpunkGlitch {
 0% { background-position: 0% 50%; }
 25% { background-position: 100% 50%; }
 50% { background-position: 100% 100%; }
 75% { background-position: 0% 100%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes galaxySpin {
 0% { background-position: 0% 50%; }
 100% { background-position: 100% 50%; }
 }

 /* Element Animations */
 @keyframes orbsFloat {
 0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.9; }
 25% { transform: translate(80px, -80px) scale(1.2); opacity: 1; }
 50% { transform: translate(-50px, 50px) scale(1.1); opacity: 0.95; }
 75% { transform: translate(-80px, -60px) scale(1.15); opacity: 1; }
 }

 @keyframes starsTwinkle {
 0%, 100% { opacity: 0.6; transform: scale(1); }
 25% { opacity: 1; transform: scale(1.2); }
 50% { opacity: 0.4; transform: scale(0.9); }
 75% { opacity: 1; transform: scale(1.1); }
 }

 @keyframes lavaBubble {
 0%, 100% { transform: translateY(0) scale(1); opacity: 0.9; }
 25% { transform: translateY(-40px) scale(1.15); opacity: 1; }
 50% { transform: translateY(-20px) scale(1.2); opacity: 0.95; }
 75% { transform: translateY(-50px) scale(1.1); opacity: 1; }
 }

 @keyframes lightningStrike {
 0%, 85%, 100% { opacity: 0; }
 86%, 88% { opacity: 1; filter: brightness(2); }
 87% { opacity: 0.3; }
 89%, 92% { opacity: 0.9; filter: brightness(1.5); }
 90% { opacity: 0.5; }
 }

 @keyframes matrixRain {
 0% { transform: translateY(0); opacity: 0.8; }
 100% { transform: translateY(100px); opacity: 1; }
 }

 @keyframes rainbowShimmer {
 0% { transform: translateX(0) rotate(0deg); }
 100% { transform: translateX(100%) rotate(5deg); }
 }

 @keyframes vaporwaveGrid {
 0% { transform: perspective(800px) rotateX(60deg) translateY(0) translateZ(0); opacity: 0.9; }
 100% { transform: perspective(800px) rotateX(60deg) translateY(40px) translateZ(-100px); opacity: 1; }
 }

 @keyframes flamesRise {
 0%, 100% { transform: translateY(0) scale(1) scaleY(1); opacity: 0.9; }
 25% { transform: translateY(-60px) scale(1.1) scaleY(1.3); opacity: 1; }
 50% { transform: translateY(-40px) scale(1.15) scaleY(1.2); opacity: 0.95; }
 75% { transform: translateY(-70px) scale(1.08) scaleY(1.4); opacity: 1; }
 }

 @keyframes cyberpunkGlitchBars {
 0%, 100% { transform: translateX(0) skew(0deg); opacity: 0.8; }
 20% { transform: translateX(50%) skew(5deg); opacity: 1; }
 40% { transform: translateX(-30%) skew(-3deg); opacity: 0.9; }
 60% { transform: translateX(70%) skew(4deg); opacity: 1; }
 80% { transform: translateX(-50%) skew(-5deg); opacity: 0.95; }
 }

 @keyframes nebulaRotate {
 0% { transform: rotate(0deg) scale(1); opacity: 0.9; }
 25% { transform: rotate(90deg) scale(1.1); opacity: 1; }
 50% { transform: rotate(180deg) scale(1.05); opacity: 0.95; }
 75% { transform: rotate(270deg) scale(1.1); opacity: 1; }
 100% { transform: rotate(360deg) scale(1); opacity: 0.9; }
 }

 /* New Mood Element Animations */
 @keyframes glitchSplit {
 0%, 100% { transform: translate(0, 0); opacity: 0.8; }
 10% { transform: translate(10px, -5px); opacity: 1; }
 20% { transform: translate(-8px, 8px); opacity: 0.9; }
 30% { transform: translate(5px, -10px); opacity: 1; }
 40% { transform: translate(-10px, 5px); opacity: 0.85; }
 50% { transform: translate(0, 0); opacity: 0.9; }
 }

 @keyframes lightningBolt {
 0%, 85%, 100% { opacity: 0; }
 86%, 88%, 91%, 93% { opacity: 1; filter: brightness(3); }
 87%, 89%, 92% { opacity: 0.3; }
 }

 @keyframes pulseRings {
 0%, 100% { transform: scale(0.8); opacity: 1; }
 50% { transform: scale(1.3); opacity: 0.6; }
 }

 @keyframes prismRefract {
 0% { transform: rotate(0deg); }
 100% { transform: rotate(360deg); }
 }

 @keyframes hologramScan {
 0%, 100% { transform: translateY(0) scaleY(1); opacity: 0.9; }
 50% { transform: translateY(-20px) scaleY(1.1); opacity: 1; }
 }

 @keyframes laserSweep {
 0%, 100% { transform: translateX(-100%) rotate(0deg); opacity: 0.8; }
 50% { transform: translateX(100%) rotate(15deg); opacity: 1; }
 }

 @keyframes warpStreaks {
 0% { transform: translate(0, 0) scale(1); }
 100% { transform: translate(-100px, -100px) scale(1.2); }
 }

 @keyframes discoSpotlight {
 0% { transform: rotate(0deg); }
 100% { transform: rotate(360deg); }
 }

 @keyframes radioactiveGlow {
 0%, 100% { transform: scale(1); opacity: 0.8; filter: blur(60px); }
 25% { transform: scale(1.2); opacity: 1; filter: blur(70px); }
 50% { transform: scale(1.4); opacity: 0.9; filter: blur(80px); }
 75% { transform: scale(1.2); opacity: 1; filter: blur(70px); }
 }

 @keyframes explosionExpand {
 0%, 100% { transform: scale(0.5); opacity: 1; }
 25% { transform: scale(1.5); opacity: 0.9; }
 50% { transform: scale(2); opacity: 0.7; }
 75% { transform: scale(1.5); opacity: 0.9; }
 }

 /* Dramatic Mood Animations */
 @keyframes atmosphericShift {
 0% { background-position: 0% 50%, 100% 50%, 50% 50%; }
 33% { background-position: 100% 80%, 0% 20%, 30% 70%; }
 66% { background-position: 50% 20%, 50% 80%, 70% 30%; }
 100% { background-position: 0% 50%, 100% 50%, 50% 50%; }
 }

 @keyframes gradientShift {
 0% { background-position: 0% 50%; }
 25% { background-position: 100% 50%; }
 50% { background-position: 100% 100%; }
 75% { background-position: 0% 100%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes sunsetPulse {
 0% { background-position: 0% 50%; }
 25% { background-position: 50% 100%; }
 50% { background-position: 100% 50%; }
 75% { background-position: 50% 0%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes oceanWave {
 0% { background-position: 0% 0%; }
 25% { background-position: 100% 50%; }
 50% { background-position: 50% 100%; }
 75% { background-position: 0% 50%; }
 100% { background-position: 0% 0%; }
 }

 @keyframes forestBreeze {
 0% { background-position: 0% 50%; }
 33% { background-position: 100% 100%; }
 66% { background-position: 50% 0%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes midnightPulse {
 0% { background-position: 50% 50%; }
 25% { background-position: 100% 0%; }
 50% { background-position: 50% 100%; }
 75% { background-position: 0% 50%; }
 100% { background-position: 50% 50%; }
 }

 @keyframes auroraFlow {
 0% { background-position: 0% 0%; }
 25% { background-position: 100% 50%; }
 50% { background-position: 100% 100%; }
 75% { background-position: 50% 50%; }
 100% { background-position: 0% 0%; }
 }

 @keyframes candyPop {
 0% { background-position: 0% 0%; }
 25% { background-position: 100% 100%; }
 50% { background-position: 100% 0%; }
 75% { background-position: 0% 100%; }
 100% { background-position: 0% 0%; }
 }

 @keyframes neonPulse {
 0% { background-position: 0% 50%; }
 25% { background-position: 100% 100%; }
 50% { background-position: 100% 0%; }
 75% { background-position: 0% 100%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes tropicalVibe {
 0% { background-position: 0% 50%; }
 33% { background-position: 100% 100%; }
 66% { background-position: 50% 0%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes cosmicShift {
 0% { background-position: 0% 50%; }
 25% { background-position: 100% 0%; }
 50% { background-position: 100% 100%; }
 75% { background-position: 0% 100%; }
 100% { background-position: 0% 50%; }
 }

 /* 15 NEW MOOD ANIMATIONS - SAFE (background-position only) */
 @keyframes oceanicDepths {
 0% { background-position: 0% 0%; }
 25% { background-position: 50% 100%; }
 50% { background-position: 100% 50%; }
 75% { background-position: 50% 0%; }
 100% { background-position: 0% 0%; }
 }

 @keyframes desertSunset {
 0% { background-position: 0% 100%; }
 33% { background-position: 100% 50%; }
 66% { background-position: 50% 0%; }
 100% { background-position: 0% 100%; }
 }

 @keyframes arcticFreeze {
 0% { background-position: 50% 50%; }
 20% { background-position: 80% 20%; }
 40% { background-position: 20% 80%; }
 60% { background-position: 70% 30%; }
 80% { background-position: 30% 70%; }
 100% { background-position: 50% 50%; }
 }

 @keyframes jungleNight {
 0% { background-position: 0% 50%; }
 30% { background-position: 100% 70%; }
 60% { background-position: 30% 30%; }
 90% { background-position: 70% 100%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes cherryBlossom {
 0% { background-position: 0% 0%; }
 25% { background-position: 100% 100%; }
 50% { background-position: 0% 100%; }
 75% { background-position: 100% 0%; }
 100% { background-position: 0% 0%; }
 }

 @keyframes thunderstorm {
 0% { background-position: 50% 50%; }
 33% { background-position: 100% 100%; }
 66% { background-position: 0% 0%; }
 100% { background-position: 50% 50%; }
 }

 @keyframes mysticForest {
 0% { background-position: 0% 50%; }
 20% { background-position: 60% 80%; }
 40% { background-position: 100% 40%; }
 60% { background-position: 40% 20%; }
 80% { background-position: 20% 60%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes cyberGrid {
 0% { background-position: 0 0, 0 0, 0% 50%; }
 100% { background-position: 50px 50px, 50px 50px, 100% 50%; }
 }

 @keyframes royalPurple {
 0% { background-position: 0% 0%; }
 25% { background-position: 100% 50%; }
 50% { background-position: 50% 100%; }
 75% { background-position: 0% 50%; }
 100% { background-position: 0% 0%; }
 }

 @keyframes goldenHour {
 0% { background-position: 50% 0%; }
 33% { background-position: 100% 100%; }
 66% { background-position: 0% 50%; }
 100% { background-position: 50% 0%; }
 }

 @keyframes nebulaDream {
 0% { background-position: 0% 50%; }
 20% { background-position: 80% 80%; }
 40% { background-position: 100% 20%; }
 60% { background-position: 20% 100%; }
 80% { background-position: 50% 30%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes crimsonTide {
 0% { background-position: 0% 50%; }
 25% { background-position: 100% 100%; }
 50% { background-position: 100% 0%; }
 75% { background-position: 0% 100%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes emeraldCity {
 0% { background-position: 50% 50%; }
 30% { background-position: 100% 0%; }
 60% { background-position: 0% 100%; }
 90% { background-position: 80% 20%; }
 100% { background-position: 50% 50%; }
 }

 @keyframes solarFlare {
 0% { background-position: 50% 50%; }
 25% { background-position: 100% 100%; }
 50% { background-position: 50% 50%; }
 75% { background-position: 0% 0%; }
 100% { background-position: 50% 50%; }
 }

 @keyframes moonlightSerenade {
 0% { background-position: 0% 0%; }
 25% { background-position: 100% 50%; }
 50% { background-position: 50% 100%; }
 75% { background-position: 50% 0%; }
 100% { background-position: 0% 0%; }
 }

 /* 10 NEW MOOD @KEYFRAMES - SAFE (background-position only) */
 @keyframes sakuraPetals {
 0% { background-position: 0% 0%; }
 25% { background-position: 100% 50%; }
 50% { background-position: 50% 100%; }
 75% { background-position: 0% 50%; }
 100% { background-position: 0% 0%; }
 }

 @keyframes volcanoEruption {
 0% { background-position: 50% 80%; }
 20% { background-position: 70% 60%; }
 40% { background-position: 30% 70%; }
 60% { background-position: 60% 90%; }
 80% { background-position: 40% 75%; }
 100% { background-position: 50% 80%; }
 }

 @keyframes arcticWave {
 0% { background-position: 0% 0%; }
 25% { background-position: 50% 100%; }
 50% { background-position: 100% 50%; }
 75% { background-position: 50% 0%; }
 100% { background-position: 0% 0%; }
 }

 @keyframes amethystGlow {
 0% { background-position: 50% 50%; }
 33% { background-position: 100% 0%; }
 66% { background-position: 0% 100%; }
 100% { background-position: 50% 50%; }
 }

 @keyframes forestWhisper {
 0% { background-position: 0% 50%; }
 20% { background-position: 60% 80%; }
 40% { background-position: 100% 40%; }
 60% { background-position: 40% 20%; }
 80% { background-position: 20% 60%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes beachSunset {
 0% { background-position: 0% 40%; }
 25% { background-position: 100% 60%; }
 50% { background-position: 100% 40%; }
 75% { background-position: 0% 60%; }
 100% { background-position: 0% 40%; }
 }

 @keyframes oceanTide {
 0% { background-position: 0% 50%; }
 25% { background-position: 100% 100%; }
 50% { background-position: 50% 0%; }
 75% { background-position: 100% 50%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes roseShimmer {
 0% { background-position: 0% 50%; }
 25% { background-position: 50% 100%; }
 50% { background-position: 100% 50%; }
 75% { background-position: 50% 0%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes cosmicDrift {
 0% { background-position: 0% 0%; }
 20% { background-position: 80% 80%; }
 40% { background-position: 100% 20%; }
 60% { background-position: 20% 100%; }
 80% { background-position: 50% 30%; }
 100% { background-position: 0% 0%; }
 }

 @keyframes phoenixRise {
 0% { background-position: 50% 100%; }
 25% { background-position: 100% 75%; }
 50% { background-position: 50% 50%; }
 75% { background-position: 0% 75%; }
 100% { background-position: 50% 100%; }
 }

 /* Background Motion Effects */
 @keyframes bgHeartbeat {
 0%, 100% { transform: scale(1); }
 14% { transform: scale(1.02); }
 28% { transform: scale(1); }
 42% { transform: scale(1.02); }
 56% { transform: scale(1); }
 }

 @keyframes bgFlash {
 0%, 50%, 100% { filter: brightness(1); }
 25%, 75% { filter: brightness(1.3); }
 }

 @keyframes bgGlowPulse {
 0%, 100% { box-shadow: 0 0 10px rgba(102, 126, 234, 0.3); }
 50% { box-shadow: 0 0 30px rgba(102, 126, 234, 0.8), 0 0 60px rgba(118, 75, 162, 0.5); }
 }

 @keyframes bgScaleBounce {
 0%, 100% { transform: scale(1); }
 50% { transform: scale(1.03); }
 }

 @keyframes bgBreathe {
 0%, 100% { transform: scale(1); opacity: 1; }
 50% { transform: scale(1.02); opacity: 0.95; }
 }

 @keyframes bgBeatDrop {
 0%, 90%, 100% { transform: scale(1); }
 95% { transform: scale(1.05); }
 }

 @keyframes bgShake {
 0%, 100% { transform: translateX(0); }
 10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
 20%, 40%, 60%, 80% { transform: translateX(3px); }
 }

 @keyframes bgSway {
 0%, 100% { transform: rotate(0deg); }
 25% { transform: rotate(0.5deg); }
 75% { transform: rotate(-0.5deg); }
 }

 @keyframes bgFloat {
 0%, 100% { transform: translateY(0); }
 50% { transform: translateY(-10px); }
 }

 @keyframes bgWobble {
 0%, 100% { transform: rotate(0deg); }
 15% { transform: rotate(-1deg); }
 30% { transform: rotate(1deg); }
 45% { transform: rotate(-0.5deg); }
 60% { transform: rotate(0.5deg); }
 75% { transform: rotate(-0.3deg); }
 }


 @keyframes bgTilt3D {
 0%, 100% { transform: perspective(1000px) rotateX(0deg) rotateY(0deg); }
 25% { transform: perspective(1000px) rotateX(1deg) rotateY(-1deg); }
 50% { transform: perspective(1000px) rotateX(-1deg) rotateY(1deg); }
 75% { transform: perspective(1000px) rotateX(1deg) rotateY(1deg); }
 }

 @keyframes bgFlicker {
 0%, 100% { opacity: 1; }
 5%, 15%, 25%, 35%, 45% { opacity: 0.95; }
 10%, 20%, 30%, 40% { opacity: 0.98; }
 50% { opacity: 0.92; }
 }

 @keyframes bgGlitch {
 0%, 100% { transform: translate(0); }
 20% { transform: translate(-2px, 2px); }
 40% { transform: translate(-2px, -2px); }
 60% { transform: translate(2px, 2px); }
 80% { transform: translate(2px, -2px); }
 }

 @keyframes bgRGBSplit {
 0%, 100% { text-shadow: 0 0 0 rgba(255, 0, 0, 0); }
 33% { text-shadow: -2px 0 0 rgba(255, 0, 0, 0.7), 2px 0 0 rgba(0, 255, 255, 0.7); }
 66% { text-shadow: 2px 0 0 rgba(255, 0, 0, 0.7), -2px 0 0 rgba(0, 255, 255, 0.7); }
 }

 @keyframes bgWaveMotion {
 0% { background-position: 0% 50%; }
 50% { background-position: 100% 50%; }
 100% { background-position: 0% 50%; }
 }

 @keyframes bgRipple {
 0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
 100% { box-shadow: 0 0 0 20px rgba(102, 126, 234, 0); }
 }

 @keyframes bgPrism {
 0% { filter: hue-rotate(0deg); }
 100% { filter: hue-rotate(360deg); }
 }

 @keyframes bgBorderPulse {
 0%, 100% { border-color: rgba(102, 126, 234, 0.5); border-width: 2px; }
 50% { border-color: rgba(102, 126, 234, 1); border-width: 4px; }
 }

 @keyframes bgNeonGlow {
 0%, 100% { box-shadow: 0 0 5px #667eea, 0 0 10px #667eea; }
 50% { box-shadow: 0 0 20px #667eea, 0 0 30px #764ba2, 0 0 40px #f093fb; }
 }

 @keyframes bgRainbowBorder {
 0% { border-color: #ff0000; }
 16% { border-color: #ff7f00; }
 33% { border-color: #ffff00; }
 50% { border-color: #00ff00; }
 66% { border-color: #0000ff; }
 83% { border-color: #8b00ff; }
 100% { border-color: #ff0000; }
 }

 @keyframes bgShadowDance {
 0%, 100% { box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3); }
 25% { box-shadow: -5px 5px 15px rgba(0, 0, 0, 0.3); }
 50% { box-shadow: -5px -5px 15px rgba(0, 0, 0, 0.3); }
 75% { box-shadow: 5px -5px 15px rgba(0, 0, 0, 0.3); }
 }

 @keyframes bgElectricEdges {
 0%, 100% { box-shadow: 0 0 5px #667eea, inset 0 0 5px #667eea; }
 25% { box-shadow: 0 0 15px #764ba2, inset 0 0 10px #764ba2; }
 50% { box-shadow: 0 0 20px #f093fb, inset 0 0 15px #f093fb; }
 75% { box-shadow: 0 0 15px #764ba2, inset 0 0 10px #764ba2; }
 }

 /* Animated Background Elements */
 .bg-animation {
 position: fixed;
 top: 0;
 left: 0;
 width: 100%;
 height: 100%;
 pointer-events: none;
 z-index: 0;
 overflow: hidden;
 }

 .wave {
 position: absolute;
 bottom: 0;
 left: 0;
 width: 200%;
 height: 150px;
 background: rgba(255, 255, 255, 0.05);
 animation: wave 15s linear infinite;
 }

 .wave:nth-child(2) {
 animation: wave 20s linear infinite;
 opacity: 0.5;
 }

 .wave:nth-child(3) {
 animation: wave 25s linear infinite;
 opacity: 0.3;
 }

 @keyframes wave {
 0% { transform: translateX(0) translateZ(0) scaleY(1); }
 50% { transform: translateX(-25%) translateZ(0) scaleY(0.8); }
 100% { transform: translateX(-50%) translateZ(0) scaleY(1); }
 }

 .particles {
 position: absolute;
 width: 100%;
 height: 100%;
 }

 .particle {
 position: absolute;
 width: 4px;
 height: 4px;
 background: rgba(255, 255, 255, 0.6);
 border-radius: 50%;
 animation: float 10s infinite ease-in-out;
 }

 @keyframes float {
 0%, 100% {
 transform: translateY(0) translateX(0);
 opacity: 0;
 }
 10% {
 opacity: 1;
 }
 90% {
 opacity: 1;
 }
 100% {
 transform: translateY(-100vh) translateX(50px);
 opacity: 0;
 }
 }

 /* Settings Button */
 .settings-btn {
 position: fixed !important;
 top: 20px !important;
 right: 20px !important;
 width: 50px;
 height: 50px;
 background: rgba(255, 255, 255, 0.95);
 border: none;
 border-radius: 50%;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
 transition: all 0.3s ease;
 z-index: 10002 !important;
 transform: translateZ(0);
 isolation: isolate;
 }

 .settings-btn:hover {
 transform: rotate(90deg) scale(1.1) translateZ(0);
 box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
 }

 .settings-btn svg {
 width: 28px;
 height: 28px;
 fill: #667eea;
 }

 /* Settings Modal */
 .settings-modal-overlay {
 position: fixed;
 top: 0;
 left: 0;
 right: 0;
 bottom: 0;
 background: rgba(0, 0, 0, 0.7);
 display: none;
 align-items: center;
 justify-content: center;
 z-index: 10000;
 backdrop-filter: blur(5px);
 }

 .settings-modal-overlay.active {
 display: flex;
 align-items: center;
 justify-content: center;
 }

 .settings-modal {
 background: #2a2a2a;
 border-radius: 20px;
 width: 90%;
 max-width: 500px;
 max-height: 80vh;
 overflow-y: auto;
 animation: modalFadeIn 0.3s ease;
 position: absolute;
 top: 50%;
 left: 50%;
 transform: translate(-50%, -50%);
 z-index: 10001;
 }

 @keyframes modalFadeIn {
 from {
 opacity: 0;
 transform: translate(-50%, -50%) scale(0.95) translateZ(0);
 }
 to {
 opacity: 1;
 transform: translate(-50%, -50%) scale(1) translateZ(0);
 }
 }

 .settings-header {
 padding: 20px;
 border-bottom: 1px solid #3a3a3a;
 display: flex;
 justify-content: space-between;
 align-items: center;
 }

 .settings-title {
 font-size: 20px;
 font-weight: 700;
 color: #fff;
 display: flex;
 align-items: center;
 gap: 10px;
 }

 .settings-close {
 background: none;
 border: none;
 color: #667eea;
 font-size: 15px;
 font-weight: 600;
 cursor: pointer;
 padding: 5px 10px;
 }

 .settings-body {
 padding: 20px;
 }

 .setting-group {
 margin-bottom: 25px;
 }

 .setting-label {
 font-size: 15px;
 font-weight: 600;
 color: #fff;
 margin-bottom: 10px;
 display: flex;
 align-items: center;
 gap: 8px;
 }

 .setting-description {
 font-size: 12px;
 color: #aaa;
 margin-bottom: 10px;
 line-height: 1.5;
 }

 .toggle-switch {
 position: relative;
 display: inline-block;
 width: 50px;
 height: 26px;
 }

 .toggle-switch input {
 opacity: 0;
 width: 0;
 height: 0;
 }

 .toggle-slider {
 position: absolute;
 cursor: pointer;
 top: 0;
 left: 0;
 right: 0;
 bottom: 0;
 background-color: #3a3a3a;
 transition: 0.3s;
 border-radius: 26px;
 }

 .toggle-slider:before {
 position: absolute;
 content: "";
 height: 20px;
 width: 20px;
 left: 3px;
 bottom: 3px;
 background-color: white;
 transition: 0.3s;
 border-radius: 50%;
 }

 input:checked + .toggle-slider {
 background: linear-gradient(135deg, #667eea, #764ba2);
 }

 input:checked + .toggle-slider:before {
 transform: translateX(24px);
 }

 .setting-row {
 display: flex;
 justify-content: space-between;
 align-items: center;
 padding: 12px;
 background: #353535;
 border-radius: 10px;
 margin-bottom: 10px;
 }

 .setting-info {
 flex: 1;
 }

 .setting-name {
 font-size: 14px;
 font-weight: 600;
 color: #fff;
 margin-bottom: 4px;
 }

 .setting-desc {
 font-size: 11px;
 color: #aaa;
 }

 /* Floating Mini Player - Enhanced */
 .floating-player {
 position: fixed;
 bottom: 20px;
 right: 20px;
 width: 320px;
 background: rgba(26, 26, 26, 0.98);
 backdrop-filter: blur(20px);
 border-radius: 16px;
 padding: 15px;
 box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
 z-index: 100;
 display: none;
 cursor: move;
 border: 2px solid rgba(102, 126, 234, 0.3);
 }

 .floating-player.active {
 display: block;
 animation: slideInUp 0.3s ease;
 }

 .floating-player.pip-mode {
 width: 280px;
 bottom: 80px;
 right: 20px;
 border: 3px solid #667eea;
 box-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
 }

 @keyframes slideInUp {
 from {
 transform: translateY(100px) translateZ(0);
 opacity: 0;
 }
 to {
 transform: translateY(0) translateZ(0);
 opacity: 1;
 }
 }

 .floating-player-header {
 display: flex;
 justify-content: space-between;
 align-items: center;
 margin-bottom: 12px;
 cursor: move;
 }

 .floating-player-title {
 font-size: 13px;
 font-weight: 700;
 color: #fff;
 display: flex;
 align-items: center;
 gap: 6px;
 }

 .floating-player-actions {
 display: flex;
 gap: 6px;
 }

 .floating-action-btn {
 background: rgba(255, 255, 255, 0.1);
 border: none;
 color: #fff;
 width: 24px;
 height: 24px;
 border-radius: 50%;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 font-size: 14px;
 transition: all 0.2s;
 }

 .floating-action-btn:hover {
 background: rgba(255, 255, 255, 0.2);
 transform: scale(1.1);
 }

 .floating-player-video {
 width: 100%;
 height: 180px;
 border-radius: 12px;
 overflow: hidden;
 margin-bottom: 12px;
 background: #000;
 }

 .floating-player-info {
 margin-bottom: 10px;
 }

 .floating-player-song {
 font-size: 14px;
 font-weight: 600;
 color: #fff;
 margin-bottom: 4px;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .floating-player-artist {
 font-size: 12px;
 color: #aaa;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .floating-player-controls {
 display: flex;
 justify-content: center;
 align-items: center;
 gap: 12px;
 }

 .floating-control-btn {
 background: rgba(255, 255, 255, 0.1);
 border: none;
 color: #fff;
 width: 40px;
 height: 40px;
 border-radius: 50%;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 transition: all 0.2s;
 }

 .floating-control-btn:hover {
 background: rgba(255, 255, 255, 0.2);
 transform: scale(1.05);
 }

 .floating-control-btn.large {
 width: 50px;
 height: 50px;
 background: linear-gradient(135deg, #667eea, #764ba2);
 }

 .floating-control-btn svg {
 width: 20px;
 height: 20px;
 fill: currentColor;
 }

 /* Music Visualizer for Sticky Controls */
 .music-visualizer {
 display: flex;
 align-items: flex-end;
 justify-content: center;
 gap: 3px;
 height: 40px;
 max-height: 40px;
 margin: 0 15px;
 flex-shrink: 0;
 overflow: hidden;
 }

 .visualizer-bar {
 width: 4px;
 background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
 border-radius: 2px;
 animation: visualize 0.5s ease-in-out infinite;
 }

 .visualizer-bar:nth-child(1) { animation-delay: 0s; }
 .visualizer-bar:nth-child(2) { animation-delay: 0.05s; }
 .visualizer-bar:nth-child(3) { animation-delay: 0.1s; }
 .visualizer-bar:nth-child(4) { animation-delay: 0.15s; }
 .visualizer-bar:nth-child(5) { animation-delay: 0.2s; }
 .visualizer-bar:nth-child(6) { animation-delay: 0.25s; }
 .visualizer-bar:nth-child(7) { animation-delay: 0.2s; }
 .visualizer-bar:nth-child(8) { animation-delay: 0.15s; }
 .visualizer-bar:nth-child(9) { animation-delay: 0.1s; }
 .visualizer-bar:nth-child(10) { animation-delay: 0.05s; }
 .visualizer-bar:nth-child(11) { animation-delay: 0s; }
 .visualizer-bar:nth-child(12) { animation-delay: 0.05s; }
 .visualizer-bar:nth-child(13) { animation-delay: 0.1s; }
 .visualizer-bar:nth-child(14) { animation-delay: 0.15s; }
 .visualizer-bar:nth-child(15) { animation-delay: 0.2s; }
 .visualizer-bar:nth-child(16) { animation-delay: 0.25s; }
 .visualizer-bar:nth-child(17) { animation-delay: 0.2s; }
 .visualizer-bar:nth-child(18) { animation-delay: 0.15s; }
 .visualizer-bar:nth-child(19) { animation-delay: 0.1s; }
 .visualizer-bar:nth-child(20) { animation-delay: 0.05s; }

 @keyframes visualize {
 0% { height: 8px; opacity: 0.5; transform: scaleY(1); }
 25% { height: 20px; opacity: 0.7; transform: scaleY(1.1); }
 50% { height: 32px; opacity: 1; transform: scaleY(1); }
 75% { height: 24px; opacity: 0.8; transform: scaleY(0.95); }
 100% { height: 8px; opacity: 0.5; transform: scaleY(1); }
 }

 .music-visualizer.playing .visualizer-bar {
 animation-play-state: running;
 }

 .music-visualizer.paused .visualizer-bar {
 animation-play-state: paused;
 height: 8px;
 opacity: 0.3;
 }

 /* Sticky Control Bar */
 .sticky-controls {
 position: fixed !important;
 bottom: 0 !important;
 left: 0 !important;
 right: 0 !important;
 background: rgba(26, 26, 26, 0.98);
 backdrop-filter: blur(20px);
 padding: 12px 20px;
 display: flex;
 align-items: center;
 justify-content: space-between;
 z-index: 10500 !important;
 border-top: 2px solid rgba(102, 126, 234, 0.3);
 box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.3);
 animation: slideInUp 0.3s ease;
 contain: layout style;
 min-height: 74px;
 max-height: 74px;
 }

 .sticky-controls.hidden {
 display: none !important;
 }

 .sticky-info {
 display: flex;
 align-items: center;
 gap: 12px;
 flex: 1;
 min-width: 0;
 }

 .sticky-thumb {
 width: 50px;
 height: 50px;
 border-radius: 8px;
 overflow: hidden;
 flex-shrink: 0;
 background: linear-gradient(135deg, #667eea, #764ba2);
 }

 .sticky-thumb img {
 width: 100%;
 height: 100%;
 object-fit: cover;
 }

 .sticky-text {
 flex: 1;
 min-width: 0;
 }

 .sticky-song {
 font-size: 14px;
 font-weight: 600;
 color: #fff;
 margin-bottom: 2px;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .sticky-artist {
 font-size: 12px;
 color: #aaa;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .sticky-controls-buttons {
 display: flex;
 gap: 10px;
 align-items: center;
 }

 .sticky-btn {
 background: rgba(255, 255, 255, 0.1);
 border: none;
 color: #fff;
 width: 36px;
 height: 36px;
 border-radius: 50%;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 transition: all 0.2s;
 }

 .sticky-btn:hover {
 background: rgba(255, 255, 255, 0.2);
 }

 .sticky-btn.large {
 width: 45px;
 height: 45px;
 background: linear-gradient(135deg, #667eea, #764ba2);
 }

 .sticky-btn svg {
 width: 18px;
 height: 18px;
 fill: currentColor;
 }

 .player-wrapper {
 display: flex;
 justify-content: center;
 align-items: center;
 min-height: 100vh;
 padding: 15px;
 padding-bottom: 100px;
 position: relative;
 z-index: 2;
 }

 .music-player {
 background: #ffffffad;
 border-radius: 24px;
 box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
 width: 100%;
 max-width: 900px;
 padding: 25px;
 position: relative;
 backdrop-filter: blur(10px);
 }

 /* Top Bar with Volume */
 .top-bar {
 display: flex;
 justify-content: space-between;
 align-items: center;
 margin-bottom: 15px;
 padding-bottom: 12px;
 border-bottom: 1px solid #e0e0e0;
 gap: 10px;
 }

 .app-title {
 font-size: 18px;
 font-weight: 700;
 color: #1a1a1a;
 display: flex;
 align-items: center;
 gap: 8px;
 flex-shrink: 1;
 min-width: 0;
 }

 .app-title span:first-child {
 flex-shrink: 0;
 }

 .app-title span:last-child {
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .volume-control-top {
 display: flex;
 align-items: center;
 gap: 8px;
 min-width: 120px;
 flex-shrink: 0;
 }

 .volume-slider-top {
 flex: 1;
 height: 4px;
 background: #e0e0e0;
 border-radius: 10px;
 position: relative;
 cursor: pointer;
 }

 .volume-fill-top {
 height: 100%;
 background: linear-gradient(90deg, #667eea, #764ba2);
 border-radius: 10px;
 width: 70%;
 transition: width 0.1s;
 }

 /* Mood Selector */
 .mood-section {
 margin-bottom: 15px;
 padding: 15px;
 background: #f8f8f8;
 border-radius: 12px;
 position: relative;
 transition: all 0.3s ease;
 isolation: isolate;
 z-index: 1;
 }

 .mood-header {
 display: flex;
 align-items: center;
 justify-content: center;
 margin-bottom: 8px;
 gap: 10px;
 position: relative;
 }

 .mood-title {
 font-size: 36px;
 font-weight: 900;
 font-family: 'Poppins', 'Montserrat', 'Raleway', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
 color: #ffffff;
 text-transform: uppercase;
 letter-spacing: 4px;
 text-shadow: 0 0 20px rgba(102, 126, 234, 0.6),
              0 0 40px rgba(118, 75, 162, 0.4),
              0 4px 8px rgba(0, 0, 0, 0.3),
              0 2px 4px rgba(0, 0, 0, 0.2);
 filter: drop-shadow(0 0 15px rgba(240, 147, 251, 0.5));
 animation: moodTitleGlow 4s ease-in-out infinite;
 position: relative;
 z-index: 10;
 }

 @keyframes moodTitleGlow {
 0%, 100% {
 text-shadow: 0 0 20px rgba(102, 126, 234, 0.6),
              0 0 40px rgba(118, 75, 162, 0.4),
              0 4px 8px rgba(0, 0, 0, 0.3),
              0 2px 4px rgba(0, 0, 0, 0.2);
 }
 50% {
 text-shadow: 0 0 30px rgba(102, 126, 234, 0.8),
              0 0 60px rgba(118, 75, 162, 0.6),
              0 0 80px rgba(240, 147, 251, 0.4),
              0 4px 8px rgba(0, 0, 0, 0.3),
              0 2px 4px rgba(0, 0, 0, 0.2);
 }
 }

 .mood-help-btn {
 width: 26px;
 height: 26px;
 border-radius: 50%;
 background: linear-gradient(135deg, #667eea, #764ba2);
 color: white;
 border: none;
 font-size: 14px;
 font-weight: bold;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 transition: all 0.3s ease;
 box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
 }

 .mood-help-btn:hover {
 transform: scale(1.1);
 box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5);
 }

 /* Random Effect Buttons Row */
 .random-buttons-row {
 display: flex;
 gap: 6px;
 align-items: center;
 justify-content: center;
 margin-bottom: 12px;
 }

 .random-btn {
 padding: 6px 12px;
 border-radius: 10px;
 border: none;
 font-size: 12px;
 font-weight: 600;
 cursor: pointer;
 transition: all 0.3s ease;
 color: white;
 position: relative;
 overflow: hidden;
 box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
 white-space: nowrap;
 }

 .random-btn::before {
 content: '';
 position: absolute;
 top: 50%;
 left: 50%;
 width: 0;
 height: 0;
 border-radius: 50%;
 background: rgba(255, 255, 255, 0.3);
 transform: translate(-50%, -50%);
 transition: width 0.6s, height 0.6s;
 }

 .random-btn:active::before {
 width: 300px;
 height: 300px;
 }

 .random-btn-mood {
 background: linear-gradient(135deg, #667eea, #764ba2);
 }

 .random-btn-mood:hover {
 transform: translateY(-2px) scale(1.05);
 box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
 }

 .random-btn-atmosphere {
 background: linear-gradient(135deg, #43e97b, #38d172);
 }

 .random-btn-atmosphere:hover {
 transform: translateY(-2px) scale(1.05);
 box-shadow: 0 6px 20px rgba(67, 233, 123, 0.4);
 }

 .random-btn-bg {
 background: linear-gradient(135deg, #fa709a, #fee140);
 }

 .random-btn-bg:hover {
 transform: translateY(-2px) scale(1.05);
 box-shadow: 0 6px 20px rgba(250, 112, 154, 0.4);
 }

 .random-btn:active {
 transform: translateY(0) scale(0.95);
 }

 @keyframes randomPulse {
 0%, 100% { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
 50% { box-shadow: 0 6px 24px currentColor; }
 }

 .random-btn.pulsing {
 animation: randomPulse 0.6s ease;
 }

 /* Border Animation Effects */
 @keyframes borderFlash {
 0%, 100% { opacity: 1; }
 50% { opacity: 0.3; }
 }

 @keyframes borderFlicker {
 0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { opacity: 1; }
 20%, 24%, 55% { opacity: 0.4; }
 }

 @keyframes borderBreathing {
 0%, 100% { box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); }
 50% { box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2), 0 0 20px 10px currentColor; }
 }

 @keyframes borderColorShift {
 0% { filter: hue-rotate(0deg); }
 100% { filter: hue-rotate(360deg); }
 }

 .border-flash {
 animation: borderFlash 1.5s ease-in-out infinite;
 }

 .border-flicker {
 animation: borderFlicker 3s linear infinite;
 }

 .border-breathing {
 animation: borderBreathing 2s ease-in-out infinite;
 }

 .border-colorshift {
 animation: borderColorShift 4s linear infinite;
 }

 /* Background Effects Button & Popup */
 .mood-effects-btn {
 position: absolute;
 top: 12px;
 right: 12px;
 width: 34px;
 height: 34px;
 border-radius: 50%;
 background: linear-gradient(135deg, #f093fb, #f5576c);
 color: white;
 border: none;
 font-size: 18px;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 transition: all 0.3s ease;
 box-shadow: 0 2px 8px rgba(245, 87, 108, 0.3);
 z-index: 10;
 }

 .mood-effects-btn:hover {
 transform: scale(1.1) rotate(90deg);
 box-shadow: 0 4px 16px rgba(245, 87, 108, 0.5);
 }

 .mood-effects-popup {
 position: fixed;
 top: 100px;
 right: 20px;
 width: 280px;
 max-height: 0;
 overflow: hidden;
 background: white;
 border-radius: 12px;
 box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
 z-index: 1000;
 transition: max-height 0.3s ease, opacity 0.3s ease;
 opacity: 0;
 }

 .mood-effects-popup.active {
 max-height: 500px;
 opacity: 1;
 overflow-y: auto;
 }

 .mood-effects-header {
 padding: 15px;
 border-bottom: 2px solid #f0f0f0;
 display: flex;
 align-items: center;
 justify-content: space-between;
 background: linear-gradient(135deg, #f093fb, #f5576c);
 color: white;
 border-radius: 12px 12px 0 0;
 }

 .mood-effects-title {
 font-size: 16px;
 font-weight: 700;
 display: flex;
 align-items: center;
 gap: 8px;
 }

 .mood-effects-body {
 padding: 12px;
 max-height: 400px;
 overflow-y: auto;
 }

 .effect-category {
 margin-bottom: 15px;
 }

 .effect-category-title {
 font-size: 13px;
 font-weight: 700;
 color: #667eea;
 margin-bottom: 8px;
 padding: 6px 8px;
 background: rgba(102, 126, 234, 0.1);
 border-radius: 6px;
 cursor: pointer;
 user-select: none;
 display: flex;
 align-items: center;
 justify-content: space-between;
 }

 .effect-category-title:hover {
 background: rgba(102, 126, 234, 0.2);
 }

 .effect-options {
 display: grid;
 grid-template-columns: repeat(2, 1fr);
 gap: 6px;
 margin-top: 6px;
 max-height: 0;
 overflow: hidden;
 transition: max-height 0.3s ease;
 }

 .effect-options.expanded {
 max-height: 500px;
 }

 .effect-btn {
 padding: 8px;
 background: #f8f8f8;
 border: 2px solid transparent;
 border-radius: 8px;
 font-size: 11px;
 font-weight: 600;
 color: #555;
 cursor: pointer;
 transition: all 0.2s ease;
 text-align: center;
 }

 .effect-btn:hover {
 background: #667eea;
 color: white;
 transform: translateY(-2px);
 }

 .effect-btn.active {
 background: linear-gradient(135deg, #667eea, #764ba2);
 color: white;
 border-color: #667eea;
 }

 .effect-controls {
 padding: 12px;
 background: #f8f8f8;
 border-radius: 8px;
 margin-bottom: 10px;
 }

 .effect-control-group {
 margin-bottom: 12px;
 }

 .effect-control-label {
 font-size: 12px;
 font-weight: 600;
 color: #555;
 margin-bottom: 6px;
 display: block;
 }

 .effect-slider {
 width: 100%;
 height: 6px;
 border-radius: 3px;
 background: #ddd;
 outline: none;
 -webkit-appearance: none;
 }

 .effect-slider::-webkit-slider-thumb {
 -webkit-appearance: none;
 appearance: none;
 width: 16px;
 height: 16px;
 border-radius: 50%;
 background: linear-gradient(135deg, #667eea, #764ba2);
 cursor: pointer;
 }

 .effect-slider::-moz-range-thumb {
 width: 16px;
 height: 16px;
 border-radius: 50%;
 background: linear-gradient(135deg, #667eea, #764ba2);
 cursor: pointer;
 border: none;
 }


 .style-control {
 padding: 8px;
 background: #f8f8f8;
 border-radius: 8px;
 margin-bottom: 8px;
 }

 .style-control label {
 font-size: 12px;
 font-weight: 600;
 color: #555;
 margin-bottom: 6px;
 display: block;
 }

 .style-control input[type="color"] {
 width: 100%;
 height: 40px;
 border: 2px solid #ddd;
 border-radius: 8px;
 cursor: pointer;
 }

 .style-control input[type="range"] {
 margin-top: 4px;
 }

 /* Texture Grid - Optimized for performance */
 .texture-grid {
 display: grid;
 grid-template-columns: repeat(5, 1fr);
 gap: 8px;
 margin-top: 8px;
 contain: layout style; /* CSS containment for better performance */
 }

 .texture-btn {
 width: 100%;
 aspect-ratio: 1;
 border: 2px solid #ddd;
 border-radius: 8px;
 cursor: pointer;
 transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
 position: relative;
 overflow: hidden;
 background-size: cover;
 background-position: center;
 contain: layout style paint; /* CSS containment for isolation */
 transform: translateZ(0); /* GPU acceleration hint */
 backface-visibility: hidden; /* Reduce flickering */
 }

 .texture-btn:hover {
 transform: scale(1.05) translateZ(0);
 border-color: #667eea;
 box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
 }

 /* Performance: GPU acceleration for animated textures */
 [class^="texture-"]:not(.texture-btn):not(.texture-none-icon):not(.texture-grid) {
 will-change: transform, opacity;
 transform: translateZ(0);
 }

 .texture-btn.active {
 border-color: #667eea;
 border-width: 3px;
 box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
 }

 .texture-none-icon {
 font-size: 24px;
 color: #999;
 display: flex;
 align-items: center;
 justify-content: center;
 width: 100%;
 height: 100%;
 background: #f0f0f0;
 }

 /* Texture Patterns */
 .texture-speaker-grille {
 background: radial-gradient(circle at 25% 25%, #333 2px, transparent 2px),
             radial-gradient(circle at 75% 25%, #333 2px, transparent 2px),
             radial-gradient(circle at 25% 75%, #333 2px, transparent 2px),
             radial-gradient(circle at 75% 75%, #333 2px, transparent 2px),
             radial-gradient(circle at 50% 50%, #333 2px, transparent 2px),
             #666;
 background-size: 12px 12px;
 background-position: 0 0, 6px 0, 0 6px, 6px 6px, 3px 3px;
 animation: subtlePulse 3s ease-in-out infinite;
 }

 .texture-sound-waves {
 background: repeating-linear-gradient(
   0deg,
   #667eea 0px,
   #667eea 2px,
   transparent 2px,
   transparent 8px
 );
 animation: waveScroll 2s linear infinite;
 }

 .texture-equalizer {
 background: linear-gradient(to top, #764ba2 20%, transparent 20%, transparent 40%, #667eea 40%, #667eea 45%, transparent 45%, transparent 65%, #f093fb 65%, #f093fb 80%, transparent 80%),
             linear-gradient(to top, #667eea 10%, transparent 10%, transparent 50%, #764ba2 50%, #764ba2 60%, transparent 60%, transparent 70%, #f093fb 70%, #f093fb 90%, transparent 90%),
             linear-gradient(to top, #f093fb 30%, transparent 30%, transparent 40%, #667eea 40%, #667eea 70%, transparent 70%, transparent 85%, #764ba2 85%, #764ba2 95%, transparent 95%);
 background-size: 10px 100%, 10px 100%, 10px 100%;
 background-position: 0 0, 12px 0, 24px 0;
 background-repeat: repeat-x;
 animation: equalizerBounce 1.5s ease-in-out infinite;
 }

 .texture-waveform {
 background:
   linear-gradient(135deg, transparent 40%, #667eea 40%, #667eea 45%, transparent 45%),
   linear-gradient(-135deg, transparent 40%, #764ba2 40%, #764ba2 45%, transparent 45%),
   linear-gradient(45deg, transparent 35%, #f093fb 35%, #f093fb 40%, transparent 40%),
   linear-gradient(-45deg, transparent 35%, #667eea 35%, #667eea 40%, transparent 40%),
   #e0e0e0;
 background-size: 15px 15px;
 background-position: 0 0, 0 0, 0 0, 0 0;
 animation: waveformPulse 2s ease-in-out infinite;
 }

 .texture-bass-ripples {
 background: radial-gradient(circle at center, transparent 20%, rgba(102, 126, 234, 0.3) 20%, rgba(102, 126, 234, 0.3) 25%, transparent 25%),
             radial-gradient(circle at center, transparent 40%, rgba(118, 75, 162, 0.3) 40%, rgba(118, 75, 162, 0.3) 45%, transparent 45%),
             radial-gradient(circle at center, transparent 60%, rgba(240, 147, 251, 0.3) 60%, rgba(240, 147, 251, 0.3) 65%, transparent 65%),
             linear-gradient(135deg, #667eea, #764ba2);
 animation: bassRipple 3s ease-in-out infinite;
 }

 .texture-studio-foam {
 background: conic-gradient(from 45deg at 25% 25%, #555 90deg, #777 90deg 180deg, #555 180deg 270deg, #777 270deg),
             conic-gradient(from 45deg at 75% 25%, #777 90deg, #555 90deg 180deg, #777 180deg 270deg, #555 270deg),
             conic-gradient(from 45deg at 25% 75%, #777 90deg, #555 90deg 180deg, #777 180deg 270deg, #555 270deg),
             conic-gradient(from 45deg at 75% 75%, #555 90deg, #777 90deg 180deg, #555 180deg 270deg, #777 270deg),
             #666;
 background-size: 20px 20px;
 background-position: 0 0, 10px 0, 0 10px, 10px 10px;
 }

 /* Texture Animations */
 @keyframes subtlePulse {
 0%, 100% { opacity: 0.8; }
 50% { opacity: 1; }
 }

 @keyframes waveScroll {
 0% { background-position: 0 0; }
 100% { background-position: 0 8px; }
 }

 @keyframes equalizerBounce {
 0%, 100% { transform: scaleY(1); }
 50% { transform: scaleY(1.1); }
 }

 @keyframes waveformPulse {
 0%, 100% { background-size: 15px 15px; }
 50% { background-size: 18px 18px; }
 }

 @keyframes bassRipple {
 0%, 100% { transform: scale(1); }
 50% { transform: scale(1.05); }
 }

 /* New Audio Textures */
 .texture-audio-jack {
 background: radial-gradient(circle at 30% 50%, #333 15%, #666 15%, #666 20%, transparent 20%),
             radial-gradient(circle at 50% 50%, #444 25%, #777 25%, #777 30%, transparent 30%),
             radial-gradient(circle at 70% 50%, #333 15%, #666 15%, #666 20%, transparent 20%),
             linear-gradient(135deg, #2a2a2a, #3a3a3a);
 background-size: 100% 100%;
 animation: jackPulse 2s ease-in-out infinite;
 }

 .texture-mic-mesh {
 background: repeating-linear-gradient(
   0deg,
   #555 0px,
   #555 1px,
   transparent 1px,
   transparent 4px
 ),
 repeating-linear-gradient(
   60deg,
   #666 0px,
   #666 1px,
   transparent 1px,
   transparent 4px
 ),
 repeating-linear-gradient(
   120deg,
   #555 0px,
   #555 1px,
   transparent 1px,
   transparent 4px
 ),
 #444;
 animation: meshBreathe 3s ease-in-out infinite;
 }

 .texture-piano-keys {
 background: repeating-linear-gradient(
   90deg,
   #fff 0px,
   #fff 12px,
   #000 12px,
   #000 15px,
   #fff 15px,
   #fff 27px,
   #000 27px,
   #000 30px,
   #fff 30px,
   #fff 42px,
   #000 42px,
   #000 45px
 );
 background-size: 60px 100%;
 animation: keysSlide 4s linear infinite;
 }

 .texture-guitar-strings {
 background: repeating-linear-gradient(
   0deg,
   #d4af37 0px,
   #d4af37 2px,
   transparent 2px,
   transparent 12px
 ),
 linear-gradient(90deg, rgba(212, 175, 55, 0.1), rgba(212, 175, 55, 0.3));
 animation: stringVibrate 1.5s ease-in-out infinite;
 }

 .texture-drum-skin {
 background: radial-gradient(circle at center, transparent 30%, rgba(139, 69, 19, 0.2) 30%, rgba(139, 69, 19, 0.2) 32%, transparent 32%),
             radial-gradient(circle at center, transparent 50%, rgba(160, 82, 45, 0.2) 50%, rgba(160, 82, 45, 0.2) 52%, transparent 52%),
             radial-gradient(circle at center, transparent 70%, rgba(139, 69, 19, 0.2) 70%, rgba(139, 69, 19, 0.2) 72%, transparent 72%),
             radial-gradient(circle at center, #f5deb3, #d2b48c);
 animation: drumRipple 2s ease-out infinite;
 }

 .texture-foam-pyramids {
 background: linear-gradient(135deg, #444 25%, transparent 25%),
             linear-gradient(225deg, #555 25%, transparent 25%),
             linear-gradient(45deg, #444 25%, transparent 25%),
             linear-gradient(315deg, #555 25%, transparent 25%),
             #333;
 background-size: 20px 20px;
 background-position: 0 0, 10px 0, 10px 10px, 0 10px;
 animation: foamFade 3s ease-in-out infinite;
 }

 .texture-xlr-connector {
 background: radial-gradient(circle at 33% 33%, #888 8%, transparent 8%),
             radial-gradient(circle at 66% 33%, #888 8%, transparent 8%),
             radial-gradient(circle at 50% 66%, #888 8%, transparent 8%),
             radial-gradient(circle at 50% 50%, #555 35%, #777 35%, #777 40%, transparent 40%),
             linear-gradient(135deg, #2a2a2a, #3a3a3a);
 background-size: 100% 100%;
 animation: xlrGlow 2.5s ease-in-out infinite;
 }

 .texture-cassette-tape {
 background: repeating-linear-gradient(
   90deg,
   #8b4513 0px,
   #8b4513 1px,
   #654321 1px,
   #654321 2px,
   #8b4513 2px,
   #8b4513 3px,
   transparent 3px,
   transparent 4px
 ),
 linear-gradient(0deg, #3a2a1a 0%, #4a3a2a 50%, #3a2a1a 100%);
 animation: tapeMove 3s linear infinite;
 }

 .texture-cd-diffraction {
 background: repeating-linear-gradient(
   45deg,
   rgba(102, 126, 234, 0.3) 0px,
   rgba(118, 75, 162, 0.3) 5px,
   rgba(240, 147, 251, 0.3) 10px,
   rgba(102, 126, 234, 0.3) 15px
 ),
 repeating-linear-gradient(
   -45deg,
   rgba(240, 147, 251, 0.2) 0px,
   rgba(102, 126, 234, 0.2) 5px,
   rgba(118, 75, 162, 0.2) 10px,
   rgba(240, 147, 251, 0.2) 15px
 ),
 radial-gradient(circle at center, #e0e0e0, #c0c0c0);
 animation: cdShimmer 3s ease-in-out infinite;
 }

 .texture-mixing-console {
 background: repeating-linear-gradient(
   0deg,
   #333 0px,
   #333 30px,
   #444 30px,
   #444 32px
 ),
 repeating-linear-gradient(
   90deg,
   transparent 0px,
   transparent 8px,
   #555 8px,
   #555 10px,
   transparent 10px,
   transparent 18px
 ),
 linear-gradient(135deg, #2a2a2a, #3a3a3a);
 animation: consoleFade 2.5s ease-in-out infinite;
 }

 /* New Music Wave Textures (10 more amazing patterns) */
 .texture-frequency-spectrum {
 background:
   linear-gradient(to top, #667eea 0%, #667eea 15%, transparent 15%),
   linear-gradient(to top, #764ba2 0%, #764ba2 35%, transparent 35%),
   linear-gradient(to top, #f093fb 0%, #f093fb 25%, transparent 25%),
   linear-gradient(to top, #667eea 0%, #667eea 60%, transparent 60%),
   linear-gradient(to top, #764ba2 0%, #764ba2 45%, transparent 45%),
   linear-gradient(to top, #f093fb 0%, #f093fb 70%, transparent 70%),
   linear-gradient(to top, #667eea 0%, #667eea 30%, transparent 30%),
   linear-gradient(to top, #764ba2 0%, #764ba2 55%, transparent 55%),
   linear-gradient(to top, #f093fb 0%, #f093fb 40%, transparent 40%),
   linear-gradient(to top, #667eea 0%, #667eea 50%, transparent 50%),
   #1a1a1a;
 background-size: 8% 100%;
 background-position: 0% 0%, 10% 0%, 20% 0%, 30% 0%, 40% 0%, 50% 0%, 60% 0%, 70% 0%, 80% 0%, 90% 0%;
 background-repeat: no-repeat;
 animation: spectrumDance 1.2s ease-in-out infinite;
 }

 .texture-oscilloscope {
 background:
   linear-gradient(90deg, transparent 48%, #667eea 48%, #667eea 52%, transparent 52%),
   linear-gradient(0deg, transparent 48%, rgba(102, 126, 234, 0.3) 48%, rgba(102, 126, 234, 0.3) 52%, transparent 52%),
   repeating-linear-gradient(
     90deg,
     transparent 0px,
     transparent 10px,
     rgba(102, 126, 234, 0.1) 10px,
     rgba(102, 126, 234, 0.1) 11px
   ),
   radial-gradient(ellipse 100% 30% at 20% 50%, #f093fb 0%, transparent 50%),
   radial-gradient(ellipse 100% 25% at 50% 50%, #764ba2 0%, transparent 50%),
   radial-gradient(ellipse 100% 35% at 80% 50%, #667eea 0%, transparent 50%),
   #0a0a0a;
 animation: oscilloscopeWave 2s ease-in-out infinite;
 }

 .texture-soundwave-circular {
 background:
   radial-gradient(circle at center, transparent 15%, rgba(102, 126, 234, 0.4) 15%, rgba(102, 126, 234, 0.4) 16%, transparent 16%),
   radial-gradient(circle at center, transparent 30%, rgba(118, 75, 162, 0.4) 30%, rgba(118, 75, 162, 0.4) 31%, transparent 31%),
   radial-gradient(circle at center, transparent 45%, rgba(240, 147, 251, 0.4) 45%, rgba(240, 147, 251, 0.4) 46%, transparent 46%),
   radial-gradient(circle at center, transparent 60%, rgba(102, 126, 234, 0.3) 60%, rgba(102, 126, 234, 0.3) 61%, transparent 61%),
   radial-gradient(circle at center, transparent 75%, rgba(118, 75, 162, 0.3) 75%, rgba(118, 75, 162, 0.3) 76%, transparent 76%),
   radial-gradient(circle at center, #667eea 0%, #764ba2 100%);
 animation: circularPulse 2.5s ease-in-out infinite;
 }

 .texture-amplitude-pulse {
 background:
   repeating-linear-gradient(
     90deg,
     rgba(102, 126, 234, 0.8) 0px,
     rgba(102, 126, 234, 0.8) 2px,
     rgba(118, 75, 162, 0.6) 2px,
     rgba(118, 75, 162, 0.6) 4px,
     rgba(240, 147, 251, 0.8) 4px,
     rgba(240, 147, 251, 0.8) 6px,
     rgba(102, 126, 234, 0.6) 6px,
     rgba(102, 126, 234, 0.6) 8px
   ),
   linear-gradient(0deg, #1a1a1a 0%, #2a2a4a 50%, #1a1a1a 100%);
 animation: amplitudePulse 1.5s ease-in-out infinite;
 }

 .texture-stereo-waves {
 background:
   repeating-linear-gradient(
     180deg,
     transparent 0%,
     transparent 45%,
     rgba(102, 126, 234, 0.3) 45%,
     rgba(102, 126, 234, 0.3) 50%,
     transparent 50%,
     transparent 95%,
     rgba(240, 147, 251, 0.3) 95%,
     rgba(240, 147, 251, 0.3) 100%
   ),
   linear-gradient(90deg,
     #667eea 0%,
     #667eea 2%,
     transparent 2%,
     transparent 48%,
     #764ba2 48%,
     #764ba2 52%,
     transparent 52%,
     transparent 98%,
     #f093fb 98%,
     #f093fb 100%
   ),
   radial-gradient(ellipse 200% 40% at 25% 50%, rgba(102, 126, 234, 0.5), transparent),
   radial-gradient(ellipse 200% 40% at 75% 50%, rgba(240, 147, 251, 0.5), transparent),
   linear-gradient(135deg, #1a1a2a, #2a1a2a);
 animation: stereoWaveMove 2s ease-in-out infinite;
 }

 .texture-frequency-rings {
 background:
   radial-gradient(circle at 30% 30%, transparent 10%, rgba(102, 126, 234, 0.6) 10%, rgba(102, 126, 234, 0.6) 12%, transparent 12%),
   radial-gradient(circle at 30% 30%, transparent 20%, rgba(118, 75, 162, 0.5) 20%, rgba(118, 75, 162, 0.5) 22%, transparent 22%),
   radial-gradient(circle at 70% 70%, transparent 15%, rgba(240, 147, 251, 0.6) 15%, rgba(240, 147, 251, 0.6) 17%, transparent 17%),
   radial-gradient(circle at 70% 70%, transparent 30%, rgba(102, 126, 234, 0.5) 30%, rgba(102, 126, 234, 0.5) 32%, transparent 32%),
   radial-gradient(circle at 50% 50%, transparent 25%, rgba(118, 75, 162, 0.4) 25%, rgba(118, 75, 162, 0.4) 27%, transparent 27%),
   linear-gradient(135deg, #0a0a1a, #1a0a1a);
 animation: ringsPulse 3s ease-in-out infinite;
 }

 .texture-audio-spectrum-3d {
 background:
   linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.5) 100%),
   linear-gradient(to top,
     #667eea 0%, #667eea 20%, transparent 20%, transparent 25%,
     #764ba2 25%, #764ba2 40%, transparent 40%, transparent 45%,
     #f093fb 45%, #f093fb 30%, transparent 30%, transparent 35%,
     #667eea 35%, #667eea 65%, transparent 65%, transparent 70%,
     #764ba2 70%, #764ba2 50%, transparent 50%, transparent 55%,
     #f093fb 55%, #f093fb 75%, transparent 75%, transparent 80%,
     #667eea 80%, #667eea 45%, transparent 45%, transparent 50%,
     #764ba2 50%, #764ba2 60%, transparent 60%
   ),
   repeating-linear-gradient(
     90deg,
     transparent 0px,
     transparent 28px,
     rgba(255, 255, 255, 0.1) 28px,
     rgba(255, 255, 255, 0.1) 30px
   ),
   linear-gradient(135deg, #1a1a2a, #2a1a3a);
 animation: spectrum3dBounce 1.8s ease-in-out infinite;
 }

 .texture-sine-waves {
 background:
   radial-gradient(ellipse 100% 15% at 0% 50%, #667eea, transparent),
   radial-gradient(ellipse 100% 15% at 25% 65%, #764ba2, transparent),
   radial-gradient(ellipse 100% 15% at 50% 35%, #f093fb, transparent),
   radial-gradient(ellipse 100% 15% at 75% 50%, #667eea, transparent),
   radial-gradient(ellipse 100% 15% at 100% 65%, #764ba2, transparent),
   repeating-linear-gradient(
     0deg,
     transparent 0px,
     transparent 24px,
     rgba(102, 126, 234, 0.1) 24px,
     rgba(102, 126, 234, 0.1) 25px
   ),
   linear-gradient(135deg, #0a0a1a, #1a0a2a);
 animation: sineWaveFlow 3s ease-in-out infinite;
 }

 .texture-beat-grid {
 background:
   repeating-linear-gradient(
     0deg,
     transparent 0px,
     transparent 24px,
     rgba(102, 126, 234, 0.4) 24px,
     rgba(102, 126, 234, 0.4) 26px
   ),
   repeating-linear-gradient(
     90deg,
     transparent 0px,
     transparent 24px,
     rgba(118, 75, 162, 0.4) 24px,
     rgba(118, 75, 162, 0.4) 26px
   ),
   repeating-linear-gradient(
     0deg,
     transparent 0px,
     transparent 6px,
     rgba(240, 147, 251, 0.2) 6px,
     rgba(240, 147, 251, 0.2) 7px
   ),
   repeating-linear-gradient(
     90deg,
     transparent 0px,
     transparent 6px,
     rgba(240, 147, 251, 0.2) 6px,
     rgba(240, 147, 251, 0.2) 7px
   ),
   linear-gradient(135deg, #1a1a2a, #2a1a2a);
 animation: beatGridPulse 2s steps(4) infinite;
 }

 .texture-harmonic-waves {
 background:
   radial-gradient(ellipse 150% 30% at 50% 20%, rgba(102, 126, 234, 0.5), transparent),
   radial-gradient(ellipse 120% 25% at 30% 40%, rgba(118, 75, 162, 0.5), transparent),
   radial-gradient(ellipse 140% 35% at 70% 60%, rgba(240, 147, 251, 0.5), transparent),
   radial-gradient(ellipse 130% 28% at 40% 80%, rgba(102, 126, 234, 0.5), transparent),
   repeating-linear-gradient(
     45deg,
     transparent 0px,
     transparent 40px,
     rgba(255, 255, 255, 0.05) 40px,
     rgba(255, 255, 255, 0.05) 42px
   ),
   linear-gradient(135deg, #0a0a1a 0%, #1a0a2a 50%, #2a0a1a 100%);
 animation: harmonicFlow 4s ease-in-out infinite;
 }

 /* New Texture Animations */
 @keyframes jackPulse {
 0%, 100% { opacity: 0.85; }
 50% { opacity: 1; }
 }

 @keyframes meshBreathe {
 0%, 100% { opacity: 0.8; }
 50% { opacity: 1; }
 }

 @keyframes keysSlide {
 0% { background-position: 0 0; }
 100% { background-position: 60px 0; }
 }

 @keyframes stringVibrate {
 0%, 100% { transform: scaleY(1); }
 50% { transform: scaleY(1.02); }
 }

 @keyframes drumRipple {
 0% { transform: scale(1); }
 50% { transform: scale(1.03); }
 100% { transform: scale(1); }
 }

 @keyframes foamFade {
 0%, 100% { opacity: 0.9; }
 50% { opacity: 1; }
 }

 @keyframes xlrGlow {
 0%, 100% { filter: brightness(1); }
 50% { filter: brightness(1.2); }
 }

 @keyframes tapeMove {
 0% { background-position: 0 0; }
 100% { background-position: 4px 0; }
 }

 @keyframes cdShimmer {
 0%, 100% { transform: scale(1); filter: brightness(1); }
 50% { transform: scale(1.05); filter: brightness(1.1); }
 }

 @keyframes consoleFade {
 0%, 100% { opacity: 0.9; }
 50% { opacity: 1; }
 }

 /* New Texture Animations for Music Waves */
 @keyframes spectrumDance {
 0%, 100% {
   background-size: 8% 100%;
 }
 50% {
   background-size: 8% 100%;
 }
 }

 @keyframes oscilloscopeWave {
 0%, 100% {
   background-position: 0% 50%, 50% 0%, 0% 0%, 20% 50%, 50% 50%, 80% 50%, 0% 0%;
 }
 25% {
   background-position: 0% 50%, 50% 0%, 0% 0%, 20% 35%, 50% 65%, 80% 40%, 0% 0%;
 }
 50% {
   background-position: 0% 50%, 50% 0%, 0% 0%, 20% 60%, 50% 40%, 80% 55%, 0% 0%;
 }
 75% {
   background-position: 0% 50%, 50% 0%, 0% 0%, 20% 45%, 50% 55%, 80% 48%, 0% 0%;
 }
 }

 @keyframes circularPulse {
 0%, 100% {
   transform: scale(1);
   opacity: 1;
 }
 50% {
   transform: scale(1.08);
   opacity: 0.9;
 }
 }

 @keyframes amplitudePulse {
 0%, 100% {
   background-size: auto, auto;
   opacity: 0.9;
 }
 50% {
   background-size: auto, auto;
   opacity: 1;
 }
 }

 @keyframes stereoWaveMove {
 0%, 100% {
   background-position: 0% 50%, 0% 0%, 25% 50%, 75% 50%, 0% 0%;
 }
 33% {
   background-position: 0% 60%, 0% 0%, 30% 50%, 70% 50%, 0% 0%;
 }
 66% {
   background-position: 0% 40%, 0% 0%, 20% 50%, 80% 50%, 0% 0%;
 }
 }

 @keyframes ringsPulse {
 0%, 100% {
   transform: scale(1);
   filter: brightness(1);
 }
 50% {
   transform: scale(1.05);
   filter: brightness(1.15);
 }
 }

 @keyframes spectrum3dBounce {
 0%, 100% {
   background-position: 0% 0%, 0% 100%, 0% 0%, 0% 0%;
 }
 25% {
   background-position: 0% 0%, 0% 90%, 0% 0%, 0% 0%;
 }
 50% {
   background-position: 0% 0%, 0% 95%, 0% 0%, 0% 0%;
 }
 75% {
   background-position: 0% 0%, 0% 85%, 0% 0%, 0% 0%;
 }
 }

 @keyframes sineWaveFlow {
 0%, 100% {
   background-position: 0% 50%, 25% 65%, 50% 35%, 75% 50%, 100% 65%, 0% 0%, 0% 0%;
 }
 50% {
   background-position: 0% 50%, 25% 35%, 50% 65%, 75% 50%, 100% 35%, 0% 0%, 0% 0%;
 }
 }

 @keyframes beatGridPulse {
 0%, 100% {
   opacity: 0.8;
 }
 50% {
   opacity: 1;
 }
 }

 @keyframes harmonicFlow {
 0%, 100% {
   background-position: 50% 20%, 30% 40%, 70% 60%, 40% 80%, 0% 0%, 0% 0%;
 }
 33% {
   background-position: 50% 30%, 30% 50%, 70% 50%, 40% 70%, 0% 0%, 0% 0%;
 }
 66% {
   background-position: 50% 25%, 30% 35%, 70% 65%, 40% 75%, 0% 0%, 0% 0%;
 }
 }

 .effect-reset-btn {
 width: 100%;
 padding: 10px;
 background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
 color: white;
 border: none;
 border-radius: 8px;
 font-weight: 700;
 cursor: pointer;
 transition: all 0.2s ease;
 }

 .effect-reset-btn:hover {
 transform: translateY(-2px);
 box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
 }

 .mood-selector-wrapper {
 position: relative;
 display: flex;
 align-items: center;
 gap: 8px;
 }

 .mood-selector {
 display: flex;
 align-items: center;
 gap: 8px;
 overflow-x: auto;
 scrollbar-width: none;
 padding: 5px 0;
 flex: 1;
 scroll-behavior: smooth;
 }

 .mood-selector::-webkit-scrollbar {
 display: none;
 }

 .mood-nav-btn {
 width: 40px;
 height: 40px;
 min-width: 40px;
 border-radius: 50%;
 background: rgba(255, 255, 255, 0.95);
 border: 2px solid #667eea;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 color: #667eea;
 transition: all 0.3s ease;
 box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
 z-index: 10;
 flex-shrink: 0;
 }

 .mood-nav-btn:hover {
 background: linear-gradient(135deg, #667eea, #764ba2);
 color: #fff;
 transform: scale(1.1);
 box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
 }

 .mood-nav-btn:active {
 transform: scale(0.95);
 }

 .mood-nav-btn svg {
 pointer-events: none;
 }

 .mood-option {
 width: 35px;
 height: 35px;
 border-radius: 50%;
 cursor: pointer;
 border: 3px solid transparent;
 transition: all 0.3s ease;
 flex-shrink: 0;
 position: relative;
 }

 .mood-option:hover {
 transform: scale(1.1);
 }

 .mood-option.active {
 border-color: #667eea;
 box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
 transform: scale(1.15);
 }

 .mood-option.active::after {
 content: '\2713';
 position: absolute;
 top: 50%;
 left: 50%;
 transform: translate(-50%, -50%);
 color: white;
 font-size: 16px;
 font-weight: bold;
 text-shadow: 0 0 4px rgba(0,0,0,0.5);
 }

 .mood-option[data-mood="default"] {
 background: linear-gradient(135deg, #667eea, #764ba2);
 }

 .mood-option[data-mood="sunset"] {
 background: linear-gradient(135deg, #ff6b6b, #ffa07a);
 }

 .mood-option[data-mood="ocean"] {
 background: linear-gradient(135deg, #2e3192, #1bffff);
 }

 .mood-option[data-mood="forest"] {
 background: linear-gradient(135deg, #134e5e, #71b280);
 }

 .mood-option[data-mood="midnight"] {
 background: linear-gradient(135deg, #1a1a2e, #0f3460);
 }

 .mood-option[data-mood="aurora"] {
 background: linear-gradient(135deg, #00c6ff, #667eea);
 }

 .mood-option[data-mood="candy"] {
 background: linear-gradient(135deg, #ff0844, #ffb199);
 }

 .mood-option[data-mood="neon"] {
 background: linear-gradient(135deg, #ff00cc, #3333ff);
 }

 .mood-option[data-mood="tropical"] {
 background: linear-gradient(135deg, #f093fb, #f5576c);
 }

 .mood-option[data-mood="cosmic"] {
 background: linear-gradient(135deg, #4a00e0, #8e2de2);
 }

 .mood-option[data-mood="plasma"] {
 background: linear-gradient(135deg, #ff006e, #8338ec, #3a86ff);
 }

 .mood-option[data-mood="starfield"] {
 background: linear-gradient(135deg, #000428, #004e92);
 }

 .mood-option[data-mood="lava"] {
 background: linear-gradient(135deg, #8b0000, #ff4500, #ff6347);
 }

 .mood-option[data-mood="electric"] {
 background: linear-gradient(135deg, #00fff9, #7000ff, #ff00f7);
 }

 .mood-option[data-mood="matrix"] {
 background: linear-gradient(135deg, #001100, #00ff00, #003300);
 }

 .mood-option[data-mood="rainbow"] {
 background: linear-gradient(135deg, #ff0000, #ff7700, #ffdd00, #00ff00, #0088ff, #0000ff, #8800ff);
 }

 .mood-option[data-mood="vaporwave"] {
 background: linear-gradient(135deg, #ff6ec7, #7f00ff, #00d4ff);
 }

 .mood-option[data-mood="fire"] {
 background: linear-gradient(135deg, #000000, #8b0000, #ff4500, #ff8c00);
 }

 .mood-option[data-mood="cyberpunk"] {
 background: linear-gradient(135deg, #ff00de, #00ffff, #ff00de);
 }

 .mood-option[data-mood="galaxy"] {
 background: linear-gradient(135deg, #0f0c29, #302b63, #667eea, #764ba2);
 }

 .mood-option[data-mood="glitch"] {
 background: linear-gradient(135deg, #000000, #ff0000, #00ff00, #0000ff);
 }

 .mood-option[data-mood="lightning"] {
 background: linear-gradient(135deg, #1a1a2e, #ffffff, #16213e);
 }

 .mood-option[data-mood="pulse"] {
 background: radial-gradient(circle, #ff006e, #3a86ff);
 }

 .mood-option[data-mood="prism"] {
 background: conic-gradient(from 0deg, #ff0000, #ff7700, #ffdd00, #00ff00, #0088ff, #0000ff, #8800ff, #ff0000);
 }

 .mood-option[data-mood="hologram"] {
 background: linear-gradient(135deg, #00ffff, #ff00ff, #00ffff);
 }

 .mood-option[data-mood="laser"] {
 background: linear-gradient(135deg, #000000, #ff0066, #ff0066);
 }

 .mood-option[data-mood="warp"] {
 background: radial-gradient(ellipse, #8e2de2, #4a00e0);
 }

 .mood-option[data-mood="disco"] {
 background: linear-gradient(135deg, #ff00ff, #00ffff, #ffff00);
 }

 .mood-option[data-mood="nuclear"] {
 background: radial-gradient(circle, #00ff00, #003300);
 }

 .mood-option[data-mood="supernova"] {
 background: radial-gradient(circle, #ffffff, #ff4500, #8b0000);
 }

 .mood-option[data-mood="oceanic"] {
 background: linear-gradient(135deg, #006994, #1a5f7a);
 }

 .mood-option[data-mood="desert"] {
 background: linear-gradient(135deg, #ff8c42, #ffa600);
 }

 .mood-option[data-mood="arctic"] {
 background: linear-gradient(135deg, #e0f7ff, #89c2d9);
 }

 .mood-option[data-mood="jungle"] {
 background: linear-gradient(135deg, #1e4620, #2c5364);
 }

 .mood-option[data-mood="cherry"] {
 background: linear-gradient(135deg, #ffb3d9, #ff99cc);
 }

 .mood-option[data-mood="thunder"] {
 background: linear-gradient(135deg, #4a5568, #2d3748);
 }

 .mood-option[data-mood="mystic"] {
 background: linear-gradient(135deg, #5b3a70, #44318d);
 }

 .mood-option[data-mood="cybergrid"] {
 background: linear-gradient(135deg, #00ff9f, #7000ff);
 }

 .mood-option[data-mood="royal"] {
 background: linear-gradient(135deg, #7209b7, #5a189a);
 }

 .mood-option[data-mood="golden"] {
 background: linear-gradient(135deg, #ffd700, #ffa500);
 }

 .mood-option[data-mood="nebula"] {
 background: linear-gradient(135deg, #b794f6, #f093fb);
 }

 .mood-option[data-mood="crimson"] {
 background: linear-gradient(135deg, #dc2626, #b91c1c);
 }

 .mood-option[data-mood="emerald"] {
 background: linear-gradient(135deg, #10b981, #047857);
 }

 .mood-option[data-mood="solar"] {
 background: radial-gradient(circle, #fff7ed, #fb923c, #ea580c);
 }

 .mood-option[data-mood="moonlight"] {
 background: linear-gradient(135deg, #e0e7ff, #5b21b6);
 }

 .mood-option[data-mood="sakura"] {
 background: linear-gradient(135deg, #ffb7d5, #ff99c8);
 }

 .mood-option[data-mood="volcano"] {
 background: linear-gradient(135deg, #ff4500, #8b0000);
 }

 .mood-option[data-mood="arcticaurora"] {
 background: linear-gradient(135deg, #00fff2, #005f7f);
 }

 .mood-option[data-mood="amethyst"] {
 background: linear-gradient(135deg, #b19cd9, #6a0dad);
 }

 .mood-option[data-mood="emeraldforest"] {
 background: linear-gradient(135deg, #2ecc71, #0b3d0b);
 }

 .mood-option[data-mood="sunsetbeach"] {
 background: linear-gradient(135deg, #ff9a76, #f28c28);
 }

 .mood-option[data-mood="deepocean"] {
 background: linear-gradient(135deg, #006994, #001a33);
 }

 .mood-option[data-mood="rosegold"] {
 background: linear-gradient(135deg, #ffd1dc, #d4a5a5);
 }

 .mood-option[data-mood="cosmos"] {
 background: linear-gradient(135deg, #6d28d9, #0f0728);
 }

 .mood-option[data-mood="phoenix"] {
 background: linear-gradient(135deg, #ffa500, #8b0000);
 }

 /* Playlist Tabs */
 .playlist-tabs-wrapper {
 position: relative;
 margin-bottom: 15px;
 }

 .playlist-tabs-container {
 display: flex;
 align-items: center;
 gap: 6px;
 overflow-x: auto;
 padding-bottom: 8px;
 padding-right: 55px;
 scrollbar-width: thin;
 scrollbar-color: #667eea #f0f0f0;
 }

 .playlist-tabs-container::-webkit-scrollbar {
 height: 6px;
 }

 .playlist-tabs-container::-webkit-scrollbar-track {
 background: #f0f0f0;
 border-radius: 10px;
 }

 .playlist-tabs-container::-webkit-scrollbar-thumb {
 background: #667eea;
 border-radius: 10px;
 }

 .playlist-tab {
 padding: 8px 8px 8px 14px;
 background: #f5f5f5;
 border: 2px solid transparent;
 border-radius: 10px;
 font-size: 13px;
 font-weight: 600;
 color: #666;
 cursor: pointer;
 transition: all 0.3s ease;
 white-space: nowrap;
 flex-shrink: 0;
 display: flex;
 align-items: center;
 gap: 8px;
 max-width: 150px;
 }

 .playlist-tab span:first-child {
 overflow: hidden;
 text-overflow: ellipsis;
 white-space: nowrap;
 flex: 1;
 min-width: 0;
 }

 .playlist-tab:hover {
 background: #e8e8e8;
 color: #333;
 }

 .playlist-tab.active {
 background: linear-gradient(135deg, #667eea, #764ba2);
 color: white;
 }

 .playlist-tab-delete {
 width: 18px;
 height: 18px;
 border-radius: 50%;
 background: rgba(255, 255, 255, 0.3);
 display: flex;
 align-items: center;
 justify-content: center;
 font-size: 14px;
 line-height: 1;
 cursor: pointer;
 transition: all 0.2s ease;
 font-weight: 700;
 flex-shrink: 0;
 }

 .playlist-tab-delete:hover {
 background: rgba(255, 255, 255, 0.5);
 transform: scale(1.1);
 }

 .playlist-tab-add-song {
 width: 18px;
 height: 18px;
 border-radius: 50%;
 background: rgba(67, 233, 123, 0.4);
 display: flex;
 align-items: center;
 justify-content: center;
 font-size: 12px;
 line-height: 1;
 cursor: pointer;
 transition: all 0.2s ease;
 font-weight: 700;
 flex-shrink: 0;
 margin-right: 4px;
 }

 .playlist-tab-add-song:hover {
 background: rgba(67, 233, 123, 0.6);
 transform: scale(1.1);
 }

 .add-playlist-btn {
 position: absolute;
 right: 5px;
 top: 50%;
 transform: translateY(-50%);
 width: 40px;
 height: 40px;
 background: linear-gradient(135deg, #43e97b, #38d172);
 border: none;
 border-radius: 10px;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 font-size: 22px;
 font-weight: bold;
 color: white;
 transition: all 0.3s ease;
 box-shadow: 0 4px 15px rgba(67, 233, 123, 0.3);
 z-index: 10;
 }

 .add-playlist-btn:hover {
 transform: translateY(calc(-50% - 2px));
 box-shadow: 0 6px 20px rgba(67, 233, 123, 0.4);
 }

 /* Mobile floating add button - hidden by default */
 .add-playlist-btn-mobile {
 display: none;
 }

 .import-playlist-btn {
 width: 100%;
 padding: 12px;
 background: linear-gradient(135deg, #FF0000, #CC0000);
 color: white;
 border: none;
 border-radius: 12px;
 font-size: 14px;
 font-weight: 600;
 cursor: pointer;
 margin-bottom: 15px;
 transition: all 0.3s ease;
 display: flex;
 align-items: center;
 justify-content: center;
 gap: 8px;
 }

 .import-playlist-btn:hover {
 transform: translateY(-2px);
 box-shadow: 0 8px 20px rgba(255, 0, 0, 0.3);
 }

 .loading-spinner {
 display: inline-block;
 width: 16px;
 height: 16px;
 border: 3px solid rgba(255, 255, 255, 0.3);
 border-top-color: white;
 border-radius: 50%;
 animation: spin 0.8s linear infinite;
 }

 @keyframes spin {
 to { transform: rotate(360deg); }
 }

 /* Floating Player Controls */
 .pip-controls {
 display: flex;
 gap: 8px;
 margin-bottom: 15px;
 }

 .pip-btn {
 flex: 1;
 padding: 10px;
 background: linear-gradient(135deg, #667eea, #764ba2);
 color: white;
 border: none;
 border-radius: 10px;
 font-size: 13px;
 font-weight: 600;
 cursor: pointer;
 transition: all 0.3s ease;
 display: flex;
 align-items: center;
 justify-content: center;
 gap: 6px;
 }

 .pip-btn:hover {
 transform: translateY(-2px);
 box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
 }

 .pip-btn.active {
 background: linear-gradient(135deg, #43e97b, #38d172);
 }

 /* Video Player */
 .video-player-container {
 width: 100%;
 height: 350px;
 border-radius: 16px;
 overflow: hidden;
 margin-bottom: 20px;
 box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
 position: relative;
 background: #000;
 transition: all 0.3s ease;
 }

 #player {
 width: 100%;
 height: 100%;
 }

 .song-info {
 margin-bottom: 15px;
 }

 .song-title {
 font-size: 20px;
 font-weight: 700;
 color: #1a1a1a;
 margin-bottom: 5px;
 }

 .artist-name {
 font-size: 15px;
 color: #666;
 font-weight: 500;
 }

 .progress-container {
 margin: 20px 0;
 }

 .progress-bar {
 width: 100%;
 height: 6px;
 background: #e0e0e0;
 border-radius: 10px;
 position: relative;
 cursor: pointer;
 margin-bottom: 8px;
 }

 .progress-fill {
 height: 100%;
 background: linear-gradient(90deg, #667eea, #764ba2);
 border-radius: 10px;
 width: 0%;
 transition: width 0.1s linear;
 position: relative;
 }

 .progress-fill::after {
 content: '';
 position: absolute;
 right: -6px;
 top: 50%;
 transform: translateY(-50%);
 width: 14px;
 height: 14px;
 background: #667eea;
 border-radius: 50%;
 box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
 }

 .time-display {
 display: flex;
 justify-content: space-between;
 font-size: 12px;
 color: #888;
 font-weight: 500;
 }

 .controls {
 display: flex;
 justify-content: center;
 align-items: center;
 gap: 15px;
 margin: 25px 0;
 }

 .control-btn {
 background: none;
 border: none;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 transition: all 0.3s ease;
 color: #333;
 }

 .control-btn:hover {
 transform: scale(1.1);
 }

 .control-btn.small {
 width: 32px;
 height: 32px;
 }

 .control-btn.medium {
 width: 40px;
 height: 40px;
 }

 .control-btn.large {
 width: 55px;
 height: 55px;
 background: linear-gradient(135deg, #667eea, #764ba2);
 border-radius: 50%;
 color: white;
 box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
 }

 .control-btn.large:hover {
 box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
 }

 .control-btn.active {
 color: #667eea;
 }

 .control-btn svg {
 width: 100%;
 height: 100%;
 }

 /* Horizontal Carousel */
 .carousel-section {
 margin: 20px 0;
 padding: 15px 0;
 border-top: 1px solid #e0e0e0;
 border-bottom: 1px solid #e0e0e0;
 }

 .carousel-header {
 display: flex;
 justify-content: space-between;
 align-items: center;
 margin-bottom: 12px;
 padding: 0 8px;
 }

 .carousel-header h3 {
 font-size: 15px;
 font-weight: 700;
 color: #1a1a1a;
 }

 .carousel-container {
 position: relative;
 padding: 0 45px;
 }

 .carousel-wrapper {
 overflow: hidden;
 border-radius: 12px;
 }

 .carousel-track {
 display: flex;
 gap: 10px;
 transition: transform 0.3s ease;
 }

 .carousel-item {
 min-width: calc(33.333% - 7px);
 background: #f8f8f8;
 border-radius: 10px;
 padding: 10px;
 cursor: pointer;
 transition: all 0.3s ease;
 display: flex;
 align-items: center;
 gap: 10px;
 border: 3px solid transparent;
 }

 .carousel-item:hover {
 background: #f0f0f0;
 transform: translateY(-2px);
 box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
 }

 .carousel-item.active {
 background: #e8f5e9;
 border-color: #43e97b;
 box-shadow: 0 4px 12px rgba(67, 233, 123, 0.3);
 }

 .carousel-item.playing {
 background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
 border-color: #43e97b;
 animation: pulse 2s ease-in-out infinite;
 }

 @keyframes pulse {
 0%, 100% {
 box-shadow: 0 4px 12px rgba(67, 233, 123, 0.3);
 }
 50% {
 box-shadow: 0 6px 20px rgba(67, 233, 123, 0.5);
 }
 }

 .carousel-thumb {
 width: 50px;
 height: 50px;
 border-radius: 8px;
 overflow: hidden;
 flex-shrink: 0;
 background: linear-gradient(135deg, #667eea, #764ba2);
 }

 .carousel-thumb img {
 width: 100%;
 height: 100%;
 object-fit: cover;
 }

 .carousel-info {
 flex: 1;
 min-width: 0;
 }

 .carousel-title {
 font-size: 13px;
 font-weight: 600;
 color: #1a1a1a;
 margin-bottom: 3px;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .carousel-artist {
 font-size: 11px;
 color: #888;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .carousel-duration {
 font-size: 12px;
 color: #666;
 font-weight: 600;
 flex-shrink: 0;
 }

 .carousel-playing-badge {
 display: inline-block;
 padding: 2px 6px;
 background: #43e97b;
 color: white;
 border-radius: 4px;
 font-size: 9px;
 font-weight: 700;
 margin-left: 4px;
 text-transform: uppercase;
 }

 .carousel-nav {
 position: absolute;
 top: 50%;
 transform: translateY(-50%);
 width: 36px;
 height: 36px;
 background: white;
 border: 2px solid #e0e0e0;
 border-radius: 50%;
 display: flex;
 align-items: center;
 justify-content: center;
 cursor: pointer;
 transition: all 0.3s ease;
 z-index: 10;
 box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
 }

 .carousel-nav:hover {
 background: #667eea;
 border-color: #667eea;
 color: white;
 transform: translateY(-50%) scale(1.1);
 }

 .carousel-nav.prev {
 left: 0;
 }

 .carousel-nav.next {
 right: 0;
 }

 .carousel-nav svg {
 width: 18px;
 height: 18px;
 }

 /* Playlist Library Button */
 .library-button {
 width: 100%;
 padding: 12px;
 background: linear-gradient(135deg, #667eea, #764ba2);
 color: white;
 border: none;
 border-radius: 12px;
 font-size: 15px;
 font-weight: 600;
 cursor: pointer;
 margin: 20px 0;
 transition: all 0.3s ease;
 display: flex;
 align-items: center;
 justify-content: center;
 gap: 8px;
 box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
 }

 .library-button:hover {
 transform: translateY(-2px);
 box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
 }

 /* Vertical Playlist */
 .playlist-header {
 display: flex;
 justify-content: space-between;
 align-items: center;
 margin-bottom: 10px;
 padding: 0 8px;
 }

 .playlist-header h3 {
 font-size: 16px;
 font-weight: 700;
 color: #1a1a1a;
 }

 .playlist-count {
 font-size: 13px;
 color: #888;
 font-weight: 500;

 .playlist-header-add-btn {
 padding: 6px 12px;
 background: linear-gradient(135deg, #43e97b, #38d9a9);
 color: white;
 border: none;
 border-radius: 6px;
 font-size: 12px;
 font-weight: 600;
 cursor: pointer;
 transition: all 0.2s ease;
 }

 .playlist-header-add-btn:hover {
 transform: translateY(-1px);
 box-shadow: 0 4px 12px rgba(67, 233, 123, 0.3);
 }
 }

 .playlist-container {
 margin-top: 15px;
 }

 .playlist-scroll {
 max-height: 400px;
 overflow-y: auto;
 overflow-x: hidden;
 padding-right: 8px;
 scrollbar-width: thin;
 scrollbar-color: #667eea #f0f0f0;
 }

 .playlist-scroll::-webkit-scrollbar {
 width: 8px;
 }

 .playlist-scroll::-webkit-scrollbar-track {
 background: #f0f0f0;
 border-radius: 10px;
 }

 .playlist-scroll::-webkit-scrollbar-thumb {
 background: linear-gradient(135deg, #667eea, #764ba2);
 border-radius: 10px;
 }

 .playlist-item {
 display: flex;
 align-items: center;
 padding: 10px;
 border-radius: 10px;
 cursor: pointer;
 transition: all 0.3s ease;
 margin-bottom: 6px;
 }

 .playlist-item:hover {
 background: #f5f5f5;
 }

 .playlist-item.active {
 background: #f0f0ff;
 }

 .playlist-thumb {
 width: 45px;
 height: 45px;
 border-radius: 8px;
 margin-right: 12px;
 overflow: hidden;
 flex-shrink: 0;
 background: linear-gradient(135deg, #667eea, #764ba2);
 }

 .playlist-thumb img {
 width: 100%;
 height: 100%;
 object-fit: cover;
 }

 .playlist-thumb-placeholder {
 width: 100%;
 height: 100%;
 display: flex;
 align-items: center;
 justify-content: center;
 color: white;
 font-weight: bold;
 font-size: 16px;
 }

 .playlist-info {
 flex: 1;
 min-width: 0;
 }

 .playlist-title {
 font-size: 14px;
 font-weight: 600;
 color: #1a1a1a;
 margin-bottom: 3px;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .playlist-artist {
 font-size: 12px;
 color: #888;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .playlist-duration {
 font-size: 13px;
 color: #888;
 font-weight: 500;
 margin-left: 12px;
 flex-shrink: 0;
 }

 .playlist-delete-btn {
 width: 32px;
 height: 32px;
 border-radius: 50%;
 background: transparent;
 border: none;
 cursor: pointer;
 margin-left: 8px;
 flex-shrink: 0;
 display: flex;
 align-items: center;
 justify-content: center;
 color: #888;
 transition: all 0.2s ease;
 opacity: 0;
 }

 .playlist-item:hover .playlist-delete-btn {
 opacity: 1;
 }

 .playlist-delete-btn:hover {
 background: rgba(255, 59, 48, 0.1);
 color: #ff3b30;
 transform: scale(1.1);
 }

 .playlist-delete-btn:active {
 transform: scale(0.95);
 }

 .playlist-delete-btn svg {
 width: 18px;
 height: 18px;
 }

 /* Library Modal */
 .modal-overlay {
 position: fixed;
 top: 0;
 left: 0;
 right: 0;
 bottom: 0;
 background: rgba(0, 0, 0, 0.7);
 display: none;
 align-items: center;
 justify-content: center;
 z-index: 9000;
 backdrop-filter: blur(5px);
 pointer-events: none;
 }

 .modal-overlay.active {
 display: flex;
 align-items: center;
 justify-content: center;
 pointer-events: auto;
 }

 .modal {
 background: #2a2a2a;
 border-radius: 20px;
 width: 90%;
 max-width: 800px;
 max-height: 80vh;
 padding: 0;
 animation: modalFadeIn 0.3s ease;
 overflow: hidden;
 display: flex;
 flex-direction: column;
 position: absolute;
 top: 50%;
 left: 50%;
 transform: translate(-50%, -50%);
 z-index: 9001;
 }

 @keyframes modalFadeIn {
 from {
 opacity: 0;
 transform: translate(-50%, -50%) scale(0.95) translateZ(0);
 }
 to {
 opacity: 1;
 transform: translate(-50%, -50%) scale(1) translateZ(0);
 }
 }

 .modal-header {
 padding: 20px;
 border-bottom: 1px solid #3a3a3a;
 display: flex;
 justify-content: space-between;
 align-items: center;
 flex-shrink: 0;
 }

 .modal-title {
 font-size: 20px;
 font-weight: 700;
 color: #fff;
 margin: 0;
 }

 .modal-close {
 background: none;
 border: none;
 color: #667eea;
 font-size: 15px;
 font-weight: 600;
 cursor: pointer;
 padding: 5px 10px;
 }

 .modal-close:hover {
 color: #764ba2;
 }

 .modal-body {
 padding: 20px;
 overflow-y: auto;
 flex: 1;
 }

 .modal-body::-webkit-scrollbar {
 width: 8px;
 }

 .modal-body::-webkit-scrollbar-track {
 background: #353535;
 border-radius: 10px;
 }

 .modal-body::-webkit-scrollbar-thumb {
 background: linear-gradient(135deg, #667eea, #764ba2);
 border-radius: 10px;
 }

 /* Mood Help Modal Styles */
 .mood-help-modal {
 max-width: 1200px;
 max-height: 85vh;
 }

 .mood-help-content {
 padding: 15px;
 }

 .mood-category {
 margin-bottom: 25px;
 }

 .mood-category-title {
 font-size: 18px;
 font-weight: 700;
 color: #fff;
 margin-bottom: 12px;
 padding-bottom: 8px;
 border-bottom: 2px solid rgba(102, 126, 234, 0.3);
 display: flex;
 align-items: center;
 gap: 8px;
 }

 .mood-list {
 display: grid;
 grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
 gap: 10px;
 }

 /* Accessibility & Performance: Reduce animations for users who prefer reduced motion */
 @media (prefers-reduced-motion: reduce) {
 /* Disable texture animations */
 [class^="texture-"]:not(.texture-btn):not(.texture-none-icon):not(.texture-grid) {
   animation: none !important;
 }

 /* Reduce mood animations */
 .mood-section {
   animation-duration: 0.01ms !important;
 }

 /* Simplify transitions */
 * {
   animation-duration: 0.01ms !important;
   animation-iteration-count: 1 !important;
   transition-duration: 0.01ms !important;
 }
 }

 @media (max-width: 768px) {
 .mood-help-modal {
 max-width: 95vw;
 }

 .mood-list {
 grid-template-columns: 1fr;
 }
 }

 .mood-item {
 background: rgba(102, 126, 234, 0.1);
 border: 1px solid rgba(102, 126, 234, 0.2);
 border-radius: 10px;
 padding: 12px;
 font-size: 14px;
 color: #ccc;
 transition: all 0.3s ease;
 display: flex;
 align-items: flex-start;
 gap: 10px;
 cursor: pointer;
 }

 .mood-item:hover {
 background: rgba(102, 126, 234, 0.25);
 border-color: rgba(102, 126, 234, 0.5);
 transform: translateY(-2px);
 box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
 }

 .mood-item:active {
 transform: translateY(0);
 box-shadow: 0 2px 6px rgba(102, 126, 234, 0.2);
 }

 .mood-emoji {
 font-size: 20px;
 flex-shrink: 0;
 }

 .mood-item strong {
 color: #fff;
 font-weight: 600;
 }

 .library-status {
 text-align: center;
 padding: 20px;
 color: #aaa;
 font-size: 14px;
 }

 .library-empty {
 text-align: center;
 padding: 50px 20px;
 color: #888;
 }

 .library-empty-icon {
 font-size: 54px;
 margin-bottom: 15px;
 opacity: 0.5;
 }

 .library-empty-text {
 font-size: 15px;
 line-height: 1.6;
 }

 .library-grid {
 display: grid;
 grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
 gap: 15px;
 }

 .library-card {
 background: #353535;
 border-radius: 12px;
 overflow: hidden;
 transition: all 0.3s ease;
 cursor: pointer;
 }

 .library-card:hover {
 transform: translateY(-4px);
 box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
 background: #404040;
 }

 .library-card-image {
 width: 100%;
 height: 140px;
 background: linear-gradient(135deg, #667eea, #764ba2);
 position: relative;
 overflow: hidden;
 }

 .library-card-image img {
 width: 100%;
 height: 100%;
 object-fit: cover;
 }

 .library-card-badge {
 position: absolute;
 top: 8px;
 right: 8px;
 background: rgba(0, 0, 0, 0.7);
 color: white;
 padding: 3px 7px;
 border-radius: 6px;
 font-size: 10px;
 font-weight: 600;
 }

 .library-card-content {
 padding: 12px;
 }

 .library-card-title {
 font-size: 15px;
 font-weight: 700;
 color: #fff;
 margin-bottom: 6px;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .library-card-meta {
 display: flex;
 justify-content: space-between;
 align-items: center;
 margin-bottom: 10px;
 }

 .library-card-tracks {
 font-size: 12px;
 color: #aaa;
 }

 .library-card-date {
 font-size: 10px;
 color: #888;
 }

 .library-card-actions {
 display: flex;
 gap: 6px;
 }

 .library-add-btn {
 flex: 1;
 padding: 7px;
 background: linear-gradient(135deg, #43e97b, #38d172);
 color: white;
 border: none;
 border-radius: 8px;
 font-size: 12px;
 font-weight: 600;
 cursor: pointer;
 transition: all 0.3s ease;
 display: flex;
 align-items: center;
 justify-content: center;
 gap: 5px;
 }

 .library-add-btn:hover {
 transform: translateY(-2px);
 box-shadow: 0 4px 12px rgba(67, 233, 123, 0.4);
 }

 /* Library Search */
 .library-search-container {
 padding: 15px 20px;
 background: #2a2a2a;
 border-bottom: 1px solid #3a3a3a;
 position: relative;
 }

 .library-search-wrapper {
 display: flex;
 gap: 10px;
 }

 .library-search-input {
 flex: 1;
 padding: 10px 15px;
 background: #1f1f1f;
 border: 2px solid #3a3a3a;
 border-radius: 10px;
 color: #fff;
 font-size: 14px;
 transition: all 0.3s ease;
 }

 .library-search-input:focus {
 outline: none;
 border-color: #667eea;
 background: #2a2a2a;
 }

 .library-search-input::placeholder {
 color: #666;
 }

 .library-search-btn {
 padding: 10px 24px;
 background: linear-gradient(135deg, #667eea, #764ba2);
 color: #fff;
 border: none;
 border-radius: 10px;
 font-size: 14px;
 font-weight: 600;
 cursor: pointer;
 transition: all 0.3s ease;
 white-space: nowrap;
 }

 .library-search-btn:hover {
 transform: translateY(-2px);
 box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
 }

 .library-search-preview {
 position: absolute;
 top: 100%;
 left: 20px;
 right: 20px;
 background: #1f1f1f;
 border: 2px solid #667eea;
 border-radius: 10px;
 max-height: 300px;
 overflow-y: auto;
 z-index: 1000;
 margin-top: 5px;
 box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
 display: none;
 }

 .library-search-preview.active {
 display: block;
 animation: fadeIn 0.2s ease;
 }

 .library-search-preview-item {
 padding: 12px 15px;
 border-bottom: 1px solid #2a2a2a;
 cursor: pointer;
 transition: all 0.2s ease;
 }

 .library-search-preview-item:last-child {
 border-bottom: none;
 }

 .library-search-preview-item:hover {
 background: #2a2a2a;
 }

 .library-search-preview-title {
 color: #fff;
 font-size: 13px;
 font-weight: 600;
 margin-bottom: 3px;
 }

 .library-search-preview-info {
 color: #888;
 font-size: 11px;
 }

 .library-search-preview-empty {
 padding: 20px;
 text-align: center;
 color: #666;
 font-size: 13px;
 }

 /* Library Pagination */
 .library-pagination {
 display: flex;
 align-items: center;
 justify-content: center;
 padding: 15px 20px;
 gap: 8px;
 background: #2a2a2a;
 border-top: 1px solid #3a3a3a;
 flex-wrap: wrap;
 }

 .library-pagination-btn {
 padding: 8px 14px;
 background: #3a3a3a;
 color: #fff;
 border: none;
 border-radius: 8px;
 font-size: 13px;
 font-weight: 600;
 cursor: pointer;
 transition: all 0.3s ease;
 min-width: 36px;
 }

 .library-pagination-btn:hover:not(:disabled) {
 background: #4a4a4a;
 transform: translateY(-2px);
 }

 .library-pagination-btn:disabled {
 opacity: 0.3;
 cursor: not-allowed;
 }

 .library-pagination-btn.active {
 background: linear-gradient(135deg, #667eea, #764ba2);
 color: #fff;
 }

 .library-pagination-btn.dots {
 background: transparent;
 cursor: default;
 color: #666;
 }

 .library-pagination-info {
 color: #888;
 font-size: 12px;
 margin: 0 10px;
 }

 /* Library Loading Skeleton */
 .library-skeleton {
 display: grid;
 grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
 gap: 15px;
 }

 .library-skeleton-card {
 background: #2a2a2a;
 border-radius: 12px;
 overflow: hidden;
 animation: pulse 1.5s ease-in-out infinite;
 }

 .library-skeleton-image {
 width: 100%;
 height: 140px;
 background: linear-gradient(90deg, #2a2a2a 25%, #353535 50%, #2a2a2a 75%);
 background-size: 200% 100%;
 animation: shimmer 1.5s ease-in-out infinite;
 }

 .library-skeleton-content {
 padding: 12px;
 }

 .library-skeleton-title {
 height: 16px;
 background: #353535;
 border-radius: 4px;
 margin-bottom: 8px;
 width: 80%;
 }

 .library-skeleton-text {
 height: 12px;
 background: #353535;
 border-radius: 4px;
 margin-bottom: 6px;
 }

 .library-skeleton-text:last-child {
 width: 60%;
 }

 @keyframes shimmer {
 0% { background-position: -200% 0; }
 100% { background-position: 200% 0; }
 }

 @keyframes pulse {
 0%, 100% { opacity: 1; }
 50% { opacity: 0.7; }
 }

 @keyframes fadeIn {
 from { opacity: 0; transform: translateY(-10px); }
 to { opacity: 1; transform: translateY(0); }
 }

 /* Library Fade Transition */
 .library-fade-out {
 opacity: 0;
 transition: opacity 0.3s ease;
 }

 .library-fade-in {
 opacity: 1;
 transition: opacity 0.3s ease;
 }

/* Easter Egg Modal */
.easter-egg-modal {
max-width: 600px;
max-height: 85vh;
overflow-y: auto;
}

.easter-egg-content {
padding: 20px;
display: flex;
flex-direction: column;
gap: 15px;
}

.easter-egg-option {
background: #2a2a2a;
border-radius: 12px;
padding: 15px;
border: 2px solid #3a3a3a;
transition: all 0.3s ease;
}

.easter-egg-option:hover {
border-color: #667eea;
box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
}

.easter-egg-option-header {
display: flex;
align-items: center;
gap: 12px;
margin-bottom: 12px;
}

.easter-egg-icon {
font-size: 24px;
width: 40px;
height: 40px;
display: flex;
align-items: center;
justify-content: center;
background: rgba(102, 126, 234, 0.1);
border-radius: 10px;
flex-shrink: 0;
}

.easter-egg-option-info {
flex: 1;
}

.easter-egg-option-title {
font-size: 15px;
font-weight: 600;
color: #fff;
margin-bottom: 4px;
}

.easter-egg-option-desc {
font-size: 12px;
color: #999;
}

.easter-egg-control {
display: flex;
align-items: center;
gap: 12px;
}

.easter-egg-slider {
flex: 1;
height: 6px;
border-radius: 3px;
background: #3a3a3a;
outline: none;
-webkit-appearance: none;
}

.easter-egg-slider::-webkit-slider-thumb {
-webkit-appearance: none;
appearance: none;
width: 18px;
height: 18px;
border-radius: 50%;
background: linear-gradient(135deg, #667eea, #764ba2);
cursor: pointer;
box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
}

.easter-egg-slider::-moz-range-thumb {
width: 18px;
height: 18px;
border-radius: 50%;
background: linear-gradient(135deg, #667eea, #764ba2);
cursor: pointer;
border: none;
box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
}

.easter-egg-value {
font-size: 13px;
font-weight: 600;
color: #667eea;
min-width: 45px;
text-align: right;
}

.easter-egg-select {
flex: 1;
padding: 8px 12px;
background: #3a3a3a;
border: 2px solid #4a4a4a;
border-radius: 8px;
color: #fff;
font-size: 13px;
cursor: pointer;
transition: all 0.3s ease;
}

.easter-egg-select:hover {
border-color: #667eea;
}

.easter-egg-select:focus {
outline: none;
border-color: #667eea;
box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.easter-egg-toggle {
position: relative;
width: 50px;
height: 26px;
cursor: pointer;
}

.easter-egg-toggle input {
opacity: 0;
width: 0;
height: 0;
}

.easter-egg-toggle-slider {
position: absolute;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: #3a3a3a;
border-radius: 26px;
transition: all 0.3s ease;
}

.easter-egg-toggle-slider:before {
content: "";
position: absolute;
height: 20px;
width: 20px;
left: 3px;
bottom: 3px;
background: #fff;
border-radius: 50%;
transition: all 0.3s ease;
}

.easter-egg-toggle input:checked + .easter-egg-toggle-slider {
background: linear-gradient(135deg, #667eea, #764ba2);
}

.easter-egg-toggle input:checked + .easter-egg-toggle-slider:before {
transform: translateX(24px);
}

.easter-egg-footer {
margin-top: 10px;
padding-top: 15px;
border-top: 1px solid #3a3a3a;
}

.easter-egg-reset {
width: 100%;
padding: 12px;
background: rgba(255, 107, 107, 0.1);
border: 2px solid rgba(255, 107, 107, 0.3);
border-radius: 10px;
color: #ff6b6b;
font-size: 14px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
}

.easter-egg-reset:hover {
background: rgba(255, 107, 107, 0.2);
border-color: #ff6b6b;
transform: translateY(-2px);
}

.mood-title {
cursor: pointer;
transition: all 0.3s ease;
user-select: none;
}

.mood-title:hover {
text-shadow: 0 0 30px rgba(102, 126, 234, 1),
             0 0 60px rgba(118, 75, 162, 0.8),
             0 0 80px rgba(240, 147, 251, 0.6),
             0 4px 8px rgba(0, 0, 0, 0.3);
transform: scale(1.05);
}

 .input-modal-content {
 padding: 20px;
 }

 .input-group {
 margin-bottom: 15px;
 }

 .input-label {
 display: block;
 font-size: 13px;
 font-weight: 600;
 color: #aaa;
 margin-bottom: 6px;
 }

 .input-field {
 width: 100%;
 padding: 10px 12px;
 background: #353535;
 border: 2px solid #3a3a3a;
 border-radius: 10px;
 color: #fff;
 font-size: 14px;
 transition: all 0.3s ease;
 }


 .manual-playlist-toggle {
 display: flex;
 align-items: center;
 cursor: pointer;
 user-select: none;
 }

 .manual-playlist-toggle input[type="checkbox"] {
 width: 20px;
 height: 20px;
 margin-right: 10px;
 cursor: pointer;
 }

 .manual-playlist-label {
 font-size: 14px;
 font-weight: 600;
 color: #667eea;
 }
 .input-field:focus {
 outline: none;
 border-color: #667eea;
 background: #3a3a3a;
 }

 .input-field::placeholder {
 color: #666;
 }

 .modal-actions {
 display: flex;
 gap: 10px;
 margin-top: 20px;
 }

 .modal-btn {
 flex: 1;
 padding: 11px;
 border: none;
 border-radius: 10px;
 font-size: 15px;
 font-weight: 600;
 cursor: pointer;
 transition: all 0.3s ease;
 }

 .modal-btn.cancel {
 background: #3a3a3a;
 color: #fff;
 }

 .modal-btn.cancel:hover {
 background: #444;
 }

 .modal-btn.save {
 background: linear-gradient(135deg, #667eea, #764ba2);
 color: #fff;
 }

 .modal-btn.save:hover {
 transform: translateY(-2px);
 box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
 }

 .empty-state {
 text-align: center;
 padding: 35px 15px;
 color: #999;
 }

 .empty-state-icon {
 font-size: 54px;
 margin-bottom: 15px;
 opacity: 0.5;
 }

 .empty-state-text {
 font-size: 14px;
 line-height: 1.6;
 }

 /* Responsive */
 @media (max-width: 768px) {
 .player-wrapper {
 padding: 10px;
 padding-bottom: 100px;
 }

 .music-player {
 padding: 18px;
 border-radius: 20px;
 }

 .app-title {
 font-size: 16px;
 }

 .volume-control-top {
 min-width: 100px;
 }

 .video-player-container {
 height: 220px;
 margin-bottom: 15px;
 }

 .song-title {
 font-size: 18px;
 }

 .artist-name {
 font-size: 14px;
 }

 .carousel-container {
 padding: 0 38px;
 }

 .carousel-item {
 min-width: calc(50% - 5px);
 padding: 8px;
 gap: 8px;
 }

 .carousel-thumb {
 width: 45px;
 height: 45px;
 }

 .carousel-title {
 font-size: 12px;
 }

 .carousel-artist {
 font-size: 10px;
 }

 .carousel-duration {
 font-size: 11px;
 }

 .library-grid {
 grid-template-columns: 1fr;
 }

 .modal {
 width: 95%;
 max-height: 85vh;
 }

 .modal-title {
 font-size: 18px;
 }

 .mood-list {
 grid-template-columns: 1fr;
 gap: 8px;
 }

 .mood-item {
 padding: 10px;
 font-size: 13px;
 }

 .mood-emoji {
 font-size: 18px;
 }

 .mood-category-title {
 font-size: 16px;
 }

 .top-bar {
 flex-wrap: wrap;
 }

 .mood-section {
 padding: 12px;
 margin-bottom: 12px;
 }

 .mood-title {
 font-size: 28px;
 letter-spacing: 3px;
 }

 .random-buttons-row {
 gap: 4px;
 margin-bottom: 10px;
 }

 .random-btn {
 padding: 5px 8px;
 font-size: 10px;
 }

 /* Hide navigation buttons on mobile - touch scrolling works fine */
 .mood-nav-btn {
 display: none;
 }

 .mood-selector {
 gap: 6px;
 padding: 5px 0;
 }

 .mood-option {
 width: 30px;
 height: 30px;
 min-width: 30px;
 border-width: 2px;
 }

 .mood-option.active::after {
 font-size: 14px;
 }

 .playlist-tabs-container {
 padding-right: 48px;
 }

 .playlist-tab {
 font-size: 12px;
 padding: 7px 6px 7px 12px;
 max-width: 130px;
 gap: 6px;
 }

 .playlist-tab-delete {
 width: 16px;
 height: 16px;
 font-size: 13px;
 }

 .add-playlist-btn {
 width: 36px;
 height: 36px;
 font-size: 20px;
 }

 .import-playlist-btn {
 font-size: 13px;
 padding: 10px;
 }

 .controls {
 gap: 12px;
 }

 .control-btn.small {
 width: 28px;
 height: 28px;
 }

 .control-btn.medium {
 width: 36px;
 height: 36px;
 }

 .control-btn.large {
 width: 50px;
 height: 50px;
 }

 .pip-btn {
 font-size: 12px;
 padding: 8px;
 }

 .floating-player {
 width: 280px;
 bottom: 10px;
 right: 10px;
 }

 .floating-player-video {
 height: 160px;
 }

 .sticky-controls {
 padding: 6px 10px;
 flex-direction: row;
 flex-wrap: wrap;
 gap: 6px;
 min-height: auto;
 max-height: none;
 align-items: center;
 }

 .sticky-info {
 flex: 1;
 order: 2;
 min-width: 0;
 display: flex;
 align-items: center;
 gap: 8px;
 }

 .sticky-thumb {
 width: 32px;
 height: 32px;
 flex-shrink: 0;
 }

 .sticky-text {
 flex: 1;
 min-width: 0;
 }

 .sticky-song {
 font-size: 12px;
 }

 .sticky-artist {
 font-size: 10px;
 }

 .music-visualizer {
 width: 100%;
 order: 1;
 height: 20px;
 max-height: 20px;
 margin: 0;
 }

 .visualizer-bar {
 width: 3px;
 }

 .sticky-controls-buttons {
 order: 3;
 display: flex;
 justify-content: flex-end;
 gap: 10px;
 flex-shrink: 0;
 }

 .sticky-btn {
 width: 38px;
 height: 38px;
 }

 .sticky-btn.large {
 width: 46px;
 height: 46px;
 }

 /* Mobile floating add playlist button */
 .add-playlist-btn-mobile {
 display: flex;
 position: fixed;
 bottom: 60px;
 left: 50%;
 transform: translateX(-50%);
 width: 56px;
 height: 56px;
 border-radius: 50%;
 background: linear-gradient(135deg, #43e97b, #38d172);
 color: white;
 border: none;
 font-size: 28px;
 font-weight: 300;
 cursor: pointer;
 align-items: center;
 justify-content: center;
 box-shadow: 0 4px 20px rgba(67, 233, 123, 0.5);
 z-index: 10600;
 transition: all 0.3s ease;
 }

 .add-playlist-btn-mobile:active {
 transform: translateX(-50%) scale(0.9);
 }

 /* Hide desktop add playlist button on mobile */
 .playlist-tabs-wrapper .add-playlist-btn {
 display: none;
 }

 .settings-btn {
 width: 45px;
 height: 45px;
 top: 15px;
 right: 15px;
 }

 .settings-btn svg {
 width: 24px;
 height: 24px;
 }

 .settings-modal {
 width: 95%;
 max-width: 95%;
 max-height: 90vh;
 }

 /* Effects Button and Popup Mobile Styles */
 .mood-effects-btn {
 width: 32px;
 height: 32px;
 top: 10px;
 right: 10px;
 font-size: 16px;
 }

 .mood-effects-popup {
 right: 10px;
 left: auto;
 width: calc(100vw - 20px);
 max-width: 320px;
 }

 .mood-effects-popup.active {
 max-height: 420px;
 }

 .style-control input[type="color"] {
 height: 35px;
 }

 /* Library Search and Pagination Mobile Styles */
 .library-search-container {
 padding: 10px 12px;
 }

 .library-search-input {
 font-size: 13px;
 padding: 8px 12px;
 }

 .library-search-btn {
 padding: 8px 14px;
 font-size: 13px;
 }

 .library-search-preview-item {
 padding: 8px 10px;
 }

 .library-search-preview-title {
 font-size: 13px;
 }

 .library-search-preview-info {
 font-size: 10px;
 }

 .library-pagination {
 padding: 10px 12px;
 gap: 6px;
 }

 /* Simplify pagination on mobile - show only prev/next and current page */
 .library-pagination-btn:not(.prev):not(.next):not(.active) {
 display: none;
 }

 .library-pagination-btn {
 padding: 6px 10px;
 font-size: 12px;
 min-width: 32px;
 }

 .library-pagination-info {
 font-size: 11px;
 }

 .library-skeleton {
 grid-template-columns: 1fr;
 }

 .library-skeleton-item {
 height: 100px;
 }
 }

 @media (min-width: 769px) {
 .music-player {
 max-width: 900px;
 }
 }
 </style>
<script>
// CRITICAL FIX: Define YouTube player event callbacks BEFORE DOMContentLoaded
// This prevents race condition where player tries to use undefined callbacks

// YouTube Player Event Handlers - MUST be defined before player creation
window.onPlayerReady = function(event) {
  console.log('âœ… YouTube Player Ready!');

  // CRITICAL FIX: Use event.target to get the player object
  // The player in event.target is guaranteed to be ready
  window.player = event.target;
  window.playerReady = true;

  // Set volume (now player is guaranteed to exist)
  if (window.volume !== undefined) {
    window.player.setVolume(window.volume);
    console.log('ğŸ”Š Volume set to:', window.volume);
  } else {
    window.player.setVolume(70); // Default volume
    console.log('ğŸ”Š Volume set to default: 70');
  }

  const songs = window.getCurrentSongs();
  console.log('ğŸ“‹ Songs in current playlist:', songs.length);
  if (songs.length > 0) {
    console.log('ğŸµ Auto-selecting first song...');
    window.selectSong(0);
    window.updateStickyControlsInfo();
  } else {
    console.log('âš ï¸ No songs available to auto-select');
  }
};

window.onPlayerStateChange = function(event) {
  if (event.data === YT.PlayerState.PLAYING) {
    window.isPlaying = true;
    window.playIcon.style.display = 'none';
    window.pauseIcon.style.display = 'block';
    window.updateAllPlayButtons('pause');
    window.updateVisualizerState();
    window.startProgressUpdater();

    // Update Media Session state
    if ('mediaSession' in navigator) {
      navigator.mediaSession.playbackState = 'playing';
    }
  } else if (event.data === YT.PlayerState.PAUSED) {
    window.isPlaying = false;
    window.playIcon.style.display = 'block';
    window.pauseIcon.style.display = 'none';
    window.updateAllPlayButtons('play');
    window.updateVisualizerState();
    window.stopProgressUpdater();

    // Update Media Session state
    if ('mediaSession' in navigator) {
      navigator.mediaSession.playbackState = 'paused';
    }
  } else if (event.data === YT.PlayerState.ENDED) {
    window.handleSongEnd();
  }
};

// YouTube Player Initialization - Define callback BEFORE DOMContentLoaded
// This ensures the callback exists when YouTube API finishes loading
var ytPlayerReadyToInit = false;
var domIsReady = false;

window.onYouTubeIframeAPIReady = function() {
  console.log('âœ… YouTube API loaded via callback');
  ytPlayerReadyToInit = true;
  initYouTubePlayerWhenReady();
};

// CRITICAL FIX: Check if YouTube API already loaded
// If YT object exists, the API loaded before we defined the callback
if (typeof YT !== 'undefined' && YT.Player) {
  console.log('âœ… YouTube API already loaded - initializing immediately');
  ytPlayerReadyToInit = true;
}

function initYouTubePlayerWhenReady() {
  if (ytPlayerReadyToInit && domIsReady && document.getElementById('player')) {
    console.log('ğŸ¬ Creating YouTube player...');
    try {
      window.player = new YT.Player('player', {
        height: '100%',
        width: '100%',
        videoId: '',
        playerVars: {
          'autoplay': 0,
          'controls': 0,
          'rel': 0,
          'showinfo': 0,
          'modestbranding': 1,
          'playsinline': 1
        },
        events: {
          'onReady': window.onPlayerReady,
          'onStateChange': window.onPlayerStateChange
        }
      });
      console.log('âœ… YouTube player created successfully');
    } catch (error) {
      console.error('âŒ Error creating YouTube player:', error);
    }
  } else {
    console.log('â³ Waiting... YT Ready:', ytPlayerReadyToInit, '| DOM Ready:', domIsReady, '| Player div exists:', !!document.getElementById('player'));
  }
}

// Wait for DOM to be ready before accessing elements
document.addEventListener('DOMContentLoaded', function() {
domIsReady = true;
console.log('âœ… DOM Ready - attempting player initialization...');
initYouTubePlayerWhenReady();

 // Firebase Configuration
 const firebaseConfig = {
 apiKey: "AIzaSyDPjVCn59pOyBUVW0vy0e5gAmbvunR8Eaw",
 authDomain: "music-player-library.firebaseapp.com",
 databaseURL: "https://music-player-library-default-rtdb.firebaseio.com",
 projectId: "music-player-library",
 storageBucket: "music-player-library.firebasestorage.app",
 messagingSenderId: "1021984826826",
 appId: "1:1021984826826:web:b24eaa21402b5a00485b33",
 measurementId: "G-NRMYDTH8BG"
};

 // Initialize Firebase
 window.database = null;
 window.firebaseAvailable = false;

 try {
 firebase.initializeApp(firebaseConfig);
 window.database = firebase.database();
 window.firebaseAvailable = true;
 console.log('âœ“ Firebase connected - Community library active!');
 } catch (e) {
 console.log('âš ï¸ Firebase unavailable - Using localStorage fallback');
 window.firebaseAvailable = false;
 }

 // YouTube API Configuration
 const YOUTUBE_API_KEY = 'AIzaSyBijIimhG2s_uzGQybB13Iw0SQxwLTwQ4Y';
 const YOUTUBE_API_BASE = 'https://www.googleapis.com/youtube/v3';

 // Data structures
 window.playlists = [];
 window.playlistLibrary = [];
 window.currentPlaylistIndex = 0;
 window.currentSongIndex = 0;
 window.isPlaying = false;
 window.isShuffled = false;
 window.repeatMode = 0;
 window.volume = 70;
 window.isMuted = false;
 window.carouselOffset = 0;

 // Settings
 window.settings = {
 stickyControls: true,
 visualizer: true,
 backgroundAnim: true,
 floatingPlayer: false
 };

 // YouTube Player
 window.player = null;
 window.playerReady = false;
 window.progressInterval = null;

 // Floating Player State
 window.floatingPlayerActive = false;
 window.isDragging = false;
 window.dragOffsetX = 0;
 window.dragOffsetY = 0;
 window.popoutWindow = null;

 // DOM Elements
 window.playPauseBtn = document.getElementById('playPauseBtn');
 window.playIcon = document.getElementById('playIcon');
 window.pauseIcon = document.getElementById('pauseIcon');
 window.prevBtn = document.getElementById('prevBtn');
 window.nextBtn = document.getElementById('nextBtn');
 window.shuffleBtn = document.getElementById('shuffleBtn');
 window.repeatBtn = document.getElementById('repeatBtn');
 window.progressBar = document.getElementById('progressBar');
 window.progressFill = document.getElementById('progressFill');
 window.currentTimeEl = document.getElementById('currentTime');
 window.totalTimeEl = document.getElementById('totalTime');
 window.songTitle = document.getElementById('songTitle');
 window.artistName = document.getElementById('artistName');
 window.playlistContainer = document.getElementById('playlist');
 window.playlistCount = document.getElementById('playlistCount');
 window.volumeBtn = document.getElementById('volumeBtn');
 window.volumeIcon = document.getElementById('volumeIcon');
 window.muteIcon = document.getElementById('muteIcon');
 window.volumeSlider = document.getElementById('volumeSlider');
 window.volumeFill = document.getElementById('volumeFill');

 // Mood section and effects
 window.moodSection = document.querySelector('.mood-section');
 window.moodEffectsBtn = document.getElementById('moodEffectsBtn');
 window.moodEffectsPopup = document.getElementById('moodEffectsPopup');
 window.playlistTabsContainer = document.getElementById('playlistTabs');
 window.addPlaylistBtn = document.getElementById('addPlaylistBtn');
 
 // Settings elements
 window.settingsBtn = document.getElementById('settingsBtn');
 window.settingsModalOverlay = document.getElementById('settingsModalOverlay');
 window.closeSettingsModal = document.getElementById('closeSettingsModal');
 window.toggleStickyControls = document.getElementById('toggleStickyControls');
 window.toggleVisualizer = document.getElementById('toggleVisualizer');
 window.toggleBackgroundAnim = document.getElementById('toggleBackgroundAnim');
 window.toggleFloatingPlayerSetting = document.getElementById('toggleFloatingPlayer');
 
 // Floating Player elements
 window.floatingPlayer = document.getElementById('floatingPlayer');
 window.floatingPlayerBtn = document.getElementById('floatingPlayerBtn');
 window.closeFloatingPlayer = document.getElementById('closeFloatingPlayer');
 window.popoutWindowBtn = document.getElementById('popoutWindowBtn');
 window.floatingSongTitle = document.getElementById('floatingSongTitle');
window.addSongModalOverlay = document.getElementById('addSongModalOverlay');
window.closeAddSongModal = document.getElementById('closeAddSongModal');
window.cancelAddSong = document.getElementById('cancelAddSong');
window.addSongBtn = document.getElementById('addSongBtn');
window.addSongVideoUrl = document.getElementById('addSongVideoUrl');
window.addSongStatus = document.getElementById('addSongStatus');
window.addSongBtnText = document.getElementById('addSongBtnText');
window.addSongModalTitle = document.getElementById('addSongModalTitle');

window.targetPlaylistIndex = null;

 window.floatingArtistName = document.getElementById('floatingArtistName');
 window.floatingPlayPauseBtn = document.getElementById('floatingPlayPauseBtn');
 window.floatingPrevBtn = document.getElementById('floatingPrevBtn');
 window.floatingNextBtn = document.getElementById('floatingNextBtn');
 
 // Sticky Controls elements
 window.stickyControls = document.getElementById('stickyControls');
 window.stickySongTitle = document.getElementById('stickySongTitle');
 window.stickyArtistName = document.getElementById('stickyArtistName');
 window.stickyThumb = document.getElementById('stickyThumb');
 window.stickyPlayPauseBtn = document.getElementById('stickyPlayPauseBtn');
 window.stickyPrevBtn = document.getElementById('stickyPrevBtn');
 window.stickyNextBtn = document.getElementById('stickyNextBtn');
 window.musicVisualizer = document.getElementById('musicVisualizer');
 
 // Carousel elements
 window.carouselSection = document.getElementById('carouselSection');
 window.carouselTrack = document.getElementById('carouselTrack');
 window.carouselPrev = document.getElementById('carouselPrev');
 window.carouselNext = document.getElementById('carouselNext');
 
 // Library elements
 window.libraryBtn = document.getElementById('libraryBtn');
 window.libraryBadge = document.getElementById('libraryBadge');
 window.libraryModalOverlay = document.getElementById('libraryModalOverlay');
 window.libraryModalBody = document.getElementById('libraryModalBody');
 window.closeLibraryModal = document.getElementById('closeLibraryModal');
 
 // Import modal elements
 window.importPlaylistBtn = document.getElementById('importPlaylistBtn');
 window.playlistModalOverlay = document.getElementById('playlistModalOverlay');
 window.closePlaylistModal = document.getElementById('closePlaylistModal');
 window.cancelPlaylist = document.getElementById('cancelPlaylist');
 window.loadPlaylist = document.getElementById('loadPlaylist');
 window.playlistUrlInput = document.getElementById('playlistUrlInput');
 window.playlistNameInput = document.getElementById('playlistNameInput');
 window.playlistStatus = document.getElementById('playlistStatus');
 window.loadPlaylistText = document.getElementById('loadPlaylistText');
window.manualPlaylistCheckbox = document.getElementById('manualPlaylistCheckbox');
window.playlistUrlGroup = document.getElementById('playlistUrlGroup');
window.videoUrlGroup = document.getElementById('videoUrlGroup');
window.videoUrlInput = document.getElementById('videoUrlInput');
window.communityNotice = document.getElementById('communityNotice');
window.playlistModalTitle = document.getElementById('playlistModalTitle');


 // Mood Management
 window.moodOptions = document.querySelectorAll('.mood-option');
 window.currentMood = 'default';

window.loadMood = function() {
 const savedMood = localStorage.getItem('musicPlayerMood') || 'default';
 window.applyMood(savedMood);
 }

window.applyMood = function(mood) {
 window.currentMood = mood;
 document.body.className = mood !== 'default' ? `mood-${mood}` : '';

 window.moodOptions.forEach(option => {
 option.classList.toggle('active', option.dataset.mood === mood);
 });

 localStorage.setItem('musicPlayerMood', mood);

 // Update sticky color if Easter egg feature is enabled
 if (typeof updateStickyColor === 'function') {
 updateStickyColor(mood);
 }
 }

 window.moodOptions.forEach(option => {
 option.addEventListener('click', () => {
 window.applyMood(option.dataset.mood);
 });
 });

 // Mood Navigation Buttons
 const moodSelector = document.getElementById('moodSelector');
 const moodNavLeft = document.getElementById('moodNavLeft');
 const moodNavRight = document.getElementById('moodNavRight');

 if (moodNavLeft && moodNavRight && moodSelector) {
 moodNavLeft.addEventListener('click', () => {
 const scrollAmount = 200; // Scroll 200px to the left
 moodSelector.scrollBy({
 left: -scrollAmount,
 behavior: 'smooth'
 });
 });

 moodNavRight.addEventListener('click', () => {
 const scrollAmount = 200; // Scroll 200px to the right
 moodSelector.scrollBy({
 left: scrollAmount,
 behavior: 'smooth'
 });
 });
 }

 // Random Effect Functions
 const allMoods = ['default', 'sunset', 'ocean', 'forest', 'midnight', 'aurora', 'candy', 'neon', 'tropical', 'cosmic', 'plasma', 'starfield', 'lava', 'electric', 'matrix', 'rainbow', 'vaporwave', 'fire', 'twilight', 'galaxy'];
 const allAtmosphereEffects = ['shake', 'sway', 'float', 'wobble', 'tilt3d', 'flicker', 'glitch', 'rgbsplit', 'wavemotion', 'ripple', 'prism', 'borderpulse', 'neonglow', 'rainbowborder', 'shadowdance', 'electricedges'];
 const colorPalette = ['#667eea', '#764ba2', '#f093fb', '#43e97b', '#fa709a', '#fee140', '#667eea', '#ff6b6b', '#ffa07a', '#2e3192', '#1bffff', '#38d172'];

window.applyRandomMood = function() {
 const randomMood = allMoods[Math.floor(Math.random() * allMoods.length)];
 window.applyMood(randomMood);

 // Randomize MOOD title opacity (30-100%)
 const moodTitle = document.querySelector('.mood-title');
 if (moodTitle) {
 const randomOpacity = (Math.floor(Math.random() * 71) + 30) / 100; // 30-100%
 moodTitle.style.opacity = randomOpacity;
 }

 const btn = document.getElementById('randomMoodBtn');
 btn.classList.add('pulsing');
 setTimeout(() => btn.classList.remove('pulsing'), 600);
}

window.applyRandomAtmosphere = function() {
 // CRITICAL FIX: Disable transitions during randomization to prevent flickering
 document.body.classList.add('no-transition');

 // Clear all effects first
 window.activeEffects = [];
 document.querySelectorAll('.effect-btn').forEach(btn => {
 btn.classList.remove('active');
 });

 // Pick 1-3 random effects to combine
 const numEffects = Math.floor(Math.random() * 3) + 1;
 const availableEffects = ['heartbeat', 'flash', 'glowpulse', 'scalebounce', 'breathe', 'beatdrop', 'shake', 'sway', 'float', 'wobble', 'tilt3d', 'flicker', 'glitch', 'rgbsplit', 'wavemotion', 'ripple', 'prism', 'borderpulse', 'neonglow', 'rainbowborder', 'shadowdance', 'electricedges'];

 // Randomly select effects
 const shuffled = availableEffects.sort(() => 0.5 - Math.random());
 const selectedEffects = shuffled.slice(0, numEffects);

 // Add to activeEffects and mark buttons as active
 selectedEffects.forEach(effect => {
 window.activeEffects.push(effect);
 const btn = document.querySelector(`.effect-btn[data-effect="${effect}"]`);
 if (btn) btn.classList.add('active');
 });

 // Apply effects
 window.updateEffects();

 // Randomize MOOD title opacity (30-100%)
 const moodTitle = document.querySelector('.mood-title');
 if (moodTitle) {
 const randomOpacity = (Math.floor(Math.random() * 71) + 30) / 100; // 30-100%
 moodTitle.style.opacity = randomOpacity;
 }

 // Re-enable transitions after effects are applied
 requestAnimationFrame(() => {
 requestAnimationFrame(() => {
 document.body.classList.remove('no-transition');
 });
 });

 const btn = document.getElementById('randomAtmosphereBtn');
 btn.classList.add('pulsing');
 setTimeout(() => btn.classList.remove('pulsing'), 600);
}

window.applyRandomBgEffects = function() {
 // Choose random mode for variety
 const modes = ['minimal', 'moderate', 'dramatic', 'neon', 'retro'];
 const mode = modes[Math.floor(Math.random() * modes.length)];

 // Random background color
 const randomColor = colorPalette[Math.floor(Math.random() * colorPalette.length)];
 bgColor.value = randomColor;

 // Random opacity (60-100%) - NOW INCLUDED!
 const randomOpacity = Math.floor(Math.random() * 41) + 60;
 bgOpacity.value = randomOpacity;
 bgOpacityValue.textContent = randomOpacity + '%';

 // Random blur based on mode
 let randomBlur = 0;
 if (mode === 'dramatic' || mode === 'neon') {
 randomBlur = Math.floor(Math.random() * 16) + 5; // 5-20px
 } else if (mode === 'moderate') {
 randomBlur = Math.floor(Math.random() * 11); // 0-10px
 } // minimal and retro: no blur

 bgBlur.value = randomBlur;
 bgBlurValue.textContent = randomBlur + 'px';

 // Random border radius (8-30px) - LIMITED!
 const randomRadius = Math.floor(Math.random() * 23) + 8;
 borderRadius.value = randomRadius;
 borderRadiusValue.textContent = randomRadius + 'px';

 // Random shadow depth based on mode
 let randomShadow = 0;
 if (mode === 'dramatic' || mode === 'neon') {
 randomShadow = Math.floor(Math.random() * 21) + 10; // 10-30px
 } else if (mode === 'moderate') {
 randomShadow = Math.floor(Math.random() * 16); // 0-15px
 } else if (mode === 'retro') {
 randomShadow = Math.floor(Math.random() * 6); // 0-5px
 }

 bgShadowDepth.value = randomShadow;
 bgShadowDepthValue.textContent = randomShadow + 'px';

 // Random border glow (3-8px) - EVEN SMALLER!
 let randomGlow = 0;
 if (mode === 'neon') {
 randomGlow = Math.floor(Math.random() * 6) + 3; // 3-8px
 } else if (mode === 'dramatic') {
 randomGlow = Math.floor(Math.random() * 4) + 3; // 3-6px
 } else if (mode === 'moderate') {
 randomGlow = Math.floor(Math.random() * 3) + 3; // 3-5px
 }

 const randomGlowColor = colorPalette[Math.floor(Math.random() * colorPalette.length)];
 bgBorderGlow.value = randomGlow;
 bgBorderGlowValue.textContent = randomGlow + 'px';
 bgBorderGlowColor.value = randomGlowColor;

 // Random border animation
 const borderAnimations = ['border-flash', 'border-flicker', 'border-breathing', 'border-colorshift'];
 const randomAnimation = borderAnimations[Math.floor(Math.random() * borderAnimations.length)];

 // Random CSS border (width and style) - NEW!
 let borderStyle = 'none';
 let borderWidth = 0;
 let borderColor = randomGlowColor;

 if (mode === 'retro') {
 borderStyle = ['solid', 'dashed', 'dotted', 'double'][Math.floor(Math.random() * 4)];
 borderWidth = Math.floor(Math.random() * 3) + 2; // 2-4px
 } else if (mode === 'dramatic') {
 borderStyle = 'solid';
 borderWidth = Math.floor(Math.random() * 2) + 1; // 1-2px
 }

 // Random filters - NEW!
 const saturation = Math.floor(Math.random() * 41) + 80; // 80-120%
 const brightness = Math.floor(Math.random() * 21) + 90; // 90-110%
 const contrast = Math.floor(Math.random() * 21) + 90; // 90-110%

 // Apply all effects to mood section
 window.moodSection.style.backgroundColor = randomColor;
 window.moodSection.style.opacity = (randomOpacity / 100);
 window.moodSection.style.backdropFilter = randomBlur > 0 ? `blur(${randomBlur}px)` : '';
 window.moodSection.style.borderRadius = randomRadius + 'px';
 window.moodSection.style.border = borderWidth > 0 ? `${borderWidth}px ${borderStyle} ${borderColor}` : '';

 // Box shadow
 let boxShadow = randomShadow > 0 ? `0 ${randomShadow}px ${randomShadow * 2}px rgba(0,0,0,0.3)` : '';
 if (randomGlow > 0) {
 const glowShadow = `0 0 ${randomGlow}px ${randomGlow * 2}px ${randomGlowColor}`;
 boxShadow = boxShadow ? boxShadow + ', ' + glowShadow : glowShadow;
 }
 window.moodSection.style.boxShadow = boxShadow;

 // Filters only (transform removed to prevent mobile sticky control issues)
 window.moodSection.style.filter = `saturate(${saturation}%) brightness(${brightness}%) contrast(${contrast}%)`;
 window.moodSection.style.transform = ''; // Clear any previous transforms

 // Border animations
 window.moodSection.classList.remove('border-flash', 'border-flicker', 'border-breathing', 'border-colorshift');
 if (randomGlow > 0) {
 window.moodSection.classList.add(randomAnimation);
 }

 // Apply to video player
 const videoPlayerContainer = document.querySelector('.video-player-container');
 if (videoPlayerContainer) {
 let videoBoxShadow = '0 10px 30px rgba(0, 0, 0, 0.2)';
 if (randomGlow > 0) {
 videoBoxShadow += `, 0 0 ${randomGlow}px ${randomGlow * 2}px ${randomGlowColor}`;
 }
 videoPlayerContainer.style.boxShadow = videoBoxShadow;
 videoPlayerContainer.style.border = borderWidth > 0 ? `${borderWidth}px ${borderStyle} ${borderColor}` : '';
 videoPlayerContainer.classList.remove('border-flash', 'border-flicker', 'border-breathing', 'border-colorshift');
 if (randomGlow > 0) {
 videoPlayerContainer.classList.add(randomAnimation);
 }
 }

 // Random texture - EXPANDED with 10 new music wave textures!
 const textures = ['none', 'speaker-grille', 'sound-waves', 'equalizer', 'waveform', 'bass-ripples', 'studio-foam', 'audio-jack', 'mic-mesh', 'piano-keys', 'guitar-strings', 'drum-skin', 'foam-pyramids', 'xlr-connector', 'cassette-tape', 'cd-diffraction', 'mixing-console', 'frequency-spectrum', 'oscilloscope', 'soundwave-circular', 'amplitude-pulse', 'stereo-waves', 'frequency-rings', 'audio-spectrum-3d', 'sine-waves', 'beat-grid', 'harmonic-waves'];
 let randomTexture;

 // Mode-specific texture preferences
 if (mode === 'neon') {
 // Neon mode prefers modern tech textures
 randomTexture = ['equalizer', 'sound-waves', 'cd-diffraction', 'mixing-console'][Math.floor(Math.random() * 4)];
 } else if (mode === 'retro') {
 // Retro mode prefers vintage textures
 randomTexture = ['cassette-tape', 'piano-keys', 'guitar-strings', 'speaker-grille', 'studio-foam'][Math.floor(Math.random() * 5)];
 } else if (mode === 'dramatic') {
 // Dramatic mode can use any texture or none
 randomTexture = textures[Math.floor(Math.random() * textures.length)];
 } else {
 // Minimal and moderate modes: 50% chance of no texture
 randomTexture = Math.random() < 0.5 ? 'none' : textures[Math.floor(Math.random() * textures.length)];
 }

 // Apply texture
 currentTexture = randomTexture;
 document.querySelectorAll('.texture-btn').forEach(btn => btn.classList.remove('active'));
 const textureBtn = document.querySelector(`.texture-btn[data-texture="${randomTexture}"]`);
 if (textureBtn) textureBtn.classList.add('active');
 applyTexture(randomTexture);

 // Randomize MOOD title opacity (30-100%)
 const moodTitle = document.querySelector('.mood-title');
 if (moodTitle) {
 const randomOpacity = (Math.floor(Math.random() * 71) + 30) / 100; // 30-100%
 moodTitle.style.opacity = randomOpacity;
 }

 const btn = document.getElementById('randomBgBtn');
 btn.classList.add('pulsing');
 setTimeout(() => btn.classList.remove('pulsing'), 600);
}

 // Settings Management
window.loadSettings = function() {
 const saved = localStorage.getItem('musicPlayerSettings');
 if (saved) {
 settings = JSON.parse(saved);
 }
 applySettings();
 }

window.saveSettings = function() {
 localStorage.setItem('musicPlayerSettings', JSON.stringify(settings));
 }

window.applySettings = function() {
 toggleStickyControls.checked = settings.stickyControls;
 toggleVisualizer.checked = settings.visualizer;
 toggleBackgroundAnim.checked = settings.backgroundAnim;
 toggleFloatingPlayerSetting.checked = settings.floatingPlayer;
 
 if (!settings.stickyControls) {
 stickyControls.classList.add('hidden');
 } else {
 stickyControls.classList.remove('hidden');
 }
 
 if (!settings.visualizer) {
 musicVisualizer.style.display = 'none';
 } else {
 musicVisualizer.style.display = 'flex';
 }
 
 if (!settings.backgroundAnim) {
 document.querySelector('.bg-animation').style.display = 'none';
 } else {
 document.querySelector('.bg-animation').style.display = 'block';
 }
 
 if (settings.floatingPlayer && !floatingPlayerActive) {
 toggleFloatingPlayer();
 }
 }

 // Settings Event Listeners
 settingsBtn.addEventListener('click', () => {
 settingsModalOverlay.classList.add('active');
 });

 closeSettingsModal.addEventListener('click', () => {
 settingsModalOverlay.classList.remove('active');
 });

 settingsModalOverlay.addEventListener('click', (e) => {
 if (e.target === settingsModalOverlay) {
 settingsModalOverlay.classList.remove('active');
 }
 });

 toggleStickyControls.addEventListener('change', (e) => {
 settings.stickyControls = e.target.checked;
 if (!settings.stickyControls) {
 stickyControls.classList.add('hidden');
 } else {
 stickyControls.classList.remove('hidden');
 }
 saveSettings();
 });

 toggleVisualizer.addEventListener('change', (e) => {
 settings.visualizer = e.target.checked;
 if (!settings.visualizer) {
 musicVisualizer.style.display = 'none';
 } else {
 musicVisualizer.style.display = 'flex';
 }
 saveSettings();
 });

 toggleBackgroundAnim.addEventListener('change', (e) => {
 settings.backgroundAnim = e.target.checked;
 if (!settings.backgroundAnim) {
 document.querySelector('.bg-animation').style.display = 'none';
 } else {
 document.querySelector('.bg-animation').style.display = 'block';
 }
 saveSettings();
 });

 toggleFloatingPlayerSetting.addEventListener('change', (e) => {
 settings.floatingPlayer = e.target.checked;
 if (settings.floatingPlayer && !floatingPlayerActive) {
 toggleFloatingPlayer();
 } else if (!settings.floatingPlayer && floatingPlayerActive) {
 toggleFloatingPlayer();
 }
 saveSettings();
 });

 // Background Animation - Particles
window.createParticles = function() {
 const particlesContainer = document.getElementById('particles');
 const particleCount = 20;
 
 for (let i = 0; i < particleCount; i++) {
 const particle = document.createElement('div');
 particle.className = 'particle';
 particle.style.left = Math.random() * 100 + '%';
 particle.style.animationDelay = Math.random() * 10 + 's';
 particle.style.animationDuration = (8 + Math.random() * 4) + 's';
 particlesContainer.appendChild(particle);
 }
 }

 // Floating Player Functions
window.toggleFloatingPlayer = function() {
 floatingPlayerActive = !floatingPlayerActive;
 
 if (floatingPlayerActive) {
 floatingPlayer.classList.add('active');
 floatingPlayerBtn.classList.add('active');
 floatingPlayerBtn.innerHTML = '<span>ğŸ“º</span><span>Hide Floating Video</span>';
 updateFloatingPlayerInfo();
 } else {
 floatingPlayer.classList.remove('active');
 floatingPlayerBtn.classList.remove('active');
 floatingPlayerBtn.innerHTML = '<span>ğŸ“º</span><span>Floating Video Player</span>';
 }
 }

window.updateFloatingPlayerInfo = function() {
 const songs = window.getCurrentSongs();
 if (songs.length === 0 || window.currentSongIndex >= songs.length) return;
 
 const song = songs[window.currentSongIndex];
 window.floatingSongTitle.textContent = song.title || 'No Track';
 window.floatingArtistName.textContent = song.artist || 'Unknown Artist';
 }

 // Pop-out Window Function
window.openPopoutWindow = function() {
 const songs = window.getCurrentSongs();
 if (songs.length === 0 || window.currentSongIndex >= songs.length) return;
 
 const song = songs[window.currentSongIndex];
 const videoId = song.videoId;
 
 if (window.popoutWindow && !window.popoutWindow.closed) {
 window.popoutWindow.focus();
 return;
 }
 
 const windowFeatures = 'width=500,height=400,menubar=no,toolbar=no,location=no,status=no';
 window.popoutWindow = window.open('', 'MusicPlayerPopout', windowFeatures);
 
 window.popoutWindow.document.write(`
 <!DOCTYPE html>
 <html>
 <head>
 <title>${song.title} - Music Player</title>
 <style>
 body { margin: 0; padding: 0; background: #000; overflow: hidden; }
 #popout-player { width: 100%; height: 100%; }
 </style>
 </head>
 <body>
 <div id="popout-player"></div>
 <script src="https://www.youtube.com/iframe_api"><\/script>
 <script>
 let popoutYTPlayer;
window.onYouTubeIframeAPIReady = function() {
 popoutYTPlayer = new YT.Player('popout-player', {
 height: '100%',
 width: '100%',
 videoId: '${videoId}',
 playerVars: {
 'autoplay': ${isPlaying ? 1 : 0},
 'controls': 1,
 'rel': 0,
 'showinfo': 1,
 'modestbranding': 1
 }
 });
 }
 <\/script>
 </body>
 </html>
 `);
 window.popoutWindow.document.close();
 }

 // Update Sticky Controls Info
window.updateStickyControlsInfo = function() {
 const songs = window.getCurrentSongs();
 if (songs.length === 0 || window.currentSongIndex >= songs.length) return;
 
 const song = songs[window.currentSongIndex];
 stickySongTitle.textContent = song.title || 'No Track';
 stickyArtistName.textContent = song.artist || 'Unknown Artist';
 
 if (song.thumbnail) {
 stickyThumb.innerHTML = `<img src="${song.thumbnail}" alt="${song.title}">`;
 } else {
 stickyThumb.innerHTML = `<div class="playlist-thumb-placeholder">${(song.artist || 'U').charAt(0)}</div>`;
 }
 }

 // Update Visualizer State
window.updateVisualizerState = function() {
 if (isPlaying) {
 musicVisualizer.classList.remove('paused');
 musicVisualizer.classList.add('playing');
 } else {
 musicVisualizer.classList.remove('playing');
 musicVisualizer.classList.add('paused');
 }
 }

 // Media Session API for Native Mobile Controls
window.setupMediaSession = function() {
 if ('mediaSession' in navigator) {
 const songs = window.getCurrentSongs();
 if (songs.length === 0 || window.currentSongIndex >= songs.length) return;
 
 const song = songs[window.currentSongIndex];
 
 navigator.mediaSession.metadata = new MediaMetadata({
 title: song.title || 'Unknown Title',
 artist: song.artist || 'Unknown Artist',
 artwork: song.thumbnail ? [
 { src: song.thumbnail, sizes: '96x96', type: 'image/jpeg' },
 { src: song.thumbnail, sizes: '128x128', type: 'image/jpeg' },
 { src: song.thumbnail, sizes: '192x192', type: 'image/jpeg' },
 { src: song.thumbnail, sizes: '256x256', type: 'image/jpeg' },
 { src: song.thumbnail, sizes: '384x384', type: 'image/jpeg' },
 { src: song.thumbnail, sizes: '512x512', type: 'image/jpeg' }
 ] : []
 });

 navigator.mediaSession.setActionHandler('play', () => {
 play();
 });

 navigator.mediaSession.setActionHandler('pause', () => {
 pause();
 });

 navigator.mediaSession.setActionHandler('previoustrack', () => {
 window.prevSong();
 });

 navigator.mediaSession.setActionHandler('nexttrack', () => {
 window.nextSong();
 });

 navigator.mediaSession.setActionHandler('seekbackward', (details) => {
 if (window.player && window.player.getCurrentTime && window.player.seekTo) {
 const currentTime = window.player.getCurrentTime();
 window.player.seekTo(Math.max(0, currentTime - (details.seekOffset || 10)));
 }
 });

 navigator.mediaSession.setActionHandler('seekforward', (details) => {
 if (window.player && window.player.getCurrentTime && player.getDuration && window.player.seekTo) {
 const currentTime = window.player.getCurrentTime();
 const duration = window.player.getDuration();
 window.player.seekTo(Math.min(duration, currentTime + (details.seekOffset || 10)));
 }
 });
 }
 }

 // Dragging functionality for floating player
window.setupDragging = function() {
 floatingPlayer.addEventListener('mousedown', startDragging);
 document.addEventListener('mousemove', drag);
 document.addEventListener('mouseup', stopDragging);
 
 floatingPlayer.addEventListener('touchstart', startDragging);
 document.addEventListener('touchmove', drag);
 document.addEventListener('touchend', stopDragging);
 }

window.startDragging = function(e) {
 if (e.target.closest('.floating-action-btn') || 
 e.target.closest('.floating-control-btn')) {
 return;
 }
 
 isDragging = true;
 const touch = e.touches ? e.touches[0] : e;
 const rect = floatingPlayer.getBoundingClientRect();
 
 dragOffsetX = touch.clientX - rect.left;
 dragOffsetY = touch.clientY - rect.top;
 
 floatingPlayer.style.cursor = 'grabbing';
 }

window.drag = function(e) {
 if (!isDragging) return;
 
 e.preventDefault();
 const touch = e.touches ? e.touches[0] : e;
 
 let newX = touch.clientX - dragOffsetX;
 let newY = touch.clientY - dragOffsetY;
 
 // Keep within viewport bounds
 newX = Math.max(0, Math.min(newX, window.innerWidth - floatingPlayer.offsetWidth));
 newY = Math.max(0, Math.min(newY, window.innerHeight - floatingPlayer.offsetHeight));
 
 floatingPlayer.style.right = 'auto';
 floatingPlayer.style.bottom = 'auto';
 floatingPlayer.style.left = newX + 'px';
 floatingPlayer.style.top = newY + 'px';
 }

window.stopDragging = function() {
 isDragging = false;
 floatingPlayer.style.cursor = 'move';
 }

 // YouTube Player callback functions are now defined at the TOP of this file
 // This prevents race conditions during initialization

window.updateAllPlayButtons = function(state) {
 var playIconHTML = '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';
 var pauseIconHTML = '<svg viewBox="0 0 24 24"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/></svg>';
 
 if (state === 'pause') {
 window.floatingPlayPauseBtn.innerHTML = pauseIconHTML;
 window.stickyPlayPauseBtn.innerHTML = pauseIconHTML;
 } else {
 window.floatingPlayPauseBtn.innerHTML = playIconHTML;
 window.stickyPlayPauseBtn.innerHTML = playIconHTML;
 }
 }

window.startProgressUpdater = function() {
 window.stopProgressUpdater();
 window.progressInterval = setInterval(() => {
 if (window.player && window.player.getCurrentTime) {
 const currentTime = window.player.getCurrentTime();
 const duration = window.player.getDuration();
 window.updateProgressDisplay(currentTime, duration);
 }
 }, 100);
 }

window.stopProgressUpdater = function() {
 if (window.progressInterval) {
 clearInterval(window.progressInterval);
 window.progressInterval = null;
 }
 }

window.updateProgressDisplay = function(currentTime, duration) {
 if (duration > 0) {
 const percentage = (currentTime / duration) * 100;
 progressFill.style.width = percentage + '%';
 currentTimeEl.textContent = formatTime(currentTime);
 totalTimeEl.textContent = formatTime(duration);
 }
 }

 // Helper Functions
window.getRandomColor = function() {
 const colors = ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#43e97b', '#fa709a', '#fee140', '#30cfd0', '#a8edea', '#fed6e3'];
 return colors[Math.floor(Math.random() * colors.length)];
 }

window.extractPlaylistId = function(url) {
 const patterns = [
 /[?&]list=([^&]+)/,
 /^([A-Za-z0-9_-]+)$/
 ];
 
 for (const pattern of patterns) {
 const match = url.match(pattern);
 if (match) return match[1];
 }
 
 return null;
 }

 // Extract Video ID from YouTube URL
window.extractVideoId = function(url) {
 const patterns = [
 /(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\?\/]+)/,
 /^([A-Za-z0-9_-]{11})$/
 ];
 
 for (const pattern of patterns) {
 const match = url.match(pattern);
 if (match) return match[1];
 }
 
 return null;
 }

 // Fetch Single Video Info from YouTube
 window.fetchVideoInfo = async function(videoId) {
 try {
 const url = `${YOUTUBE_API_BASE}/videos?part=snippet,contentDetails&id=${videoId}&key=${YOUTUBE_API_KEY}`;
 const response = await fetch(url);
 const data = await response.json();
 
 if (!data.items || data.items.length === 0) {
 throw new Error('Video not found');
 }
 
 const video = data.items[0];
 const snippet = video.snippet;
 const duration = video.contentDetails.duration;
 
 return {
 title: snippet.title,
 artist: snippet.channelTitle || 'Unknown Artist',
 duration: window.parseYouTubeDuration(duration),
 albumColor: window.getRandomColor(),
 source: `https://www.youtube.com/watch?v=${videoId}`,
 sourceType: 'youtube',
 thumbnail: snippet.thumbnails?.maxres?.url || snippet.thumbnails?.high?.url || snippet.thumbnails?.medium?.url || snippet.thumbnails?.default?.url || null,
 videoId: videoId,
 addedManually: true
 };
 } catch (error) {
 console.error('Error fetching video info:', error);
 throw error;
 }
 }

window.parseYouTubeDuration = function(duration) {
 const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
 if (!match) return '0:00';
 
 const hours = parseInt(match[1] || 0);
 const minutes = parseInt(match[2] || 0);
 const seconds = parseInt(match[3] || 0);
 
 if (hours > 0) {
 return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
 }
 return `${minutes}:${seconds.toString().padStart(2, '0')}`;
 }

window.formatTime = function(seconds) {
 const min = Math.floor(seconds / 60);
 const sec = Math.floor(seconds % 60);
 return `${min}:${sec.toString().padStart(2, '0')}`;
 }

 // YouTube API Functions
 window.fetchYouTubePlaylist = async function(playlistId) {
 try {
 let allItems = [];
 let nextPageToken = '';
 
 playlistStatus.textContent = 'Fetching playlist...';
 
 do {
 const url = `${YOUTUBE_API_BASE}/playlistItems?part=snippet,contentDetails&maxResults=50&playlistId=${playlistId}&key=${YOUTUBE_API_KEY}${nextPageToken ? '&pageToken=' + nextPageToken : ''}`;
 
 const response = await fetch(url);
 const data = await response.json();
 
 if (data.error) {
 throw new Error(data.error.message || 'Failed to fetch playlist');
 }
 
 allItems = allItems.concat(data.items || []);
 nextPageToken = data.nextPageToken || '';
 
 playlistStatus.textContent = `Fetching... (${allItems.length} videos)`;
 
 } while (nextPageToken);
 
 playlistStatus.textContent = `Fetching video details...`;
 
 const videoIds = allItems.map(item => item.contentDetails.videoId).filter(id => id);
 
 if (videoIds.length === 0) {
 throw new Error('No videos found in playlist');
 }
 
 const videoDetails = [];
 for (let i = 0; i < videoIds.length; i += 50) {
 const batch = videoIds.slice(i, i + 50);
 const detailsUrl = `${YOUTUBE_API_BASE}/videos?part=contentDetails&id=${batch.join(',')}&key=${YOUTUBE_API_KEY}`;
 
 const response = await fetch(detailsUrl);
 const data = await response.json();
 
 if (data.items) {
 videoDetails.push(...data.items);
 }
 
 playlistStatus.textContent = `Processing... (${Math.min(i + 50, videoIds.length)}/${videoIds.length})`;
 }
 
 const durationMap = {};
 videoDetails.forEach(video => {
 durationMap[video.id] = video.contentDetails.duration;
 });
 
 const newSongs = allItems.map(item => {
 const snippet = item.snippet;
 const videoId = item.contentDetails.videoId;
 const duration = durationMap[videoId] || 'PT0S';
 
 return {
 title: snippet.title,
 artist: snippet.videoOwnerChannelTitle || snippet.channelTitle || 'Unknown Artist',
 duration: window.parseYouTubeDuration(duration),
 albumColor: window.getRandomColor(),
 source: `https://www.youtube.com/watch?v=${videoId}`,
 sourceType: 'youtube',
 thumbnail: snippet.thumbnails?.maxres?.url || snippet.thumbnails?.high?.url || snippet.thumbnails?.medium?.url || snippet.thumbnails?.default?.url || null,
 videoId: videoId
 };
 }).filter(song => song.title && song.title !== 'Private video' && song.title !== 'Deleted video');
 
 return newSongs;
 
 } catch (error) {
 console.error('YouTube API Error:', error);
 throw error;
 }
 }

 window.importYouTubePlaylist = async function(playlistIdOrUrl, playlistName) {
 const playlistId = window.extractPlaylistId(playlistIdOrUrl);

 if (!playlistId) {
 alert('Invalid playlist URL or ID. Please check and try again.');
 return;
 }
 
 try {
 loadPlaylist.disabled = true;
 loadPlaylistText.innerHTML = '<span class="loading-spinner"></span> Loading...';
 
 const newSongs = await window.fetchYouTubePlaylist(playlistId);
 
 if (newSongs.length === 0) {
 throw new Error('No valid videos found in playlist');
 }
 
 const newPlaylist = {
 id: Date.now(),
 name: playlistName || `Playlist ${window.playlists.length + 1}`,
 songs: newSongs,
 youtubePlaylistId: playlistId
 };

 window.playlists.push(newPlaylist);
 window.currentPlaylistIndex = window.playlists.length - 1;

 // Save to community library
 await window.saveToLibrary(newPlaylist);

 window.savePlaylists();
 window.initPlaylistTabs();
 window.initPlaylist();
 window.initCarousel();

 if (newSongs.length > 0 && window.playerReady) {
 window.selectSong(0);
 }

 playlistStatus.style.color = '#34C759';
 playlistStatus.textContent = `âœ“ Imported ${newSongs.length} songs & shared with community!`;

 setTimeout(() => {
 window.closePlaylistModalFunc();
 }, 2000);
 
 } catch (error) {
 console.error('Import error:', error);
 playlistStatus.style.color = '#FF3B30';
 playlistStatus.textContent = `âœ— Error: ${error.message}`;
 
 loadPlaylist.disabled = false;
 loadPlaylistText.textContent = 'Import & Share';
 }
 }

 // Create Manual Playlist with Single Video
 window.createManualPlaylist = async function(videoUrl, playlistName) {
 const videoId = window.extractVideoId(videoUrl);

 if (!videoId) {
 alert('Invalid video URL. Please check and try again.');
 return;
 }
 
 try {
 loadPlaylist.disabled = true;
 loadPlaylistText.innerHTML = '<span class="loading-spinner"></span> Loading...';
 
 const videoInfo = await window.fetchVideoInfo(videoId);
 
 const newPlaylist = {
 id: Date.now(),
 name: playlistName || 'Manual Playlist ' + (window.playlists.length + 1),
 songs: [videoInfo],
 isManual: true,
 youtubePlaylistId: null
 };

 window.playlists.push(newPlaylist);
 window.currentPlaylistIndex = window.playlists.length - 1;

 window.savePlaylists();
 window.initPlaylistTabs();
 window.initPlaylist();
 window.initCarousel();

 if (window.playlists[window.currentPlaylistIndex].songs.length > 0 && window.playerReady) {
 window.selectSong(0);
 }

 playlistStatus.style.color = '#34C759';
 playlistStatus.textContent = 'âœ“ Manual playlist created with 1 song!';

 setTimeout(() => {
 window.closePlaylistModalFunc();
 }, 2000);
 
 } catch (error) {
 console.error('Error creating manual playlist:', error);
 playlistStatus.style.color = '#FF3B30';
 playlistStatus.textContent = 'âœ— Error: ' + error.message;
 
 loadPlaylist.disabled = false;
 loadPlaylistText.textContent = 'Create Playlist';
 }
 }

 // Firebase Library Functions
 window.saveToLibrary = async function(playlist) {
 const libraryEntry = {
 id: playlist.id,
 name: playlist.name,
 youtubePlaylistId: playlist.youtubePlaylistId,
 songs: playlist.songs,
 dateAdded: new Date().toISOString(),
 trackCount: playlist.songs.length,
 thumbnail: playlist.songs[0]?.thumbnail || null
 };
 
 if (window.firebaseAvailable) {
 try {
 const snapshot = await window.database.ref('playlists').orderByChild('youtubePlaylistId').equalTo(playlist.youtubePlaylistId).once('value');
 
 if (!snapshot.exists()) {
 await window.database.ref('playlists').push(libraryEntry);
 console.log('âœ“ Playlist saved to Firebase community library!');
 await window.loadLibrary();
 } else {
 console.log('â„¹ï¸ Playlist already in community library');
 }
 } catch (e) {
 console.error('Firebase save error:', e);
 window.saveToLocalStorage(libraryEntry);
 }
 } else {
 window.saveToLocalStorage(libraryEntry);
 }
 }

window.saveToLocalStorage = function(libraryEntry) {
 const exists = playlistLibrary.find(p => p.youtubePlaylistId === libraryEntry.youtubePlaylistId);
 if (!exists) {
 playlistLibrary.unshift(libraryEntry);
 localStorage.setItem('playlistLibrary', JSON.stringify(playlistLibrary));
 window.updateLibraryBadge();
 }
 }

 window.loadLibrary = async function() {
 if (window.firebaseAvailable) {
 try {
 const snapshot = await window.database.ref('playlists').orderByChild('dateAdded').once('value');
 playlistLibrary = [];
 
 snapshot.forEach(childSnapshot => {
 playlistLibrary.push(childSnapshot.val());
 });
 
 playlistLibrary.reverse();
 console.log(`âœ“ Loaded ${playlistLibrary.length} playlists from Firebase`);
 window.updateLibraryBadge();
 } catch (e) {
 console.error('Firebase load error:', e);
 window.loadFromLocalStorage();
 }
 } else {
 window.loadFromLocalStorage();
 }
 }

window.loadFromLocalStorage = function() {
 try {
 const saved = localStorage.getItem('playlistLibrary');
 if (saved) {
 playlistLibrary = JSON.parse(saved);
 console.log(`âœ“ Loaded ${playlistLibrary.length} playlists from localStorage`);
 }
 window.updateLibraryBadge();
 } catch (e) {
 console.error('Error loading library:', e);
 window.updateLibraryBadge();
 }
 }

window.updateLibraryBadge = function() {
 const count = playlistLibrary.length;
 libraryBadge.textContent = count > 0 ? `(${count} available)` : '(Empty)';
 }

 // Library Pagination State
 let libraryCurrentPage = 1;
 const libraryPageSize = 20;
 let libraryTotalPages = 1;
 let librarySearchQuery = '';
 let librarySearchTimeout = null;
 let libraryPageCache = {};

 // Library Elements
 const librarySearchInput = document.getElementById('librarySearchInput');
 const librarySearchBtn = document.getElementById('librarySearchBtn');
 const librarySearchPreview = document.getElementById('librarySearchPreview');
 const libraryPaginationTop = document.getElementById('libraryPaginationTop');
 const libraryPaginationBottom = document.getElementById('libraryPaginationBottom');

window.openLibraryModal = function() {
 libraryModalOverlay.classList.add('active');
 libraryCurrentPage = 1;
 librarySearchQuery = '';
 librarySearchInput.value = '';
 libraryPageCache = {};
 loadLibraryPage(1);
 }

window.closeLibraryModalFunc = function() {
 libraryModalOverlay.classList.remove('active');
 librarySearchPreview.classList.remove('active');
 }

window.renderLibrary = function() {
 if (playlistLibrary.length === 0) {
 libraryModalBody.innerHTML = `
 <div class="library-empty">
 <div class="library-empty-icon">ğŸ“š</div>
 <div class="library-empty-text">
 No playlists in community library yet.<br>
 Import a YouTube playlist to get started!<br><br>
 ${window.firebaseAvailable ? '<strong style="color: #43e97b;">ğŸŒ Firebase Connected</strong> - Your imports are shared with everyone!' : '<strong style="color: #ff9500;">âš ï¸ Using Local Storage</strong> - Enable Firebase for cross-device sharing'}
 </div>
 </div>
 `;
 return;
 }
 
 const grid = document.createElement('div');
 grid.className = 'library-grid';
 
 playlistLibrary.forEach(playlist => {
 const card = document.createElement('div');
 card.className = 'library-card';
 
 const date = new Date(playlist.dateAdded);
 const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
 
 card.innerHTML = `
 <div class="library-card-image">
 ${playlist.thumbnail ? '<img src="' + playlist.thumbnail + '" alt="' + playlist.name + '">' : ''}
 <div class="library-card-badge">${playlist.trackCount} tracks</div>
 </div>
 <div class="library-card-content">
 <div class="library-card-title">${playlist.name}</div>
 <div class="library-card-meta">
 <div class="library-card-tracks">ğŸµ ${playlist.trackCount} songs</div>
 <div class="library-card-date">${dateStr}</div>
 </div>
 <div class="library-card-actions">
 <button class="library-add-btn" data-playlist-id="${playlist.id}">
 <span>+</span>
 <span>Add to Player</span>
 </button>
 </div>
 </div>
 `;
 
 grid.appendChild(card);
 });
 
 libraryModalBody.innerHTML = '';
 libraryModalBody.appendChild(grid);
 
 document.querySelectorAll('.library-add-btn').forEach(btn => {
 btn.addEventListener('click', (e) => {
 const playlistId = parseInt(e.currentTarget.getAttribute('data-playlist-id'));
 addFromLibrary(playlistId);
 });
 });
 }

window.addFromLibrary = function(playlistId) {
 const libraryPlaylist = playlistLibrary.find(p => p.id === playlistId);
 
 if (libraryPlaylist) {
 const newPlaylist = {
 id: Date.now(),
 name: libraryPlaylist.name,
 songs: JSON.parse(JSON.stringify(libraryPlaylist.songs)),
 youtubePlaylistId: libraryPlaylist.youtubePlaylistId
 };

 window.playlists.push(newPlaylist);
 window.currentPlaylistIndex = window.playlists.length - 1;

 window.savePlaylists();
 window.initPlaylistTabs();
 window.initPlaylist();
 window.initCarousel();

 if (newPlaylist.songs.length > 0 && window.playerReady) {
 window.selectSong(0);
 }

 window.closeLibraryModalFunc();
 
 alert(`âœ“ Added "${libraryPlaylist.name}" with ${libraryPlaylist.trackCount} songs!\n\nğŸ‰ No API calls needed - loaded from community library!`);
 }
 }

 // Library Pagination Functions
window.loadLibraryPage = function(page) {
 libraryCurrentPage = page;

 // Check cache first
 if (libraryPageCache[page]) {
 renderLibraryPage(libraryPageCache[page]);
 return;
 }

 // Show skeleton loading
 showLibrarySkeleton();

 // Simulate API delay for smooth transition
 setTimeout(() => {
 const filteredPlaylists = librarySearchQuery
 ? playlistLibrary.filter(p =>
 p.name.toLowerCase().includes(librarySearchQuery.toLowerCase()) ||
 (p.tags && p.tags.some(tag => tag.toLowerCase().includes(librarySearchQuery.toLowerCase())))
 )
 : playlistLibrary;

 libraryTotalPages = Math.ceil(filteredPlaylists.length / libraryPageSize);
 const start = (page - 1) * libraryPageSize;
 const end = start + libraryPageSize;
 const pageData = filteredPlaylists.slice(start, end);

 // Cache the page
 libraryPageCache[page] = {
 playlists: pageData,
 total: filteredPlaylists.length
 };

 renderLibraryPage(libraryPageCache[page]);
 }, 300);
 }

window.showLibrarySkeleton = function() {
 const skeleton = document.createElement('div');
 skeleton.className = 'library-skeleton';

 for (let i = 0; i < libraryPageSize; i++) {
 const card = document.createElement('div');
 card.className = 'library-skeleton-card';
 card.innerHTML = `
 <div class="library-skeleton-image"></div>
 <div class="library-skeleton-content">
 <div class="library-skeleton-title"></div>
 <div class="library-skeleton-text"></div>
 <div class="library-skeleton-text"></div>
 </div>
 `;
 skeleton.appendChild(card);
 }

 libraryModalBody.classList.add('library-fade-out');
 setTimeout(() => {
 libraryModalBody.innerHTML = '';
 libraryModalBody.appendChild(skeleton);
 libraryModalBody.classList.remove('library-fade-out');
 libraryModalBody.classList.add('library-fade-in');
 }, 150);
 }

window.renderLibraryPage = function(pageData) {
 if (pageData.playlists.length === 0) {
 libraryModalBody.innerHTML = `
 <div class="library-empty">
 <div class="library-empty-icon">ğŸ”</div>
 <div class="library-empty-text">
 ${librarySearchQuery ? 'No playlists found matching "' + librarySearchQuery + '"' : 'No playlists available'}
 </div>
 </div>
 `;
 renderPagination(0);
 return;
 }

 const grid = document.createElement('div');
 grid.className = 'library-grid';

 pageData.playlists.forEach(playlist => {
 const card = document.createElement('div');
 card.className = 'library-card';

 const date = new Date(playlist.dateAdded);
 const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

 card.innerHTML = `
 <div class="library-card-image">
 ${playlist.thumbnail ? '<img src="' + playlist.thumbnail + '" alt="' + playlist.name + '">' : ''}
 <div class="library-card-badge">${playlist.trackCount} tracks</div>
 </div>
 <div class="library-card-content">
 <div class="library-card-title">${playlist.name}</div>
 <div class="library-card-meta">
 <div class="library-card-tracks">ğŸµ ${playlist.trackCount} songs</div>
 <div class="library-card-date">${dateStr}</div>
 </div>
 <div class="library-card-actions">
 <button class="library-add-btn" data-playlist-id="${playlist.id}">
 <span>+</span>
 <span>Add to Player</span>
 </button>
 </div>
 </div>
 `;

 grid.appendChild(card);
 });

 libraryModalBody.classList.add('library-fade-out');
 setTimeout(() => {
 libraryModalBody.innerHTML = '';
 libraryModalBody.appendChild(grid);
 libraryModalBody.classList.remove('library-fade-out');
 libraryModalBody.classList.add('library-fade-in');

 document.querySelectorAll('.library-add-btn').forEach(btn => {
 btn.addEventListener('click', (e) => {
 const playlistId = parseInt(e.currentTarget.getAttribute('data-playlist-id'));
 addFromLibrary(playlistId);
 });
 });
 }, 150);

 renderPagination(pageData.total);
 }

window.renderPagination = function(totalItems) {
 if (totalItems === 0) {
 libraryPaginationTop.innerHTML = '';
 libraryPaginationBottom.innerHTML = '';
 return;
 }

 const totalPages = Math.ceil(totalItems / libraryPageSize);
 const startItem = ((libraryCurrentPage - 1) * libraryPageSize) + 1;
 const endItem = Math.min(libraryCurrentPage * libraryPageSize, totalItems);

 let paginationHTML = '';

 // Previous button
 paginationHTML += `<button class="library-pagination-btn" ${libraryCurrentPage === 1 ? 'disabled' : ''} data-page="${libraryCurrentPage - 1}">â† Prev</button>`;

 // Page numbers
 if (totalPages <= 7) {
 // Show all pages
 for (let i = 1; i <= totalPages; i++) {
 paginationHTML += `<button class="library-pagination-btn ${i === libraryCurrentPage ? 'active' : ''}" data-page="${i}">${i}</button>`;
 }
 } else {
 // Show first, last, and pages around current
 paginationHTML += `<button class="library-pagination-btn ${1 === libraryCurrentPage ? 'active' : ''}" data-page="1">1</button>`;

 if (libraryCurrentPage > 3) {
 paginationHTML += `<span class="library-pagination-btn dots">...</span>`;
 }

 const start = Math.max(2, libraryCurrentPage - 1);
 const end = Math.min(totalPages - 1, libraryCurrentPage + 1);

 for (let i = start; i <= end; i++) {
 paginationHTML += `<button class="library-pagination-btn ${i === libraryCurrentPage ? 'active' : ''}" data-page="${i}">${i}</button>`;
 }

 if (libraryCurrentPage < totalPages - 2) {
 paginationHTML += `<span class="library-pagination-btn dots">...</span>`;
 }

 paginationHTML += `<button class="library-pagination-btn ${totalPages === libraryCurrentPage ? 'active' : ''}" data-page="${totalPages}">${totalPages}</button>`;
 }

 // Next button
 paginationHTML += `<button class="library-pagination-btn" ${libraryCurrentPage === totalPages ? 'disabled' : ''} data-page="${libraryCurrentPage + 1}">Next â†’</button>`;

 // Info
 paginationHTML += `<span class="library-pagination-info">Showing ${startItem}-${endItem} of ${totalItems}</span>`;

 libraryPaginationTop.innerHTML = paginationHTML;
 libraryPaginationBottom.innerHTML = paginationHTML;

 // Add click handlers
 document.querySelectorAll('.library-pagination-btn:not(.dots)').forEach(btn => {
 btn.addEventListener('click', (e) => {
 const page = parseInt(e.target.getAttribute('data-page'));
 if (page && !isNaN(page)) {
 loadLibraryPage(page);
 }
 });
 });
 }

 // Search functionality
window.handleLibrarySearch = function() {
 librarySearchQuery = librarySearchInput.value.trim();
 libraryCurrentPage = 1;
 libraryPageCache = {};
 librarySearchPreview.classList.remove('active');
 loadLibraryPage(1);
 }

window.handleLiveSearch = function() {
 clearTimeout(librarySearchTimeout);
 const query = librarySearchInput.value.trim().toLowerCase();

 if (query.length < 2) {
 librarySearchPreview.classList.remove('active');
 return;
 }

 librarySearchTimeout = setTimeout(() => {
 const matches = playlistLibrary
 .filter(p =>
 p.name.toLowerCase().includes(query) ||
 (p.tags && p.tags.some(tag => tag.toLowerCase().includes(query)))
 )
 .slice(0, 5);

 if (matches.length > 0) {
 let previewHTML = '';
 matches.forEach(p => {
 previewHTML += `
 <div class="library-search-preview-item" data-playlist-id="${p.id}">
 <div class="library-search-preview-title">${p.name}</div>
 <div class="library-search-preview-info">${p.trackCount} tracks</div>
 </div>
 `;
 });
 librarySearchPreview.innerHTML = previewHTML;
 librarySearchPreview.classList.add('active');

 document.querySelectorAll('.library-search-preview-item').forEach(item => {
 item.addEventListener('click', (e) => {
 const playlistId = parseInt(e.currentTarget.getAttribute('data-playlist-id'));
 addFromLibrary(playlistId);
 });
 });
 } else {
 librarySearchPreview.innerHTML = '<div class="library-search-preview-empty">No matches found</div>';
 librarySearchPreview.classList.add('active');
 }
 }, 300);
 }
}); // End DOMContentLoaded
</script>
<script>
// Wait for DOM to be ready before accessing elements
document.addEventListener('DOMContentLoaded', function() {
 // Carousel Functions
window.initCarousel = function() {
 const songs = window.getCurrentSongs();
 
 if (songs.length === 0) {
 window.carouselSection.style.display = 'none';
 return;
 }
 
 window.carouselSection.style.display = 'block';
 window.carouselTrack.innerHTML = '';
 window.carouselOffset = 0;
 
 songs.forEach((song, index) => {
 const item = document.createElement('div');
 item.className = `carousel-item ${index === window.currentSongIndex ? 'playing active' : ''}`;
 
 const thumbContent = song.thumbnail 
 ? `<img src="${song.thumbnail}" alt="${song.title}">`
 : `<div class="playlist-thumb-placeholder">${(song.artist || 'U').charAt(0)}</div>`;
 
 item.innerHTML = `
 <div class="carousel-thumb">
 ${thumbContent}
 </div>
 <div class="carousel-info">
 <div class="carousel-title">
 ${song.title}
 ${index === window.currentSongIndex ? '<span class="carousel-playing-badge">Playing</span>' : ''}
 </div>
 <div class="carousel-artist">${song.artist}</div>
 </div>
 <div class="carousel-duration">${song.duration}</div>
 `;
 
 item.addEventListener('click', () => window.selectSong(index));
 window.carouselTrack.appendChild(item);
 });
 
 window.scrollCarouselToActive();
 }

window.scrollCarouselToActive = function() {
 const items = window.carouselTrack.querySelectorAll('.carousel-item');
 const activeIndex = window.currentSongIndex;
 
 const itemWidth = items[0]?.offsetWidth || 0;
 const gap = 10;
 const offset = Math.max(0, (activeIndex - 1) * (itemWidth + gap));
 
 window.carouselOffset = -offset;
 window.carouselTrack.style.transform = `translateX(${window.carouselOffset}px)`;
 }

window.scrollCarousel = function(direction) {
 const items = window.carouselTrack.querySelectorAll('.carousel-item');
 if (items.length === 0) return;
 
 const itemWidth = items[0].offsetWidth;
 const gap = 10;
 const step = itemWidth + gap;
 
 if (direction === 'prev') {
 window.carouselOffset = Math.min(0, window.carouselOffset + step);
 } else {
 const maxOffset = -(items.length - 3) * step;
 window.carouselOffset = Math.max(maxOffset, window.carouselOffset - step);
 }
 
 window.carouselTrack.style.transform = `translateX(${window.carouselOffset}px)`;
 }

 // Playlist Management
window.getCurrentPlaylist = function() {
 return window.playlists[window.currentPlaylistIndex] || { songs: [] };
 }

window.getCurrentSongs = function() {
 return getCurrentPlaylist().songs || [];
 }

// Add Song Modal Functions
window.openAddSongModal = function(playlistIndex) {
  window.targetPlaylistIndex = playlistIndex;
  const playlistName = window.playlists[playlistIndex].name;
  window.addSongModalTitle.textContent = 'Add Song to "' + playlistName + '"';
  window.addSongVideoUrl.value = '';
  window.addSongStatus.textContent = '';
  window.addSongBtn.disabled = false;
  window.addSongModalOverlay.classList.add('active');
}

window.closeAddSongModalFunc = function() {
  window.addSongModalOverlay.classList.remove('active');
  window.targetPlaylistIndex = null;
}

window.addSongToPlaylist = async function() {
  const videoUrl = window.addSongVideoUrl.value.trim();
  
  if (!videoUrl) {
    alert('Please enter a video URL');
    return;
  }
  
  const videoId = window.extractVideoId(videoUrl);
  
  if (!videoId) {
    alert('Invalid video URL. Please check and try again.');
    return;
  }
  
  try {
    window.addSongBtn.disabled = true;
    window.addSongBtnText.innerHTML = '<span class="loading-spinner"></span> Loading...';
    
    const videoInfo = await window.fetchVideoInfo(videoId);
    
    window.playlists[window.targetPlaylistIndex].songs.push(videoInfo);
    
    savePlaylists();
    
    if (window.targetPlaylistIndex === window.currentPlaylistIndex) {
      window.initPlaylist();
      window.initCarousel();
    }
    
    window.addSongStatus.style.color = '#34C759';
    window.addSongStatus.textContent = 'âœ“ Song added successfully!';
    
    setTimeout(() => {
      window.closeAddSongModalFunc();
    }, 1500);
    
  } catch (error) {
    console.error('Error adding song:', error);
    window.addSongStatus.style.color = '#FF3B30';
    window.addSongStatus.textContent = 'âœ— Error: ' + error.message;
    
    window.addSongBtn.disabled = false;
    window.addSongBtnText.textContent = 'Add Song';
  }
}

window.initPlaylistTabs = function() {
 playlistTabsContainer.innerHTML = '';
 
 playlists.forEach((playlist, index) => {
 const tab = document.createElement('div');
 tab.className = 'playlist-tab ' + (index === window.currentPlaylistIndex ? 'active' : '');
 
 const tabName = document.createElement('span');
 tabName.textContent = playlist.name;
 tab.appendChild(tabName);
 
 // Add Song button (â•)
 const addSongTabBtn = document.createElement('span');
 addSongTabBtn.className = 'playlist-tab-add-song';
 addSongTabBtn.innerHTML = 'â•';
 addSongTabBtn.title = 'Add song to this playlist';
 addSongTabBtn.addEventListener('click', (e) => {
 e.stopPropagation();
 window.openAddSongModal(index);
 });
 tab.appendChild(addSongTabBtn);
 
 if (playlists.length > 1) {
 const deleteBtn = document.createElement('span');
 deleteBtn.className = 'playlist-tab-delete';
 deleteBtn.innerHTML = 'Ã—';
 deleteBtn.addEventListener('click', (e) => {
 e.stopPropagation();
 window.deletePlaylist(index);
 });
 tab.appendChild(deleteBtn);
 }
 
 tab.addEventListener('click', () => window.switchPlaylist(index));
 playlistTabsContainer.appendChild(tab);
 });
}

window.switchPlaylist = function(index) {
 if (index === window.currentPlaylistIndex) return;
 
 if (window.player && window.player.stopVideo) {
 window.player.stopVideo();
 }
 
 window.currentPlaylistIndex = index;
 window.currentSongIndex = 0;
 window.isPlaying = false;
 playIcon.style.display = 'block';
 pauseIcon.style.display = 'none';
 updateAllPlayButtons('play');
 updateVisualizerState();
 
 window.initPlaylistTabs();
 window.initPlaylist();
 window.initCarousel();
 
 const songs = window.getCurrentSongs();
 if (songs.length > 0 && window.playerReady) {
 window.selectSong(0);
 } else {
 window.showEmptyState();
 }
}

window.deletePlaylist = function(index) {
 if (playlists.length === 1) {
 alert('Cannot delete the last playlist!');
 return;
 }
 
 if (confirm(`Delete playlist "${window.playlists[index].name}"?`)) {
 playlists.splice(index, 1);
 
 if (window.currentPlaylistIndex >= playlists.length) {
 window.currentPlaylistIndex = playlists.length - 1;
 }
 
 savePlaylists();
 window.initPlaylistTabs();
 window.initPlaylist();
 window.initCarousel();
 
 const songs = window.getCurrentSongs();
 if (songs.length > 0 && window.playerReady) {
 window.selectSong(0);
 } else {
 window.showEmptyState();
 }
 }
}

window.showEmptyState = function() {
 window.songTitle.textContent = 'No Tracks';
 window.artistName.textContent = 'Import a playlist to begin';
 window.totalTimeEl.textContent = '0:00';
 window.currentTimeEl.textContent = '0:00';
 window.progressFill.style.width = '0%';
 window.carouselSection.style.display = 'none';
 
 window.playlistContainer.innerHTML = `
 <div class="empty-state">
 <div class="empty-state-icon">ğŸµ</div>
 <div class="empty-state-text">
 Click "Import YouTube Playlist" to add songs<br>
 or browse the Community Library for instant access!
 </div>
 </div>
 `;
 playlistCount.textContent = '0 songs';
 }

 // Playlist Display
window.initPlaylist = function() {
 const songs = window.getCurrentSongs();
 window.playlistContainer.innerHTML = '';
 
 if (songs.length === 0) {
 window.showEmptyState();
 return;
 }
 
 playlistCount.textContent = `${songs.length} song${songs.length !== 1 ? 's' : ''}`;
 
 songs.forEach((song, index) => {
 const item = document.createElement('div');
 item.className = `playlist-item ${index === window.currentSongIndex ? 'active' : ''}`;
 
 const thumbContent = song.thumbnail 
 ? `<img src="${song.thumbnail}" alt="${song.title}">`
 : `<div class="playlist-thumb-placeholder">${(song.artist || 'U').charAt(0)}</div>`;
 
 item.innerHTML = `
 <div class="playlist-thumb">
 ${thumbContent}
 </div>
 <div class="playlist-info">
 <div class="playlist-title">${song.title}</div>
 <div class="playlist-artist">${song.artist}</div>
 </div>
 <div class="playlist-duration">${song.duration}</div>
 <button class="playlist-delete-btn" title="Remove song">
 <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
 <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"/>
 </svg>
 </button>
 `;

 // Click handler for song selection (but not for delete button)
 item.addEventListener('click', (e) => {
 if (!e.target.closest('.playlist-delete-btn')) {
 window.selectSong(index);
 }
 });

 // Delete button click handler
 const deleteBtn = item.querySelector('.playlist-delete-btn');
 deleteBtn.addEventListener('click', (e) => {
 e.stopPropagation();
 window.deleteSong(index);
 });

 window.playlistContainer.appendChild(item);
 });
 }

window.selectSong = function(index) {
 console.log('ğŸµ selectSong called with index:', index);
 const songs = window.getCurrentSongs();
 console.log('ğŸ“‹ Songs available:', songs.length);
 console.log('âœ“ Player ready:', window.playerReady);

 if (songs.length === 0 || !window.playerReady) {
 console.log('âŒ Returning early - no songs or player not ready');
 return;
 }

 window.currentSongIndex = index;
 const song = songs[window.currentSongIndex];
 console.log('ğŸ¶ Selected song:', song.title, 'VideoID:', song.videoId);

 window.songTitle.textContent = song.title;
 window.artistName.textContent = song.artist;

 // Update floating and sticky displays
 window.updateFloatingPlayerInfo();
 window.updateStickyControlsInfo();

 // Setup Media Session for native mobile controls
 window.setupMediaSession();

 document.querySelectorAll('.playlist-item').forEach((item, i) => {
 item.classList.toggle('active', i === window.currentSongIndex);
 });

 document.querySelectorAll('.carousel-item').forEach((item, i) => {
 item.classList.remove('playing', 'active');
 if (i === window.currentSongIndex) {
 item.classList.add('playing', 'active');
 const badge = item.querySelector('.carousel-playing-badge');
 if (!badge) {
 const titleDiv = item.querySelector('.carousel-title');
 titleDiv.innerHTML += '<span class="carousel-playing-badge">Playing</span>';
 }
 } else {
 const badge = item.querySelector('.carousel-playing-badge');
 if (badge) badge.remove();
 }
 });

 window.scrollCarouselToActive();

 console.log('ğŸ” Checking player:', 'videoId?', !!song.videoId, 'player?', !!window.player, 'loadVideoById?', !!(window.player && window.player.loadVideoById));

 if (song.videoId  && window.player && window.player.loadVideoById) {
 console.log('â–¶ï¸ Loading video:', song.videoId);
 window.player.loadVideoById(song.videoId);
 window.progressFill.style.width = '0%';
 window.currentTimeEl.textContent = '0:00';
 window.totalTimeEl.textContent = song.duration;
 console.log('âœ… Video loaded successfully');
 } else {
 console.log('âŒ Cannot load video - missing:', !song.videoId ? 'videoId' : !window.player ? 'player' : 'loadVideoById method');
 }
 }

 // Playback Controls
window.togglePlay = function() {
 const songs = window.getCurrentSongs();
 if (songs.length === 0 || !window.playerReady) return;
 
 if (window.isPlaying) {
 window.pause();
 } else {
 window.play();
 }
 }

window.play = function() {
 if (window.player && window.player.playVideo) {
 window.player.playVideo();
 }
 }

window.pause = function() {
 if (window.player && window.player.pauseVideo) {
 window.player.pauseVideo();
 }
 }

window.handleSongEnd = function() {
 const songs = window.getCurrentSongs();

 if (window.repeatMode === 2) {
 // Repeat current song
 window.play();
 } else if (window.repeatMode === 1 || window.currentSongIndex < songs.length - 1) {
 // Continue to next song in current playlist
 nextSong();
 } else {
 // Last song in playlist - auto-advance to next playlist
 if (window.currentPlaylistIndex < playlists.length - 1) {
 // Switch to next playlist and start playing
 const nextPlaylistIndex = window.currentPlaylistIndex + 1;
 window.switchPlaylist(nextPlaylistIndex);
 // Wait a brief moment for playlist to initialize, then start playing
 setTimeout(() => {
 const nextSongs = window.getCurrentSongs();
 if (nextSongs.length > 0) {
 window.selectSong(0);
 window.play();
 }
 }, 300);
 } else {
 // Last song of last playlist - stop
 window.isPlaying = false;
 playIcon.style.display = 'block';
 pauseIcon.style.display = 'none';
 updateAllPlayButtons('play');
 updateVisualizerState();
 }
 }
 }

window.prevSong = function() {
 const songs = window.getCurrentSongs();
 if (songs.length === 0) return;

 if (window.player && window.player.getCurrentTime && window.player.getCurrentTime() > 3) {
 window.player.seekTo(0);
 } else {
 window.currentSongIndex = (window.currentSongIndex - 1 + songs.length) % songs.length;
 window.selectSong(window.currentSongIndex);
 if (window.isPlaying) window.play();
 }
}

window.nextSong = function() {
 const songs = window.getCurrentSongs();
 if (songs.length === 0) return;
 
 if (window.isShuffled) {
 let newIndex;
 do {
 newIndex = Math.floor(Math.random() * songs.length);
 } while (newIndex === window.currentSongIndex && songs.length > 1);
 window.currentSongIndex = newIndex;
 } else {
 window.currentSongIndex = (window.currentSongIndex + 1) % songs.length;
 }
 window.selectSong(window.currentSongIndex);
 if (window.isPlaying) window.play();
 }

window.toggleShuffle = function() {
 window.isShuffled = !window.isShuffled;
 window.shuffleBtn.classList.toggle('active', window.isShuffled);
 }

window.toggleRepeat = function() {
 window.repeatMode = (window.repeatMode + 1) % 3;
 window.repeatBtn.classList.toggle('active', window.repeatMode > 0);
 
 if (window.repeatMode === 2) {
 window.repeatBtn.innerHTML = `
 <svg viewBox="0 0 24 24" fill="currentColor">
 <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/>
 <text x="12" y="16" text-anchor="middle" font-size="8" font-weight="bold" fill="currentColor">1</text>
 </svg>
 `;
 } else {
 window.repeatBtn.innerHTML = `
 <svg viewBox="0 0 24 24" fill="currentColor">
 <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/>
 </svg>
 `;
 }
 }

window.seekTo = function(event) {
 if (!player || !window.player.getDuration) return;
 
 const duration = window.player.getDuration();
 if (duration === 0) return;
 
 const rect = progressBar.getBoundingClientRect();
 const clickX = event.clientX - rect.left;
 const percentage = clickX / rect.width;
 const seekTime = percentage * duration;
 
 window.player.seekTo(seekTime);
 }

window.toggleMute = function() {
 isMuted = !isMuted;
 volumeIcon.style.display = isMuted ? 'none' : 'block';
 muteIcon.style.display = isMuted ? 'block' : 'none';
 volumeFill.style.width = isMuted ? '0%' : volume + '%';
 
 if (window.player && window.player.setVolume) {
 if (isMuted) {
 window.player.mute();
 } else {
 window.player.unMute();
 }
 }
 }

window.adjustVolume = function(event) {
 const rect = volumeSlider.getBoundingClientRect();
 const clickX = event.clientX - rect.left;
 volume = (clickX / rect.width) * 100;
 volumeFill.style.width = volume + '%';
 
 if (window.player && window.player.setVolume) {
 window.player.setVolume(volume);
 }
 
 if (volume > 0 && isMuted) {
 isMuted = false;
 volumeIcon.style.display = 'block';
 muteIcon.style.display = 'none';
 if (window.player && window.player.unMute) {
 window.player.unMute();
 }
 }
 }

window.openPlaylistModal = function() {
  window.playlistModalOverlay.classList.add('active');
  playlistUrlInput.value = '';
  videoUrlInput.value = '';
  playlistNameInput.value = '';
  playlistStatus.textContent = '';
  window.loadPlaylist.disabled = false;
  manualPlaylistCheckbox.checked = false;
  playlistUrlGroup.style.display = 'block';
  videoUrlGroup.style.display = 'none';
  communityNotice.style.display = 'block';
  playlistModalTitle.textContent = 'Import YouTube Playlist';
  window.loadPlaylistText.textContent = 'Import & Share';
 }

window.closePlaylistModalFunc = function() {
 window.playlistModalOverlay.classList.remove('active');
 }

 // Delete Song from Playlist
window.deleteSong = function(index) {
 const songs = window.getCurrentSongs();
 const song = songs[index];

 // Ask for confirmation
 const confirmed = confirm(`Are you sure you want to remove "${song.title}" by ${song.artist} from this playlist?`);

 if (!confirmed) {
 return;
 }

 // Remove the song
 window.playlists[window.currentPlaylistIndex].songs.splice(index, 1);

 // Update current song index if needed
 if (window.currentSongIndex === index) {
 // If deleted song was playing, pause and reset
 if (window.isPlaying) {
 window.pause();
 }
 // If there are more songs, play the next one (which is now at the same index)
 if (window.playlists[window.currentPlaylistIndex].songs.length > 0) {
 if (index >= window.playlists[window.currentPlaylistIndex].songs.length) {
 window.currentSongIndex = window.playlists[window.currentPlaylistIndex].songs.length - 1;
 }
 window.selectSong(window.currentSongIndex);
 } else {
 window.currentSongIndex = -1;
 }
 } else if (window.currentSongIndex > index) {
 // Adjust current song index if it's after the deleted song
 window.currentSongIndex--;
 }

 // Save and refresh
 savePlaylists();
 window.initPlaylist();
 window.initCarousel();
 }

 // LocalStorage
window.savePlaylists = function() {
 console.log('ğŸ’¾ Saving playlists:', window.playlists.length);
 localStorage.setItem('universalMusicPlayerPlaylists', JSON.stringify(window.playlists));
 }

window.loadPlaylists = function() {
 console.log('ğŸ“‚ Loading playlists from localStorage...');
 try {
 const saved = localStorage.getItem('universalMusicPlayerPlaylists');
 if (saved) {
 window.playlists = JSON.parse(saved);
 console.log('âœ… Loaded', window.playlists.length, 'playlists from localStorage');
 }
 } catch (e) {
 console.error('âŒ Error loading playlists:', e);
 }

 if (window.playlists.length === 0) {
 console.log('âš ï¸ No playlists found, creating default playlist');
 window.playlists = [{
 id: Date.now(),
 name: 'My Playlist',
 songs: []
 }];
 }
 console.log('ğŸ“‹ Total playlists:', window.playlists.length);
 }

// Add Song Modal Event Listeners
window.closeAddSongModal.addEventListener('click', window.closeAddSongModalFunc);
window.cancelAddSong.addEventListener('click', window.closeAddSongModalFunc);
window.addSongBtn.addEventListener('click', window.addSongToPlaylist);
window.addSongModalOverlay.addEventListener('click', (e) => {
  if (e.target === window.addSongModalOverlay) window.closeAddSongModalFunc();
});
window.addSongVideoUrl.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') window.addSongToPlaylist();
});

// Event Listeners - Main Controls
 window.playPauseBtn.addEventListener('click', window.togglePlay);
 window.prevBtn.addEventListener('click', window.prevSong);
 window.nextBtn.addEventListener('click', window.nextSong);
 window.shuffleBtn.addEventListener('click', window.toggleShuffle);
 window.repeatBtn.addEventListener('click', window.toggleRepeat);
 progressBar.addEventListener('click', seekTo);
 volumeBtn.addEventListener('click', toggleMute);
 volumeSlider.addEventListener('click', adjustVolume);
 
 // Event Listeners - Floating Player
 window.floatingPlayerBtn.addEventListener('click', window.toggleFloatingPlayer);
 window.closeFloatingPlayer.addEventListener('click', window.toggleFloatingPlayer);
 popoutWindowBtn.addEventListener('click', openPopoutWindow);
 window.floatingPlayPauseBtn.addEventListener('click', window.togglePlay);
 window.floatingPrevBtn.addEventListener('click', window.prevSong);
 window.floatingNextBtn.addEventListener('click', window.nextSong);
 
const playlistHeaderAddBtn = document.getElementById('playlistHeaderAddBtn');

// Playlist Header Add Button Event Listener
if (playlistHeaderAddBtn) {
  playlistHeaderAddBtn.addEventListener('click', () => {
    window.openAddSongModal(window.currentPlaylistIndex);
  });
}

 // Event Listeners - Sticky Controls
 window.stickyPlayPauseBtn.addEventListener('click', window.togglePlay);
 window.stickyPrevBtn.addEventListener('click', window.prevSong);
 window.stickyNextBtn.addEventListener('click', window.nextSong);
 
 // Event Listeners - Carousel
 window.carouselPrev.addEventListener('click', () => scrollCarousel('prev'));
 window.carouselNext.addEventListener('click', () => scrollCarousel('next'));
 
 // Event Listeners - Library
 libraryBtn.addEventListener('click', openLibraryModal);
 closeLibraryModal.addEventListener('click', closeLibraryModalFunc);
 libraryModalOverlay.addEventListener('click', (e) => {
 if (e.target === libraryModalOverlay) closeLibraryModalFunc();
 });
 librarySearchBtn.addEventListener('click', handleLibrarySearch);
 librarySearchInput.addEventListener('input', handleLiveSearch);
 librarySearchInput.addEventListener('keypress', (e) => {
 if (e.key === 'Enter') handleLibrarySearch();
 });
 // Close preview when clicking outside
 document.addEventListener('click', (e) => {
 if (!librarySearchPreview.contains(e.target) && !librarySearchInput.contains(e.target)) {
 librarySearchPreview.classList.remove('active');
 }
 });
 
 // Event Listeners - Import
 window.importPlaylistBtn.addEventListener('click', window.openPlaylistModal);
 window.addPlaylistBtn.addEventListener('click', window.openPlaylistModal);
 const addPlaylistBtnMobile = document.getElementById('addPlaylistBtnMobile');
 if (addPlaylistBtnMobile) {
 addPlaylistBtnMobile.addEventListener('click', window.openPlaylistModal);
 }
 window.closePlaylistModal.addEventListener('click', window.closePlaylistModalFunc);
 window.cancelPlaylist.addEventListener('click', window.closePlaylistModalFunc);
// Manual Playlist Checkbox Toggle
manualPlaylistCheckbox.addEventListener('change', () => {
  if (manualPlaylistCheckbox.checked) {
    // Manual playlist mode
    playlistUrlGroup.style.display = 'none';
    videoUrlGroup.style.display = 'block';
    communityNotice.style.display = 'none';
    playlistModalTitle.textContent = 'Create Manual Playlist';
    window.loadPlaylistText.textContent = 'Create Playlist';
  } else {
    // Regular playlist mode
    playlistUrlGroup.style.display = 'block';
    videoUrlGroup.style.display = 'none';
    communityNotice.style.display = 'block';
    playlistModalTitle.textContent = 'Import YouTube Playlist';
    window.loadPlaylistText.textContent = 'Import & Share';
  }
});

 window.loadPlaylist.addEventListener('click', async () => {
 const name = playlistNameInput.value.trim();
 
 if (manualPlaylistCheckbox.checked) {
 // Manual playlist mode
 const videoUrl = videoUrlInput.value.trim();
 if (videoUrl) {
 await createManualPlaylist(videoUrl, name);
 } else {
 alert('Please enter a video URL');
 }
 } else {
 // Regular playlist mode
 const url = playlistUrlInput.value.trim();
 if (url) {
 window.importYouTubePlaylist(url, name);
 } else {
 alert('Please enter a playlist URL or ID');
 }
 }
 });
 
 window.playlistModalOverlay.addEventListener('click', (e) => {
 if (e.target === window.playlistModalOverlay) closePlaylistModalFunc();
 });
 

// Easter Egg Modal - Advanced Atmosphere Settings
const easterEggModalOverlay = document.getElementById('easterEggModalOverlay');
const closeEasterEggModal = document.getElementById('closeEasterEggModal');
const moodTitle = document.querySelector('.mood-title');
const resetEasterEgg = document.getElementById('resetEasterEgg');

// Easter Egg Controls
const playerOpacity = document.getElementById('playerOpacity');
const playerOpacityValue = document.getElementById('playerOpacityValue');
const stickyMoodColors = document.getElementById('stickyMoodColors');
const animationSpeed = document.getElementById('animationSpeed');
const blurIntensity = document.getElementById('blurIntensity');
const visualizerBars = document.getElementById('visualizerBars');
const visualizerBarsValue = document.getElementById('visualizerBarsValue');
const borderGlow = document.getElementById('borderGlow');
const particleEffects = document.getElementById('particleEffects');
const shadowDepth = document.getElementById('shadowDepth');
const textGlow = document.getElementById('textGlow');
const progressGlow = document.getElementById('progressGlow');
const buttonRotation = document.getElementById('buttonRotation');
const colorSaturation = document.getElementById('colorSaturation');
const colorSaturationValue = document.getElementById('colorSaturationValue');

// Mood colors for sticky controller
const moodColors = {
  default: 'rgba(26, 26, 26, 0.98)',
  sunset: 'rgba(255, 94, 77, 0.95)',
  ocean: 'rgba(52, 152, 219, 0.95)',
  forest: 'rgba(39, 174, 96, 0.95)',
  midnight: 'rgba(44, 62, 80, 0.95)',
  aurora: 'rgba(155, 89, 182, 0.95)',
  candy: 'rgba(255, 107, 107, 0.95)',
  neon: 'rgba(236, 112, 99, 0.95)',
  tropical: 'rgba(253, 121, 168, 0.95)',
  cosmic: 'rgba(142, 68, 173, 0.95)',
  plasma: 'rgba(187, 143, 206, 0.95)',
  starfield: 'rgba(41, 47, 76, 0.95)',
  electric: 'rgba(0, 184, 255, 0.95)',
  matrix: 'rgba(0, 255, 65, 0.95)',
  vaporwave: 'rgba(255, 113, 206, 0.95)',
  fire: 'rgba(255, 87, 34, 0.95)',
  cyberpunk: 'rgba(255, 0, 128, 0.95)',
  glitch: 'rgba(128, 0, 255, 0.95)',
  lightning: 'rgba(255, 235, 59, 0.95)',
  heart: 'rgba(255, 192, 203, 0.95)',
  prism: 'rgba(179, 136, 255, 0.95)',
  hologram: 'rgba(0, 255, 255, 0.95)',
  laser: 'rgba(255, 0, 0, 0.95)',
  warp: 'rgba(138, 43, 226, 0.95)',
  disco: 'rgba(255, 215, 0, 0.95)',
  nuclear: 'rgba(0, 255, 0, 0.95)',
  supernova: 'rgba(255, 165, 0, 0.95)',
  oceanic: 'rgba(0, 105, 148, 0.95)',
  desert: 'rgba(205, 133, 63, 0.95)',
  arctic: 'rgba(176, 224, 230, 0.95)',
  jungle: 'rgba(34, 139, 34, 0.95)',
  cherry: 'rgba(220, 20, 60, 0.95)',
  thunder: 'rgba(75, 0, 130, 0.95)',
  mystic: 'rgba(138, 43, 226, 0.95)',
  cybergrid: 'rgba(0, 255, 255, 0.95)',
  royal: 'rgba(75, 0, 130, 0.95)',
  golden: 'rgba(255, 215, 0, 0.95)',
  nebula: 'rgba(218, 112, 214, 0.95)',
  crimson: 'rgba(220, 20, 60, 0.95)',
  emerald: 'rgba(0, 201, 87, 0.95)',
  solar: 'rgba(255, 140, 0, 0.95)',
  moonlight: 'rgba(192, 192, 192, 0.95)',
  sakura: 'rgba(255, 183, 197, 0.95)',
  volcano: 'rgba(255, 69, 0, 0.95)',
  arcticaurora: 'rgba(0, 255, 242, 0.95)',
  amethyst: 'rgba(177, 156, 217, 0.95)',
  emeraldforest: 'rgba(46, 204, 113, 0.95)',
  sunsetbeach: 'rgba(255, 154, 118, 0.95)',
  deepocean: 'rgba(0, 105, 148, 0.95)',
  rosegold: 'rgba(232, 180, 184, 0.95)',
  cosmos: 'rgba(109, 40, 217, 0.95)',
  phoenix: 'rgba(255, 165, 0, 0.95)'
};

let particleContainer = null;

// Load settings from localStorage
window.loadEasterEggSettings = function() {
  const settings = JSON.parse(localStorage.getItem('easterEggSettings') || '{}');

  // CRITICAL: Remove any body filter from old versions (breaks position: fixed)
  document.body.style.filter = '';

  playerOpacity.value = settings.playerOpacity || 68;
  playerOpacityValue.textContent = playerOpacity.value + '%';
  const alpha = playerOpacity.value / 100;
  document.querySelector('.music-player').style.background = `rgba(255, 255, 255, ${alpha})`;

  stickyMoodColors.checked = settings.stickyMoodColors || false;

  animationSpeed.value = settings.animationSpeed || 1;
  document.body.style.animationDuration = (10 / parseFloat(animationSpeed.value)) + 's';

  blurIntensity.value = settings.blurIntensity !== undefined ? settings.blurIntensity : 20;
  updateBlur();

  visualizerBars.value = settings.visualizerBars || 50;
  visualizerBarsValue.textContent = visualizerBars.value;
  updateVisualizerBars();

  borderGlow.checked = settings.borderGlow || false;
  updateBorderGlow();

  particleEffects.checked = settings.particleEffects || false;
  if (particleEffects.checked) createParticles();

  shadowDepth.value = settings.shadowDepth || 'medium';
  updateShadowDepth();

  textGlow.checked = settings.textGlow || false;
  updateTextGlow();

  progressGlow.checked = settings.progressGlow || false;
  updateProgressGlow();

  buttonRotation.checked = settings.buttonRotation || false;
  updateButtonRotation();

  colorSaturation.value = settings.colorSaturation || 100;
  colorSaturationValue.textContent = colorSaturation.value + '%';
  updateColorSaturation();
}

// Save settings to localStorage
window.saveEasterEggSettings = function() {
  const settings = {
    playerOpacity: parseFloat(playerOpacity.value),
    stickyMoodColors: stickyMoodColors.checked,
    animationSpeed: parseFloat(animationSpeed.value),
    blurIntensity: parseInt(blurIntensity.value),
    visualizerBars: parseInt(visualizerBars.value),
    borderGlow: borderGlow.checked,
    particleEffects: particleEffects.checked,
    shadowDepth: shadowDepth.value,
    textGlow: textGlow.checked,
    progressGlow: progressGlow.checked,
    buttonRotation: buttonRotation.checked,
    colorSaturation: parseInt(colorSaturation.value)
  };
  localStorage.setItem('easterEggSettings', JSON.stringify(settings));
}

// Open Easter Egg Modal
window.openEasterEggModal = function() {
  easterEggModalOverlay.classList.add('active');
}

// Close Easter Egg Modal
window.closeEasterEggModalFunc = function() {
  easterEggModalOverlay.classList.remove('active');
}

// Player Opacity
playerOpacity.addEventListener('input', () => {
  playerOpacityValue.textContent = playerOpacity.value + '%';
  const alpha = playerOpacity.value / 100;
  document.querySelector('.music-player').style.background = `rgba(255, 255, 255, ${alpha})`;
  saveEasterEggSettings();
});

// Sticky Mood Colors
stickyMoodColors.addEventListener('change', () => {
  if (stickyMoodColors.checked) {
    updateStickyColor(currentMood);
  } else {
    document.querySelector('.sticky-controls').style.background = 'rgba(26, 26, 26, 0.98)';
  }
  saveEasterEggSettings();
});

// Update sticky color when mood changes
window.updateStickyColor = function(mood) {
  if (stickyMoodColors.checked && moodColors[mood]) {
    document.querySelector('.sticky-controls').style.background = moodColors[mood];
  }
}

// Animation Speed
animationSpeed.addEventListener('change', () => {
  const speed = parseFloat(animationSpeed.value);
  const allMoodClasses = Array.from(document.body.classList).filter(c => c.startsWith('mood-'));
  allMoodClasses.forEach(moodClass => {
    const style = document.createElement('style');
    const duration = (10 / speed);
    style.textContent = 'body.' + moodClass + ' { animation-duration: ' + duration + 's !important; }';
    document.head.appendChild(style);
  });
  saveEasterEggSettings();
});

// Blur Intensity
blurIntensity.addEventListener('change', () => {
  updateBlur();
  saveEasterEggSettings();
});

window.updateBlur = function() {
  const blur = parseInt(blurIntensity.value);
  const elements = [
    document.querySelector('.music-player'),
    document.querySelector('.sticky-controls'),
    ...document.querySelectorAll('.modal')
  ];
  elements.forEach(el => {
    if (el) {
      el.style.backdropFilter = blur > 0 ? ('blur(' + blur + 'px)') : 'none';
    }
  });
}

// Visualizer Bars
visualizerBars.addEventListener('input', () => {
  visualizerBarsValue.textContent = visualizerBars.value;
  updateVisualizerBars();
  saveEasterEggSettings();
});

window.updateVisualizerBars = function() {
  const count = parseInt(visualizerBars.value);
  const visualizer = document.querySelector('.music-visualizer');
  if (visualizer) {
    visualizer.innerHTML = '';
    for (let i = 0; i < count; i++) {
      const bar = document.createElement('div');
      bar.className = 'visualizer-bar';
      // Add random animation delay and duration for variety
      const delay = (Math.random() * 0.5).toFixed(2);
      const duration = (0.4 + Math.random() * 0.4).toFixed(2);
      bar.style.animationDelay = delay + 's';
      bar.style.animationDuration = duration + 's';
      visualizer.appendChild(bar);
    }
  }
}

// Border Glow
borderGlow.addEventListener('change', () => {
  updateBorderGlow();
  saveEasterEggSettings();
});

window.updateBorderGlow = function() {
  const elements = [
    document.querySelector('.music-player'),
    document.querySelector('.sticky-controls'),
    ...document.querySelectorAll('.control-btn'),
    ...document.querySelectorAll('.carousel-item')
  ];
  
  if (borderGlow.checked) {
    elements.forEach(el => {
      if (el) {
        el.style.boxShadow = '0 0 20px rgba(102, 126, 234, 0.5), 0 0 40px rgba(118, 75, 162, 0.3)';
      }
    });
  } else {
    elements.forEach(el => {
      if (el) {
        el.style.boxShadow = '';
      }
    });
  }
}

// Particle Effects
particleEffects.addEventListener('change', () => {
  if (particleEffects.checked) {
    createParticles();
  } else {
    removeParticles();
  }
  saveEasterEggSettings();
});

window.createParticles = function() {
  if (particleContainer) return;
  
  particleContainer = document.createElement('div');
  particleContainer.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; overflow: hidden;';
  
  for (let i = 0; i < 50; i++) {
    const particle = document.createElement('div');
    const size = Math.random() * 4 + 2;
    const opacity = Math.random() * 0.5 + 0.3;
    const leftPos = Math.random() * 100;
    const topPos = Math.random() * 100;
    const duration = Math.random() * 10 + 10;
    
    particle.style.cssText = 'position: absolute; width: ' + size + 'px; height: ' + size + 'px; background: rgba(102, 126, 234, ' + opacity + '); border-radius: 50%; left: ' + leftPos + '%; top: ' + topPos + '%; animation: float ' + duration + 's linear infinite;';
    particleContainer.appendChild(particle);
  }
  
  const style = document.createElement('style');
  const randomX = Math.random() * 100 - 50;
  style.textContent = '@keyframes float { 0%, 100% { transform: translateY(0) translateX(0); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateY(-100vh) translateX(' + randomX + 'px); opacity: 0; } }';
  document.head.appendChild(style);
  
  document.body.appendChild(particleContainer);
}

window.removeParticles = function() {
  if (particleContainer) {
    particleContainer.remove();
    particleContainer = null;
  }
}


// Shadow Depth
shadowDepth.addEventListener('change', () => {
  updateShadowDepth();
  saveEasterEggSettings();
});

window.updateShadowDepth = function() {
  const depth = shadowDepth.value;
  const cards = [
    ...document.querySelectorAll('.carousel-item'),
    ...document.querySelectorAll('.library-card'),
    ...document.querySelectorAll('.modal')
  ];
  
  const shadows = {
    flat: 'none',
    low: '0 2px 8px rgba(0, 0, 0, 0.1)',
    medium: '0 4px 15px rgba(0, 0, 0, 0.2)',
    high: '0 8px 30px rgba(0, 0, 0, 0.3)',
    ultra: '0 12px 50px rgba(0, 0, 0, 0.4), 0 20px 80px rgba(0, 0, 0, 0.2)'
  };
  
  cards.forEach(el => {
    if (el) el.style.boxShadow = shadows[depth];
  });
}

// Text Glow
textGlow.addEventListener('change', () => {
  updateTextGlow();
  saveEasterEggSettings();
});

window.updateTextGlow = function() {
  const titles = [
    ...document.querySelectorAll('.song-title'),
    ...document.querySelectorAll('.modal-title'),
    ...document.querySelectorAll('.app-title'),
    ...document.querySelectorAll('h2')
  ];
  
  if (textGlow.checked) {
    titles.forEach(el => {
      if (el) {
        el.style.textShadow = '0 0 10px rgba(102, 126, 234, 0.8), 0 0 20px rgba(118, 75, 162, 0.6)';
      }
    });
  } else {
    titles.forEach(el => {
      if (el) el.style.textShadow = '';
    });
  }
}

// Progress Bar Glow
progressGlow.addEventListener('change', () => {
  updateProgressGlow();
  saveEasterEggSettings();
});

window.updateProgressGlow = function() {
  const progressBars = document.querySelectorAll('.progress');
  
  if (progressGlow.checked) {
    progressBars.forEach(bar => {
      if (bar) {
        bar.style.boxShadow = '0 0 15px rgba(102, 126, 234, 0.8), inset 0 0 10px rgba(118, 75, 162, 0.5)';
        bar.style.filter = 'brightness(1.3)';
      }
    });
  } else {
    progressBars.forEach(bar => {
      if (bar) {
        bar.style.boxShadow = '';
        bar.style.filter = '';
      }
    });
  }
}

// Button Rotation
buttonRotation.addEventListener('change', () => {
  updateButtonRotation();
  saveEasterEggSettings();
});

window.updateButtonRotation = function() {
  const style = document.createElement('style');
  style.id = 'button-rotation-style';
  
  if (buttonRotation.checked) {
    style.textContent = '.control-btn:hover, .carousel-btn:hover, .modal-btn:hover { transform: rotate(5deg) scale(1.1); transition: all 0.3s ease; }';
    document.head.appendChild(style);
  } else {
    const existing = document.getElementById('button-rotation-style');
    if (existing) existing.remove();
  }
}

// Color Saturation
colorSaturation.addEventListener('input', () => {
  colorSaturationValue.textContent = colorSaturation.value + '%';
  updateColorSaturation();
  saveEasterEggSettings();
});

window.updateColorSaturation = function() {
  const saturation = parseInt(colorSaturation.value) / 100;
  // Apply filter to visual elements, NOT body (body filter breaks position: fixed)
  document.querySelector('.player-wrapper').style.filter = 'saturate(' + saturation + ')';
  document.querySelector('.sticky-controls').style.filter = 'saturate(' + saturation + ')';

  // Apply to all mood background ::before elements via CSS variable
  document.documentElement.style.setProperty('--saturation-value', saturation);
}
// Reset to defaults
resetEasterEgg.addEventListener('click', () => {
  if (confirm('Reset all atmosphere settings to default values?')) {
    localStorage.removeItem('easterEggSettings');
    playerOpacity.value = 68;
    playerOpacityValue.textContent = '68%';
    document.querySelector('.music-player').style.background = 'rgba(255, 255, 255, 0.68)';
    stickyMoodColors.checked = false;
    document.querySelector('.sticky-controls').style.background = 'rgba(26, 26, 26, 0.98)';
    animationSpeed.value = 1;
    blurIntensity.value = 20;
    updateBlur();
    visualizerBars.value = 50;
    visualizerBarsValue.textContent = '50';
    updateVisualizerBars();
    borderGlow.checked = false;
    updateBorderGlow();
    particleEffects.checked = false;
    removeParticles();
    // Reset color saturation
    colorSaturation.value = 100;
    colorSaturationValue.textContent = '100%';
    document.querySelector('.player-wrapper').style.filter = '';
    document.querySelector('.sticky-controls').style.filter = '';
    document.documentElement.style.setProperty('--saturation-value', '1');
    // Remove old body filter if it exists
    document.body.style.filter = '';
    shadowDepth.value = 'medium';
    updateShadowDepth();
    textGlow.checked = false;
    updateTextGlow();
    progressGlow.checked = false;
    updateProgressGlow();
    buttonRotation.checked = false;
    updateButtonRotation();
    colorSaturation.value = 100;
    colorSaturationValue.textContent = '100%';
    updateColorSaturation();
  }
});

// Mood Help Button
const moodHelpBtn = document.getElementById('moodHelpBtn');
const moodHelpModalOverlay = document.getElementById('moodHelpModalOverlay');
const closeMoodHelpModal = document.getElementById('closeMoodHelpModal');

window.openMoodHelpModal = function() {
  moodHelpModalOverlay.classList.add('active');
}

window.closeMoodHelpModalFunc = function() {
  moodHelpModalOverlay.classList.remove('active');
}

moodHelpBtn.addEventListener('click', (e) => {
  e.stopPropagation(); // Prevent triggering parent click
  openMoodHelpModal();
});

closeMoodHelpModal.addEventListener('click', closeMoodHelpModalFunc);
moodHelpModalOverlay.addEventListener('click', (e) => {
  // Close modal if clicking on overlay background
  if (e.target === moodHelpModalOverlay) {
    closeMoodHelpModalFunc();
    return;
  }

  // Handle mood item clicks using event delegation (works on mobile too)
  const moodItem = e.target.closest('.mood-item[data-mood]');
  if (moodItem) {
    const mood = moodItem.getAttribute('data-mood');
    applyMood(mood);
    closeMoodHelpModalFunc();
  }
});

// Mood title click handler (Easter egg trigger)
moodTitle.addEventListener('click', openEasterEggModal);

// Close modal handlers
closeEasterEggModal.addEventListener('click', closeEasterEggModalFunc);
easterEggModalOverlay.addEventListener('click', (e) => {
  if (e.target === easterEggModalOverlay) closeEasterEggModalFunc();
});

// Background Effects System
const effectSpeed = document.getElementById('effectSpeed');
const effectSpeedValue = document.getElementById('effectSpeedValue');
const effectIntensity = document.getElementById('effectIntensity');
const effectIntensityValue = document.getElementById('effectIntensityValue');
const effectResetBtn = document.getElementById('effectResetBtn');
const bgColor = document.getElementById('bgColor');
const bgBlur = document.getElementById('bgBlur');
const bgBlurValue = document.getElementById('bgBlurValue');
const borderRadius = document.getElementById('borderRadius');
const borderRadiusValue = document.getElementById('borderRadiusValue');
const bgShadowDepth = document.getElementById('bgShadowDepth');
const bgShadowDepthValue = document.getElementById('bgShadowDepthValue');
const bgBorderGlow = document.getElementById('bgBorderGlow');
const bgBorderGlowValue = document.getElementById('bgBorderGlowValue');
const bgBorderGlowColor = document.getElementById('bgBorderGlowColor');

// Texture variables
let currentTexture = 'none';

// CRITICAL FIX: Make activeEffects a window property for cross-file access
window.activeEffects = [];
let effectSettings = {
  speed: 1,
  intensity: 50
};

// Toggle popup
window.moodEffectsBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  window.moodEffectsPopup.classList.toggle('active');
});

// Close popup when clicking outside
document.addEventListener('click', (e) => {
  if (!window.moodEffectsPopup.contains(e.target) && e.target !== window.moodEffectsBtn) {
    window.moodEffectsPopup.classList.remove('active');
  }
});

// Category expand/collapse
document.querySelectorAll('.effect-category-title').forEach(title => {
  title.addEventListener('click', () => {
    const category = title.dataset.category;
    const options = title.nextElementSibling;
    const arrow = title.querySelector('span:last-child');

    options.classList.toggle('expanded');
    arrow.textContent = options.classList.contains('expanded') ? 'â–¼' : 'â–¶';
  });
});

// Speed control
effectSpeed.addEventListener('input', () => {
  effectSettings.speed = parseFloat(effectSpeed.value);
  effectSpeedValue.textContent = effectSettings.speed + 'x';
  updateEffects();
});

// Intensity control
effectIntensity.addEventListener('input', () => {
  effectSettings.intensity = parseInt(effectIntensity.value);
  effectIntensityValue.textContent = effectSettings.intensity + '%';
  updateEffects();
});

// Effect buttons
document.querySelectorAll('.effect-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const effect = btn.dataset.effect;

    if (window.activeEffects.includes(effect)) {
      // Remove effect
      window.activeEffects = window.activeEffects.filter(e => e !== effect);
      btn.classList.remove('active');
    } else {
      // Add effect
      window.activeEffects.push(effect);
      btn.classList.add('active');
    }

    updateEffects();
  });
});


// Style Customization Event Listeners
bgColor.addEventListener('input', () => {
  updateStyleCustomization();
});

bgOpacity.addEventListener('input', () => {
  bgOpacityValue.textContent = bgOpacity.value + '%';
  updateStyleCustomization();
});

bgBlur.addEventListener('input', () => {
  bgBlurValue.textContent = bgBlur.value + 'px';
  updateStyleCustomization();
});

borderRadius.addEventListener('input', () => {
  borderRadiusValue.textContent = borderRadius.value + 'px';
  updateStyleCustomization();
});

bgShadowDepth.addEventListener('input', () => {
  bgShadowDepthValue.textContent = bgShadowDepth.value + 'px';
  updateStyleCustomization();
});

bgBorderGlow.addEventListener('input', () => {
  bgBorderGlowValue.textContent = bgBorderGlow.value + 'px';
  updateStyleCustomization();
});

bgBorderGlowColor.addEventListener('input', () => {
  updateStyleCustomization();
});

// Texture buttons event listeners
document.querySelectorAll('.texture-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const texture = btn.dataset.texture;

    // Remove active class from all texture buttons
    document.querySelectorAll('.texture-btn').forEach(b => b.classList.remove('active'));

    // Add active class to clicked button
    btn.classList.add('active');

    // Update current texture
    currentTexture = texture;

    // Apply texture
    applyTexture(texture);
  });
});

// Apply texture function
window.applyTexture = function(texture) {
  if (texture === 'none') {
    window.moodSection.style.backgroundImage = '';
    window.moodSection.style.backgroundBlendMode = '';
  } else {
    // CRITICAL FIX: Remove ALL texture classes (including new ones added)
    // This prevents textures from stacking when switching between them
    window.moodSection.classList.remove(
      'texture-speaker-grille', 'texture-sound-waves', 'texture-equalizer',
      'texture-waveform', 'texture-bass-ripples', 'texture-studio-foam',
      'texture-audio-jack', 'texture-mic-mesh', 'texture-piano-keys',
      'texture-guitar-strings', 'texture-drum-skin', 'texture-foam-pyramids',
      'texture-xlr-connector', 'texture-cassette-tape', 'texture-cd-diffraction',
      'texture-mixing-console', 'texture-frequency-spectrum', 'texture-oscilloscope',
      'texture-soundwave-circular', 'texture-amplitude-pulse', 'texture-stereo-waves',
      'texture-frequency-rings', 'texture-audio-spectrum-3d', 'texture-sine-waves',
      'texture-beat-grid', 'texture-harmonic-waves'
    );

    // Add the selected texture class
    window.moodSection.classList.add('texture-' + texture);

    // Use blend mode to combine texture with background color
    window.moodSection.style.backgroundBlendMode = 'overlay';
  }

  updateStyleCustomization();
}

// Update style customization function
window.updateStyleCustomization = function() {
  const color = bgColor.value;
  const opacity = bgOpacity.value / 100;
  const blur = bgBlur.value;
  const radius = borderRadius.value;
  const shadow = bgShadowDepth.value;
  const glow = bgBorderGlow.value;
  const glowColor = bgBorderGlowColor.value;

  // Convert hex to rgba
  const r = parseInt(color.substr(1, 2), 16);
  const g = parseInt(color.substr(3, 2), 16);
  const b = parseInt(color.substr(5, 2), 16);

  window.moodSection.style.backgroundColor = 'rgba(' + r + ', ' + g + ', ' + b + ', ' + opacity + ')';
  window.moodSection.style.backdropFilter = blur > 0 ? 'blur(' + blur + 'px)' : '';
  window.moodSection.style.webkitBackdropFilter = blur > 0 ? 'blur(' + blur + 'px)' : '';
  window.moodSection.style.borderRadius = radius + 'px';
  
  let boxShadow = '';
  if (shadow > 0) {
    boxShadow = '0 ' + shadow + 'px ' + (shadow * 2) + 'px rgba(0, 0, 0, 0.2)';
  }
  if (glow > 0) {
    const glowR = parseInt(glowColor.substr(1, 2), 16);
    const glowG = parseInt(glowColor.substr(3, 2), 16);
    const glowB = parseInt(glowColor.substr(5, 2), 16);
    const glowShadow = '0 0 ' + glow + 'px rgba(' + glowR + ', ' + glowG + ', ' + glowB + ', 0.6)';
    boxShadow = boxShadow ? boxShadow + ', ' + glowShadow : glowShadow;
  }
  window.moodSection.style.boxShadow = boxShadow;

  // Apply border glow to video player container
  const videoPlayerContainer = document.querySelector('.video-player-container');
  if (videoPlayerContainer) {
    let videoBoxShadow = '0 10px 30px rgba(0, 0, 0, 0.2)';
    if (glow > 0) {
      const glowR = parseInt(glowColor.substr(1, 2), 16);
      const glowG = parseInt(glowColor.substr(3, 2), 16);
      const glowB = parseInt(glowColor.substr(5, 2), 16);
      const videoGlowShadow = '0 0 ' + glow + 'px ' + (glow * 2) + 'px rgba(' + glowR + ', ' + glowG + ', ' + glowB + ', 0.6)';
      videoBoxShadow += ', ' + videoGlowShadow;
    }
    videoPlayerContainer.style.boxShadow = videoBoxShadow;
  }
}
// Reset button
effectResetBtn.addEventListener('click', () => {
  window.activeEffects = [];
  document.querySelectorAll('.effect-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  window.moodSection.style.animation = '';
  window.moodSection.style.border = '';
  
  // Reset style customizations
  bgColor.value = '#f8f8f8';
  bgOpacity.value = 100;
  bgOpacityValue.textContent = '100%';
  bgBlur.value = 0;
  bgBlurValue.textContent = '0px';
  borderRadius.value = 12;
  borderRadiusValue.textContent = '12px';
  bgShadowDepth.value = 0;
  bgShadowDepthValue.textContent = '0px';
  bgBorderGlow.value = 0;
  bgBorderGlowValue.textContent = '0px';
  window.moodSection.style.backgroundColor = '';
  window.moodSection.style.backdropFilter = '';
  window.moodSection.style.webkitBackdropFilter = '';
  window.moodSection.style.borderRadius = '';
  window.moodSection.style.boxShadow = '';

  // Reset texture - Remove ALL texture classes
  currentTexture = 'none';
  window.moodSection.style.backgroundImage = '';
  window.moodSection.style.backgroundBlendMode = '';
  window.moodSection.classList.remove(
    'texture-speaker-grille', 'texture-sound-waves', 'texture-equalizer',
    'texture-waveform', 'texture-bass-ripples', 'texture-studio-foam',
    'texture-audio-jack', 'texture-mic-mesh', 'texture-piano-keys',
    'texture-guitar-strings', 'texture-drum-skin', 'texture-foam-pyramids',
    'texture-xlr-connector', 'texture-cassette-tape', 'texture-cd-diffraction',
    'texture-mixing-console', 'texture-frequency-spectrum', 'texture-oscilloscope',
    'texture-soundwave-circular', 'texture-amplitude-pulse', 'texture-stereo-waves',
    'texture-frequency-rings', 'texture-audio-spectrum-3d', 'texture-sine-waves',
    'texture-beat-grid', 'texture-harmonic-waves'
  );
  document.querySelectorAll('.texture-btn').forEach(btn => btn.classList.remove('active'));
  const noneTextureBtn = document.querySelector('.texture-btn[data-texture="none"]');
  if (noneTextureBtn) noneTextureBtn.classList.add('active');

  updateEffects();
});

// Apply effects
window.updateEffects = function() {
  const duration = 2 / effectSettings.speed;
  const scale = effectSettings.intensity / 100;

  if (window.activeEffects.length === 0) {
    window.moodSection.style.animation = '';
    window.moodSection.style.border = '';
    return;
  }

  const animations = window.activeEffects.map(effect => {
    let animName = '';
    switch(effect) {
      case 'heartbeat': animName = 'bgHeartbeat'; break;
      case 'flash': animName = 'bgFlash'; break;
      case 'glowpulse': animName = 'bgGlowPulse'; break;
      case 'scalebounce': animName = 'bgScaleBounce'; break;
      case 'breathe': animName = 'bgBreathe'; break;
      case 'beatdrop': animName = 'bgBeatDrop'; break;
      case 'shake': animName = 'bgShake'; break;
      case 'sway': animName = 'bgSway'; break;
      case 'float': animName = 'bgFloat'; break;
      case 'wobble': animName = 'bgWobble'; break;
      case 'tilt3d': animName = 'bgTilt3D'; break;
      case 'flicker': animName = 'bgFlicker'; break;
      case 'glitch': animName = 'bgGlitch'; break;
      case 'rgbsplit': animName = 'bgRGBSplit'; break;
      case 'wavemotion': animName = 'bgWaveMotion'; break;
      case 'ripple': animName = 'bgRipple'; break;
      case 'prism': animName = 'bgPrism'; break;
      case 'borderpulse': animName = 'bgBorderPulse'; break;
      case 'neonglow': animName = 'bgNeonGlow'; break;
      case 'rainbowborder': animName = 'bgRainbowBorder'; break;
      case 'shadowdance': animName = 'bgShadowDance'; break;
      case 'electricedges': animName = 'bgElectricEdges'; break;
    }
    return `${animName} ${duration}s ease-in-out infinite`;
  }).join(', ');

  window.moodSection.style.animation = animations;

  // Add border for border effects
  if (window.activeEffects.some(e => ['borderpulse', 'neonglow', 'rainbowborder', 'shadowdance', 'electricedges'].includes(e))) {
    window.moodSection.style.border = '2px solid transparent';
  }
}

// Load settings on page load
loadEasterEggSettings();
 playlistUrlInput.addEventListener('keypress', (e) => {
 if (e.key === 'Enter') window.loadPlaylist.click();
 });

 // Global API
 window.musicPlayer = {
 getPlaylists: () => playlists,
 getLibrary: () => playlistLibrary,
 getCurrentPlaylist: getCurrentPlaylist,
 getSongs: getCurrentSongs,
 getCurrentSong: () => window.getCurrentSongs()[window.currentSongIndex],
 importYouTubePlaylist: (url, name) => window.importYouTubePlaylist(url, name),
 switchPlaylist: switchPlaylist,
 deletePlaylist: deletePlaylist,
 play: play,
 pause: pause,
 next: nextSong,
 prev: prevSong,
 toggleFloatingPlayer: toggleFloatingPlayer,
 getSettings: () => settings,
 updateSettings: (newSettings) => {
 settings = {...settings, ...newSettings};
 saveSettings();
 applySettings();
 }
 };

 // Random Button Event Listeners
 const randomMoodBtn = document.getElementById('randomMoodBtn');
 const randomAtmosphereBtn = document.getElementById('randomAtmosphereBtn');
 const randomBgBtn = document.getElementById('randomBgBtn');

 // CRITICAL FIX: Use window. prefix since functions are defined in widget-3
 if (randomMoodBtn) {
 randomMoodBtn.addEventListener('click', window.applyRandomMood);
 }

 if (randomAtmosphereBtn) {
 randomAtmosphereBtn.addEventListener('click', window.applyRandomAtmosphere);
 }

 if (randomBgBtn) {
 randomBgBtn.addEventListener('click', window.applyRandomBgEffects);
 }

 // Initialize
 // CRITICAL FIX: Disable transitions on initial load to prevent flickering
 document.body.classList.add('no-transition');
 loadMood();
 loadSettings();
 // Remove no-transition class after mood is applied to enable smooth transitions
 requestAnimationFrame(() => {
 requestAnimationFrame(() => {
 document.body.classList.remove('no-transition');
 });
 });
 // CRITICAL FIX: Don't create particles on page load - only if enabled in settings
 // This prevents annoying flickering effect on initial page load
 // Particles will be created by loadEasterEggSettings() if particleEffects is enabled
 setupDragging();
 
 window.loadLibrary().then(() => {
 window.loadPlaylists();
 window.initPlaylistTabs();
 window.initPlaylist();
 window.initCarousel();

 if (window.getCurrentSongs().length === 0) {
 window.showEmptyState();
 }

 console.log('%cğŸµ Universal Music Player Pro - Enhanced', 'font-size: 20px; font-weight: bold; color: #667eea');
 console.log(`%c${firebaseAvailable ? 'âœ“ Firebase Connected' : 'âš ï¸ Firebase Unavailable - Using localStorage'}`, 'font-size: 14px; color: ' + (firebaseAvailable ? '#43e97b' : '#ff9500'));
 console.log(`%cğŸ“š ${playlistLibrary.length} playlists in ${firebaseAvailable ? 'community' : 'local'} library`, 'font-size: 14px; color: #764ba2');
 console.log('%cğŸ­ 20 Moods with Animated Effects | ğŸ“Š Music Visualizer | âš™ï¸ Settings Panel | ğŸ“º Enhanced Floating Player', 'font-size: 14px; color: #667eea');
 });
}); // End DOMContentLoaded
</script>
