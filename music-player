<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Universal Music Player Pro - Enhanced</title>
 <style>
 * {
 margin: 0;
 padding: 0;
 box-sizing: border-box;
 }

 body {
 font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
 padding: 0;
 margin: 0;
 background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
 min-height: 100vh;
 position: relative;
 overflow-x: hidden;
 transition: background 1s ease;
 }

 /* Mood Backgrounds with Dramatic Animations */
 body.mood-default {
 background: linear-gradient(-45deg, #667eea, #764ba2, #667eea, #5f4fb8);
 background-size: 400% 400%;
 animation: gradientShift 12s ease-in-out infinite;
 }

 body.mood-sunset {
 background: radial-gradient(circle at 20% 50%, #ff6b6b, transparent 50%),
             radial-gradient(circle at 80% 50%, #ffa07a, transparent 50%),
             linear-gradient(135deg, #ff8c42, #ff9966);
 background-size: 200% 200%;
 animation: sunsetPulse 8s ease-in-out infinite;
 }

 body.mood-ocean {
 background: linear-gradient(45deg, #2e3192, #1bffff, #0099ff, #2e3192);
 background-size: 400% 400%;
 animation: oceanWave 10s ease-in-out infinite;
 }

 body.mood-forest {
 background: radial-gradient(ellipse at 30% 40%, #71b280, transparent 60%),
             radial-gradient(ellipse at 70% 60%, #2d8659, transparent 60%),
             linear-gradient(135deg, #134e5e, #1a6644);
 background-size: 300% 300%;
 animation: forestBreeze 15s ease-in-out infinite;
 }

 body.mood-midnight {
 background: radial-gradient(circle at 50% 50%, #302b63, transparent 70%),
             linear-gradient(135deg, #0f0c29, #24243e);
 background-size: 300% 300%;
 animation: midnightPulse 20s ease-in-out infinite;
 }

 body.mood-aurora {
 background: linear-gradient(0deg, #00c6ff, transparent 50%),
             linear-gradient(60deg, #0072ff, transparent 50%),
             linear-gradient(120deg, #667eea, transparent 50%),
             linear-gradient(180deg, #00d4ff, #0072ff);
 background-size: 300% 300%;
 animation: auroraFlow 8s linear infinite;
 }

 body.mood-candy {
 background: radial-gradient(circle at 30% 30%, #ff0844, transparent 40%),
             radial-gradient(circle at 70% 70%, #ffb199, transparent 40%),
             linear-gradient(135deg, #ff6b9d, #ff0844);
 background-size: 250% 250%;
 animation: candyPop 6s ease-in-out infinite;
 }

 body.mood-neon {
 background: linear-gradient(45deg, #ff00cc, #3333ff, #cc00ff, #6600ff);
 background-size: 400% 400%;
 animation: neonPulse 4s ease-in-out infinite;
 }

 body.mood-tropical {
 background: radial-gradient(circle at 40% 40%, #f093fb, transparent 50%),
             radial-gradient(circle at 60% 60%, #f5576c, transparent 50%),
             linear-gradient(135deg, #ff9a9e, #fad0c4);
 background-size: 300% 300%;
 animation: tropicalVibe 10s ease-in-out infinite;
 }

 body.mood-cosmic {
 background: radial-gradient(circle at 50% 50%, #8e2de2, transparent 60%),
             linear-gradient(45deg, #4a00e0, #6a0ec0, #ae4de2, #4a00e0);
 background-size: 400% 400%;
 animation: cosmicShift 12s linear infinite;
 }

 /* NEW BOLD MOODS WITH CSS ANIMATIONS */
 body.mood-plasma {
 background: radial-gradient(circle at 30% 40%, #ff006e, transparent 40%),
             radial-gradient(circle at 70% 60%, #8338ec, transparent 40%),
             radial-gradient(circle at 50% 50%, #3a86ff, transparent 50%),
             linear-gradient(135deg, #fb5607, #ff006e);
 background-size: 300% 300%;
 animation: plasmaFlow 8s ease-in-out infinite;
 }

 body.mood-starfield {
 background: linear-gradient(135deg, #000428, #004e92);
 animation: starfieldPulse 15s ease-in-out infinite;
 }

 body.mood-lava {
 background: radial-gradient(circle at 40% 60%, #ff4500, transparent 50%),
             radial-gradient(circle at 60% 40%, #ff6347, transparent 50%),
             linear-gradient(135deg, #8b0000, #ff4500);
 background-size: 250% 250%;
 animation: lavaFlow 10s ease-in-out infinite;
 }

 body.mood-electric {
 background: linear-gradient(45deg, #00fff9, #7000ff, #ff00f7, #00fff9);
 background-size: 400% 400%;
 animation: electricPulse 5s linear infinite;
 }

 body.mood-matrix {
 background: linear-gradient(180deg, #001100, #003300);
 animation: matrixFlicker 10s ease-in-out infinite;
 }

 body.mood-rainbow {
 background: linear-gradient(45deg, #ff0000, #ff7700, #ffdd00, #00ff00, #0088ff, #0000ff, #8800ff);
 background-size: 600% 600%;
 animation: rainbowShift 10s linear infinite;
 }

 body.mood-vaporwave {
 background: linear-gradient(180deg, #ff6ec7, #7f00ff, #00d4ff);
 background-size: 300% 300%;
 animation: vaporwaveDrift 12s ease-in-out infinite;
 }

 body.mood-fire {
 background: radial-gradient(ellipse at 50% 100%, #ff4500, transparent 60%),
             radial-gradient(ellipse at 30% 80%, #ff6347, transparent 40%),
             radial-gradient(ellipse at 70% 80%, #ff8c00, transparent 40%),
             linear-gradient(180deg, #000000, #8b0000);
 background-size: 300% 300%;
 animation: fireFlicker 6s ease-in-out infinite;
 }

 body.mood-cyberpunk {
 background: linear-gradient(135deg, #ff00de, #00ffff, #ff00de);
 background-size: 400% 400%;
 animation: cyberpunkGlitch 7s ease-in-out infinite;
 }

 body.mood-galaxy {
 background: radial-gradient(circle at 30% 30%, #667eea, transparent 30%),
             radial-gradient(circle at 70% 70%, #764ba2, transparent 30%),
             radial-gradient(circle at 50% 50%, #f093fb, transparent 40%),
             linear-gradient(135deg, #0f0c29, #302b63, #24243e);
 background-size: 400% 400%;
 animation: galaxySpin 20s linear infinite;
 }

 /* 10 NEW BOLD MOODS */
 body.mood-glitch {
 background: linear-gradient(135deg, #000000, #ff0000, #00ff00, #0000ff);
 background-size: 400% 400%;
 animation: glitchShift 4s ease-in-out infinite;
 }

 body.mood-lightning {
 background: linear-gradient(135deg, #1a1a2e, #16213e);
 animation: lightningFlash 6s ease-in-out infinite;
 }

 body.mood-pulse {
 background: radial-gradient(circle at 50% 50%, #ff006e, #3a86ff);
 background-size: 200% 200%;
 animation: heartPulse 3s ease-in-out infinite;
 }

 body.mood-prism {
 background: conic-gradient(from 0deg at 50% 50%, 
 #ff0000, #ff7700, #ffdd00, #00ff00, #0088ff, #0000ff, #8800ff, #ff0000);
 background-size: 200% 200%;
 animation: prismRotate 15s linear infinite;
 }

 body.mood-hologram {
 background: linear-gradient(45deg, #00ffff, #ff00ff, #00ffff);
 background-size: 400% 400%;
 animation: hologramShimmer 8s ease-in-out infinite;
 }

 body.mood-laser {
 background: linear-gradient(135deg, #000000, #ff0066);
 animation: laserBeam 5s ease-in-out infinite;
 }

 body.mood-warp {
 background: radial-gradient(ellipse at 50% 50%, #8e2de2, #4a00e0);
 background-size: 300% 300%;
 animation: warpSpeed 10s ease-in-out infinite;
 }

 body.mood-disco {
 background: linear-gradient(45deg, #ff00ff, #00ffff, #ffff00, #ff00ff);
 background-size: 400% 400%;
 animation: discoRotate 6s linear infinite;
 }

 body.mood-nuclear {
 background: radial-gradient(circle at 50% 50%, #00ff00, #003300);
 background-size: 200% 200%;
 animation: nuclearGlow 8s ease-in-out infinite;
 }

 body.mood-supernova {
 background: radial-gradient(circle at 50% 50%, #ffffff, #ff4500, #8b0000, #000000);
 background-size: 300% 300%;
 animation: supernovaExplosion 12s ease-in-out infinite;
 }

 /* NEW MOOD ANIMATIONS */
 @keyframes glitchShift {
 0%, 100% { background-position: 0% 50%; filter: hue-rotate(0deg) saturate(1); }
 10% { background-position: 100% 50%; filter: hue-rotate(90deg) saturate(2); }
 20% { background-position: 0% 100%; filter: hue-rotate(180deg) saturate(1.5); }
 30% { background-position: 100% 0%; filter: hue-rotate(270deg) saturate(2); }
 40% { background-position: 50% 50%; filter: hue-rotate(0deg) saturate(1); }
 }

 @keyframes lightningFlash {
 0%, 90%, 100% { filter: brightness(0.8); }
 91%, 93%, 95% { filter: brightness(3) saturate(2); }
 92%, 94% { filter: brightness(0.5); }
 }

 @keyframes heartPulse {
 0%, 100% { background-position: 50% 50%; transform: scale(1) translateZ(0); }
 25% { background-position: 100% 100%; transform: scale(1.1) translateZ(0); }
 50% { background-position: 0% 0%; transform: scale(1) translateZ(0); }
 75% { background-position: 100% 0%; transform: scale(1.1) translateZ(0); }
 }

 @keyframes prismRotate {
 0% { background-position: 0% 50%; filter: hue-rotate(0deg); }
 100% { background-position: 100% 50%; filter: hue-rotate(360deg); }
 }

 @keyframes hologramShimmer {
 0%, 100% { background-position: 0% 50%; filter: brightness(1) saturate(1.5); }
 25% { background-position: 100% 50%; filter: brightness(1.3) saturate(2); }
 50% { background-position: 50% 100%; filter: brightness(1.5) saturate(2.5); }
 75% { background-position: 50% 0%; filter: brightness(1.3) saturate(2); }
 }

 @keyframes laserBeam {
 0%, 100% { filter: brightness(1) contrast(1); }
 50% { filter: brightness(2) contrast(2) saturate(3); }
 }

 @keyframes warpSpeed {
 0%, 100% { background-position: 50% 50%; transform: scale(1) translateZ(0); filter: blur(0px); }
 50% { background-position: 100% 100%; transform: scale(1.2) translateZ(0); filter: blur(5px); }
 }

 @keyframes discoRotate {
 0% { background-position: 0% 50%; filter: hue-rotate(0deg) brightness(1); }
 25% { background-position: 100% 50%; filter: hue-rotate(90deg) brightness(1.3); }
 50% { background-position: 100% 100%; filter: hue-rotate(180deg) brightness(1); }
 75% { background-position: 0% 100%; filter: hue-rotate(270deg) brightness(1.3); }
 100% { background-position: 0% 50%; filter: hue-rotate(360deg) brightness(1); }
 }

 @keyframes nuclearGlow {
 0%, 100% { background-position: 50% 50%; filter: brightness(1) saturate(1.5); }
 50% { background-position: 100% 100%; filter: brightness(2) saturate(3) drop-shadow(0 0 50px #00ff00); }
 }

 @keyframes supernovaExplosion {
 0%, 100% { background-position: 50% 50%; transform: scale(1) translateZ(0); filter: brightness(1); }
 25% { background-position: 75% 75%; transform: scale(1.3) translateZ(0); filter: brightness(2); }
 50% { background-position: 100% 100%; transform: scale(1.5) translateZ(0); filter: brightness(3); }
 75% { background-position: 75% 75%; transform: scale(1.3) translateZ(0); filter: brightness(2); }
 }

 /* CSS Animated Elements for ALL Moods */
 body.mood-plasma::before,
 body.mood-starfield::before,
 body.mood-lava::before,
 body.mood-electric::before,
 body.mood-matrix::before,
 body.mood-rainbow::before,
 body.mood-vaporwave::before,
 body.mood-fire::before,
 body.mood-cyberpunk::before,
 body.mood-galaxy::before,
 body.mood-glitch::before,
 body.mood-lightning::before,
 body.mood-pulse::before,
 body.mood-prism::before,
 body.mood-hologram::before,
 body.mood-laser::before,
 body.mood-warp::before,
 body.mood-disco::before,
 body.mood-nuclear::before,
 body.mood-supernova::before {
 content: '';
 position: fixed !important;
 top: 0 !important;
 left: 0 !important;
 width: 100%;
 height: 100%;
 pointer-events: none;
 z-index: 1 !important;
 opacity: 1;
 contain: layout paint style;
 }

 /* Plasma - Floating Orbs */
 body.mood-plasma::before {
 background: 
 radial-gradient(circle at 20% 20%, rgba(255,0,110,0.6), transparent 25%),
 radial-gradient(circle at 80% 80%, rgba(131,56,236,0.6), transparent 25%),
 radial-gradient(circle at 50% 50%, rgba(58,134,255,0.5), transparent 35%),
 radial-gradient(circle at 70% 30%, rgba(255,0,110,0.4), transparent 20%),
 radial-gradient(circle at 30% 70%, rgba(131,56,236,0.4), transparent 20%);
 animation: orbsFloat 15s ease-in-out infinite;
 filter: blur(40px);
 }

 /* Starfield - Twinkling Stars */
 body.mood-starfield::before {
 background-image: 
 radial-gradient(circle, white 1px, transparent 1px),
 radial-gradient(circle, white 2px, transparent 2px),
 radial-gradient(circle, white 1px, transparent 1px),
 radial-gradient(circle, rgba(255,255,255,0.8) 1px, transparent 1px),
 radial-gradient(circle, white 2px, transparent 2px),
 radial-gradient(circle, rgba(255,255,255,0.6) 1px, transparent 1px),
 radial-gradient(circle, white 1px, transparent 1px),
 radial-gradient(circle, white 1px, transparent 1px),
 radial-gradient(circle, rgba(255,255,255,0.9) 2px, transparent 2px);
 background-size: 200px 200px, 300px 300px, 150px 150px, 250px 250px, 180px 180px, 220px 220px, 280px 280px, 160px 160px, 240px 240px;
 background-position: 0 0, 40px 60px, 130px 270px, 70px 100px, 200px 150px, 90px 220px, 150px 50px, 50px 180px, 180px 80px;
 animation: starsTwinkle 8s ease-in-out infinite;
 }

 /* Lava - Bubbling Effect */
 body.mood-lava::before {
 background: 
 radial-gradient(ellipse at 30% 90%, rgba(255,69,0,0.7), transparent 45%),
 radial-gradient(ellipse at 70% 85%, rgba(255,99,71,0.7), transparent 40%),
 radial-gradient(ellipse at 50% 95%, rgba(255,140,0,0.6), transparent 50%),
 radial-gradient(ellipse at 20% 80%, rgba(255,69,0,0.5), transparent 35%),
 radial-gradient(ellipse at 80% 92%, rgba(255,99,71,0.5), transparent 38%);
 animation: lavaBubble 12s ease-in-out infinite;
 filter: blur(50px);
 }

 /* Electric - Lightning Bolts */
 body.mood-electric::before {
 background: 
 radial-gradient(ellipse at 30% 20%, rgba(0,255,249,0.8), transparent 30%),
 radial-gradient(ellipse at 70% 80%, rgba(112,0,255,0.7), transparent 30%),
 radial-gradient(ellipse at 50% 50%, rgba(255,0,247,0.6), transparent 40%),
 linear-gradient(135deg, transparent 48%, rgba(0,255,249,0.4) 49%, rgba(0,255,249,0.4) 51%, transparent 52%),
 linear-gradient(45deg, transparent 48%, rgba(112,0,255,0.3) 49%, rgba(112,0,255,0.3) 51%, transparent 52%);
 background-size: 100% 100%, 100% 100%, 100% 100%, 100% 300%, 100% 300%;
 animation: lightningStrike 3s ease-in-out infinite;
 filter: blur(30px);
 }

 /* Matrix - Falling Code */
 body.mood-matrix::before {
 background: 
 repeating-linear-gradient(0deg, 
 transparent, 
 transparent 20px, 
 rgba(0,255,0,0.3) 20px, 
 rgba(0,255,0,0.3) 21px,
 transparent 21px,
 transparent 40px,
 rgba(0,255,0,0.5) 40px,
 rgba(0,255,0,0.5) 42px
 ),
 linear-gradient(180deg, transparent 0%, rgba(0,255,0,0.2) 50%, transparent 100%);
 background-size: 100% 100%, 100% 200%;
 animation: matrixRain 5s linear infinite;
 opacity: 0.8;
 }

 /* Rainbow - Shimmer Effect */
 body.mood-rainbow::before {
 background: 
 repeating-linear-gradient(45deg,
 rgba(255,0,0,0.3) 0px,
 rgba(255,119,0,0.3) 50px,
 rgba(255,221,0,0.3) 100px,
 rgba(0,255,0,0.3) 150px,
 rgba(0,136,255,0.3) 200px,
 rgba(0,0,255,0.3) 250px,
 rgba(136,0,255,0.3) 300px,
 rgba(255,0,0,0.3) 350px
 );
 background-size: 400% 400%;
 animation: rainbowShimmer 10s linear infinite;
 opacity: 0.9;
 }

 /* Vaporwave - Grid Lines */
 body.mood-vaporwave::before {
 background-image: 
 repeating-linear-gradient(0deg, 
 rgba(255,110,199,0.4) 0px, 
 rgba(255,110,199,0.4) 2px, 
 transparent 2px, 
 transparent 40px
 ),
 repeating-linear-gradient(90deg, 
 rgba(127,0,255,0.4) 0px, 
 rgba(127,0,255,0.4) 2px, 
 transparent 2px, 
 transparent 40px
 ),
 linear-gradient(180deg, transparent 60%, rgba(255,110,199,0.2) 100%);
 background-size: 100% 100%;
 animation: vaporwaveGrid 20s linear infinite;
 opacity: 0.9;
 }

 /* Fire - Flames Rising */
 body.mood-fire::before {
 background: 
 radial-gradient(ellipse at 50% 120%, rgba(255,69,0,0.8), transparent 60%),
 radial-gradient(ellipse at 30% 110%, rgba(255,99,71,0.7), transparent 50%),
 radial-gradient(ellipse at 70% 110%, rgba(255,140,0,0.7), transparent 50%),
 radial-gradient(ellipse at 40% 105%, rgba(255,69,0,0.6), transparent 45%),
 radial-gradient(ellipse at 60% 115%, rgba(255,140,0,0.6), transparent 48%);
 animation: flamesRise 8s ease-in-out infinite;
 filter: blur(60px);
 }

 /* Cyberpunk - Glitch Bars */
 body.mood-cyberpunk::before {
 background: 
 repeating-linear-gradient(90deg, 
 transparent 0%, 
 rgba(255,0,222,0.4) 10%, 
 transparent 20%,
 rgba(0,255,255,0.4) 30%,
 transparent 40%
 ),
 linear-gradient(180deg, 
 rgba(255,0,222,0.2) 0%, 
 transparent 50%, 
 rgba(0,255,255,0.2) 100%
 );
 background-size: 200% 100%, 100% 100%;
 animation: cyberpunkGlitchBars 5s ease-in-out infinite;
 opacity: 0.9;
 }

 /* Galaxy - Spinning Nebula */
 body.mood-galaxy::before {
 background: 
 radial-gradient(ellipse at 50% 50%, rgba(102,126,234,0.6), transparent 60%),
 radial-gradient(circle at 30% 70%, rgba(118,75,162,0.5), transparent 45%),
 radial-gradient(circle at 70% 30%, rgba(240,147,251,0.5), transparent 45%),
 radial-gradient(ellipse at 40% 60%, rgba(102,126,234,0.4), transparent 50%),
 radial-gradient(ellipse at 60% 40%, rgba(118,75,162,0.4), transparent 50%);
 animation: nebulaRotate 30s linear infinite;
 filter: blur(50px);
 }

 /* Glitch - RGB Split Effect */
 body.mood-glitch::before {
 background: 
 repeating-linear-gradient(0deg,
 rgba(255,0,0,0.3) 0px,
 rgba(255,0,0,0.3) 2px,
 transparent 2px,
 transparent 6px
 ),
 repeating-linear-gradient(90deg,
 rgba(0,255,0,0.3) 0px,
 rgba(0,255,0,0.3) 2px,
 transparent 2px,
 transparent 6px
 ),
 repeating-linear-gradient(45deg,
 rgba(0,0,255,0.3) 0px,
 rgba(0,0,255,0.3) 2px,
 transparent 2px,
 transparent 6px
 );
 animation: glitchSplit 4s ease-in-out infinite;
 opacity: 0.9;
 }

 /* Lightning - Storm Bolts */
 body.mood-lightning::before {
 background: 
 radial-gradient(ellipse at 20% 30%, rgba(255,255,255,1), transparent 10%),
 radial-gradient(ellipse at 50% 60%, rgba(255,255,255,0.9), transparent 15%),
 radial-gradient(ellipse at 80% 40%, rgba(255,255,255,1), transparent 12%),
 linear-gradient(135deg, transparent 45%, rgba(255,255,255,0.9) 48%, rgba(255,255,255,0.9) 52%, transparent 55%);
 animation: lightningBolt 6s ease-in-out infinite;
 filter: blur(15px);
 }

 /* Pulse - Heartbeat Rings */
 body.mood-pulse::before {
 background: 
 radial-gradient(circle at 50% 50%, rgba(255,0,110,0.8), transparent 40%),
 radial-gradient(circle at 50% 50%, rgba(58,134,255,0.6), transparent 60%),
 radial-gradient(circle at 50% 50%, rgba(255,0,110,0.4), transparent 80%);
 animation: pulseRings 3s ease-in-out infinite;
 filter: blur(40px);
 }

 /* Prism - Refracted Light */
 body.mood-prism::before {
 background: 
 repeating-conic-gradient(from 0deg at 50% 50%,
 rgba(255,0,0,0.4) 0deg 30deg,
 rgba(255,165,0,0.4) 30deg 60deg,
 rgba(255,255,0,0.4) 60deg 90deg,
 rgba(0,255,0,0.4) 90deg 120deg,
 rgba(0,0,255,0.4) 120deg 150deg,
 rgba(75,0,130,0.4) 150deg 180deg,
 rgba(238,130,238,0.4) 180deg 210deg,
 rgba(255,0,0,0.4) 210deg 240deg
 );
 animation: prismRefract 15s linear infinite;
 opacity: 0.9;
 }

 /* Hologram - Scan Lines */
 body.mood-hologram::before {
 background: 
 repeating-linear-gradient(0deg,
 rgba(0,255,255,0.1) 0px,
 rgba(0,255,255,0.3) 1px,
 transparent 1px,
 transparent 4px
 ),
 radial-gradient(ellipse at 50% 50%, rgba(255,0,255,0.4), transparent 60%),
 radial-gradient(ellipse at 30% 30%, rgba(0,255,255,0.4), transparent 50%);
 animation: hologramScan 8s ease-in-out infinite;
 }

 /* Laser - Sweeping Beams */
 body.mood-laser::before {
 background: 
 linear-gradient(90deg, transparent 0%, rgba(255,0,102,0.8) 50%, transparent 100%),
 linear-gradient(45deg, transparent 0%, rgba(255,0,102,0.6) 50%, transparent 100%),
 radial-gradient(circle at 50% 50%, rgba(255,0,102,0.5), transparent 60%);
 animation: laserSweep 5s ease-in-out infinite;
 filter: blur(25px);
 }

 /* Warp - Speed Streaks */
 body.mood-warp::before {
 background: 
 repeating-linear-gradient(45deg,
 transparent 0px,
 rgba(142,45,226,0.5) 50px,
 transparent 100px
 ),
 repeating-linear-gradient(-45deg,
 transparent 0px,
 rgba(74,0,224,0.5) 50px,
 transparent 100px
 );
 animation: warpStreaks 10s linear infinite;
 filter: blur(30px);
 }

 /* Disco - Rotating Spotlights */
 body.mood-disco::before {
 background: 
 radial-gradient(circle at 30% 30%, rgba(255,0,255,0.7), transparent 30%),
 radial-gradient(circle at 70% 70%, rgba(0,255,255,0.7), transparent 30%),
 radial-gradient(circle at 50% 80%, rgba(255,255,0,0.6), transparent 35%),
 radial-gradient(circle at 20% 60%, rgba(255,0,255,0.5), transparent 25%),
 radial-gradient(circle at 80% 40%, rgba(0,255,255,0.5), transparent 25%);
 animation: discoSpotlight 6s linear infinite;
 filter: blur(50px);
 }

 /* Nuclear - Radioactive Glow */
 body.mood-nuclear::before {
 background: 
 radial-gradient(circle at 50% 50%, rgba(0,255,0,0.8), transparent 50%),
 radial-gradient(circle at 50% 50%, rgba(0,255,0,0.5), transparent 70%),
 radial-gradient(circle at 50% 50%, rgba(0,255,0,0.3), transparent 90%);
 animation: radioactiveGlow 8s ease-in-out infinite;
 filter: blur(60px);
 }

 /* Supernova - Explosive Expansion */
 body.mood-supernova::before {
 background: 
 radial-gradient(circle at 50% 50%, rgba(255,255,255,1), rgba(255,69,0,0.8) 20%, rgba(139,0,0,0.5) 50%, transparent 70%),
 radial-gradient(circle at 50% 50%, rgba(255,255,255,0.8), transparent 40%),
 radial-gradient(circle at 50% 50%, rgba(255,165,0,0.6), transparent 60%);
 animation: explosionExpand 12s ease-in-out infinite;
 filter: blur(40px);
 }

 /* New Mood Animations */
 @keyframes plasmaFlow {
 0% { background-position: 0% 50%; filter: hue-rotate(0deg); }
 25% { background-position: 100% 100%; filter: hue-rotate(30deg); }
 50% { background-position: 50% 0%; filter: hue-rotate(60deg); }
 75% { background-position: 100% 50%; filter: hue-rotate(30deg); }
 100% { background-position: 0% 50%; filter: hue-rotate(0deg); }
 }

 @keyframes starfieldPulse {
 0%, 100% { filter: brightness(0.8); }
 50% { filter: brightness(1.2); }
 }

 @keyframes lavaFlow {
 0% { background-position: 0% 0%; }
 50% { background-position: 100% 100%; }
 100% { background-position: 0% 0%; }
 }

 @keyframes electricPulse {
 0% { background-position: 0% 50%; filter: brightness(1) contrast(1); }
 25% { background-position: 100% 50%; filter: brightness(1.3) contrast(1.2); }
 50% { background-position: 100% 100%; filter: brightness(1.5) contrast(1.5); }
 75% { background-position: 0% 100%; filter: brightness(1.3) contrast(1.2); }
 100% { background-position: 0% 50%; filter: brightness(1) contrast(1); }
 }

 @keyframes matrixFlicker {
 0%, 100% { filter: brightness(0.8) contrast(1); }
 50% { filter: brightness(1.2) contrast(1.3); }
 }

 @keyframes rainbowShift {
 0% { background-position: 0% 50%; }
 100% { background-position: 100% 50%; }
 }

 @keyframes vaporwaveDrift {
 0% { background-position: 0% 0%; filter: saturate(1.2); }
 50% { background-position: 0% 100%; filter: saturate(1.5); }
 100% { background-position: 0% 0%; filter: saturate(1.2); }
 }

 @keyframes fireFlicker {
 0%, 100% { filter: brightness(1) saturate(1.2); }
 25% { filter: brightness(1.2) saturate(1.4); }
 50% { filter: brightness(0.9) saturate(1); }
 75% { filter: brightness(1.3) saturate(1.5); }
 }

 @keyframes cyberpunkGlitch {
 0% { background-position: 0% 50%; filter: hue-rotate(0deg) saturate(1.5); }
 25% { background-position: 100% 50%; filter: hue-rotate(-20deg) saturate(2); }
 50% { background-position: 100% 100%; filter: hue-rotate(20deg) saturate(1.8); }
 75% { background-position: 0% 100%; filter: hue-rotate(-20deg) saturate(2); }
 100% { background-position: 0% 50%; filter: hue-rotate(0deg) saturate(1.5); }
 }

 @keyframes galaxySpin {
 0% { background-position: 0% 50%; }
 100% { background-position: 100% 50%; }
 }

 /* Element Animations */
 @keyframes orbsFloat {
 0%, 100% { transform: translate(0, 0) scale(1) translateZ(0); opacity: 0.9; }
 25% { transform: translate(80px, -80px) scale(1.2) translateZ(0); opacity: 1; }
 50% { transform: translate(-50px, 50px) scale(1.1) translateZ(0); opacity: 0.95; }
 75% { transform: translate(-80px, -60px) scale(1.15) translateZ(0); opacity: 1; }
 }

 @keyframes starsTwinkle {
 0%, 100% { opacity: 0.6; transform: scale(1) translateZ(0); }
 25% { opacity: 1; transform: scale(1.2) translateZ(0); }
 50% { opacity: 0.4; transform: scale(0.9) translateZ(0); }
 75% { opacity: 1; transform: scale(1.1) translateZ(0); }
 }

 @keyframes lavaBubble {
 0%, 100% { transform: translateY(0) scale(1) translateZ(0); opacity: 0.9; }
 25% { transform: translateY(-40px) scale(1.15) translateZ(0); opacity: 1; }
 50% { transform: translateY(-20px) scale(1.2) translateZ(0); opacity: 0.95; }
 75% { transform: translateY(-50px) scale(1.1) translateZ(0); opacity: 1; }
 }

 @keyframes lightningStrike {
 0%, 85%, 100% { opacity: 0; }
 86%, 88% { opacity: 1; filter: brightness(2); }
 87% { opacity: 0.3; }
 89%, 92% { opacity: 0.9; filter: brightness(1.5); }
 90% { opacity: 0.5; }
 }

 @keyframes matrixRain {
 0% { transform: translateY(0) translateZ(0); opacity: 0.8; }
 100% { transform: translateY(100px) translateZ(0); opacity: 1; }
 }

 @keyframes rainbowShimmer {
 0% { transform: translateX(0) rotate(0deg) translateZ(0); }
 100% { transform: translateX(100%) rotate(5deg) translateZ(0); }
 }

 @keyframes vaporwaveGrid {
 0% { transform: perspective(800px) rotateX(60deg) translateY(0) translateZ(0); opacity: 0.9; }
 100% { transform: perspective(800px) rotateX(60deg) translateY(40px) translateZ(-100px); opacity: 1; }
 }

 @keyframes flamesRise {
 0%, 100% { transform: translateY(0) scale(1) scaleY(1) translateZ(0); opacity: 0.9; }
 25% { transform: translateY(-60px) scale(1.1) scaleY(1.3) translateZ(0); opacity: 1; }
 50% { transform: translateY(-40px) scale(1.15) scaleY(1.2) translateZ(0); opacity: 0.95; }
 75% { transform: translateY(-70px) scale(1.08) scaleY(1.4) translateZ(0); opacity: 1; }
 }

 @keyframes cyberpunkGlitchBars {
 0%, 100% { transform: translateX(0) skew(0deg) translateZ(0); opacity: 0.8; }
 20% { transform: translateX(50%) skew(5deg) translateZ(0); opacity: 1; }
 40% { transform: translateX(-30%) skew(-3deg) translateZ(0); opacity: 0.9; }
 60% { transform: translateX(70%) skew(4deg) translateZ(0); opacity: 1; }
 80% { transform: translateX(-50%) skew(-5deg) translateZ(0); opacity: 0.95; }
 }

 @keyframes nebulaRotate {
 0% { transform: rotate(0deg) scale(1) translateZ(0); opacity: 0.9; }
 25% { transform: rotate(90deg) scale(1.1) translateZ(0); opacity: 1; }
 50% { transform: rotate(180deg) scale(1.05) translateZ(0); opacity: 0.95; }
 75% { transform: rotate(270deg) scale(1.1) translateZ(0); opacity: 1; }
 100% { transform: rotate(360deg) scale(1) translateZ(0); opacity: 0.9; }
 }

 /* New Mood Element Animations */
 @keyframes glitchSplit {
 0%, 100% { transform: translate(0, 0) translateZ(0); opacity: 0.8; }
 10% { transform: translate(10px, -5px) translateZ(0); opacity: 1; }
 20% { transform: translate(-8px, 8px) translateZ(0); opacity: 0.9; }
 30% { transform: translate(5px, -10px) translateZ(0); opacity: 1; }
 40% { transform: translate(-10px, 5px) translateZ(0); opacity: 0.85; }
 50% { transform: translate(0, 0) translateZ(0); opacity: 0.9; }
 }

 @keyframes lightningBolt {
 0%, 85%, 100% { opacity: 0; }
 86%, 88%, 91%, 93% { opacity: 1; filter: brightness(3); }
 87%, 89%, 92% { opacity: 0.3; }
 }

 @keyframes pulseRings {
 0%, 100% { transform: scale(0.8) translateZ(0); opacity: 1; }
 50% { transform: scale(1.3) translateZ(0); opacity: 0.6; }
 }

 @keyframes prismRefract {
 0% { transform: rotate(0deg); }
 100% { transform: rotate(360deg); }
 }

 @keyframes hologramScan {
 0%, 100% { transform: translateY(0) scaleY(1) translateZ(0); opacity: 0.9; }
 50% { transform: translateY(-20px) scaleY(1.1) translateZ(0); opacity: 1; }
 }

 @keyframes laserSweep {
 0%, 100% { transform: translateX(-100%) rotate(0deg) translateZ(0); opacity: 0.8; }
 50% { transform: translateX(100%) rotate(15deg) translateZ(0); opacity: 1; }
 }

 @keyframes warpStreaks {
 0% { transform: translate(0, 0) scale(1) translateZ(0); }
 100% { transform: translate(-100px, -100px) scale(1.2) translateZ(0); }
 }

 @keyframes discoSpotlight {
 0% { transform: rotate(0deg); }
 100% { transform: rotate(360deg); }
 }

 @keyframes radioactiveGlow {
 0%, 100% { transform: scale(1) translateZ(0); opacity: 0.8; filter: blur(60px); }
 25% { transform: scale(1.2) translateZ(0); opacity: 1; filter: blur(70px); }
 50% { transform: scale(1.4) translateZ(0); opacity: 0.9; filter: blur(80px); }
 75% { transform: scale(1.2) translateZ(0); opacity: 1; filter: blur(70px); }
 }

 @keyframes explosionExpand {
 0%, 100% { transform: scale(0.5) translateZ(0); opacity: 1; }
 25% { transform: scale(1.5) translateZ(0); opacity: 0.9; }
 50% { transform: scale(2) translateZ(0); opacity: 0.7; }
 75% { transform: scale(1.5) translateZ(0); opacity: 0.9; }
 }

 /* Dramatic Mood Animations */
 @keyframes gradientShift {
 0% { background-position: 0% 50%; transform: scale(1) translateZ(0); }
 25% { background-position: 100% 50%; transform: scale(1.05) translateZ(0); }
 50% { background-position: 100% 100%; transform: scale(1) translateZ(0); }
 75% { background-position: 0% 100%; transform: scale(1.05) translateZ(0); }
 100% { background-position: 0% 50%; transform: scale(1) translateZ(0); }
 }

 @keyframes sunsetPulse {
 0% { background-position: 0% 50%; filter: brightness(1) saturate(1); }
 25% { background-position: 50% 100%; filter: brightness(1.15) saturate(1.3); }
 50% { background-position: 100% 50%; filter: brightness(1.3) saturate(1.5); }
 75% { background-position: 50% 0%; filter: brightness(1.15) saturate(1.3); }
 100% { background-position: 0% 50%; filter: brightness(1) saturate(1); }
 }

 @keyframes oceanWave {
 0% { background-position: 0% 0%; filter: hue-rotate(0deg) brightness(1); }
 25% { background-position: 100% 50%; filter: hue-rotate(20deg) brightness(1.1); }
 50% { background-position: 50% 100%; filter: hue-rotate(0deg) brightness(1.2); }
 75% { background-position: 0% 50%; filter: hue-rotate(-20deg) brightness(1.1); }
 100% { background-position: 0% 0%; filter: hue-rotate(0deg) brightness(1); }
 }

 @keyframes forestBreeze {
 0% { background-position: 0% 50%; filter: hue-rotate(0deg) saturate(1); }
 33% { background-position: 100% 100%; filter: hue-rotate(15deg) saturate(1.2); }
 66% { background-position: 50% 0%; filter: hue-rotate(-15deg) saturate(1.2); }
 100% { background-position: 0% 50%; filter: hue-rotate(0deg) saturate(1); }
 }

 @keyframes midnightPulse {
 0% { background-position: 50% 50%; filter: brightness(0.8) contrast(1); }
 25% { background-position: 100% 0%; filter: brightness(1) contrast(1.1); }
 50% { background-position: 50% 100%; filter: brightness(1.2) contrast(1.2); }
 75% { background-position: 0% 50%; filter: brightness(1) contrast(1.1); }
 100% { background-position: 50% 50%; filter: brightness(0.8) contrast(1); }
 }

 @keyframes auroraFlow {
 0% { background-position: 0% 0%; transform: rotate(0deg) scale(1) translateZ(0); }
 25% { background-position: 100% 50%; transform: rotate(1deg) scale(1.03); }
 50% { background-position: 100% 100%; transform: rotate(0deg) scale(1.05); }
 75% { background-position: 50% 50%; transform: rotate(-1deg) scale(1.03); }
 100% { background-position: 0% 0%; transform: rotate(0deg) scale(1) translateZ(0); }
 }

 @keyframes candyPop {
 0% { background-position: 0% 0%; filter: saturate(1) brightness(1); transform: scale(1); }
 25% { background-position: 100% 100%; filter: saturate(1.5) brightness(1.1); transform: scale(1.05); }
 50% { background-position: 100% 0%; filter: saturate(2) brightness(1.2); transform: scale(1.08); }
 75% { background-position: 0% 100%; filter: saturate(1.5) brightness(1.1); transform: scale(1.05); }
 100% { background-position: 0% 0%; filter: saturate(1) brightness(1); transform: scale(1); }
 }

 @keyframes neonPulse {
 0% { background-position: 0% 50%; filter: brightness(1) saturate(1.5) contrast(1); }
 25% { background-position: 100% 100%; filter: brightness(1.3) saturate(2) contrast(1.2); }
 50% { background-position: 100% 0%; filter: brightness(1.5) saturate(2.5) contrast(1.3); }
 75% { background-position: 0% 100%; filter: brightness(1.3) saturate(2) contrast(1.2); }
 100% { background-position: 0% 50%; filter: brightness(1) saturate(1.5) contrast(1); }
 }

 @keyframes tropicalVibe {
 0% { background-position: 0% 50%; filter: hue-rotate(0deg) saturate(1.2); }
 33% { background-position: 100% 100%; filter: hue-rotate(-15deg) saturate(1.4); }
 66% { background-position: 50% 0%; filter: hue-rotate(15deg) saturate(1.5); }
 100% { background-position: 0% 50%; filter: hue-rotate(0deg) saturate(1.2); }
 }

 @keyframes cosmicShift {
 0% { background-position: 0% 50%; filter: hue-rotate(0deg) brightness(1); transform: scale(1); }
 25% { background-position: 100% 0%; filter: hue-rotate(30deg) brightness(1.1); transform: scale(1.05); }
 50% { background-position: 100% 100%; filter: hue-rotate(60deg) brightness(1.15); transform: scale(1.08); }
 75% { background-position: 0% 100%; filter: hue-rotate(30deg) brightness(1.1); transform: scale(1.05); }
 100% { background-position: 0% 50%; filter: hue-rotate(0deg) brightness(1); transform: scale(1); }
 }

 /* Animated Background Elements */
 .bg-animation {
 position: fixed;
 top: 0;
 left: 0;
 width: 100%;
 height: 100%;
 pointer-events: none;
 z-index: 0;
 overflow: hidden;
 }

 .wave {
 position: absolute;
 bottom: 0;
 left: 0;
 width: 200%;
 height: 150px;
 background: rgba(255, 255, 255, 0.05);
 animation: wave 15s linear infinite;
 }

 .wave:nth-child(2) {
 animation: wave 20s linear infinite;
 opacity: 0.5;
 }

 .wave:nth-child(3) {
 animation: wave 25s linear infinite;
 opacity: 0.3;
 }

 @keyframes wave {
 0% { transform: translateX(0) translateZ(0) scaleY(1); }
 50% { transform: translateX(-25%) translateZ(0) scaleY(0.8); }
 100% { transform: translateX(-50%) translateZ(0) scaleY(1); }
 }

 .particles {
 position: absolute;
 width: 100%;
 height: 100%;
 }

 .particle {
 position: absolute;
 width: 4px;
 height: 4px;
 background: rgba(255, 255, 255, 0.6);
 border-radius: 50%;
 animation: float 10s infinite ease-in-out;
 }

 @keyframes float {
 0%, 100% {
 transform: translateY(0) translateX(0) translateZ(0);
 opacity: 0;
 }
 10% {
 opacity: 1;
 }
 90% {
 opacity: 1;
 }
 100% {
 transform: translateY(-100vh) translateX(50px) translateZ(0);
 opacity: 0;
 }
 }

 /* Settings Button */
 .settings-btn {
 position: fixed !important;
 top: 20px !important;
 right: 20px !important;
 width: 50px;
 height: 50px;
 background: rgba(255, 255, 255, 0.95);
 border: none;
 border-radius: 50%;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
 transition: all 0.3s ease;
 z-index: 10002 !important;
 transform: translateZ(0);
 isolation: isolate;
 }

 .settings-btn:hover {
 transform: rotate(90deg) scale(1.1) translateZ(0);
 box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
 }

 .settings-btn svg {
 width: 28px;
 height: 28px;
 fill: #667eea;
 }

 /* Settings Modal */
 .settings-modal-overlay {
 position: fixed;
 top: 0;
 left: 0;
 right: 0;
 bottom: 0;
 background: rgba(0, 0, 0, 0.7);
 display: none;
 align-items: center;
 justify-content: center;
 z-index: 10000;
 backdrop-filter: blur(5px);
 }

 .settings-modal-overlay.active {
 display: flex;
 align-items: center;
 justify-content: center;
 }

 .settings-modal {
 background: #2a2a2a;
 border-radius: 20px;
 width: 90%;
 max-width: 500px;
 max-height: 80vh;
 overflow-y: auto;
 animation: modalFadeIn 0.3s ease;
 position: absolute;
 top: 50%;
 left: 50%;
 transform: translate(-50%, -50%);
 z-index: 10001;
 }

 @keyframes modalFadeIn {
 from {
 opacity: 0;
 transform: translate(-50%, -50%) scale(0.95) translateZ(0);
 }
 to {
 opacity: 1;
 transform: translate(-50%, -50%) scale(1) translateZ(0);
 }
 }

 .settings-header {
 padding: 20px;
 border-bottom: 1px solid #3a3a3a;
 display: flex;
 justify-content: space-between;
 align-items: center;
 }

 .settings-title {
 font-size: 20px;
 font-weight: 700;
 color: #fff;
 display: flex;
 align-items: center;
 gap: 10px;
 }

 .settings-close {
 background: none;
 border: none;
 color: #667eea;
 font-size: 15px;
 font-weight: 600;
 cursor: pointer;
 padding: 5px 10px;
 }

 .settings-body {
 padding: 20px;
 }

 .setting-group {
 margin-bottom: 25px;
 }

 .setting-label {
 font-size: 15px;
 font-weight: 600;
 color: #fff;
 margin-bottom: 10px;
 display: flex;
 align-items: center;
 gap: 8px;
 }

 .setting-description {
 font-size: 12px;
 color: #aaa;
 margin-bottom: 10px;
 line-height: 1.5;
 }

 .toggle-switch {
 position: relative;
 display: inline-block;
 width: 50px;
 height: 26px;
 }

 .toggle-switch input {
 opacity: 0;
 width: 0;
 height: 0;
 }

 .toggle-slider {
 position: absolute;
 cursor: pointer;
 top: 0;
 left: 0;
 right: 0;
 bottom: 0;
 background-color: #3a3a3a;
 transition: 0.3s;
 border-radius: 26px;
 }

 .toggle-slider:before {
 position: absolute;
 content: "";
 height: 20px;
 width: 20px;
 left: 3px;
 bottom: 3px;
 background-color: white;
 transition: 0.3s;
 border-radius: 50%;
 }

 input:checked + .toggle-slider {
 background: linear-gradient(135deg, #667eea, #764ba2);
 }

 input:checked + .toggle-slider:before {
 transform: translateX(24px);
 }

 .setting-row {
 display: flex;
 justify-content: space-between;
 align-items: center;
 padding: 12px;
 background: #353535;
 border-radius: 10px;
 margin-bottom: 10px;
 }

 .setting-info {
 flex: 1;
 }

 .setting-name {
 font-size: 14px;
 font-weight: 600;
 color: #fff;
 margin-bottom: 4px;
 }

 .setting-desc {
 font-size: 11px;
 color: #aaa;
 }

 /* Floating Mini Player - Enhanced */
 .floating-player {
 position: fixed;
 bottom: 20px;
 right: 20px;
 width: 320px;
 background: rgba(26, 26, 26, 0.98);
 backdrop-filter: blur(20px);
 border-radius: 16px;
 padding: 15px;
 box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
 z-index: 100;
 display: none;
 cursor: move;
 border: 2px solid rgba(102, 126, 234, 0.3);
 }

 .floating-player.active {
 display: block;
 animation: slideInUp 0.3s ease;
 }

 .floating-player.pip-mode {
 width: 280px;
 bottom: 80px;
 right: 20px;
 border: 3px solid #667eea;
 box-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
 }

 @keyframes slideInUp {
 from {
 transform: translateY(100px) translateZ(0);
 opacity: 0;
 }
 to {
 transform: translateY(0) translateZ(0);
 opacity: 1;
 }
 }

 .floating-player-header {
 display: flex;
 justify-content: space-between;
 align-items: center;
 margin-bottom: 12px;
 cursor: move;
 }

 .floating-player-title {
 font-size: 13px;
 font-weight: 700;
 color: #fff;
 display: flex;
 align-items: center;
 gap: 6px;
 }

 .floating-player-actions {
 display: flex;
 gap: 6px;
 }

 .floating-action-btn {
 background: rgba(255, 255, 255, 0.1);
 border: none;
 color: #fff;
 width: 24px;
 height: 24px;
 border-radius: 50%;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 font-size: 14px;
 transition: all 0.2s;
 }

 .floating-action-btn:hover {
 background: rgba(255, 255, 255, 0.2);
 transform: scale(1.1);
 }

 .floating-player-video {
 width: 100%;
 height: 180px;
 border-radius: 12px;
 overflow: hidden;
 margin-bottom: 12px;
 background: #000;
 }

 .floating-player-info {
 margin-bottom: 10px;
 }

 .floating-player-song {
 font-size: 14px;
 font-weight: 600;
 color: #fff;
 margin-bottom: 4px;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .floating-player-artist {
 font-size: 12px;
 color: #aaa;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .floating-player-controls {
 display: flex;
 justify-content: center;
 align-items: center;
 gap: 12px;
 }

 .floating-control-btn {
 background: rgba(255, 255, 255, 0.1);
 border: none;
 color: #fff;
 width: 40px;
 height: 40px;
 border-radius: 50%;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 transition: all 0.2s;
 }

 .floating-control-btn:hover {
 background: rgba(255, 255, 255, 0.2);
 transform: scale(1.05) translateZ(0);
 }

 .floating-control-btn.large {
 width: 50px;
 height: 50px;
 background: linear-gradient(135deg, #667eea, #764ba2);
 }

 .floating-control-btn svg {
 width: 20px;
 height: 20px;
 fill: currentColor;
 }

 /* Music Visualizer for Sticky Controls */
 .music-visualizer {
 display: flex;
 align-items: flex-end;
 justify-content: center;
 gap: 3px;
 height: 40px;
 max-height: 40px;
 margin: 0 15px;
 flex-shrink: 0;
 overflow: hidden;
 }

 .visualizer-bar {
 width: 4px;
 background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
 border-radius: 2px;
 animation: visualize 0.5s ease-in-out infinite;
 }

 .visualizer-bar:nth-child(1) { animation-delay: 0s; }
 .visualizer-bar:nth-child(2) { animation-delay: 0.05s; }
 .visualizer-bar:nth-child(3) { animation-delay: 0.1s; }
 .visualizer-bar:nth-child(4) { animation-delay: 0.15s; }
 .visualizer-bar:nth-child(5) { animation-delay: 0.2s; }
 .visualizer-bar:nth-child(6) { animation-delay: 0.25s; }
 .visualizer-bar:nth-child(7) { animation-delay: 0.2s; }
 .visualizer-bar:nth-child(8) { animation-delay: 0.15s; }
 .visualizer-bar:nth-child(9) { animation-delay: 0.1s; }
 .visualizer-bar:nth-child(10) { animation-delay: 0.05s; }
 .visualizer-bar:nth-child(11) { animation-delay: 0s; }
 .visualizer-bar:nth-child(12) { animation-delay: 0.05s; }
 .visualizer-bar:nth-child(13) { animation-delay: 0.1s; }
 .visualizer-bar:nth-child(14) { animation-delay: 0.15s; }
 .visualizer-bar:nth-child(15) { animation-delay: 0.2s; }
 .visualizer-bar:nth-child(16) { animation-delay: 0.25s; }
 .visualizer-bar:nth-child(17) { animation-delay: 0.2s; }
 .visualizer-bar:nth-child(18) { animation-delay: 0.15s; }
 .visualizer-bar:nth-child(19) { animation-delay: 0.1s; }
 .visualizer-bar:nth-child(20) { animation-delay: 0.05s; }

 @keyframes visualize {
 0%, 100% { height: 8px; opacity: 0.5; }
 50% { height: 32px; opacity: 1; }
 }

 .music-visualizer.playing .visualizer-bar {
 animation-play-state: running;
 }

 .music-visualizer.paused .visualizer-bar {
 animation-play-state: paused;
 height: 8px;
 opacity: 0.3;
 }

 /* Sticky Control Bar */
 .sticky-controls {
 position: fixed !important;
 bottom: 0 !important;
 left: 0 !important;
 right: 0 !important;
 background: rgba(26, 26, 26, 0.98);
 backdrop-filter: blur(20px);
 padding: 12px 20px;
 display: flex;
 align-items: center;
 justify-content: space-between;
 z-index: 10500 !important;
 border-top: 2px solid rgba(102, 126, 234, 0.3);
 box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.3);
 animation: slideInUp 0.3s ease;
 contain: layout style;
 min-height: 74px;
 max-height: 74px;
 }

 .sticky-controls.hidden {
 display: none !important;
 }

 .sticky-info {
 display: flex;
 align-items: center;
 gap: 12px;
 flex: 1;
 min-width: 0;
 }

 .sticky-thumb {
 width: 50px;
 height: 50px;
 border-radius: 8px;
 overflow: hidden;
 flex-shrink: 0;
 background: linear-gradient(135deg, #667eea, #764ba2);
 }

 .sticky-thumb img {
 width: 100%;
 height: 100%;
 object-fit: cover;
 }

 .sticky-text {
 flex: 1;
 min-width: 0;
 }

 .sticky-song {
 font-size: 14px;
 font-weight: 600;
 color: #fff;
 margin-bottom: 2px;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .sticky-artist {
 font-size: 12px;
 color: #aaa;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .sticky-controls-buttons {
 display: flex;
 gap: 10px;
 align-items: center;
 }

 .sticky-btn {
 background: rgba(255, 255, 255, 0.1);
 border: none;
 color: #fff;
 width: 36px;
 height: 36px;
 border-radius: 50%;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 transition: all 0.2s;
 }

 .sticky-btn:hover {
 background: rgba(255, 255, 255, 0.2);
 }

 .sticky-btn.large {
 width: 45px;
 height: 45px;
 background: linear-gradient(135deg, #667eea, #764ba2);
 }

 .sticky-btn svg {
 width: 18px;
 height: 18px;
 fill: currentColor;
 }

 .player-wrapper {
 display: flex;
 justify-content: center;
 align-items: center;
 min-height: 100vh;
 padding: 15px;
 padding-bottom: 100px;
 position: relative;
 z-index: 2;
 }

 .music-player {
 background: #ffffffad;
 border-radius: 24px;
 box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
 width: 100%;
 max-width: 900px;
 padding: 25px;
 position: relative;
 backdrop-filter: blur(10px);
 }

 /* Top Bar with Volume */
 .top-bar {
 display: flex;
 justify-content: space-between;
 align-items: center;
 margin-bottom: 15px;
 padding-bottom: 12px;
 border-bottom: 1px solid #e0e0e0;
 gap: 10px;
 }

 .app-title {
 font-size: 18px;
 font-weight: 700;
 color: #1a1a1a;
 display: flex;
 align-items: center;
 gap: 8px;
 flex-shrink: 1;
 min-width: 0;
 }

 .app-title span:first-child {
 flex-shrink: 0;
 }

 .app-title span:last-child {
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .volume-control-top {
 display: flex;
 align-items: center;
 gap: 8px;
 min-width: 120px;
 flex-shrink: 0;
 }

 .volume-slider-top {
 flex: 1;
 height: 4px;
 background: #e0e0e0;
 border-radius: 10px;
 position: relative;
 cursor: pointer;
 }

 .volume-fill-top {
 height: 100%;
 background: linear-gradient(90deg, #667eea, #764ba2);
 border-radius: 10px;
 width: 70%;
 transition: width 0.1s;
 }

 /* Mood Selector */
 .mood-section {
 margin-bottom: 15px;
 padding: 15px;
 background: #f8f8f8;
 border-radius: 12px;
 }

 .mood-header {
 display: flex;
 align-items: center;
 justify-content: center;
 margin-bottom: 12px;
 }

 .mood-title {
 font-size: 20px;
 font-weight: 800;
 background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
 -webkit-background-clip: text;
 -webkit-text-fill-color: transparent;
 background-clip: text;
 animation: moodTitleShine 3s ease infinite;
 background-size: 200% auto;
 text-transform: uppercase;
 letter-spacing: 1px;
 }

 @keyframes moodTitleShine {
 0%, 100% { background-position: 0% center; }
 50% { background-position: 100% center; }
 }

 .mood-selector {
 display: flex;
 align-items: center;
 gap: 8px;
 overflow-x: auto;
 scrollbar-width: none;
 padding: 5px 0;
 }

 .mood-selector::-webkit-scrollbar {
 display: none;
 }

 .mood-option {
 width: 35px;
 height: 35px;
 border-radius: 50%;
 cursor: pointer;
 border: 3px solid transparent;
 transition: all 0.3s ease;
 flex-shrink: 0;
 position: relative;
 }

 .mood-option:hover {
 transform: scale(1.1);
 }

 .mood-option.active {
 border-color: #667eea;
 box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
 transform: scale(1.15);
 }

 .mood-option.active::after {
 content: '\2713';
 position: absolute;
 top: 50%;
 left: 50%;
 transform: translate(-50%, -50%);
 color: white;
 font-size: 16px;
 font-weight: bold;
 text-shadow: 0 0 4px rgba(0,0,0,0.5);
 }

 .mood-option[data-mood="default"] {
 background: linear-gradient(135deg, #667eea, #764ba2);
 }

 .mood-option[data-mood="sunset"] {
 background: linear-gradient(135deg, #ff6b6b, #ffa07a);
 }

 .mood-option[data-mood="ocean"] {
 background: linear-gradient(135deg, #2e3192, #1bffff);
 }

 .mood-option[data-mood="forest"] {
 background: linear-gradient(135deg, #134e5e, #71b280);
 }

 .mood-option[data-mood="midnight"] {
 background: linear-gradient(135deg, #1a1a2e, #0f3460);
 }

 .mood-option[data-mood="aurora"] {
 background: linear-gradient(135deg, #00c6ff, #667eea);
 }

 .mood-option[data-mood="candy"] {
 background: linear-gradient(135deg, #ff0844, #ffb199);
 }

 .mood-option[data-mood="neon"] {
 background: linear-gradient(135deg, #ff00cc, #3333ff);
 }

 .mood-option[data-mood="tropical"] {
 background: linear-gradient(135deg, #f093fb, #f5576c);
 }

 .mood-option[data-mood="cosmic"] {
 background: linear-gradient(135deg, #4a00e0, #8e2de2);
 }

 .mood-option[data-mood="plasma"] {
 background: linear-gradient(135deg, #ff006e, #8338ec, #3a86ff);
 }

 .mood-option[data-mood="starfield"] {
 background: linear-gradient(135deg, #000428, #004e92);
 }

 .mood-option[data-mood="lava"] {
 background: linear-gradient(135deg, #8b0000, #ff4500, #ff6347);
 }

 .mood-option[data-mood="electric"] {
 background: linear-gradient(135deg, #00fff9, #7000ff, #ff00f7);
 }

 .mood-option[data-mood="matrix"] {
 background: linear-gradient(135deg, #001100, #00ff00, #003300);
 }

 .mood-option[data-mood="rainbow"] {
 background: linear-gradient(135deg, #ff0000, #ff7700, #ffdd00, #00ff00, #0088ff, #0000ff, #8800ff);
 }

 .mood-option[data-mood="vaporwave"] {
 background: linear-gradient(135deg, #ff6ec7, #7f00ff, #00d4ff);
 }

 .mood-option[data-mood="fire"] {
 background: linear-gradient(135deg, #000000, #8b0000, #ff4500, #ff8c00);
 }

 .mood-option[data-mood="cyberpunk"] {
 background: linear-gradient(135deg, #ff00de, #00ffff, #ff00de);
 }

 .mood-option[data-mood="galaxy"] {
 background: linear-gradient(135deg, #0f0c29, #302b63, #667eea, #764ba2);
 }

 .mood-option[data-mood="glitch"] {
 background: linear-gradient(135deg, #000000, #ff0000, #00ff00, #0000ff);
 }

 .mood-option[data-mood="lightning"] {
 background: linear-gradient(135deg, #1a1a2e, #ffffff, #16213e);
 }

 .mood-option[data-mood="pulse"] {
 background: radial-gradient(circle, #ff006e, #3a86ff);
 }

 .mood-option[data-mood="prism"] {
 background: conic-gradient(from 0deg, #ff0000, #ff7700, #ffdd00, #00ff00, #0088ff, #0000ff, #8800ff, #ff0000);
 }

 .mood-option[data-mood="hologram"] {
 background: linear-gradient(135deg, #00ffff, #ff00ff, #00ffff);
 }

 .mood-option[data-mood="laser"] {
 background: linear-gradient(135deg, #000000, #ff0066, #ff0066);
 }

 .mood-option[data-mood="warp"] {
 background: radial-gradient(ellipse, #8e2de2, #4a00e0);
 }

 .mood-option[data-mood="disco"] {
 background: linear-gradient(135deg, #ff00ff, #00ffff, #ffff00);
 }

 .mood-option[data-mood="nuclear"] {
 background: radial-gradient(circle, #00ff00, #003300);
 }

 .mood-option[data-mood="supernova"] {
 background: radial-gradient(circle, #ffffff, #ff4500, #8b0000);
 }

 /* Playlist Tabs */
 .playlist-tabs-wrapper {
 position: relative;
 margin-bottom: 15px;
 }

 .playlist-tabs-container {
 display: flex;
 align-items: center;
 gap: 6px;
 overflow-x: auto;
 padding-bottom: 8px;
 padding-right: 55px;
 scrollbar-width: thin;
 scrollbar-color: #667eea #f0f0f0;
 }

 .playlist-tabs-container::-webkit-scrollbar {
 height: 6px;
 }

 .playlist-tabs-container::-webkit-scrollbar-track {
 background: #f0f0f0;
 border-radius: 10px;
 }

 .playlist-tabs-container::-webkit-scrollbar-thumb {
 background: #667eea;
 border-radius: 10px;
 }

 .playlist-tab {
 padding: 8px 8px 8px 14px;
 background: #f5f5f5;
 border: 2px solid transparent;
 border-radius: 10px;
 font-size: 13px;
 font-weight: 600;
 color: #666;
 cursor: pointer;
 transition: all 0.3s ease;
 white-space: nowrap;
 flex-shrink: 0;
 display: flex;
 align-items: center;
 gap: 8px;
 max-width: 150px;
 }

 .playlist-tab span:first-child {
 overflow: hidden;
 text-overflow: ellipsis;
 white-space: nowrap;
 flex: 1;
 min-width: 0;
 }

 .playlist-tab:hover {
 background: #e8e8e8;
 color: #333;
 }

 .playlist-tab.active {
 background: linear-gradient(135deg, #667eea, #764ba2);
 color: white;
 }

 .playlist-tab-delete {
 width: 18px;
 height: 18px;
 border-radius: 50%;
 background: rgba(255, 255, 255, 0.3);
 display: flex;
 align-items: center;
 justify-content: center;
 font-size: 14px;
 line-height: 1;
 cursor: pointer;
 transition: all 0.2s ease;
 font-weight: 700;
 flex-shrink: 0;
 }

 .playlist-tab-delete:hover {
 background: rgba(255, 255, 255, 0.5);
 transform: scale(1.1);
 }

 .add-playlist-btn {
 position: absolute;
 right: 0;
 top: 0;
 width: 40px;
 height: 40px;
 background: linear-gradient(135deg, #43e97b, #38d172);
 border: none;
 border-radius: 10px;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 font-size: 22px;
 font-weight: bold;
 color: white;
 transition: all 0.3s ease;
 box-shadow: 0 4px 15px rgba(67, 233, 123, 0.3);
 z-index: 10;
 }

 .add-playlist-btn:hover {
 transform: translateY(-2px);
 box-shadow: 0 6px 20px rgba(67, 233, 123, 0.4);
 }

 .import-playlist-btn {
 width: 100%;
 padding: 12px;
 background: linear-gradient(135deg, #FF0000, #CC0000);
 color: white;
 border: none;
 border-radius: 12px;
 font-size: 14px;
 font-weight: 600;
 cursor: pointer;
 margin-bottom: 15px;
 transition: all 0.3s ease;
 display: flex;
 align-items: center;
 justify-content: center;
 gap: 8px;
 }

 .import-playlist-btn:hover {
 transform: translateY(-2px);
 box-shadow: 0 8px 20px rgba(255, 0, 0, 0.3);
 }

 .loading-spinner {
 display: inline-block;
 width: 16px;
 height: 16px;
 border: 3px solid rgba(255, 255, 255, 0.3);
 border-top-color: white;
 border-radius: 50%;
 animation: spin 0.8s linear infinite;
 }

 @keyframes spin {
 to { transform: rotate(360deg); }
 }

 /* Floating Player Controls */
 .pip-controls {
 display: flex;
 gap: 8px;
 margin-bottom: 15px;
 }

 .pip-btn {
 flex: 1;
 padding: 10px;
 background: linear-gradient(135deg, #667eea, #764ba2);
 color: white;
 border: none;
 border-radius: 10px;
 font-size: 13px;
 font-weight: 600;
 cursor: pointer;
 transition: all 0.3s ease;
 display: flex;
 align-items: center;
 justify-content: center;
 gap: 6px;
 }

 .pip-btn:hover {
 transform: translateY(-2px);
 box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
 }

 .pip-btn.active {
 background: linear-gradient(135deg, #43e97b, #38d172);
 }

 /* Video Player */
 .video-player-container {
 width: 100%;
 height: 350px;
 border-radius: 16px;
 overflow: hidden;
 margin-bottom: 20px;
 box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
 position: relative;
 background: #000;
 }

 #player {
 width: 100%;
 height: 100%;
 }

 .song-info {
 margin-bottom: 15px;
 }

 .song-title {
 font-size: 20px;
 font-weight: 700;
 color: #1a1a1a;
 margin-bottom: 5px;
 }

 .artist-name {
 font-size: 15px;
 color: #666;
 font-weight: 500;
 }

 .progress-container {
 margin: 20px 0;
 }

 .progress-bar {
 width: 100%;
 height: 6px;
 background: #e0e0e0;
 border-radius: 10px;
 position: relative;
 cursor: pointer;
 margin-bottom: 8px;
 }

 .progress-fill {
 height: 100%;
 background: linear-gradient(90deg, #667eea, #764ba2);
 border-radius: 10px;
 width: 0%;
 transition: width 0.1s linear;
 position: relative;
 }

 .progress-fill::after {
 content: '';
 position: absolute;
 right: -6px;
 top: 50%;
 transform: translateY(-50%);
 width: 14px;
 height: 14px;
 background: #667eea;
 border-radius: 50%;
 box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
 }

 .time-display {
 display: flex;
 justify-content: space-between;
 font-size: 12px;
 color: #888;
 font-weight: 500;
 }

 .controls {
 display: flex;
 justify-content: center;
 align-items: center;
 gap: 15px;
 margin: 25px 0;
 }

 .control-btn {
 background: none;
 border: none;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 transition: all 0.3s ease;
 color: #333;
 }

 .control-btn:hover {
 transform: scale(1.1);
 }

 .control-btn.small {
 width: 32px;
 height: 32px;
 }

 .control-btn.medium {
 width: 40px;
 height: 40px;
 }

 .control-btn.large {
 width: 55px;
 height: 55px;
 background: linear-gradient(135deg, #667eea, #764ba2);
 border-radius: 50%;
 color: white;
 box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
 }

 .control-btn.large:hover {
 box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
 }

 .control-btn.active {
 color: #667eea;
 }

 .control-btn svg {
 width: 100%;
 height: 100%;
 }

 /* Horizontal Carousel */
 .carousel-section {
 margin: 20px 0;
 padding: 15px 0;
 border-top: 1px solid #e0e0e0;
 border-bottom: 1px solid #e0e0e0;
 }

 .carousel-header {
 display: flex;
 justify-content: space-between;
 align-items: center;
 margin-bottom: 12px;
 padding: 0 8px;
 }

 .carousel-header h3 {
 font-size: 15px;
 font-weight: 700;
 color: #1a1a1a;
 }

 .carousel-container {
 position: relative;
 padding: 0 45px;
 }

 .carousel-wrapper {
 overflow: hidden;
 border-radius: 12px;
 }

 .carousel-track {
 display: flex;
 gap: 10px;
 transition: transform 0.3s ease;
 }

 .carousel-item {
 min-width: calc(33.333% - 7px);
 background: #f8f8f8;
 border-radius: 10px;
 padding: 10px;
 cursor: pointer;
 transition: all 0.3s ease;
 display: flex;
 align-items: center;
 gap: 10px;
 border: 3px solid transparent;
 }

 .carousel-item:hover {
 background: #f0f0f0;
 transform: translateY(-2px);
 box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
 }

 .carousel-item.active {
 background: #e8f5e9;
 border-color: #43e97b;
 box-shadow: 0 4px 12px rgba(67, 233, 123, 0.3);
 }

 .carousel-item.playing {
 background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
 border-color: #43e97b;
 animation: pulse 2s ease-in-out infinite;
 }

 @keyframes pulse {
 0%, 100% {
 box-shadow: 0 4px 12px rgba(67, 233, 123, 0.3);
 }
 50% {
 box-shadow: 0 6px 20px rgba(67, 233, 123, 0.5);
 }
 }

 .carousel-thumb {
 width: 50px;
 height: 50px;
 border-radius: 8px;
 overflow: hidden;
 flex-shrink: 0;
 background: linear-gradient(135deg, #667eea, #764ba2);
 }

 .carousel-thumb img {
 width: 100%;
 height: 100%;
 object-fit: cover;
 }

 .carousel-info {
 flex: 1;
 min-width: 0;
 }

 .carousel-title {
 font-size: 13px;
 font-weight: 600;
 color: #1a1a1a;
 margin-bottom: 3px;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .carousel-artist {
 font-size: 11px;
 color: #888;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .carousel-duration {
 font-size: 12px;
 color: #666;
 font-weight: 600;
 flex-shrink: 0;
 }

 .carousel-playing-badge {
 display: inline-block;
 padding: 2px 6px;
 background: #43e97b;
 color: white;
 border-radius: 4px;
 font-size: 9px;
 font-weight: 700;
 margin-left: 4px;
 text-transform: uppercase;
 }

 .carousel-nav {
 position: absolute;
 top: 50%;
 transform: translateY(-50%);
 width: 36px;
 height: 36px;
 background: white;
 border: 2px solid #e0e0e0;
 border-radius: 50%;
 display: flex;
 align-items: center;
 justify-content: center;
 cursor: pointer;
 transition: all 0.3s ease;
 z-index: 10;
 box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
 }

 .carousel-nav:hover {
 background: #667eea;
 border-color: #667eea;
 color: white;
 transform: translateY(-50%) scale(1.1);
 }

 .carousel-nav.prev {
 left: 0;
 }

 .carousel-nav.next {
 right: 0;
 }

 .carousel-nav svg {
 width: 18px;
 height: 18px;
 }

 /* Playlist Library Button */
 .library-button {
 width: 100%;
 padding: 12px;
 background: linear-gradient(135deg, #667eea, #764ba2);
 color: white;
 border: none;
 border-radius: 12px;
 font-size: 15px;
 font-weight: 600;
 cursor: pointer;
 margin: 20px 0;
 transition: all 0.3s ease;
 display: flex;
 align-items: center;
 justify-content: center;
 gap: 8px;
 box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
 }

 .library-button:hover {
 transform: translateY(-2px);
 box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
 }

 /* Vertical Playlist */
 .playlist-header {
 display: flex;
 justify-content: space-between;
 align-items: center;
 margin-bottom: 10px;
 padding: 0 8px;
 }

 .playlist-header h3 {
 font-size: 16px;
 font-weight: 700;
 color: #1a1a1a;
 }

 .playlist-count {
 font-size: 13px;
 color: #888;
 font-weight: 500;
 }

 .playlist-container {
 margin-top: 15px;
 }

 .playlist-scroll {
 max-height: 400px;
 overflow-y: auto;
 overflow-x: hidden;
 padding-right: 8px;
 scrollbar-width: thin;
 scrollbar-color: #667eea #f0f0f0;
 }

 .playlist-scroll::-webkit-scrollbar {
 width: 8px;
 }

 .playlist-scroll::-webkit-scrollbar-track {
 background: #f0f0f0;
 border-radius: 10px;
 }

 .playlist-scroll::-webkit-scrollbar-thumb {
 background: linear-gradient(135deg, #667eea, #764ba2);
 border-radius: 10px;
 }

 .playlist-item {
 display: flex;
 align-items: center;
 padding: 10px;
 border-radius: 10px;
 cursor: pointer;
 transition: all 0.3s ease;
 margin-bottom: 6px;
 }

 .playlist-item:hover {
 background: #f5f5f5;
 }

 .playlist-item.active {
 background: #f0f0ff;
 }

 .playlist-thumb {
 width: 45px;
 height: 45px;
 border-radius: 8px;
 margin-right: 12px;
 overflow: hidden;
 flex-shrink: 0;
 background: linear-gradient(135deg, #667eea, #764ba2);
 }

 .playlist-thumb img {
 width: 100%;
 height: 100%;
 object-fit: cover;
 }

 .playlist-thumb-placeholder {
 width: 100%;
 height: 100%;
 display: flex;
 align-items: center;
 justify-content: center;
 color: white;
 font-weight: bold;
 font-size: 16px;
 }

 .playlist-info {
 flex: 1;
 min-width: 0;
 }

 .playlist-title {
 font-size: 14px;
 font-weight: 600;
 color: #1a1a1a;
 margin-bottom: 3px;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .playlist-artist {
 font-size: 12px;
 color: #888;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .playlist-duration {
 font-size: 13px;
 color: #888;
 font-weight: 500;
 margin-left: 12px;
 flex-shrink: 0;
 }

 /* Library Modal */
 .modal-overlay {
 position: fixed;
 top: 0;
 left: 0;
 right: 0;
 bottom: 0;
 background: rgba(0, 0, 0, 0.7);
 display: none;
 align-items: center;
 justify-content: center;
 z-index: 9000;
 backdrop-filter: blur(5px);
 pointer-events: none;
 }

 .modal-overlay.active {
 display: flex;
 align-items: center;
 justify-content: center;
 pointer-events: auto;
 }

 .modal {
 background: #2a2a2a;
 border-radius: 20px;
 width: 90%;
 max-width: 800px;
 max-height: 80vh;
 padding: 0;
 animation: modalFadeIn 0.3s ease;
 overflow: hidden;
 display: flex;
 flex-direction: column;
 position: absolute;
 top: 50%;
 left: 50%;
 transform: translate(-50%, -50%);
 z-index: 9001;
 }

 @keyframes modalFadeIn {
 from {
 opacity: 0;
 transform: translate(-50%, -50%) scale(0.95) translateZ(0);
 }
 to {
 opacity: 1;
 transform: translate(-50%, -50%) scale(1) translateZ(0);
 }
 }

 .modal-header {
 padding: 20px;
 border-bottom: 1px solid #3a3a3a;
 display: flex;
 justify-content: space-between;
 align-items: center;
 flex-shrink: 0;
 }

 .modal-title {
 font-size: 20px;
 font-weight: 700;
 color: #fff;
 margin: 0;
 }

 .modal-close {
 background: none;
 border: none;
 color: #667eea;
 font-size: 15px;
 font-weight: 600;
 cursor: pointer;
 padding: 5px 10px;
 }

 .modal-close:hover {
 color: #764ba2;
 }

 .modal-body {
 padding: 20px;
 overflow-y: auto;
 flex: 1;
 }

 .modal-body::-webkit-scrollbar {
 width: 8px;
 }

 .modal-body::-webkit-scrollbar-track {
 background: #353535;
 border-radius: 10px;
 }

 .modal-body::-webkit-scrollbar-thumb {
 background: linear-gradient(135deg, #667eea, #764ba2);
 border-radius: 10px;
 }

 .library-status {
 text-align: center;
 padding: 20px;
 color: #aaa;
 font-size: 14px;
 }

 .library-empty {
 text-align: center;
 padding: 50px 20px;
 color: #888;
 }

 .library-empty-icon {
 font-size: 54px;
 margin-bottom: 15px;
 opacity: 0.5;
 }

 .library-empty-text {
 font-size: 15px;
 line-height: 1.6;
 }

 .library-grid {
 display: grid;
 grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
 gap: 15px;
 }

 .library-card {
 background: #353535;
 border-radius: 12px;
 overflow: hidden;
 transition: all 0.3s ease;
 cursor: pointer;
 }

 .library-card:hover {
 transform: translateY(-4px);
 box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
 background: #404040;
 }

 .library-card-image {
 width: 100%;
 height: 140px;
 background: linear-gradient(135deg, #667eea, #764ba2);
 position: relative;
 overflow: hidden;
 }

 .library-card-image img {
 width: 100%;
 height: 100%;
 object-fit: cover;
 }

 .library-card-badge {
 position: absolute;
 top: 8px;
 right: 8px;
 background: rgba(0, 0, 0, 0.7);
 color: white;
 padding: 3px 7px;
 border-radius: 6px;
 font-size: 10px;
 font-weight: 600;
 }

 .library-card-content {
 padding: 12px;
 }

 .library-card-title {
 font-size: 15px;
 font-weight: 700;
 color: #fff;
 margin-bottom: 6px;
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 }

 .library-card-meta {
 display: flex;
 justify-content: space-between;
 align-items: center;
 margin-bottom: 10px;
 }

 .library-card-tracks {
 font-size: 12px;
 color: #aaa;
 }

 .library-card-date {
 font-size: 10px;
 color: #888;
 }

 .library-card-actions {
 display: flex;
 gap: 6px;
 }

 .library-add-btn {
 flex: 1;
 padding: 7px;
 background: linear-gradient(135deg, #43e97b, #38d172);
 color: white;
 border: none;
 border-radius: 8px;
 font-size: 12px;
 font-weight: 600;
 cursor: pointer;
 transition: all 0.3s ease;
 display: flex;
 align-items: center;
 justify-content: center;
 gap: 5px;
 }

 .library-add-btn:hover {
 transform: translateY(-2px);
 box-shadow: 0 4px 12px rgba(67, 233, 123, 0.4);
 }

 .input-modal-content {
 padding: 20px;
 }

 .input-group {
 margin-bottom: 15px;
 }

 .input-label {
 display: block;
 font-size: 13px;
 font-weight: 600;
 color: #aaa;
 margin-bottom: 6px;
 }

 .input-field {
 width: 100%;
 padding: 10px 12px;
 background: #353535;
 border: 2px solid #3a3a3a;
 border-radius: 10px;
 color: #fff;
 font-size: 14px;
 transition: all 0.3s ease;
 }

 .input-field:focus {
 outline: none;
 border-color: #667eea;
 background: #3a3a3a;
 }

 .input-field::placeholder {
 color: #666;
 }

 .modal-actions {
 display: flex;
 gap: 10px;
 margin-top: 20px;
 }

 .modal-btn {
 flex: 1;
 padding: 11px;
 border: none;
 border-radius: 10px;
 font-size: 15px;
 font-weight: 600;
 cursor: pointer;
 transition: all 0.3s ease;
 }

 .modal-btn.cancel {
 background: #3a3a3a;
 color: #fff;
 }

 .modal-btn.cancel:hover {
 background: #444;
 }

 .modal-btn.save {
 background: linear-gradient(135deg, #667eea, #764ba2);
 color: #fff;
 }

 .modal-btn.save:hover {
 transform: translateY(-2px);
 box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
 }

 .empty-state {
 text-align: center;
 padding: 35px 15px;
 color: #999;
 }

 .empty-state-icon {
 font-size: 54px;
 margin-bottom: 15px;
 opacity: 0.5;
 }

 .empty-state-text {
 font-size: 14px;
 line-height: 1.6;
 }

 /* Responsive */
 @media (max-width: 768px) {
 .player-wrapper {
 padding: 10px;
 padding-bottom: 100px;
 }

 .music-player {
 padding: 18px;
 border-radius: 20px;
 }

 .app-title {
 font-size: 16px;
 }

 .volume-control-top {
 min-width: 100px;
 }

 .video-player-container {
 height: 220px;
 margin-bottom: 15px;
 }

 .song-title {
 font-size: 18px;
 }

 .artist-name {
 font-size: 14px;
 }

 .carousel-container {
 padding: 0 38px;
 }

 .carousel-item {
 min-width: calc(50% - 5px);
 padding: 8px;
 gap: 8px;
 }

 .carousel-thumb {
 width: 45px;
 height: 45px;
 }

 .carousel-title {
 font-size: 12px;
 }

 .carousel-artist {
 font-size: 10px;
 }

 .carousel-duration {
 font-size: 11px;
 }

 .library-grid {
 grid-template-columns: 1fr;
 }

 .modal {
 width: 95%;
 max-height: 85vh;
 }

 .modal-title {
 font-size: 18px;
 }

 .top-bar {
 flex-wrap: wrap;
 }

 .mood-section {
 padding: 12px;
 margin-bottom: 12px;
 }

 .mood-title {
 font-size: 18px;
 }

 .mood-selector {
 gap: 6px;
 padding: 5px 0;
 }

 .mood-option {
 width: 30px;
 height: 30px;
 min-width: 30px;
 border-width: 2px;
 }

 .mood-option.active::after {
 font-size: 14px;
 }

 .playlist-tabs-container {
 padding-right: 48px;
 }

 .playlist-tab {
 font-size: 12px;
 padding: 7px 6px 7px 12px;
 max-width: 130px;
 gap: 6px;
 }

 .playlist-tab-delete {
 width: 16px;
 height: 16px;
 font-size: 13px;
 }

 .add-playlist-btn {
 width: 36px;
 height: 36px;
 font-size: 20px;
 }

 .import-playlist-btn {
 font-size: 13px;
 padding: 10px;
 }

 .controls {
 gap: 12px;
 }

 .control-btn.small {
 width: 28px;
 height: 28px;
 }

 .control-btn.medium {
 width: 36px;
 height: 36px;
 }

 .control-btn.large {
 width: 50px;
 height: 50px;
 }

 .pip-btn {
 font-size: 12px;
 padding: 8px;
 }

 .floating-player {
 width: 280px;
 bottom: 10px;
 right: 10px;
 }

 .floating-player-video {
 height: 160px;
 }

 .sticky-controls {
 padding: 10px 15px;
 flex-wrap: wrap;
 gap: 10px;
 }

 .sticky-thumb {
 width: 40px;
 height: 40px;
 }

 .music-visualizer {
 width: 100%;
 order: -1;
 height: 40px;
 margin: 0 0 10px 0;
 }

 .settings-btn {
 width: 45px;
 height: 45px;
 top: 15px;
 right: 15px;
 }

 .settings-btn svg {
 width: 24px;
 height: 24px;
 }

 .settings-modal {
 width: 95%;
 max-width: 95%;
 max-height: 90vh;
 }
 }

 @media (min-width: 769px) {
 .music-player {
 max-width: 900px;
 }
 }
 </style>
</head>
<body>
 <div class="bg-animation">
 <div class="wave"></div>
 <div class="wave"></div>
 <div class="wave"></div>
 <div class="particles" id="particles"></div>
 </div>

 <!-- Settings Button -->
 <button class="settings-btn" id="settingsBtn">
 <svg viewBox="0 0 24 24">
 <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
 </svg>
 </button>

 <!-- Settings Modal -->
 <div class="settings-modal-overlay" id="settingsModalOverlay">
 <div class="settings-modal">
 <div class="settings-header">
 <div class="settings-title">
 <span></span>
 <span>Settings</span>
 </div>
 <button class="settings-close" id="closeSettingsModal">Close</button>
 </div>
 <div class="settings-body">
 <div class="setting-group">
 <div class="setting-label">
 <span></span>
 <span>Display Options</span>
 </div>
 <div class="setting-row">
 <div class="setting-info">
 <div class="setting-name">Sticky Controls</div>
 <div class="setting-desc">Show playback controls at bottom of screen</div>
 </div>
 <label class="toggle-switch">
 <input type="checkbox" id="toggleStickyControls" checked>
 <span class="toggle-slider"></span>
 </label>
 </div>
 <div class="setting-row">
 <div class="setting-info">
 <div class="setting-name">Music Visualizer</div>
 <div class="setting-desc">Show animated bars in sticky controls</div>
 </div>
 <label class="toggle-switch">
 <input type="checkbox" id="toggleVisualizer" checked>
 <span class="toggle-slider"></span>
 </label>
 </div>
 <div class="setting-row">
 <div class="setting-info">
 <div class="setting-name">Background Animations</div>
 <div class="setting-desc">Enable animated particles and waves</div>
 </div>
 <label class="toggle-switch">
 <input type="checkbox" id="toggleBackgroundAnim" checked>
 <span class="toggle-slider"></span>
 </label>
 </div>
 </div>

 <div class="setting-group">
 <div class="setting-label">
 <span></span>
 <span>Floating Player</span>
 </div>
 <div class="setting-description">
 The floating player can be dragged anywhere on screen and stays visible while browsing.
 For true picture-in-picture mode that works when minimized, try the "Pop-out Window" button in the floating player.
 </div>
 <div class="setting-row">
 <div class="setting-info">
 <div class="setting-name">Enable Floating Player</div>
 <div class="setting-desc">Show draggable video player overlay</div>
 </div>
 <label class="toggle-switch">
 <input type="checkbox" id="toggleFloatingPlayer">
 <span class="toggle-slider"></span>
 </label>
 </div>
 </div>

 <div class="setting-group">
 <div class="setting-label">
 <span></span>
 <span>About</span>
 </div>
 <div class="setting-description">
 Universal Music Player Pro - Enhanced Edition<br>
 Features: Community Library, Mood System, Music Visualizer, Floating Player<br>
 <strong style="color: #43e97b;"> Firebase Connected</strong> - Share playlists with the world!
 </div>
 </div>
 </div>
 </div>
 </div>

 <!-- Floating Mini Player -->
 <div class="floating-player" id="floatingPlayer">
 <div class="floating-player-header">
 <div class="floating-player-title">
 <span></span>
 <span>Now Playing</span>
 </div>
 <div class="floating-player-actions">
 <button class="floating-action-btn" id="popoutWindowBtn" title="Open in new window">
 <span></span>
 </button>
 <button class="floating-action-btn" id="closeFloatingPlayer"></button>
 </div>
 </div>
 <div class="floating-player-video">
 <div id="floatingPlayerFrame"></div>
 </div>
 <div class="floating-player-info">
 <div class="floating-player-song" id="floatingSongTitle">No Track</div>
 <div class="floating-player-artist" id="floatingArtistName">Select a song</div>
 </div>
 <div class="floating-player-controls">
 <button class="floating-control-btn" id="floatingPrevBtn">
 <svg viewBox="0 0 24 24">
 <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
 </svg>
 </button>
 <button class="floating-control-btn large" id="floatingPlayPauseBtn">
 <svg viewBox="0 0 24 24">
 <path d="M8 5v14l11-7z"/>
 </svg>
 </button>
 <button class="floating-control-btn" id="floatingNextBtn">
 <svg viewBox="0 0 24 24">
 <path d="M16 18h2V6h-2v12zm-11-7l8.5-6v12z"/>
 </svg>
 </button>
 </div>
 </div>

 <!-- Sticky Control Bar with Visualizer -->
 <div class="sticky-controls" id="stickyControls">
 <div class="sticky-info">
 <div class="sticky-thumb" id="stickyThumb">
 <div class="playlist-thumb-placeholder"></div>
 </div>
 <div class="sticky-text">
 <div class="sticky-song" id="stickySongTitle">No Track</div>
 <div class="sticky-artist" id="stickyArtistName">Select a song</div>
 </div>
 </div>
 
 <!-- Music Visualizer -->
 <div class="music-visualizer paused" id="musicVisualizer">
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 <div class="visualizer-bar"></div>
 </div>
 
 <div class="sticky-controls-buttons">
 <button class="sticky-btn" id="stickyPrevBtn">
 <svg viewBox="0 0 24 24">
 <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
 </svg>
 </button>
 <button class="sticky-btn large" id="stickyPlayPauseBtn">
 <svg viewBox="0 0 24 24">
 <path d="M8 5v14l11-7z"/>
 </svg>
 </button>
 <button class="sticky-btn" id="stickyNextBtn">
 <svg viewBox="0 0 24 24">
 <path d="M16 18h2V6h-2v12zm-11-7l8.5-6v12z"/>
 </svg>
 </button>
 </div>
 </div>

 <div class="player-wrapper">
 <div class="music-player">
 <!-- Top Bar with Title and Volume -->
 <div class="top-bar">
 <div class="app-title">
 <span></span>
 <span>Music Player Pro</span>
 </div>
 <div class="volume-control-top">
 <button class="control-btn small" id="volumeBtn">
 <svg viewBox="0 0 24 24" id="volumeIcon">
 <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
 </svg>
 <svg viewBox="0 0 24 24" id="muteIcon" style="display: none;">
 <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
 </svg>
 </button>
 <div class="volume-slider-top" id="volumeSlider">
 <div class="volume-fill-top" id="volumeFill"></div>
 </div>
 </div>
 </div>

 <!-- Mood Selector -->
 <div class="mood-section">
 <div class="mood-header">
 <h2 class="mood-title"> Mood</h2>
 </div>
 <div class="mood-selector">
 <div class="mood-option active" data-mood="default" title="Default Vibes"></div>
 <div class="mood-option" data-mood="sunset" title="Sunset Chill"></div>
 <div class="mood-option" data-mood="ocean" title="Ocean Waves"></div>
 <div class="mood-option" data-mood="forest" title="Forest Calm"></div>
 <div class="mood-option" data-mood="midnight" title="Midnight Dreams"></div>
 <div class="mood-option" data-mood="aurora" title="Aurora Lights"></div>
 <div class="mood-option" data-mood="candy" title="Candy Pop"></div>
 <div class="mood-option" data-mood="neon" title="Neon Nights"></div>
 <div class="mood-option" data-mood="tropical" title="Tropical Heat"></div>
 <div class="mood-option" data-mood="cosmic" title="Cosmic Journey"></div>
 <div class="mood-option" data-mood="plasma" title="Plasma Orbs"></div>
 <div class="mood-option" data-mood="starfield" title="Starfield"></div>
 <div class="mood-option" data-mood="lava" title="Lava Bubbles"></div>
 <div class="mood-option" data-mood="electric" title="Electric Storm"></div>
 <div class="mood-option" data-mood="matrix" title="Matrix Code"></div>
 <div class="mood-option" data-mood="rainbow" title="Rainbow Shimmer"></div>
 <div class="mood-option" data-mood="vaporwave" title="Vaporwave Grid"></div>
 <div class="mood-option" data-mood="fire" title="Rising Flames"></div>
 <div class="mood-option" data-mood="cyberpunk" title="Cyberpunk Glitch"></div>
 <div class="mood-option" data-mood="galaxy" title="Galaxy Nebula"></div>
 <div class="mood-option" data-mood="glitch" title="RGB Glitch"></div>
 <div class="mood-option" data-mood="lightning" title="Lightning Storm"></div>
 <div class="mood-option" data-mood="pulse" title="Heartbeat Pulse"></div>
 <div class="mood-option" data-mood="prism" title="Prism Refraction"></div>
 <div class="mood-option" data-mood="hologram" title="Hologram Scan"></div>
 <div class="mood-option" data-mood="laser" title="Laser Beams"></div>
 <div class="mood-option" data-mood="warp" title="Warp Speed"></div>
 <div class="mood-option" data-mood="disco" title="Disco Lights"></div>
 <div class="mood-option" data-mood="nuclear" title="Nuclear Glow"></div>
 <div class="mood-option" data-mood="supernova" title="Supernova Explosion"></div>
 </div>
 </div>

 <!-- Playlist Tabs with Sticky + Button -->
 <div class="playlist-tabs-wrapper">
 <div class="playlist-tabs-container" id="playlistTabs"></div>
 <button class="add-playlist-btn" id="addPlaylistBtn">+</button>
 </div>

 <!-- Import Playlist Button -->
 <button class="import-playlist-btn" id="importPlaylistBtn">
 <span></span>
 <span>Import YouTube Playlist</span>
 </button>

 <!-- Floating Player Controls -->
 <div class="pip-controls">
 <button class="pip-btn" id="floatingPlayerBtn" style="flex: 1;">
 <span></span>
 <span>Floating Video Player</span>
 </button>
 </div>

 <!-- YouTube Video Player -->
 <div class="video-player-container">
 <div id="player"></div>
 </div>

 <!-- Song Info -->
 <div class="song-info">
 <div class="song-title" id="songTitle">No Tracks</div>
 <div class="artist-name" id="artistName">Import a playlist to begin</div>
 </div>

 <!-- Progress Bar -->
 <div class="progress-container">
 <div class="progress-bar" id="progressBar">
 <div class="progress-fill" id="progressFill"></div>
 </div>
 <div class="time-display">
 <span id="currentTime">0:00</span>
 <span id="totalTime">0:00</span>
 </div>
 </div>

 <!-- Playback Controls -->
 <div class="controls">
 <button class="control-btn small" id="prevBtn">
 <svg viewBox="0 0 24 24">
 <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
 </svg>
 </button>

 <button class="control-btn large" id="playPauseBtn">
 <svg viewBox="0 0 24 24" id="playIcon">
 <path d="M8 5v14l11-7z"/>
 </svg>
 <svg viewBox="0 0 24 24" id="pauseIcon" style="display: none;">
 <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
 </svg>
 </button>

 <button class="control-btn small" id="nextBtn">
 <svg viewBox="0 0 24 24">
 <path d="M16 18h2V6h-2v12zm-11-7l8.5-6v12z"/>
 </svg>
 </button>

 <button class="control-btn medium" id="shuffleBtn">
 <svg viewBox="0 0 24 24">
 <path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/>
 </svg>
 </button>

 <button class="control-btn medium" id="repeatBtn">
 <svg viewBox="0 0 24 24">
 <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/>
 </svg>
 </button>
 </div>

 <!-- Horizontal Carousel -->
 <div class="carousel-section" id="carouselSection" style="display: none;">
 <div class="carousel-header">
 <h3>Now Playing</h3>
 </div>
 <div class="carousel-container">
 <button class="carousel-nav prev" id="carouselPrev">
 <svg viewBox="0 0 24 24">
 <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
 </svg>
 </button>
 <div class="carousel-wrapper">
 <div class="carousel-track" id="carouselTrack"></div>
 </div>
 <button class="carousel-nav next" id="carouselNext">
 <svg viewBox="0 0 24 24">
 <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
 </svg>
 </button>
 </div>
 </div>

 <!-- Playlist Library Button -->
 <button class="library-button" id="libraryBtn">
 <span></span>
 <span>Browse Community Library</span>
 <span style="opacity: 0.7; font-size: 12px;" id="libraryBadge">(Empty)</span>
 </button>

 <!-- Vertical Playlist -->
 <div class="playlist-container">
 <div class="playlist-header">
 <h3>All Tracks</h3>
 <span class="playlist-count" id="playlistCount">0 songs</span>
 </div>
 <div class="playlist-scroll" id="playlist">
 <div class="empty-state">
 <div class="empty-state-icon"></div>
 <div class="empty-state-text">
 Click "Import YouTube Playlist" to add songs<br>
 or browse the Community Library for instant access!
 </div>
 </div>
 </div>
 </div>
 </div>
 </div>

 <!-- Playlist Library Modal -->
 <div class="modal-overlay" id="libraryModalOverlay">
 <div class="modal">
 <div class="modal-header">
 <h2 class="modal-title"> Community Playlist Library</h2>
 <button class="modal-close" id="closeLibraryModal">Close</button>
 </div>
 <div class="modal-body" id="libraryModalBody">
 <div class="library-status">Loading community playlists...</div>
 </div>
 </div>
 </div>

 <!-- Import Playlist Modal -->
 <div class="modal-overlay" id="playlistModalOverlay">
 <div class="modal">
 <div class="modal-header">
 <h2 class="modal-title">Import YouTube Playlist</h2>
 <button class="modal-close" id="closePlaylistModal">Cancel</button>
 </div>
 <div class="input-modal-content">
 <div class="input-group">
 <label class="input-label">Playlist Name</label>
 <input type="text" class="input-field" id="playlistNameInput" placeholder="My Awesome Playlist">
 </div>
 <div class="input-group">
 <label class="input-label">YouTube Playlist URL or ID</label>
 <input type="text" class="input-field" id="playlistUrlInput" placeholder="https://www.youtube.com/playlist?list=...">
 </div>
 <div style="padding: 10px; background: rgba(67, 233, 123, 0.1); border-radius: 8px; margin-bottom: 12px; border: 1px solid rgba(67, 233, 123, 0.3);">
 <div style="font-size: 12px; color: #aaa; line-height: 1.6;">
 <strong style="color: #43e97b;"> Community Feature:</strong> This playlist will be saved to our shared database and accessible to all users worldwide - helping everyone save on API costs! One import = Everyone benefits! 
 </div>
 </div>
 <div class="modal-actions">
 <button class="modal-btn cancel" id="cancelPlaylist">Cancel</button>
 <button class="modal-btn save" id="loadPlaylist">
 <span id="loadPlaylistText">Import & Share</span>
 </button>
 </div>
 <div id="playlistStatus" style="margin-top: 12px; font-size: 13px; text-align: center; color: #667eea;"></div>
 </div>
 </div>
 </div>

 <!-- Firebase SDK -->
 <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
 <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

 <!-- YouTube IFrame API -->
 <script src="https://www.youtube.com/iframe_api"></script>

 <script>
 // Firebase Configuration
 const firebaseConfig = {
 apiKey: "AIzaSyDPjVCn59pOyBUVW0vy0e5gAmbvunR8Eaw",
 authDomain: "music-player-library.firebaseapp.com",
 databaseURL: "https://music-player-library-default-rtdb.firebaseio.com",
 projectId: "music-player-library",
 storageBucket: "music-player-library.firebasestorage.app",
 messagingSenderId: "1021984826826",
 appId: "1:1021984826826:web:b24eaa21402b5a00485b33",
 measurementId: "G-NRMYDTH8BG"
};

 // Initialize Firebase
 let database = null;
 let firebaseAvailable = false;

 try {
 firebase.initializeApp(firebaseConfig);
 database = firebase.database();
 firebaseAvailable = true;
 console.log(' Firebase connected - Community library active!');
 } catch (e) {
 console.log(' Firebase unavailable - Using localStorage fallback');
 firebaseAvailable = false;
 }

 // YouTube API Configuration
 const YOUTUBE_API_KEY = 'AIzaSyBijIimhG2s_uzGQybB13Iw0SQxwLTwQ4Y';
 const YOUTUBE_API_BASE = 'https://www.googleapis.com/youtube/v3';

 // Data structures
 let playlists = [];
 let playlistLibrary = [];
 let currentPlaylistIndex = 0;
 let currentSongIndex = 0;
 let isPlaying = false;
 let isShuffled = false;
 let repeatMode = 0;
 let volume = 70;
 let isMuted = false;
 let carouselOffset = 0;

 // Settings
 let settings = {
 stickyControls: true,
 visualizer: true,
 backgroundAnim: true,
 floatingPlayer: false
 };

 // YouTube Player
 let player;
 let playerReady = false;
 let progressInterval;

 // Floating Player State
 let floatingPlayerActive = false;
 let isDragging = false;
 let dragOffsetX = 0;
 let dragOffsetY = 0;
 let popoutWindow = null;

 // DOM Elements
 const playPauseBtn = document.getElementById('playPauseBtn');
 const playIcon = document.getElementById('playIcon');
 const pauseIcon = document.getElementById('pauseIcon');
 const prevBtn = document.getElementById('prevBtn');
 const nextBtn = document.getElementById('nextBtn');
 const shuffleBtn = document.getElementById('shuffleBtn');
 const repeatBtn = document.getElementById('repeatBtn');
 const progressBar = document.getElementById('progressBar');
 const progressFill = document.getElementById('progressFill');
 const currentTimeEl = document.getElementById('currentTime');
 const totalTimeEl = document.getElementById('totalTime');
 const songTitle = document.getElementById('songTitle');
 const artistName = document.getElementById('artistName');
 const playlistContainer = document.getElementById('playlist');
 const playlistCount = document.getElementById('playlistCount');
 const volumeBtn = document.getElementById('volumeBtn');
 const volumeIcon = document.getElementById('volumeIcon');
 const muteIcon = document.getElementById('muteIcon');
 const volumeSlider = document.getElementById('volumeSlider');
 const volumeFill = document.getElementById('volumeFill');
 const playlistTabsContainer = document.getElementById('playlistTabs');
 const addPlaylistBtn = document.getElementById('addPlaylistBtn');
 
 // Settings elements
 const settingsBtn = document.getElementById('settingsBtn');
 const settingsModalOverlay = document.getElementById('settingsModalOverlay');
 const closeSettingsModal = document.getElementById('closeSettingsModal');
 const toggleStickyControls = document.getElementById('toggleStickyControls');
 const toggleVisualizer = document.getElementById('toggleVisualizer');
 const toggleBackgroundAnim = document.getElementById('toggleBackgroundAnim');
 const toggleFloatingPlayerSetting = document.getElementById('toggleFloatingPlayer');
 
 // Floating Player elements
 const floatingPlayer = document.getElementById('floatingPlayer');
 const floatingPlayerBtn = document.getElementById('floatingPlayerBtn');
 const closeFloatingPlayer = document.getElementById('closeFloatingPlayer');
 const popoutWindowBtn = document.getElementById('popoutWindowBtn');
 const floatingSongTitle = document.getElementById('floatingSongTitle');
 const floatingArtistName = document.getElementById('floatingArtistName');
 const floatingPlayPauseBtn = document.getElementById('floatingPlayPauseBtn');
 const floatingPrevBtn = document.getElementById('floatingPrevBtn');
 const floatingNextBtn = document.getElementById('floatingNextBtn');
 
 // Sticky Controls elements
 const stickyControls = document.getElementById('stickyControls');
 const stickySongTitle = document.getElementById('stickySongTitle');
 const stickyArtistName = document.getElementById('stickyArtistName');
 const stickyThumb = document.getElementById('stickyThumb');
 const stickyPlayPauseBtn = document.getElementById('stickyPlayPauseBtn');
 const stickyPrevBtn = document.getElementById('stickyPrevBtn');
 const stickyNextBtn = document.getElementById('stickyNextBtn');
 const musicVisualizer = document.getElementById('musicVisualizer');
 
 // Carousel elements
 const carouselSection = document.getElementById('carouselSection');
 const carouselTrack = document.getElementById('carouselTrack');
 const carouselPrev = document.getElementById('carouselPrev');
 const carouselNext = document.getElementById('carouselNext');
 
 // Library elements
 const libraryBtn = document.getElementById('libraryBtn');
 const libraryBadge = document.getElementById('libraryBadge');
 const libraryModalOverlay = document.getElementById('libraryModalOverlay');
 const libraryModalBody = document.getElementById('libraryModalBody');
 const closeLibraryModal = document.getElementById('closeLibraryModal');
 
 // Import modal elements
 const importPlaylistBtn = document.getElementById('importPlaylistBtn');
 const playlistModalOverlay = document.getElementById('playlistModalOverlay');
 const closePlaylistModal = document.getElementById('closePlaylistModal');
 const cancelPlaylist = document.getElementById('cancelPlaylist');
 const loadPlaylist = document.getElementById('loadPlaylist');
 const playlistUrlInput = document.getElementById('playlistUrlInput');
 const playlistNameInput = document.getElementById('playlistNameInput');
 const playlistStatus = document.getElementById('playlistStatus');
 const loadPlaylistText = document.getElementById('loadPlaylistText');

 // Mood Management
 const moodOptions = document.querySelectorAll('.mood-option');
 let currentMood = 'default';

 function loadMood() {
 const savedMood = localStorage.getItem('musicPlayerMood') || 'default';
 applyMood(savedMood);
 }

 function applyMood(mood) {
 currentMood = mood;
 document.body.className = mood !== 'default' ? `mood-${mood}` : '';
 
 moodOptions.forEach(option => {
 option.classList.toggle('active', option.dataset.mood === mood);
 });
 
 localStorage.setItem('musicPlayerMood', mood);
 }

 moodOptions.forEach(option => {
 option.addEventListener('click', () => {
 applyMood(option.dataset.mood);
 });
 });

 // Settings Management
 function loadSettings() {
 const saved = localStorage.getItem('musicPlayerSettings');
 if (saved) {
 settings = JSON.parse(saved);
 }
 applySettings();
 }

 function saveSettings() {
 localStorage.setItem('musicPlayerSettings', JSON.stringify(settings));
 }

 function applySettings() {
 toggleStickyControls.checked = settings.stickyControls;
 toggleVisualizer.checked = settings.visualizer;
 toggleBackgroundAnim.checked = settings.backgroundAnim;
 toggleFloatingPlayerSetting.checked = settings.floatingPlayer;
 
 if (!settings.stickyControls) {
 stickyControls.classList.add('hidden');
 } else {
 stickyControls.classList.remove('hidden');
 }
 
 if (!settings.visualizer) {
 musicVisualizer.style.display = 'none';
 } else {
 musicVisualizer.style.display = 'flex';
 }
 
 if (!settings.backgroundAnim) {
 document.querySelector('.bg-animation').style.display = 'none';
 } else {
 document.querySelector('.bg-animation').style.display = 'block';
 }
 
 if (settings.floatingPlayer && !floatingPlayerActive) {
 toggleFloatingPlayer();
 }
 }

 // Settings Event Listeners
 settingsBtn.addEventListener('click', () => {
 settingsModalOverlay.classList.add('active');
 });

 closeSettingsModal.addEventListener('click', () => {
 settingsModalOverlay.classList.remove('active');
 });

 settingsModalOverlay.addEventListener('click', (e) => {
 if (e.target === settingsModalOverlay) {
 settingsModalOverlay.classList.remove('active');
 }
 });

 toggleStickyControls.addEventListener('change', (e) => {
 settings.stickyControls = e.target.checked;
 if (!settings.stickyControls) {
 stickyControls.classList.add('hidden');
 } else {
 stickyControls.classList.remove('hidden');
 }
 saveSettings();
 });

 toggleVisualizer.addEventListener('change', (e) => {
 settings.visualizer = e.target.checked;
 if (!settings.visualizer) {
 musicVisualizer.style.display = 'none';
 } else {
 musicVisualizer.style.display = 'flex';
 }
 saveSettings();
 });

 toggleBackgroundAnim.addEventListener('change', (e) => {
 settings.backgroundAnim = e.target.checked;
 if (!settings.backgroundAnim) {
 document.querySelector('.bg-animation').style.display = 'none';
 } else {
 document.querySelector('.bg-animation').style.display = 'block';
 }
 saveSettings();
 });

 toggleFloatingPlayerSetting.addEventListener('change', (e) => {
 settings.floatingPlayer = e.target.checked;
 if (settings.floatingPlayer && !floatingPlayerActive) {
 toggleFloatingPlayer();
 } else if (!settings.floatingPlayer && floatingPlayerActive) {
 toggleFloatingPlayer();
 }
 saveSettings();
 });

 // Background Animation - Particles
 function createParticles() {
 const particlesContainer = document.getElementById('particles');
 const particleCount = 20;
 
 for (let i = 0; i < particleCount; i++) {
 const particle = document.createElement('div');
 particle.className = 'particle';
 particle.style.left = Math.random() * 100 + '%';
 particle.style.animationDelay = Math.random() * 10 + 's';
 particle.style.animationDuration = (8 + Math.random() * 4) + 's';
 particlesContainer.appendChild(particle);
 }
 }

 // Floating Player Functions
 function toggleFloatingPlayer() {
 floatingPlayerActive = !floatingPlayerActive;
 
 if (floatingPlayerActive) {
 floatingPlayer.classList.add('active');
 floatingPlayerBtn.classList.add('active');
 floatingPlayerBtn.innerHTML = '<span></span><span>Hide Floating Video</span>';
 updateFloatingPlayerInfo();
 } else {
 floatingPlayer.classList.remove('active');
 floatingPlayerBtn.classList.remove('active');
 floatingPlayerBtn.innerHTML = '<span></span><span>Floating Video Player</span>';
 }
 }

 function updateFloatingPlayerInfo() {
 const songs = getCurrentSongs();
 if (songs.length === 0 || currentSongIndex >= songs.length) return;
 
 const song = songs[currentSongIndex];
 floatingSongTitle.textContent = song.title || 'No Track';
 floatingArtistName.textContent = song.artist || 'Unknown Artist';
 }

 // Pop-out Window Function
 function openPopoutWindow() {
 const songs = getCurrentSongs();
 if (songs.length === 0 || currentSongIndex >= songs.length) return;
 
 const song = songs[currentSongIndex];
 const videoId = song.videoId;
 
 if (popoutWindow && !popoutWindow.closed) {
 popoutWindow.focus();
 return;
 }
 
 const windowFeatures = 'width=500,height=400,menubar=no,toolbar=no,location=no,status=no';
 popoutWindow = window.open('', 'MusicPlayerPopout', windowFeatures);
 
 popoutWindow.document.write(`
 <!DOCTYPE html>
 <html>
 <head>
 <title>${song.title} - Music Player</title>
 <style>
 body { margin: 0; padding: 0; background: #000; overflow: hidden; }
 #popout-player { width: 100%; height: 100%; }
 </style>
 </head>
 <body>
 <div id="popout-player"></div>
 <script src="https://www.youtube.com/iframe_api"><\/script>
 <script>
 let popoutYTPlayer;
 function onYouTubeIframeAPIReady() {
 popoutYTPlayer = new YT.Player('popout-player', {
 height: '100%',
 width: '100%',
 videoId: '${videoId}',
 playerVars: {
 'autoplay': ${isPlaying ? 1 : 0},
 'controls': 1,
 'rel': 0,
 'showinfo': 1,
 'modestbranding': 1
 }
 });
 }
 <\/script>
 </body>
 </html>
 `);
 popoutWindow.document.close();
 }

 // Update Sticky Controls Info
 function updateStickyControlsInfo() {
 const songs = getCurrentSongs();
 if (songs.length === 0 || currentSongIndex >= songs.length) return;
 
 const song = songs[currentSongIndex];
 stickySongTitle.textContent = song.title || 'No Track';
 stickyArtistName.textContent = song.artist || 'Unknown Artist';
 
 if (song.thumbnail) {
 stickyThumb.innerHTML = `<img src="${song.thumbnail}" alt="${song.title}">`;
 } else {
 stickyThumb.innerHTML = `<div class="playlist-thumb-placeholder">${(song.artist || 'U').charAt(0)}</div>`;
 }
 }

 // Update Visualizer State
 function updateVisualizerState() {
 if (isPlaying) {
 musicVisualizer.classList.remove('paused');
 musicVisualizer.classList.add('playing');
 } else {
 musicVisualizer.classList.remove('playing');
 musicVisualizer.classList.add('paused');
 }
 }

 // Media Session API for Native Mobile Controls
 function setupMediaSession() {
 if ('mediaSession' in navigator) {
 const songs = getCurrentSongs();
 if (songs.length === 0 || currentSongIndex >= songs.length) return;
 
 const song = songs[currentSongIndex];
 
 navigator.mediaSession.metadata = new MediaMetadata({
 title: song.title || 'Unknown Title',
 artist: song.artist || 'Unknown Artist',
 artwork: song.thumbnail ? [
 { src: song.thumbnail, sizes: '96x96', type: 'image/jpeg' },
 { src: song.thumbnail, sizes: '128x128', type: 'image/jpeg' },
 { src: song.thumbnail, sizes: '192x192', type: 'image/jpeg' },
 { src: song.thumbnail, sizes: '256x256', type: 'image/jpeg' },
 { src: song.thumbnail, sizes: '384x384', type: 'image/jpeg' },
 { src: song.thumbnail, sizes: '512x512', type: 'image/jpeg' }
 ] : []
 });

 navigator.mediaSession.setActionHandler('play', () => {
 play();
 });

 navigator.mediaSession.setActionHandler('pause', () => {
 pause();
 });

 navigator.mediaSession.setActionHandler('previoustrack', () => {
 prevSong();
 });

 navigator.mediaSession.setActionHandler('nexttrack', () => {
 nextSong();
 });

 navigator.mediaSession.setActionHandler('seekbackward', (details) => {
 if (player && player.getCurrentTime && player.seekTo) {
 const currentTime = player.getCurrentTime();
 player.seekTo(Math.max(0, currentTime - (details.seekOffset || 10)));
 }
 });

 navigator.mediaSession.setActionHandler('seekforward', (details) => {
 if (player && player.getCurrentTime && player.getDuration && player.seekTo) {
 const currentTime = player.getCurrentTime();
 const duration = player.getDuration();
 player.seekTo(Math.min(duration, currentTime + (details.seekOffset || 10)));
 }
 });
 }
 }

 // Dragging functionality for floating player
 function setupDragging() {
 floatingPlayer.addEventListener('mousedown', startDragging);
 document.addEventListener('mousemove', drag);
 document.addEventListener('mouseup', stopDragging);
 
 floatingPlayer.addEventListener('touchstart', startDragging);
 document.addEventListener('touchmove', drag);
 document.addEventListener('touchend', stopDragging);
 }

 function startDragging(e) {
 if (e.target.closest('.floating-action-btn') || 
 e.target.closest('.floating-control-btn')) {
 return;
 }
 
 isDragging = true;
 const touch = e.touches ? e.touches[0] : e;
 const rect = floatingPlayer.getBoundingClientRect();
 
 dragOffsetX = touch.clientX - rect.left;
 dragOffsetY = touch.clientY - rect.top;
 
 floatingPlayer.style.cursor = 'grabbing';
 }

 function drag(e) {
 if (!isDragging) return;
 
 e.preventDefault();
 const touch = e.touches ? e.touches[0] : e;
 
 let newX = touch.clientX - dragOffsetX;
 let newY = touch.clientY - dragOffsetY;
 
 // Keep within viewport bounds
 newX = Math.max(0, Math.min(newX, window.innerWidth - floatingPlayer.offsetWidth));
 newY = Math.max(0, Math.min(newY, window.innerHeight - floatingPlayer.offsetHeight));
 
 floatingPlayer.style.right = 'auto';
 floatingPlayer.style.bottom = 'auto';
 floatingPlayer.style.left = newX + 'px';
 floatingPlayer.style.top = newY + 'px';
 }

 function stopDragging() {
 isDragging = false;
 floatingPlayer.style.cursor = 'move';
 }

 // Initialize YouTube Player
 function onYouTubeIframeAPIReady() {
 player = new YT.Player('player', {
 height: '100%',
 width: '100%',
 videoId: '',
 playerVars: {
 'autoplay': 0,
 'controls': 0,
 'rel': 0,
 'showinfo': 0,
 'modestbranding': 1,
 'playsinline': 1
 },
 events: {
 'onReady': onPlayerReady,
 'onStateChange': onPlayerStateChange
 }
 });
 }

 function onPlayerReady(event) {
 playerReady = true;
 player.setVolume(volume);
 
 const songs = getCurrentSongs();
 if (songs.length > 0) {
 selectSong(0);
 updateStickyControlsInfo();
 }
 }

 function onPlayerStateChange(event) {
 if (event.data === YT.PlayerState.PLAYING) {
 isPlaying = true;
 playIcon.style.display = 'none';
 pauseIcon.style.display = 'block';
 updateAllPlayButtons('pause');
 updateVisualizerState();
 startProgressUpdater();
 
 // Update Media Session state
 if ('mediaSession' in navigator) {
 navigator.mediaSession.playbackState = 'playing';
 }
 } else if (event.data === YT.PlayerState.PAUSED) {
 isPlaying = false;
 playIcon.style.display = 'block';
 pauseIcon.style.display = 'none';
 updateAllPlayButtons('play');
 updateVisualizerState();
 stopProgressUpdater();
 
 // Update Media Session state
 if ('mediaSession' in navigator) {
 navigator.mediaSession.playbackState = 'paused';
 }
 } else if (event.data === YT.PlayerState.ENDED) {
 handleSongEnd();
 }
 }

 function updateAllPlayButtons(state) {
 const playIconHTML = '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';
 const pauseIconHTML = '<svg viewBox="0 0 24 24"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/></svg>';
 
 if (state === 'pause') {
 floatingPlayPauseBtn.innerHTML = pauseIconHTML;
 stickyPlayPauseBtn.innerHTML = pauseIconHTML;
 } else {
 floatingPlayPauseBtn.innerHTML = playIconHTML;
 stickyPlayPauseBtn.innerHTML = playIconHTML;
 }
 }

 function startProgressUpdater() {
 stopProgressUpdater();
 progressInterval = setInterval(() => {
 if (player && player.getCurrentTime) {
 const currentTime = player.getCurrentTime();
 const duration = player.getDuration();
 updateProgressDisplay(currentTime, duration);
 }
 }, 100);
 }

 function stopProgressUpdater() {
 if (progressInterval) {
 clearInterval(progressInterval);
 progressInterval = null;
 }
 }

 function updateProgressDisplay(currentTime, duration) {
 if (duration > 0) {
 const percentage = (currentTime / duration) * 100;
 progressFill.style.width = percentage + '%';
 currentTimeEl.textContent = formatTime(currentTime);
 totalTimeEl.textContent = formatTime(duration);
 }
 }

 // Helper Functions
 function getRandomColor() {
 const colors = ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#43e97b', '#fa709a', '#fee140', '#30cfd0', '#a8edea', '#fed6e3'];
 return colors[Math.floor(Math.random() * colors.length)];
 }

 function extractPlaylistId(url) {
 const patterns = [
 /[?&]list=([^&]+)/,
 /^([A-Za-z0-9_-]+)$/
 ];
 
 for (const pattern of patterns) {
 const match = url.match(pattern);
 if (match) return match[1];
 }
 
 return null;
 }

 function parseYouTubeDuration(duration) {
 const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
 if (!match) return '0:00';
 
 const hours = parseInt(match[1] || 0);
 const minutes = parseInt(match[2] || 0);
 const seconds = parseInt(match[3] || 0);
 
 if (hours > 0) {
 return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
 }
 return `${minutes}:${seconds.toString().padStart(2, '0')}`;
 }

 function formatTime(seconds) {
 const min = Math.floor(seconds / 60);
 const sec = Math.floor(seconds % 60);
 return `${min}:${sec.toString().padStart(2, '0')}`;
 }

 // YouTube API Functions
 async function fetchYouTubePlaylist(playlistId) {
 try {
 let allItems = [];
 let nextPageToken = '';
 
 playlistStatus.textContent = 'Fetching playlist...';
 
 do {
 const url = `${YOUTUBE_API_BASE}/playlistItems?part=snippet,contentDetails&maxResults=50&playlistId=${playlistId}&key=${YOUTUBE_API_KEY}${nextPageToken ? '&pageToken=' + nextPageToken : ''}`;
 
 const response = await fetch(url);
 const data = await response.json();
 
 if (data.error) {
 throw new Error(data.error.message || 'Failed to fetch playlist');
 }
 
 allItems = allItems.concat(data.items || []);
 nextPageToken = data.nextPageToken || '';
 
 playlistStatus.textContent = `Fetching... (${allItems.length} videos)`;
 
 } while (nextPageToken);
 
 playlistStatus.textContent = `Fetching video details...`;
 
 const videoIds = allItems.map(item => item.contentDetails.videoId).filter(id => id);
 
 if (videoIds.length === 0) {
 throw new Error('No videos found in playlist');
 }
 
 const videoDetails = [];
 for (let i = 0; i < videoIds.length; i += 50) {
 const batch = videoIds.slice(i, i + 50);
 const detailsUrl = `${YOUTUBE_API_BASE}/videos?part=contentDetails&id=${batch.join(',')}&key=${YOUTUBE_API_KEY}`;
 
 const response = await fetch(detailsUrl);
 const data = await response.json();
 
 if (data.items) {
 videoDetails.push(...data.items);
 }
 
 playlistStatus.textContent = `Processing... (${Math.min(i + 50, videoIds.length)}/${videoIds.length})`;
 }
 
 const durationMap = {};
 videoDetails.forEach(video => {
 durationMap[video.id] = video.contentDetails.duration;
 });
 
 const newSongs = allItems.map(item => {
 const snippet = item.snippet;
 const videoId = item.contentDetails.videoId;
 const duration = durationMap[videoId] || 'PT0S';
 
 return {
 title: snippet.title,
 artist: snippet.videoOwnerChannelTitle || snippet.channelTitle || 'Unknown Artist',
 duration: parseYouTubeDuration(duration),
 albumColor: getRandomColor(),
 source: `https://www.youtube.com/watch?v=${videoId}`,
 sourceType: 'youtube',
 thumbnail: snippet.thumbnails?.maxres?.url || snippet.thumbnails?.high?.url || snippet.thumbnails?.medium?.url || snippet.thumbnails?.default?.url || null,
 videoId: videoId
 };
 }).filter(song => song.title && song.title !== 'Private video' && song.title !== 'Deleted video');
 
 return newSongs;
 
 } catch (error) {
 console.error('YouTube API Error:', error);
 throw error;
 }
 }

 async function importYouTubePlaylist(playlistIdOrUrl, playlistName) {
 const playlistId = extractPlaylistId(playlistIdOrUrl);
 
 if (!playlistId) {
 alert('Invalid playlist URL or ID. Please check and try again.');
 return;
 }
 
 try {
 loadPlaylist.disabled = true;
 loadPlaylistText.innerHTML = '<span class="loading-spinner"></span> Loading...';
 
 const newSongs = await fetchYouTubePlaylist(playlistId);
 
 if (newSongs.length === 0) {
 throw new Error('No valid videos found in playlist');
 }
 
 const newPlaylist = {
 id: Date.now(),
 name: playlistName || `Playlist ${playlists.length + 1}`,
 songs: newSongs,
 youtubePlaylistId: playlistId
 };
 
 playlists.push(newPlaylist);
 currentPlaylistIndex = playlists.length - 1;
 
 // Save to community library
 await saveToLibrary(newPlaylist);
 
 savePlaylists();
 initPlaylistTabs();
 initPlaylist();
 initCarousel();
 
 if (newSongs.length > 0 && playerReady) {
 selectSong(0);
 }
 
 playlistStatus.style.color = '#34C759';
 playlistStatus.textContent = ` Imported ${newSongs.length} songs & shared with community!`;
 
 setTimeout(() => {
 closePlaylistModalFunc();
 }, 2000);
 
 } catch (error) {
 console.error('Import error:', error);
 playlistStatus.style.color = '#FF3B30';
 playlistStatus.textContent = ` Error: ${error.message}`;
 
 loadPlaylist.disabled = false;
 loadPlaylistText.textContent = 'Import & Share';
 }
 }

 // Firebase Library Functions
 async function saveToLibrary(playlist) {
 const libraryEntry = {
 id: playlist.id,
 name: playlist.name,
 youtubePlaylistId: playlist.youtubePlaylistId,
 songs: playlist.songs,
 dateAdded: new Date().toISOString(),
 trackCount: playlist.songs.length,
 thumbnail: playlist.songs[0]?.thumbnail || null
 };
 
 if (firebaseAvailable) {
 try {
 const snapshot = await database.ref('playlists').orderByChild('youtubePlaylistId').equalTo(playlist.youtubePlaylistId).once('value');
 
 if (!snapshot.exists()) {
 await database.ref('playlists').push(libraryEntry);
 console.log(' Playlist saved to Firebase community library!');
 await loadLibrary();
 } else {
 console.log(' Playlist already in community library');
 }
 } catch (e) {
 console.error('Firebase save error:', e);
 saveToLocalStorage(libraryEntry);
 }
 } else {
 saveToLocalStorage(libraryEntry);
 }
 }

 function saveToLocalStorage(libraryEntry) {
 const exists = playlistLibrary.find(p => p.youtubePlaylistId === libraryEntry.youtubePlaylistId);
 if (!exists) {
 playlistLibrary.unshift(libraryEntry);
 localStorage.setItem('playlistLibrary', JSON.stringify(playlistLibrary));
 updateLibraryBadge();
 }
 }

 async function loadLibrary() {
 if (firebaseAvailable) {
 try {
 const snapshot = await database.ref('playlists').orderByChild('dateAdded').once('value');
 playlistLibrary = [];
 
 snapshot.forEach(childSnapshot => {
 playlistLibrary.push(childSnapshot.val());
 });
 
 playlistLibrary.reverse();
 console.log(` Loaded ${playlistLibrary.length} playlists from Firebase`);
 updateLibraryBadge();
 } catch (e) {
 console.error('Firebase load error:', e);
 loadFromLocalStorage();
 }
 } else {
 loadFromLocalStorage();
 }
 }

 function loadFromLocalStorage() {
 try {
 const saved = localStorage.getItem('playlistLibrary');
 if (saved) {
 playlistLibrary = JSON.parse(saved);
 console.log(` Loaded ${playlistLibrary.length} playlists from localStorage`);
 }
 updateLibraryBadge();
 } catch (e) {
 console.error('Error loading library:', e);
 updateLibraryBadge();
 }
 }

 function updateLibraryBadge() {
 const count = playlistLibrary.length;
 libraryBadge.textContent = count > 0 ? `(${count} available)` : '(Empty)';
 }

 function openLibraryModal() {
 libraryModalOverlay.classList.add('active');
 renderLibrary();
 }

 function closeLibraryModalFunc() {
 libraryModalOverlay.classList.remove('active');
 }

 function renderLibrary() {
 if (playlistLibrary.length === 0) {
 libraryModalBody.innerHTML = `
 <div class="library-empty">
 <div class="library-empty-icon"></div>
 <div class="library-empty-text">
 No playlists in community library yet.<br>
 Import a YouTube playlist to get started!<br><br>
 ${firebaseAvailable ? '<strong style="color: #43e97b;"> Firebase Connected</strong> - Your imports are shared with everyone!' : '<strong style="color: #ff9500;"> Using Local Storage</strong> - Enable Firebase for cross-device sharing'}
 </div>
 </div>
 `;
 return;
 }
 
 const grid = document.createElement('div');
 grid.className = 'library-grid';
 
 playlistLibrary.forEach(playlist => {
 const card = document.createElement('div');
 card.className = 'library-card';
 
 const date = new Date(playlist.dateAdded);
 const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
 
 card.innerHTML = `
 <div class="library-card-image">
 ${playlist.thumbnail ? `<img src="${playlist.thumbnail}" alt="${playlist.name}">` : ''}
 <div class="library-card-badge">${playlist.trackCount} tracks</div>
 </div>
 <div class="library-card-content">
 <div class="library-card-title">${playlist.name}</div>
 <div class="library-card-meta">
 <div class="library-card-tracks"> ${playlist.trackCount} songs</div>
 <div class="library-card-date">${dateStr}</div>
 </div>
 <div class="library-card-actions">
 <button class="library-add-btn" data-playlist-id="${playlist.id}">
 <span>+</span>
 <span>Add to Player</span>
 </button>
 </div>
 </div>
 `;
 
 grid.appendChild(card);
 });
 
 libraryModalBody.innerHTML = '';
 libraryModalBody.appendChild(grid);
 
 document.querySelectorAll('.library-add-btn').forEach(btn => {
 btn.addEventListener('click', (e) => {
 const playlistId = parseInt(e.currentTarget.getAttribute('data-playlist-id'));
 addFromLibrary(playlistId);
 });
 });
 }

 function addFromLibrary(playlistId) {
 const libraryPlaylist = playlistLibrary.find(p => p.id === playlistId);
 
 if (libraryPlaylist) {
 const newPlaylist = {
 id: Date.now(),
 name: libraryPlaylist.name,
 songs: JSON.parse(JSON.stringify(libraryPlaylist.songs)),
 youtubePlaylistId: libraryPlaylist.youtubePlaylistId
 };
 
 playlists.push(newPlaylist);
 currentPlaylistIndex = playlists.length - 1;
 
 savePlaylists();
 initPlaylistTabs();
 initPlaylist();
 initCarousel();
 
 if (newPlaylist.songs.length > 0 && playerReady) {
 selectSong(0);
 }
 
 closeLibraryModalFunc();
 
 alert(` Added "${libraryPlaylist.name}" with ${libraryPlaylist.trackCount} songs!\n\n No API calls needed - loaded from community library!`);
 }
 }

 // Carousel Functions
 function initCarousel() {
 const songs = getCurrentSongs();
 
 if (songs.length === 0) {
 carouselSection.style.display = 'none';
 return;
 }
 
 carouselSection.style.display = 'block';
 carouselTrack.innerHTML = '';
 carouselOffset = 0;
 
 songs.forEach((song, index) => {
 const item = document.createElement('div');
 item.className = `carousel-item ${index === currentSongIndex ? 'playing active' : ''}`;
 
 const thumbContent = song.thumbnail 
 ? `<img src="${song.thumbnail}" alt="${song.title}">`
 : `<div class="playlist-thumb-placeholder">${(song.artist || 'U').charAt(0)}</div>`;
 
 item.innerHTML = `
 <div class="carousel-thumb">
 ${thumbContent}
 </div>
 <div class="carousel-info">
 <div class="carousel-title">
 ${song.title}
 ${index === currentSongIndex ? '<span class="carousel-playing-badge">Playing</span>' : ''}
 </div>
 <div class="carousel-artist">${song.artist}</div>
 </div>
 <div class="carousel-duration">${song.duration}</div>
 `;
 
 item.addEventListener('click', () => selectSong(index));
 carouselTrack.appendChild(item);
 });
 
 scrollCarouselToActive();
 }

 function scrollCarouselToActive() {
 const items = carouselTrack.querySelectorAll('.carousel-item');
 const activeIndex = currentSongIndex;
 
 const itemWidth = items[0]?.offsetWidth || 0;
 const gap = 10;
 const offset = Math.max(0, (activeIndex - 1) * (itemWidth + gap));
 
 carouselOffset = -offset;
 carouselTrack.style.transform = `translateX(${carouselOffset}px)`;
 }

 function scrollCarousel(direction) {
 const items = carouselTrack.querySelectorAll('.carousel-item');
 if (items.length === 0) return;
 
 const itemWidth = items[0].offsetWidth;
 const gap = 10;
 const step = itemWidth + gap;
 
 if (direction === 'prev') {
 carouselOffset = Math.min(0, carouselOffset + step);
 } else {
 const maxOffset = -(items.length - 3) * step;
 carouselOffset = Math.max(maxOffset, carouselOffset - step);
 }
 
 carouselTrack.style.transform = `translateX(${carouselOffset}px)`;
 }

 // Playlist Management
 function getCurrentPlaylist() {
 return playlists[currentPlaylistIndex] || { songs: [] };
 }

 function getCurrentSongs() {
 return getCurrentPlaylist().songs || [];
 }

 function initPlaylistTabs() {
 playlistTabsContainer.innerHTML = '';
 
 playlists.forEach((playlist, index) => {
 const tab = document.createElement('div');
 tab.className = `playlist-tab ${index === currentPlaylistIndex ? 'active' : ''}`;
 
 const tabName = document.createElement('span');
 tabName.textContent = playlist.name;
 tab.appendChild(tabName);
 
 if (playlists.length > 1) {
 const deleteBtn = document.createElement('span');
 deleteBtn.className = 'playlist-tab-delete';
 deleteBtn.innerHTML = '';
 deleteBtn.addEventListener('click', (e) => {
 e.stopPropagation();
 deletePlaylist(index);
 });
 tab.appendChild(deleteBtn);
 }
 
 tab.addEventListener('click', () => switchPlaylist(index));
 playlistTabsContainer.appendChild(tab);
 });
 }

 function switchPlaylist(index) {
 if (index === currentPlaylistIndex) return;
 
 if (player && player.stopVideo) {
 player.stopVideo();
 }
 
 currentPlaylistIndex = index;
 currentSongIndex = 0;
 isPlaying = false;
 playIcon.style.display = 'block';
 pauseIcon.style.display = 'none';
 updateAllPlayButtons('play');
 updateVisualizerState();
 
 initPlaylistTabs();
 initPlaylist();
 initCarousel();
 
 const songs = getCurrentSongs();
 if (songs.length > 0 && playerReady) {
 selectSong(0);
 } else {
 showEmptyState();
 }
 }

 function deletePlaylist(index) {
 if (playlists.length === 1) {
 alert('Cannot delete the last playlist!');
 return;
 }
 
 if (confirm(`Delete playlist "${playlists[index].name}"?`)) {
 playlists.splice(index, 1);
 
 if (currentPlaylistIndex >= playlists.length) {
 currentPlaylistIndex = playlists.length - 1;
 }
 
 savePlaylists();
 initPlaylistTabs();
 initPlaylist();
 initCarousel();
 
 const songs = getCurrentSongs();
 if (songs.length > 0 && playerReady) {
 selectSong(0);
 } else {
 showEmptyState();
 }
 }
 }

 function showEmptyState() {
 songTitle.textContent = 'No Tracks';
 artistName.textContent = 'Import a playlist to begin';
 totalTimeEl.textContent = '0:00';
 currentTimeEl.textContent = '0:00';
 progressFill.style.width = '0%';
 carouselSection.style.display = 'none';
 
 playlistContainer.innerHTML = `
 <div class="empty-state">
 <div class="empty-state-icon"></div>
 <div class="empty-state-text">
 Click "Import YouTube Playlist" to add songs<br>
 or browse the Community Library for instant access!
 </div>
 </div>
 `;
 playlistCount.textContent = '0 songs';
 }

 // Playlist Display
 function initPlaylist() {
 const songs = getCurrentSongs();
 playlistContainer.innerHTML = '';
 
 if (songs.length === 0) {
 showEmptyState();
 return;
 }
 
 playlistCount.textContent = `${songs.length} song${songs.length !== 1 ? 's' : ''}`;
 
 songs.forEach((song, index) => {
 const item = document.createElement('div');
 item.className = `playlist-item ${index === currentSongIndex ? 'active' : ''}`;
 
 const thumbContent = song.thumbnail 
 ? `<img src="${song.thumbnail}" alt="${song.title}">`
 : `<div class="playlist-thumb-placeholder">${(song.artist || 'U').charAt(0)}</div>`;
 
 item.innerHTML = `
 <div class="playlist-thumb">
 ${thumbContent}
 </div>
 <div class="playlist-info">
 <div class="playlist-title">${song.title}</div>
 <div class="playlist-artist">${song.artist}</div>
 </div>
 <div class="playlist-duration">${song.duration}</div>
 `;
 
 item.addEventListener('click', () => selectSong(index));
 playlistContainer.appendChild(item);
 });
 }

 function selectSong(index) {
 const songs = getCurrentSongs();
 if (songs.length === 0 || !playerReady) return;
 
 currentSongIndex = index;
 const song = songs[currentSongIndex];
 
 songTitle.textContent = song.title;
 artistName.textContent = song.artist;
 
 // Update floating and sticky displays
 updateFloatingPlayerInfo();
 updateStickyControlsInfo();
 
 // Setup Media Session for native mobile controls
 setupMediaSession();
 
 document.querySelectorAll('.playlist-item').forEach((item, i) => {
 item.classList.toggle('active', i === currentSongIndex);
 });
 
 document.querySelectorAll('.carousel-item').forEach((item, i) => {
 item.classList.remove('playing', 'active');
 if (i === currentSongIndex) {
 item.classList.add('playing', 'active');
 const badge = item.querySelector('.carousel-playing-badge');
 if (!badge) {
 const titleDiv = item.querySelector('.carousel-title');
 titleDiv.innerHTML += '<span class="carousel-playing-badge">Playing</span>';
 }
 } else {
 const badge = item.querySelector('.carousel-playing-badge');
 if (badge) badge.remove();
 }
 });
 
 scrollCarouselToActive();
 
 if (song.videoId && player && player.loadVideoById) {
 player.loadVideoById(song.videoId);
 progressFill.style.width = '0%';
 currentTimeEl.textContent = '0:00';
 totalTimeEl.textContent = song.duration;
 }
 }

 // Playback Controls
 function togglePlay() {
 const songs = getCurrentSongs();
 if (songs.length === 0 || !playerReady) return;
 
 if (isPlaying) {
 pause();
 } else {
 play();
 }
 }

 function play() {
 if (player && player.playVideo) {
 player.playVideo();
 }
 }

 function pause() {
 if (player && player.pauseVideo) {
 player.pauseVideo();
 }
 }

 function handleSongEnd() {
 const songs = getCurrentSongs();
 
 if (repeatMode === 2) {
 play();
 } else if (repeatMode === 1 || currentSongIndex < songs.length - 1) {
 nextSong();
 } else {
 isPlaying = false;
 playIcon.style.display = 'block';
 pauseIcon.style.display = 'none';
 updateAllPlayButtons('play');
 updateVisualizerState();
 }
 }

 function prevSong() {
 const songs = getCurrentSongs();
 if (songs.length === 0) return;
 
 if (player && player.getCurrentTime && player.getCurrentTime() > 3) {
 player.seekTo(0);
 } else {
 currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length;
 selectSong(currentSongIndex);
 if (isPlaying) play();
 }
 }

 function nextSong() {
 const songs = getCurrentSongs();
 if (songs.length === 0) return;
 
 if (isShuffled) {
 let newIndex;
 do {
 newIndex = Math.floor(Math.random() * songs.length);
 } while (newIndex === currentSongIndex && songs.length > 1);
 currentSongIndex = newIndex;
 } else {
 currentSongIndex = (currentSongIndex + 1) % songs.length;
 }
 selectSong(currentSongIndex);
 if (isPlaying) play();
 }

 function toggleShuffle() {
 isShuffled = !isShuffled;
 shuffleBtn.classList.toggle('active', isShuffled);
 }

 function toggleRepeat() {
 repeatMode = (repeatMode + 1) % 3;
 repeatBtn.classList.toggle('active', repeatMode > 0);
 
 if (repeatMode === 2) {
 repeatBtn.innerHTML = `
 <svg viewBox="0 0 24 24" fill="currentColor">
 <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/>
 <text x="12" y="16" text-anchor="middle" font-size="8" font-weight="bold" fill="currentColor">1</text>
 </svg>
 `;
 } else {
 repeatBtn.innerHTML = `
 <svg viewBox="0 0 24 24" fill="currentColor">
 <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/>
 </svg>
 `;
 }
 }

 function seekTo(event) {
 if (!player || !player.getDuration) return;
 
 const duration = player.getDuration();
 if (duration === 0) return;
 
 const rect = progressBar.getBoundingClientRect();
 const clickX = event.clientX - rect.left;
 const percentage = clickX / rect.width;
 const seekTime = percentage * duration;
 
 player.seekTo(seekTime);
 }

 function toggleMute() {
 isMuted = !isMuted;
 volumeIcon.style.display = isMuted ? 'none' : 'block';
 muteIcon.style.display = isMuted ? 'block' : 'none';
 volumeFill.style.width = isMuted ? '0%' : volume + '%';
 
 if (player && player.setVolume) {
 if (isMuted) {
 player.mute();
 } else {
 player.unMute();
 }
 }
 }

 function adjustVolume(event) {
 const rect = volumeSlider.getBoundingClientRect();
 const clickX = event.clientX - rect.left;
 volume = (clickX / rect.width) * 100;
 volumeFill.style.width = volume + '%';
 
 if (player && player.setVolume) {
 player.setVolume(volume);
 }
 
 if (volume > 0 && isMuted) {
 isMuted = false;
 volumeIcon.style.display = 'block';
 muteIcon.style.display = 'none';
 if (player && player.unMute) {
 player.unMute();
 }
 }
 }

 // Modal Functions
 function openPlaylistModal() {
 playlistModalOverlay.classList.add('active');
 playlistUrlInput.value = '';
 playlistNameInput.value = '';
 playlistStatus.textContent = '';
 loadPlaylist.disabled = false;
 loadPlaylistText.textContent = 'Import & Share';
 }

 function closePlaylistModalFunc() {
 playlistModalOverlay.classList.remove('active');
 }

 // LocalStorage
 function savePlaylists() {
 localStorage.setItem('universalMusicPlayerPlaylists', JSON.stringify(playlists));
 }

 function loadPlaylists() {
 try {
 const saved = localStorage.getItem('universalMusicPlayerPlaylists');
 if (saved) {
 playlists = JSON.parse(saved);
 }
 } catch (e) {
 console.error('Error loading playlists:', e);
 }
 
 if (playlists.length === 0) {
 playlists = [{
 id: Date.now(),
 name: 'My Playlist',
 songs: []
 }];
 }
 }

 // Event Listeners - Main Controls
 playPauseBtn.addEventListener('click', togglePlay);
 prevBtn.addEventListener('click', prevSong);
 nextBtn.addEventListener('click', nextSong);
 shuffleBtn.addEventListener('click', toggleShuffle);
 repeatBtn.addEventListener('click', toggleRepeat);
 progressBar.addEventListener('click', seekTo);
 volumeBtn.addEventListener('click', toggleMute);
 volumeSlider.addEventListener('click', adjustVolume);
 
 // Event Listeners - Floating Player
 floatingPlayerBtn.addEventListener('click', toggleFloatingPlayer);
 closeFloatingPlayer.addEventListener('click', toggleFloatingPlayer);
 popoutWindowBtn.addEventListener('click', openPopoutWindow);
 floatingPlayPauseBtn.addEventListener('click', togglePlay);
 floatingPrevBtn.addEventListener('click', prevSong);
 floatingNextBtn.addEventListener('click', nextSong);
 
 // Event Listeners - Sticky Controls
 stickyPlayPauseBtn.addEventListener('click', togglePlay);
 stickyPrevBtn.addEventListener('click', prevSong);
 stickyNextBtn.addEventListener('click', nextSong);
 
 // Event Listeners - Carousel
 carouselPrev.addEventListener('click', () => scrollCarousel('prev'));
 carouselNext.addEventListener('click', () => scrollCarousel('next'));
 
 // Event Listeners - Library
 libraryBtn.addEventListener('click', openLibraryModal);
 closeLibraryModal.addEventListener('click', closeLibraryModalFunc);
 libraryModalOverlay.addEventListener('click', (e) => {
 if (e.target === libraryModalOverlay) closeLibraryModalFunc();
 });
 
 // Event Listeners - Import
 importPlaylistBtn.addEventListener('click', openPlaylistModal);
 addPlaylistBtn.addEventListener('click', openPlaylistModal);
 closePlaylistModal.addEventListener('click', closePlaylistModalFunc);
 cancelPlaylist.addEventListener('click', closePlaylistModalFunc);
 loadPlaylist.addEventListener('click', () => {
 const url = playlistUrlInput.value.trim();
 const name = playlistNameInput.value.trim();
 if (url) {
 importYouTubePlaylist(url, name);
 } else {
 alert('Please enter a playlist URL or ID');
 }
 });
 
 playlistModalOverlay.addEventListener('click', (e) => {
 if (e.target === playlistModalOverlay) closePlaylistModalFunc();
 });
 
 playlistUrlInput.addEventListener('keypress', (e) => {
 if (e.key === 'Enter') loadPlaylist.click();
 });

 // Global API
 window.musicPlayer = {
 getPlaylists: () => playlists,
 getLibrary: () => playlistLibrary,
 getCurrentPlaylist: getCurrentPlaylist,
 getSongs: getCurrentSongs,
 getCurrentSong: () => getCurrentSongs()[currentSongIndex],
 importYouTubePlaylist: (url, name) => importYouTubePlaylist(url, name),
 switchPlaylist: switchPlaylist,
 deletePlaylist: deletePlaylist,
 play: play,
 pause: pause,
 next: nextSong,
 prev: prevSong,
 toggleFloatingPlayer: toggleFloatingPlayer,
 getSettings: () => settings,
 updateSettings: (newSettings) => {
 settings = {...settings, ...newSettings};
 saveSettings();
 applySettings();
 }
 };

 // Initialize
 loadMood();
 loadSettings();
 createParticles();
 setupDragging();
 
 loadLibrary().then(() => {
 loadPlaylists();
 initPlaylistTabs();
 initPlaylist();
 initCarousel();

 if (getCurrentSongs().length === 0) {
 showEmptyState();
 }

 console.log('%c Universal Music Player Pro - Enhanced', 'font-size: 20px; font-weight: bold; color: #667eea');
 console.log(`%c${firebaseAvailable ? ' Firebase Connected' : ' Firebase Unavailable - Using localStorage'}`, 'font-size: 14px; color: ' + (firebaseAvailable ? '#43e97b' : '#ff9500'));
 console.log(`%c ${playlistLibrary.length} playlists in ${firebaseAvailable ? 'community' : 'local'} library`, 'font-size: 14px; color: #764ba2');
 console.log('%c 20 Moods with Animated Effects |  Music Visualizer |  Settings Panel |  Enhanced Floating Player', 'font-size: 14px; color: #667eea');
 });
 </script>
</body>
</html>
